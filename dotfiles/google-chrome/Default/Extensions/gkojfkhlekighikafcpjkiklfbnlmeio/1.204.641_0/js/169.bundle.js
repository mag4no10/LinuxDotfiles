// LICENSE_CODE ZON
(self["webpackChunk"]=self["webpackChunk"]||[]).push([[169],{2169:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var underscore__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(7439);var underscore__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(underscore__WEBPACK_IMPORTED_MODULE_0__);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(6969);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1__);var _util_etask_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(6386);var _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_util_etask_js__WEBPACK_IMPORTED_MODULE_2__);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(7345);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3__);var _bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(8552);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(9824);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(_util_zerr_js__WEBPACK_IMPORTED_MODULE_5__);var _util_url_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(5305);var _util_url_js__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(_util_url_js__WEBPACK_IMPORTED_MODULE_6__);var _bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(1211);var _bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_7__);var _util_escape_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(4336);var _util_escape_js__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(_util_escape_js__WEBPACK_IMPORTED_MODULE_8__);var _util_version_util_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(6262);var _util_version_util_js__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(_util_version_util_js__WEBPACK_IMPORTED_MODULE_9__);var _util_storage_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(8915);var _util_storage_js__WEBPACK_IMPORTED_MODULE_10___default=__webpack_require__.n(_util_storage_js__WEBPACK_IMPORTED_MODULE_10__);var _util_ajax_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(918);var _util_ajax_js__WEBPACK_IMPORTED_MODULE_11___default=__webpack_require__.n(_util_ajax_js__WEBPACK_IMPORTED_MODULE_11__);var _util_util_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(1291);var _util_util_js__WEBPACK_IMPORTED_MODULE_12___default=__webpack_require__.n(_util_util_js__WEBPACK_IMPORTED_MODULE_12__);var _util_date_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(932);var _util_date_js__WEBPACK_IMPORTED_MODULE_13___default=__webpack_require__.n(_util_date_js__WEBPACK_IMPORTED_MODULE_13__);var _util_string_js__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(5516);var _util_string_js__WEBPACK_IMPORTED_MODULE_14___default=__webpack_require__.n(_util_string_js__WEBPACK_IMPORTED_MODULE_14__);var _bext_pub_ga_js__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(5974);var _bext_pub_ga_js__WEBPACK_IMPORTED_MODULE_15___default=__webpack_require__.n(_bext_pub_ga_js__WEBPACK_IMPORTED_MODULE_15__);var _bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(4130);var _bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_16___default=__webpack_require__.n(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_16__);var _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(9651);var _bext_vpn_bg_icon_js__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(8084);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(3727);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default=__webpack_require__.n(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19__);var _bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(8076);var _bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__(9265);var _bext_vpn_bg_dev_mode_js__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__(1679);var _bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__(7666);var _bext_vpn_bg_ccgi_js__WEBPACK_IMPORTED_MODULE_24__=__webpack_require__(7362);var _bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_25__=__webpack_require__(3886);var _svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_26__=__webpack_require__(2227);var _svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_26___default=__webpack_require__.n(_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_26__);var _bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_27__=__webpack_require__(6210);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_28__=__webpack_require__(5250);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_28___default=__webpack_require__.n(_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_28__);var _bext_vpn_util_no_log_js__WEBPACK_IMPORTED_MODULE_29__=__webpack_require__(2181);var _bext_vpn_bg_mode_js__WEBPACK_IMPORTED_MODULE_30__=__webpack_require__(1002);var _bext_vpn_bg_tpopup_js__WEBPACK_IMPORTED_MODULE_31__=__webpack_require__(4968);var conf__WEBPACK_IMPORTED_MODULE_32__=__webpack_require__(9641);var _bext_vpn_bg_bext_config_js__WEBPACK_IMPORTED_MODULE_33__=__webpack_require__(39);var _bext_vpn_bg_bext_config_js__WEBPACK_IMPORTED_MODULE_33___default=__webpack_require__.n(_bext_vpn_bg_bext_config_js__WEBPACK_IMPORTED_MODULE_33__);var _bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_34__=__webpack_require__(5371);var _bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_34___default=__webpack_require__.n(_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_34__);var cookie__WEBPACK_IMPORTED_MODULE_35__=__webpack_require__(9813);var cookie__WEBPACK_IMPORTED_MODULE_35___default=__webpack_require__.n(cookie__WEBPACK_IMPORTED_MODULE_35__);var _bext_vpn_bg_ui_api_js__WEBPACK_IMPORTED_MODULE_36__=__webpack_require__(9370);var _bext_vpn_bg_pac_engine_js__WEBPACK_IMPORTED_MODULE_37__=__webpack_require__(1225);var _bext_vpn_bg_pac_engine_js__WEBPACK_IMPORTED_MODULE_37___default=__webpack_require__.n(_bext_vpn_bg_pac_engine_js__WEBPACK_IMPORTED_MODULE_37__);var _bext_vpn_bg_start_worker_js__WEBPACK_IMPORTED_MODULE_38__=__webpack_require__(2955);
// LICENSE_CODE ZON
const v3=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().is_v3;_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_28___default().assert_bg("be_bg_main");if(!_util_util_js__WEBPACK_IMPORTED_MODULE_12___default().is_mocha())_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default().set_zerr(_util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default());_util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default().set_exception_handler("be",((id,info,err)=>_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().perr(id,info,{err})));_util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default().on_unhandled_exception=function(err){_util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default()("unhandled_exception %s",err&&err.stack);_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().perr("unhandled_exception",{},{err,rate_limit:{count:2}})};const chrome=self.chrome;const assign=Object.assign;const browser=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().browser();const mem_leak_period=3*_util_date_js__WEBPACK_IMPORTED_MODULE_13___default().ms.SEC;let last_use;let new_uuid,reused_uuid;const on_install=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*(){E.install_ts=+self.hola.t.l_start||_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_4__["default"].now();yield persist_param("install_ts",E.install_ts);yield persist_param("install_version",_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().version());_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default().set("install_version",_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().version());_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default().set("install_ts",E.install_ts);send_install_perr()}));const E=new(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1___default().model.extend({model_name:"bg_main",_defaults:function(){this.on("install",on_install);this.on("update",on_update);this.on("up",on_up);this.on("destroy",(()=>E.uninit()));this.set("ver",conf__WEBPACK_IMPORTED_MODULE_32__.version);self.addEventListener("unload",(()=>E._destroy()))}}));E.be_util=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default();E.zerr=self.hola.zerr=_util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default();E.be_browser=_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_7___default();E.be_tabs=_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_16___default();E.tabs=_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_16___default();E.be_ext=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default();E.be_vpn=_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_25__.Z;E.etask=_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default();E.unblocker_lib=_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_26___default();E.be_info=_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_27__["default"];E.pac_engine=_bext_vpn_bg_pac_engine_js__WEBPACK_IMPORTED_MODULE_37___default();E.be_rule=_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_20__.Z;E.be_premium=_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_21__["default"];E.be_mode=_bext_vpn_bg_mode_js__WEBPACK_IMPORTED_MODULE_30__.Z;E.be_trial=_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_23__["default"];E.be_tpopup=_bext_vpn_bg_tpopup_js__WEBPACK_IMPORTED_MODULE_31__.Z;E.be_util.rmt=E;function get_post_install_url(){return _util_escape_js__WEBPACK_IMPORTED_MODULE_8___default().uri(_bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_17__.Z.hola_url()+"/access/install",{ext_ver:_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().version(),uuid:E.get("uuid")})}const set_aff_id=val=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*(){if(!val)return;E.set("aff_id",val);yield persist_param("aff_id",val)}));const send_install_ga=install_src=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function(){E.ga_send("checkout",{step:3,option:install_src})}));const get_ga_info=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({cancel:true},(function*_get_ga_info(){let _ga=yield _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_28___default().get_hola_cookie("_ga");let aff_id=yield _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_28___default().get_hola_cookie("aff_id");let gclid=yield _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_28___default().get_hola_cookie("gclid");let cid;if(_ga)cid=(_ga.match(/(\d+\.\d+)$/)||{})[0];return cid&&{cid,gclid,aff_id}}));const wait_for_ga=timeout=>{let spent=0;return _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()["for"](null,(()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default().sleep(1e3)),(function*_wait_for_ga(){spent++;const info=yield get_ga_info();if(info){_bext_pub_ga_js__WEBPACK_IMPORTED_MODULE_15___default().init("UA-36775596-1",{cid:info.cid,gclid:info.gclid,cm:info.gclid&&"cpc",cs:info.gclid&&"google",cd5:info.aff_id});E.set("ga_inited",true);return this.break()}if(spent==timeout){E.set("ga_failed",true);return this.break()}}))};const init_ga=()=>{if(!E.get("agree_ts")||init_ga.init)return;init_ga.init=true;let prev_uuid;const done=()=>{let uuid;if(!(uuid=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default().get("uuid"))||uuid==prev_uuid)return;prev_uuid=uuid;wait_for_ga(20)};E.listen_to(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default(),"change:uuid",done);done()};const get_active_test_from_cookies=ui_testing=>{try{ui_testing=JSON.parse(decodeURIComponent(ui_testing))}catch(e){ui_testing={}}const tests_ids=Object.keys(ui_testing);let active_test,active_test_name,active_value;tests_ids.forEach((test=>{if(/_conf$/.test(test)){const cfg=ui_testing[test];const value=typeof cfg=="object"?cfg.on:cfg;if(value>0&&value<1){active_test=test.replace("_conf","");active_test_name=typeof cfg=="object"&&cfg.name||active_test;active_value=ui_testing[active_test]}}}));return{active_test,active_value,active_test_name}};const send_install_perr=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*_send_install_perr(){if(!E.install_ts||!E.get("agree_ts")||E.install_perr_ts||!_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_21__["default"].get("updated")){return}const now=_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_4__["default"].now(),url=get_post_install_url();let info={};const cookies=yield _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_28___default().get_hola_cookies(["ui_testing","post_install","be_usage","aff_id","ext_ref","install_src"]);const ui_test=get_active_test_from_cookies(cookies.ui_testing);const{post_install,aff_id,ext_ref,install_src}=cookies;if(post_install){try{_bext_vpn_bg_tpopup_js__WEBPACK_IMPORTED_MODULE_31__.Z.set("post_install_redirect",JSON.parse(decodeURIComponent(post_install)).redirect_url)}catch(e){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().perr("be_post_install_parse_err",{post_install},{err:e})}}E.install_perr_ts=now;if(!_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().browser_guess.hola_browser){_util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default().notice("open post insall page %s",url);_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_4__["default"].open_hola_tab({url,force_active:true})}if(_util_util_js__WEBPACK_IMPORTED_MODULE_12___default().get(chrome,"runtime.getManifest"))info=_util_util_js__WEBPACK_IMPORTED_MODULE_12___default().pick(chrome.runtime.getManifest(),"permissions");_util_util_js__WEBPACK_IMPORTED_MODULE_12___default().if_set(new_uuid,info,"new_uuid");_util_util_js__WEBPACK_IMPORTED_MODULE_12___default().if_set(reused_uuid,info,"reused_uuid");if(cookies.be_usage){try{info.be_usage=JSON.parse(decodeURIComponent(cookies.be_usage))}catch(e){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().perr("be_usage_parse_err",{},{err:e})}}yield set_aff_id(aff_id);send_install_ga(install_src);const build={};if(ui_test)build[ui_test.active_test_name]=ui_test.active_value;const perr_opt=assign({aff_id,install_src,build,ext_ref},info);_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().perr("install",perr_opt);_util_storage_js__WEBPACK_IMPORTED_MODULE_10___default().set("install_perr_ts",now)}));E.t={get_post_install_url,send_install_perr};let step2act={3:"Finished Installing Extension",5:"Extension Clicked Plus"};E.ga_send=(type,opt)=>{if(E.get("ga_failed"))return;let cb=()=>{switch(type){case"event":_bext_pub_ga_js__WEBPACK_IMPORTED_MODULE_15___default().event(opt.cat,opt.act,opt.lab,opt.val);break;case"checkout":_bext_pub_ga_js__WEBPACK_IMPORTED_MODULE_15___default().ec_checkout(opt.step,opt.option,opt.act||step2act[opt.step],opt.lab);break;case"impression_view":_bext_pub_ga_js__WEBPACK_IMPORTED_MODULE_15___default().ec_impression_view(opt.list,opt.products);break;default:return}};if(E.get("ga_inited"))cb();else E.once("change:ga_inited",cb)};function on_update(prev){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().perr("update",prev+" > "+_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().version());let ts=self.hola.t.l_start;persist_param("update_ts",ts);_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default().set("update_ts",ts)}function on_up(){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().perr("up")}function ccgi_init(){_bext_vpn_bg_ccgi_js__WEBPACK_IMPORTED_MODULE_24__.Z.init(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default());chrome.tabs.query({url:conf__WEBPACK_IMPORTED_MODULE_32__.hola_match},(tabs=>underscore__WEBPACK_IMPORTED_MODULE_0___default().each(tabs,(tab=>{try{if(v3){chrome.scripting.executeScript({target:{tabId:tab.id},files:["/js/bext/vpn/bg/cs_hola.js"]})}else{chrome.tabs.executeScript(tab.id,{file:"/js/bext/vpn/bg/cs_hola.js",runAt:"document_start"})}}catch(e){}}))))}function get_uuid(){return _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({name:"get_uuid",cancel:true},(function*(){try{const ret=yield _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default().all({allow_fail:true},{local:_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_4__["default"].storage_local_get("uuid"),localStorage:_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*get_uuid_local_storage_(){return v3?null:yield localStorage.getItem("uuid")})),cookie:_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*(){return yield cookie__WEBPACK_IMPORTED_MODULE_35___default().get("uuid")})),ccgi:_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default().cb_apply(!_util_util_js__WEBPACK_IMPORTED_MODULE_12___default().is_mocha()&&chrome.cookies,".get",[{url:conf__WEBPACK_IMPORTED_MODULE_32__.url_ccgi,name:"uuid"}])});get_uuid.last_error=collect_errors(ret);const uuid=_util_util_js__WEBPACK_IMPORTED_MODULE_12___default().get(ret,"local.uuid")||ret.localStorage||ret.cookie||_util_util_js__WEBPACK_IMPORTED_MODULE_12___default().get(ret,"ccgi.value");if(!uuid)return;_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_28___default().assert(typeof uuid=="string"&&uuid.length>=8,new Error("invalid_uuid"));if(uuid!=_util_util_js__WEBPACK_IMPORTED_MODULE_12___default().get(ret,"local.uuid")||uuid!=ret.localStorage||uuid!=ret.cookie||uuid!=_util_util_js__WEBPACK_IMPORTED_MODULE_12___default().get(ret,"ccgi.value")){reused_uuid=true}return uuid}catch(e){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().perr("unreachable","get_uuid",{err:e})}}))}let get_param_errors={};const get_param=(name,read_cookies)=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*_get_param(){try{const ret=yield _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default().all({allow_fail:true},{local:_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_4__["default"].storage_local_get(name),local_storage:v3?null:_util_storage_js__WEBPACK_IMPORTED_MODULE_10___default().get(name),cookie:read_cookies&&_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*(){return yield cookie__WEBPACK_IMPORTED_MODULE_35___default().get(name)})),ccgi:read_cookies&&_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default().cb_apply(!_util_util_js__WEBPACK_IMPORTED_MODULE_12___default().is_mocha()&&chrome.cookies,".get",[{url:conf__WEBPACK_IMPORTED_MODULE_32__.url_ccgi,name}])});get_param_errors[name]=collect_errors(ret);const ext_storage_value=_util_util_js__WEBPACK_IMPORTED_MODULE_12___default().get(ret,["local",name]);const res_value=ext_storage_value||ret.local_storage||ret.cookie||_util_util_js__WEBPACK_IMPORTED_MODULE_12___default().get(ret,"ccgi.value");if(res_value&&!ext_storage_value){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().perr("persist_param_in_ext_storage",{[name]:res_value});persist_param(name,res_value)}return res_value}catch(e){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().perr("unreachable",`get_${name}`,{err:e})}}));let persist_param_errors={};function persist_param(name,value,set_cookie){return _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({name:`persist_${name}`},(function*(){try{const ret=yield _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default().all({allow_fail:true},{local:_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_4__["default"].storage_local_set({[name]:value}),localStorage:_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*persist_param_ls_(){if(!v3)yield localStorage.setItem(name,value)})),cookie:set_cookie&&_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*persist_param_cookie_(){yield cookie__WEBPACK_IMPORTED_MODULE_35___default().set(name,value,{expires:36500,path:"/"})}))});persist_param_errors[name]=collect_errors(ret);return underscore__WEBPACK_IMPORTED_MODULE_0___default().isEmpty(ret)}catch(e){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().perr("unreachable",`persist_${name}`,{err:e})}}))}function collect_errors(ret){var arr=[];underscore__WEBPACK_IMPORTED_MODULE_0___default().each(ret,((v,k)=>{if(!_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default().is_err(v))return;var e={};e[k]=""+v.error;arr.push(e)}));return arr}E.gen_uuid=()=>{var buf=new Uint8Array(16),uuid="";self.crypto.getRandomValues(buf);for(var i=0;i<buf.length;i++)uuid+=(buf[i]<=15?"0":"")+buf[i].toString(16);return uuid};function ensure_uuid(){let uuid;return _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({name:"ensure_uuid",cancel:true},(function*ensure_uuid_(){let _uuid=yield get_uuid();if(_uuid){E.sp.spawn(persist_param("uuid",_uuid,true));return this.return(_uuid)}new_uuid=true;_uuid=yield E.gen_uuid();_util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default().assert(_uuid,"gen_uuid() returned: "+_uuid);const ret=yield persist_param("uuid",uuid=_uuid,true);if(ret){uuid="t."+uuid.substr(2);_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().perr("init_tmp_uuid",{uuid},{err:true});return this.return(uuid)}_uuid=yield get_uuid();if(uuid!=_uuid)_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().perr("uuid_storage_set_err",{uuid,_uuid});return uuid}))}const fixup_storage=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*(){if(_util_util_js__WEBPACK_IMPORTED_MODULE_12___default().is_mocha())return;let install_ver=yield get_param("install_version");if(!install_ver||!_util_version_util_js__WEBPACK_IMPORTED_MODULE_9___default().valid(install_ver)){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().perr("be_fixup_install_ver",{install_ver});yield persist_param("install_version",_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().version());_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default().set("install_version",_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().version())}let install_ts=+(yield get_param("install_ts")),now=_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_4__["default"].now();if(!install_ts||install_ts>now){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().perr("be_fixup_install_ts",{install_ts});yield persist_param("install_ts",now);_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default().set("install_ts",now)}}));const verify_install_ts=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*(){const uuid_info=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default().get("uuid_info")||{};if(!uuid_info)return;if(uuid_info.install_version){const install_ver=yield get_param("install_version");if(!install_ver||!_util_version_util_js__WEBPACK_IMPORTED_MODULE_9___default().valid(install_ver)||_util_version_util_js__WEBPACK_IMPORTED_MODULE_9___default().cmp(uuid_info.install_version,install_ver)<0){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().perr("be_install_ver_server_fix",{install_ver,uuid_info});yield persist_param("install_version",uuid_info.install_version);_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default().set("install_version",uuid_info.install_version)}}if(uuid_info.install_ts){const install_ts=yield get_param("install_ts");if(!install_ts||uuid_info.install_ts<install_ts){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().perr("be_install_ts_server_fix",{install_ts,uuid_info});yield persist_param("install_ts",uuid_info.install_ts);_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default().set("install_ts",uuid_info.install_ts)}}}));const handle_install=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*handle_install_(){try{if(!E.get("install_reason"))yield _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default().sleep(1e3);const reason=E.get("install_reason");_util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default().notice("bg_main startup "+reason);if(new_uuid&&reason!="install")_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().perr("switch_uuid_err",{reason});if(["install","update"].includes(reason)){E.trigger(reason,_util_storage_js__WEBPACK_IMPORTED_MODULE_10___default().get("ver"));_util_storage_js__WEBPACK_IMPORTED_MODULE_10___default().set("ver",_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().version())}if(reason!="install")fixup_storage()}catch(e){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().perr("handle_install_err",{},{err:e})}}));E.set_rule_use=rule=>{var name=rule.name||rule.host,now=_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_4__["default"].now();var d=now-uninstall_url_cb.ts;var update=!last_use||last_use&&last_use.name!=name||d>15*_util_date_js__WEBPACK_IMPORTED_MODULE_13___default().ms.MIN;last_use={name,ts:now};if(update||d>_util_date_js__WEBPACK_IMPORTED_MODULE_13___default().ms.HOUR)uninstall_url_cb()};const uninstall_url_cb=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*(){let ui_testing=yield _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_28___default().get_hola_cookie("ui_testing");let ui_test=get_active_test_from_cookies(ui_testing);let now=_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_4__["default"].now();uninstall_url_cb.ts=now;let qs={perr:1,uuid:E.get("uuid"),browser,version:_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().version()};if(last_use&&now-last_use.ts<15*_util_date_js__WEBPACK_IMPORTED_MODULE_13___default().ms.MIN){qs.last=btoa(last_use.name);if(last_use.is_mitm)qs.mitm=1}let ms;if(ms=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().get_install_ms())qs.inst_ms=ms;if(ms=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().get_ua_update_ms())qs.ua_ms=ms;if(ui_test.active_test_name){qs.u_t_n=ui_test.active_test_name;qs.u_t=ui_test.active_value}let url=_bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_17__.Z.get_selected_url({name:"ccgi",url:conf__WEBPACK_IMPORTED_MODULE_32__.url_ccgi})+"/uninstall?"+_util_escape_js__WEBPACK_IMPORTED_MODULE_8___default().qs(qs);url=url.substr(0,255);if(_util_util_js__WEBPACK_IMPORTED_MODULE_12___default().get(chrome,"runtime.setUninstallURL"))chrome.runtime.setUninstallURL(url)}));const get_agree_ts=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*(){if(!conf__WEBPACK_IMPORTED_MODULE_32__.check_agree_ts)return 1;const ver_install=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default().get("install_version");if(ver_install&&_util_version_util_js__WEBPACK_IMPORTED_MODULE_9___default().cmp(ver_install,"1.131.737")<0)return 1;return yield get_param("agree_ts")}));E.set_agree_ts=val=>{E.set("agree_ts",val);persist_param("agree_ts",val)};E.debug_set_install_ts=val=>{_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default().set("install_ts",val);persist_param("install_ts",val)};E.debug_set_install_ver=val=>{_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default().set("install_version",val);persist_param("install_version",val)};function set_upgrade_ext_interval(){_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_28___default().clear_interval(set_upgrade_ext_interval.interval);_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_4__["default"].upgrade_ext();set_upgrade_ext_interval.interval=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_28___default().set_interval(_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_4__["default"].upgrade_ext,24*_util_date_js__WEBPACK_IMPORTED_MODULE_13___default().ms.HOUR,{sp:E.sp})}function ajax_do_op(o){var op=_util_util_js__WEBPACK_IMPORTED_MODULE_12___default().get(o,"op");if(!op)return;switch(op){case"reload_ext":_util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default().notice("do_op_reload_ext "+_util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default().json(o));_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().perr("be_reload_ext_ajax_op");_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_28___default().set_timeout((()=>_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().reload_ext_native()),500);break;case"upgrade_ext":_util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default().notice("do_op_upgrade_ext "+_util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default().json(o));_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_4__["default"].upgrade_ext();break;default:_util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default()("unknown op "+_util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default().json(o));break}}function dev_mode_cb(){const level=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default().get("dev_mode")?"NOTICE":"WARN";_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_4__["default"].set_dbg_conf("debug.zerr",{level});_util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default().set_level(level)}function debug_cb(){_util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default().set_level(_util_util_js__WEBPACK_IMPORTED_MODULE_12___default().get(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default().get("debug.zerr"),"level"))}const no_log_cb=enabled=>_bext_pub_ga_js__WEBPACK_IMPORTED_MODULE_15___default().set_enabled(!enabled);const check_user_agent=()=>{let prev_ua=_util_storage_js__WEBPACK_IMPORTED_MODULE_10___default().get("ua"),ua=navigator.userAgent;if(prev_ua==ua)return;_util_storage_js__WEBPACK_IMPORTED_MODULE_10___default().set("ua",ua);if(!prev_ua)return;_util_storage_js__WEBPACK_IMPORTED_MODULE_10___default().set("ua_update_ts",_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_4__["default"].now());_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().perr("be_user_agent_update",{prev_ua,ua})};const check_permissions=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*(){if(!chrome.permissions||!chrome.permissions.contains||(yield _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().check_permission())){return}_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().perr("be_no_permission");_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default().set("no_permission",true)}));const all_urls=v3?"*://*/*":"<all_urls>";const on_permission_added=data=>{_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().perr("be_permission_added",data);if(data&&data.origins&&data.origins.includes(all_urls)){_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default().set("no_permission",false);_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().reload_ext_native()}};const on_permission_removed=data=>{_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().perr("be_permission_removed",data);if(data&&data.origins&&data.origins.includes(all_urls))_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default().set("no_permission",true)};const on_agree_ts=()=>{init_ga();active_cb();_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_28___default().set_timeout(send_install_perr,2e3)};const init_sync=()=>{chrome.permissions.onAdded.addListener(on_permission_added);chrome.permissions.onRemoved.addListener(on_permission_removed)};E.init=opt=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*(){if(E.inited)return;if(v3)yield _util_storage_js__WEBPACK_IMPORTED_MODULE_10___default().init();opt=opt||{};assert_no_listeners();E.inited=(E.inited||0)+1;_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_28___default().set_conf(conf__WEBPACK_IMPORTED_MODULE_32__);_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().set_bext_config_cb((()=>_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default().get("bext_config")));_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().set_now_cb((()=>_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_4__["default"].now()));E.sp=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_28___default().new_etask("be_bg_main");_util_ajax_js__WEBPACK_IMPORTED_MODULE_11___default().do_op=ajax_do_op;_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_7___default().init();_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_16___default().init(_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_34___default());_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default().init();ccgi_init();_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_21__["default"].init(_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_20__.Z);_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_23__["default"].init(_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_20__.Z,_bext_vpn_bg_tpopup_js__WEBPACK_IMPORTED_MODULE_31__.Z,_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_34___default());_bext_vpn_bg_dev_mode_js__WEBPACK_IMPORTED_MODULE_22__["default"].init();_bext_vpn_bg_ui_api_js__WEBPACK_IMPORTED_MODULE_36__.Z.init(E);_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().set_hola_org_cookie("ext_ver",_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().version());_util_storage_js__WEBPACK_IMPORTED_MODULE_10___default().clr("ajax_timeout");_util_storage_js__WEBPACK_IMPORTED_MODULE_10___default().clr("be_ajax_simulator");E.on("change:inited",inited_cb);E.on("change:ga_failed",ga_failed_cb);if(_util_util_js__WEBPACK_IMPORTED_MODULE_12___default().get(chrome,"runtime.setUninstallURL")){E.on_init("change:uuid change:cid",uninstall_url_cb);E.listen_to(_bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_17__.Z,"change:ccgi_selected",uninstall_url_cb)}E.listen_to(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default(),"change:session_key change:enabled "+"change:ext.conflict change:uuid",active_cb);E.listen_to(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default(),"change:ext.suspended",suspend_cb);E.listen_to(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default(),"change:debug.zerr",debug_cb);E.listen_to(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default(),"change:dev_mode",dev_mode_cb);_bext_vpn_util_no_log_js__WEBPACK_IMPORTED_MODULE_29__["default"].set_status_cb(no_log_cb);if(!v3)_bext_vpn_bg_start_worker_js__WEBPACK_IMPORTED_MODULE_38__.Z.start_monitor_worker();check_user_agent();check_permissions();if(!v3&&chrome.permissions&&chrome.permissions.onAdded)chrome.permissions.onAdded.addListener(on_permission_added);if(!v3&&chrome.permissions&&chrome.permissions.onRemoved)chrome.permissions.onRemoved.addListener(on_permission_removed);_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_25__.Z.set_bext_config(_util_storage_js__WEBPACK_IMPORTED_MODULE_10___default().get_json("bext_config_last")||_bext_vpn_bg_bext_config_js__WEBPACK_IMPORTED_MODULE_33___default());const install_reason=_util_util_js__WEBPACK_IMPORTED_MODULE_12___default().get(opt,"install_details.reason","");if(install_reason)E.set("install_reason",install_reason);E.sp.spawn(_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*init_(){try{const uuid=yield ensure_uuid();_util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default().notice("uuid: "+uuid);E.set("uuid",uuid);_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default().set("uuid",uuid);_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default().set("install_ts",yield get_param("install_ts"));_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default().set("install_version",yield get_param("install_version"));E.set("agree_ts",yield get_agree_ts());E.set("aff_id",yield get_param("aff_id"));E.on("change:agree_ts",on_agree_ts);E.listen_to(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default(),"change:uuid_info",verify_install_ts);E.sp.spawn(handle_install());E.trigger("up");E.set("inited",true)}catch(e){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().perr("init_err",{},{err:e})}finally{const get=get_uuid.last_error||[];const set=persist_param_errors.uuid||[];if(get.length||set.length)_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().perr("uuid_storage_err",_util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default().json({get,set}))}})));set_upgrade_ext_interval();init_ga();if(_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_21__["default"].get("updated"))send_install_perr();else E.listen_to(_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_21__["default"],"change:updated",send_install_perr)}));E.uninit=function(){if(!E.inited)return;_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().perr("bg_main_uninit",{stack:new Error("bg_uninit").stack,reload_ext:_util_storage_js__WEBPACK_IMPORTED_MODULE_10___default().get_json("reload_ext")});_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().perr("bg_main_uninit_log",{stack:new Error("bg_uninit").stack,reload_ext:_util_storage_js__WEBPACK_IMPORTED_MODULE_10___default().get_json("reload_ext")},{with_log:true});E.sp.return();E.off();E.stopListening();_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().del_hola_org_cookie("ext_ver");set_upgrade_ext_interval.interval=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_28___default().clear_interval(set_upgrade_ext_interval.interval);if(monitor_active.sp)monitor_active.sp.return();if(monitor_suspended.sp)monitor_suspended.sp.return();if(chrome.permissions&&chrome.permissions.onAdded)chrome.permissions.onAdded.removeListener(on_permission_added);if(chrome.permissions&&chrome.permissions.onRemoved)chrome.permissions.onRemoved.removeListener(on_permission_removed);if(_util_util_js__WEBPACK_IMPORTED_MODULE_12___default().is_mocha()){_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_25__.Z.uninit();_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_21__["default"].uninit();_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_23__["default"].uninit();_bext_vpn_bg_icon_js__WEBPACK_IMPORTED_MODULE_18__.Z.uninit();_bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_17__.Z.uninit();_bext_vpn_bg_ccgi_js__WEBPACK_IMPORTED_MODULE_24__.Z.uninit();_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default().uninit();_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_16___default().uninit();_bext_vpn_bg_dev_mode_js__WEBPACK_IMPORTED_MODULE_22__["default"].uninit();_bext_vpn_bg_ui_api_js__WEBPACK_IMPORTED_MODULE_36__.Z.uninit();_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_7___default().uninit()}else{_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_25__.Z._destroy();_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_21__["default"]._destroy();_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_23__["default"]._destroy();_bext_vpn_bg_icon_js__WEBPACK_IMPORTED_MODULE_18__.Z._destroy();_bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_17__.Z._destroy();_bext_vpn_bg_ccgi_js__WEBPACK_IMPORTED_MODULE_24__.Z._destroy();_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default()._destroy();_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_16___default()._destroy();_bext_vpn_bg_dev_mode_js__WEBPACK_IMPORTED_MODULE_22__["default"]._destroy();_bext_vpn_bg_ui_api_js__WEBPACK_IMPORTED_MODULE_36__.Z._destroy();_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_7___default()._destroy()}E.inited=false;E.clear();assert_no_listeners()};function assert_no_listeners(){_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_25__.Z.assert_no_listeners();_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_21__["default"].assert_no_listeners();_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_23__["default"].assert_no_listeners();_bext_vpn_bg_icon_js__WEBPACK_IMPORTED_MODULE_18__.Z.assert_no_listeners();_bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_17__.Z.assert_no_listeners();_bext_vpn_bg_ccgi_js__WEBPACK_IMPORTED_MODULE_24__.Z.assert_no_listeners();_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default().assert_no_listeners();_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_16___default().assert_no_listeners();_bext_vpn_bg_dev_mode_js__WEBPACK_IMPORTED_MODULE_22__["default"].assert_no_listeners();_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_20__.Z.assert_no_listeners()}function ga_failed_cb(){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().perr("be_bg_main_ga_init_failed")}function inited_cb(){if(!E.get("inited"))return;E.off("change:inited",inited_cb);_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*inited_cb_(){try{const state=yield _util_storage_js__WEBPACK_IMPORTED_MODULE_10___default().get("ext_state");E.set("enabled",state!="disabled");_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default().set("enabled",state!="disabled");_bext_vpn_bg_icon_js__WEBPACK_IMPORTED_MODULE_18__.Z.init();_bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_17__.Z.init(_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_34___default());E.listen_to(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default(),"change:uuid change:session_key",background_init);E.on("recover",background_init);if(yield _util_storage_js__WEBPACK_IMPORTED_MODULE_10___default().get("suspended_ext_ts"))_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default().set("ext.suspended",true)}catch(e){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().perr("be_bg_main_init_err",{},{err:e})}}))}const monitor_active=()=>{E.sp.spawn(monitor_active.sp=_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({cancel:true},(function*monitor_active_(){this.finally((()=>delete monitor_active.sp));yield _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default().sleep(mem_leak_period);let prev_ps=_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default().ps()||"";let a=_util_string_js__WEBPACK_IMPORTED_MODULE_14___default().split_nl(prev_ps).length;yield _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default().sleep(mem_leak_period);let ps=_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default().ps(),b=_util_string_js__WEBPACK_IMPORTED_MODULE_14___default().split_nl(ps).length;if(b>a){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().perr("be_ext_off_leak",{before_n:a,after_n:b,reason:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default().get("ext.conflict")?"conflict":"disable"},{rate_limit:{count:1},filehead:"before: "+prev_ps+"\nafter: "+ps})}})))};function active_cb(){let uuid=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default().get("uuid");let active=!!(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default().get("enabled")&&!_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default().get("ext.conflict")&&!(conf__WEBPACK_IMPORTED_MODULE_32__.check_agree_ts&&!E.get("agree_ts"))&&uuid&&_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default().get("session_key"));_bext_vpn_util_no_log_js__WEBPACK_IMPORTED_MODULE_29__["default"].set_uuid(uuid);let prev=!!_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default().get("ext.active");_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default().safe_set({"ext.active":active});if(prev==active)return;if(active){if(monitor_active.sp)monitor_active.sp=void monitor_active.sp.return();_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_21__["default"].init(_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_20__.Z)}else{if(!monitor_active.sp)monitor_active();_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_21__["default"].uninit({keep_user:true})}}E.suspend_client=permanent=>{if(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default().get("ext.suspended")){if(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default().get("ext.suspended").permanent!=permanent)_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default().set("ext.suspended",{permanent});return}_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().perr("suspend_client");_util_storage_js__WEBPACK_IMPORTED_MODULE_10___default().set("suspended_ext_ts",_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_4__["default"].now());_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default().set("ext.suspended",{permanent});_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_21__["default"].refresh_user();let url=_util_url_js__WEBPACK_IMPORTED_MODULE_6___default().qs_add(_bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_17__.Z.hola_url()+"/signin",{force_signin:1,signin_redirect:true,next:"/cp"});_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_4__["default"].open_hola_tab({url,force_active:true})};E.check_suspend_status=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*_check_suspend_status(){if(!_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default().get("ext.suspended"))return;try{let location=_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_27__["default"].get("location");let qs=assign({ip:location&&location.ip},_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default().auth());let res=yield _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_17__.Z.ccgi_ajax({url:conf__WEBPACK_IMPORTED_MODULE_32__.url_ccgi+"/user_status",qs});if(res&&res.active){_util_storage_js__WEBPACK_IMPORTED_MODULE_10___default().clr("suspended_ext_ts");_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default().set("ext.suspended",false);_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().perr("suspend_restore");background_init()}if(res&&res.blocked)_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default().set("ext.suspended",{permanent:res.permanent})}catch(e){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().perr("suspend_status_check_fail",{},{err:e,rate_limit:{count:2}})}}));const monitor_suspended=()=>{E.sp.spawn(monitor_suspended.sp=_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*_monitor_suspended(){let check_rl=underscore__WEBPACK_IMPORTED_MODULE_0___default().throttle(E.check_suspend_status,2*_util_date_js__WEBPACK_IMPORTED_MODULE_13___default().ms.SEC);this.finally((()=>{delete monitor_suspended.sp;E.stopListening(_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_21__["default"],"user_updated",check_rl);E.stopListening(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default(),"change:uuid change:session_key",check_rl)}));E.listen_to(_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_21__["default"],"user_updated",check_rl);E.listen_to(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default(),"change:uuid change:session_key",check_rl);yield this.wait()})))};let suspend_cb=()=>{if(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default().get("ext.suspended")){if(!monitor_suspended.sp)monitor_suspended()}else{if(monitor_suspended.sp)monitor_suspended.sp=void monitor_suspended.sp.return()}};E.set_enabled=on=>{if(!!E.get("enabled")==!!on)return;return _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*set_enabled_(){try{E.set("enabled",!!on);_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default().set("enabled",!!on);return yield _util_storage_js__WEBPACK_IMPORTED_MODULE_10___default().set("ext_state",on?"enabled":"disabled")}catch(e){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().perr("be_bg_main_set_enable_err",{},{err:e})}}))};const background_init_ajax=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*_background_init_ajax(){let req={retry:1,method:"POST",json:1,data:{login:1,ver:_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().version()},qs:_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().qs_ajax({uuid:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default().get("uuid")}),url:conf__WEBPACK_IMPORTED_MODULE_32__.url_ccgi+"/background_init",with_credentials:true};let err,retries=5;for(let i=0;i<retries;i++)try{return yield _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_17__.Z.ccgi_ajax(req)}catch(e){err=e}_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().perr("be_background_init_ccgi_failed",{req,retries},{err});req.url="https://client.zspeed-cdn.com/client_cgi/background_init";try{return yield _util_ajax_js__WEBPACK_IMPORTED_MODULE_11___default()(req)}catch(e){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().perr("be_background_init_zspeed_cdn_failed",{req},{err:e})}req.url="https://perr.hola.org/background_init";try{return yield _util_ajax_js__WEBPACK_IMPORTED_MODULE_11___default()(req)}catch(e){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().perr("be_background_init_perr_init_failed",{req},{err:e})}req.method="GET";req.url=conf__WEBPACK_IMPORTED_MODULE_32__.url_ccgi+"/background_init";try{return yield _util_ajax_js__WEBPACK_IMPORTED_MODULE_11___default()(req)}catch(e){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().perr("be_background_init_get_ccgi_failed",{req},{err:e})}req.url="https://client.zspeed-cdn.com/client_cgi/background_init";try{return yield _util_ajax_js__WEBPACK_IMPORTED_MODULE_11___default()(req)}catch(e){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().perr("be_background_init_get_zspeed_cdn_failed",{req},{err:e})}req.url="https://perr.hola.org/background_init";try{return yield _util_ajax_js__WEBPACK_IMPORTED_MODULE_11___default()(req)}catch(e){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().perr("be_background_init_get_perr_init_failed",{req},{err:e})}if(!_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().CG("disable_background_init_agent_test")){req={url:"http://208.68.38.214:22222/myip"};try{let res=yield _util_ajax_js__WEBPACK_IMPORTED_MODULE_11___default()(req);if(res.ip)_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().perr("be_background_init_agent_ok")}catch(e){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().perr("be_background_init_agent_err",{req},{err:e})}}throw new Error("background_init_ajax failed")}));const background_init=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*_background_init(){let req;try{_util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default().notice("background_init called %s",E.get("status"));if(["busy","ready"].includes(E.get("status")))return;if(!_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default().get("uuid"))return void _util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default().notice("background_init no uuid");E.set("status","busy");req={retry:1,method:"POST",data:{login:1,ver:_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().version()},qs:_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().qs_ajax({uuid:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default().get("uuid")}),url:conf__WEBPACK_IMPORTED_MODULE_32__.url_ccgi+"/background_init",with_credentials:true};let info=yield background_init_ajax(),t=self.hola.t;if(info.blocked){E.suspend_client(info.permanent);throw new Error("background_init_ajax blocked")}E.stopListening(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default(),"change:uuid change:session_key",background_init);_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_19___default().set("session_key",info.key);yield _bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_25__.Z.init();E.set("status","ready");t.r_init=_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_4__["default"].now();let start=t.new_ver||t.l_start,diff=t.r_init-start;_util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default()[diff>2e3?"err":"notice"](diff>2e4?"rmt_init_slow":"background_init %sms",diff);_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().perr("be_background_init_ok",{diff,req});if(_util_storage_js__WEBPACK_IMPORTED_MODULE_10___default().get("reload_ext_ts")){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().perr("be_recover_ok",{ts:_util_storage_js__WEBPACK_IMPORTED_MODULE_10___default().get("reload_ext_ts")});_util_storage_js__WEBPACK_IMPORTED_MODULE_10___default().clr("reload_ext_ts")}}catch(e){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().perr("be_background_init_err",{req},{err:e});E.set("status","error");if(_util_storage_js__WEBPACK_IMPORTED_MODULE_10___default().get("reload_ext_ts")){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().perr("be_recover_failed",{ts:_util_storage_js__WEBPACK_IMPORTED_MODULE_10___default().get("reload_ext_ts")},{err:e});_util_storage_js__WEBPACK_IMPORTED_MODULE_10___default().clr("reload_ext_ts")}_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_25__.Z.uninit()}}));let dumped_errors={};E.dump_errors=(tab_id,errors)=>dumped_errors[tab_id]=errors;E.get_dumped_errors=tab_id=>dumped_errors[tab_id];E.set_bug_id=bug_id=>{_util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default().warn("VPN BUG REPORT: http://web.hola.org/vpn_debug?id="+bug_id)};if(v3)init_sync();const __WEBPACK_DEFAULT_EXPORT__=E},39:(module,exports,__webpack_require__)=>{"use strict";var __WEBPACK_AMD_DEFINE_RESULT__;!(__WEBPACK_AMD_DEFINE_RESULT__=function(){return{exclude_user_countries:{whitelist:{uuids:[],hola_uids:[]},blacklist:{uuids:["webos-5e3465f7f426ef5f2cc466d8d55fcd7b","webos-dfc5f3e90628c00bb33669b5f98382f6"],hola_uids:[],url:"https://hola.org/blog/article/slug/india-and-vpns-an-uneasy-relationship"},countries:[{country:"in",url:"https://hola.org/blog/article/slug/india-and-vpns-an-uneasy-relationship"}],affected_services:{proxy:true,vpn:true,dnsvpn:true,dnsvpn_lum:true}},version:45,reset_trial:{min_conf_ver:18,reset_on_period_change:false},debug_hooks:true,bump:1,bw_perr:[{id:"bbc",url:["**.bbc.co.uk","**.bbci.co.uk","**.bbc.com","**.bbcfmt.hs","**.bbcdotcom.2cnt.net","**.bbcfmt.hs.llnwd.net"],error_code:[403]},{id:"netflix",url:["**.nflxvideo.net"],error_code:[420]},{id:"youtube",url:["**.googlevideo.com"],error_code:[403]},{id:"cbs",url:["**.cbsaavideo.com"],error_code:[403]}],load_perr:[{id:"netflix",domain:"netflix.com",paths:["login","signin","clearcookies","search","browse","watch"]},{id:"youtube",domain:"youtube.com",paths:["results","watch"]},{id:"pornhub",domain:"pornhub.com",paths:["view_video.php","video"]},{id:"omegle",domain:"omegle.com",paths:[""]},{id:"chaturbate",domain:"chaturbate.com",paths:[""]},{id:"xvideos",domain:"xvideos.com",paths:[""]},{id:"vk",domain:"vk.com",paths:[""]},{id:"steampowered",domain:"steampowered.com",paths:[""]},{id:"truepeoplesearch",domain:"truepeoplesearch.com",paths:[""]},{id:"google",domain:"google.com",paths:[""]}],force_premium:{rules:[{id:"bbc",domain:"bbc.co.uk"},{id:"bbc_com",domain:"bbc.com"},{id:"netflix",domain:"netflix.com"},{id:"hulu",domain:"hulu.com"},{id:"itv",domain:"itv.com"},{id:"vueling_com",domain:"vueling.com"}]},trial_timeline:{disable:false,disable_perr_state:false},skip_trial_must_wait_error:true,stub_rule_on_hola_site:false,show_top_sites_on_hola:true,ab_test:{min_ver:"1.199.59",min_tfi:31536e6,ver:35,name:"test_trial_old_users",value:[[0,.9,"off"],[.9,1,"on"]],ref_prefix:true},trial_rules:[{conf:{key:"all_sites",new_trial:{autostart:true,wait:0},new_cycle:{autostart:true,wait:5e3},grace_time:864e9,wait:5e3,skip_signin:true,timer_type:"cycle_timer",trial_ready_dialog:true,hide_watermark_progress_dots:false,hide_timer:false,allow_tmp_watermark_hide:true,can_close_watermark:true,progress_type:"trial",start_dlg:{buttons:["free","pay"]},wait_dlg:{buttons:["free","pay"]},end_dlg:{buttons:["free","pay"]},timer_dlg:{buttons:["free","pay"]},close_watermark_dlg:{buttons:["free","pay"]},more_dlg:{buttons:["free","pay"]},watermark:{banner:{type:"all_plans"}},intervals:[{dur:6e5,conf:{wait:15e3,autostart_after_wait:true}},{dur:12e5,conf:{wait:6e4,autostart_after_wait:true}},{dur:27e5,conf:{wait:45e3,autostart_after_wait:true}},{dur:18e5,conf:{wait:6e5}},{dur:9e5,conf:{wait:12e4,autostart_after_wait:true}},{dur:18e5,conf:{wait:18e5}},{dur:18e5,conf:{wait:18e5}},{dur:18e5,conf:{wait:18e5}},{dur:18e5,conf:{wait:18e5}},{dur:18e5,conf:{wait:18e5}},{dur:18e5,conf:{wait:18e5}},{dur:18e5,conf:{wait:18e5}},{dur:18e5,conf:{wait:18e5}},{dur:18e5,conf:{wait:18e5}},{dur:18e5,conf:{wait:18e5}},{dur:18e5,conf:{wait:18e5}},{dur:18e5,conf:{wait:18e5}},{dur:18e5,conf:{wait:18e5}},{dur:18e5,conf:{wait:18e5}},{dur:18e5,conf:{wait:18e5}},{dur:18e5,conf:{wait:18e5}},{dur:18e5,conf:{wait:18e5}},{dur:18e5,conf:{wait:18e5}},{dur:18e5,conf:{wait:18e5}},{dur:18e5,conf:{wait:18e5}},{dur:18e5,conf:{wait:18e5}},{dur:18e5,conf:{wait:18e5}}],cycle:864e5,autostart_after_wait:false}},{filter:{since_install_ts_gt:864e5},conf:{intervals:[{dur:18e5,conf:{wait:18e5}},{dur:18e5,conf:{wait:18e5}},{dur:18e5,conf:{wait:18e5}},{dur:18e5,conf:{wait:18e5}},{dur:18e5,conf:{wait:18e5}},{dur:18e5,conf:{wait:18e5}},{dur:18e5,conf:{wait:18e5}},{dur:18e5,conf:{wait:18e5}},{dur:18e5,conf:{wait:18e5}},{dur:18e5,conf:{wait:18e5}},{dur:18e5,conf:{wait:18e5}},{dur:18e5,conf:{wait:18e5}},{dur:18e5,conf:{wait:18e5}},{dur:18e5,conf:{wait:18e5}},{dur:18e5,conf:{wait:18e5}},{dur:18e5,conf:{wait:18e5}},{dur:18e5,conf:{wait:18e5}},{dur:18e5,conf:{wait:18e5}},{dur:18e5,conf:{wait:18e5}},{dur:18e5,conf:{wait:18e5}},{dur:18e5,conf:{wait:18e5}},{dur:18e5,conf:{wait:18e5}},{dur:18e5,conf:{wait:18e5}},{dur:18e5,conf:{wait:18e5}}]}},{filter:{ab_test_name:"test_trial_old_users",ab_test_value:"on",since_install_ts_gt:31536e6},conf:{intervals:[{dur:186e4,conf:{wait:18e5}},{dur:186e4,conf:{wait:18e5}},{dur:186e4,conf:{wait:18e5}},{dur:186e4,conf:{wait:18e5}},{dur:186e4,conf:{wait:18e5}},{dur:186e4,conf:{wait:18e5}},{dur:186e4,conf:{wait:18e5}},{dur:186e4,conf:{wait:18e5}},{dur:186e4,conf:{wait:18e5}},{dur:186e4,conf:{wait:18e5}},{dur:186e4,conf:{wait:18e5}},{dur:186e4,conf:{wait:18e5}},{dur:186e4,conf:{wait:18e5}},{dur:186e4,conf:{wait:18e5}},{dur:186e4,conf:{wait:18e5}},{dur:186e4,conf:{wait:18e5}},{dur:186e4,conf:{wait:18e5}},{dur:186e4,conf:{wait:18e5}},{dur:186e4,conf:{wait:18e5}},{dur:186e4,conf:{wait:18e5}},{dur:186e4,conf:{wait:18e5}},{dur:186e4,conf:{wait:18e5}},{dur:186e4,conf:{wait:18e5}},{dur:186e4,conf:{wait:18e5}}]}},{filter:{ab_test_name:"test_trial_old_users",ab_test_value:"off",since_install_ts_gt:31536e6},conf:{intervals:[{dur:186e4,conf:{wait:18e5}},{dur:186e4,conf:{wait:18e5}},{dur:186e4,conf:{wait:18e5}},{dur:186e4,conf:{wait:18e5}},{dur:186e4,conf:{wait:18e5}},{dur:186e4,conf:{wait:18e5}},{dur:186e4,conf:{wait:18e5}},{dur:186e4,conf:{wait:18e5}},{dur:186e4,conf:{wait:18e5}},{dur:186e4,conf:{wait:18e5}},{dur:186e4,conf:{wait:18e5}},{dur:186e4,conf:{wait:18e5}},{dur:186e4,conf:{wait:18e5}},{dur:186e4,conf:{wait:18e5}},{dur:186e4,conf:{wait:18e5}},{dur:186e4,conf:{wait:18e5}},{dur:186e4,conf:{wait:18e5}},{dur:186e4,conf:{wait:18e5}},{dur:186e4,conf:{wait:18e5}},{dur:186e4,conf:{wait:18e5}},{dur:186e4,conf:{wait:18e5}},{dur:186e4,conf:{wait:18e5}},{dur:186e4,conf:{wait:18e5}},{dur:186e4,conf:{wait:18e5}}]}},{filter:{since_closed_watermark_ts_gt:3e5},conf:{can_close_watermark:false}},{filter:{since_first_start_ts_lt:6e5},conf:{small_watermark:true}},{filter:{since_install_ts_gt:864e5,since_interval_start_ts_gt:12e5,since_interval_start_ts_lt:15e5},conf:{popcorn_watermark:true}},{filter:{tmp_watermark_hide_ts_gt:0,since_tmp_watermark_hide_ts_lt:3e5},conf:{is_watermark_hidden:true}},{filter:{tmp_watermark_hide_ts_gt:0},conf:{allow_tmp_watermark_hide:false}},{filter:{premium_site:true},conf:{skip_signin:false,signin_opt:{type:"force"}}},{filter:{since_install_ts_lt:864e5,cycle_n:1,interval_n:1,since_interval_start_ts_gt:6e5,since_interval_start_ts_lt:9e5},conf:{watermark:{bonus_watermark:true},popcorn_watermark:false}},{filter:{since_install_ts_lt:864e5,cycle_n:1,interval_n:1,since_interval_start_ts_gt:6e5,since_interval_start_ts_lt:62e4},conf:{watermark:{open_bonus_tooltip:true},popcorn_watermark:false}},{filter:{since_install_ts_lt:864e5,cycle_n:1,interval_n:1,since_interval_start_ts_gt:9e5,since_interval_start_ts_lt:18e5},conf:{watermark:{bonus_logo:true},popcorn_watermark:false}},{filter:{since_install_ts_lt:864e5,cycle_n:1,interval_n:1,since_interval_start_ts_gt:18e5,since_interval_start_ts_lt:21e5},conf:{watermark:{bonus_watermark:true},popcorn_watermark:false}},{filter:{since_install_ts_lt:864e5,cycle_n:1,interval_n:1,since_interval_start_ts_gt:18e5,since_interval_start_ts_lt:182e4},conf:{watermark:{open_bonus_tooltip:true},popcorn_watermark:false}},{filter:{since_install_ts_lt:864e5,cycle_n:1,interval_n:1,since_interval_start_ts_gt:21e5,since_interval_start_ts_lt:36e5},conf:{watermark:{bonus_logo:true},popcorn_watermark:false}},{filter:{since_first_start_ts_gt:2592e6,since_first_start_ts_lt:7776e6,interval_n:0,since_interval_start_ts_gt:6e5,since_interval_start_ts_lt:9e5},conf:{watermark:{bonus_watermark:true},popcorn_watermark:false}},{filter:{since_first_start_ts_gt:2592e6,since_first_start_ts_lt:7776e6,interval_n:0,since_interval_start_ts_gt:6e5,since_interval_start_ts_lt:62e4},conf:{watermark:{open_bonus_tooltip:true},popcorn_watermark:false}},{filter:{since_first_start_ts_gt:2592e6,since_first_start_ts_lt:7776e6,interval_n:0,since_interval_start_ts_gt:9e5,since_interval_start_ts_lt:18e5},conf:{watermark:{bonus_logo:true},popcorn_watermark:false}},{filter:{since_first_start_ts_gt:2592e6,since_first_start_ts_lt:7776e6,interval_n:0,since_interval_start_ts_gt:18e5,since_interval_start_ts_lt:21e5},conf:{watermark:{bonus_watermark:true},popcorn_watermark:false}},{filter:{since_first_start_ts_gt:2592e6,since_first_start_ts_lt:7776e6,interval_n:0,since_interval_start_ts_gt:18e5,since_interval_start_ts_lt:182e4},conf:{watermark:{open_bonus_tooltip:true},popcorn_watermark:false}},{filter:{since_first_start_ts_gt:2592e6,since_first_start_ts_lt:7776e6,interval_n:0,since_interval_start_ts_gt:21e5,since_interval_start_ts_lt:36e5},conf:{watermark:{bonus_logo:true},popcorn_watermark:false}},{filter:{src_country_in:["RU"]},conf:{skip_trial:true}}],sites_default:{min_ver:"1.174.223",install_min_ver:"1.1.1",require_plus:false},sites:{itv_com:{require_plus:true,premium_site:true,trial:{period:36e5,wait2:5e3,grace_time:6048e5,limits:{count:24,period:864e5},skip_signin:false},min_ver:"1.136.635",root_url:["itv.com"],suggestion_popup:{GB:null,"*":{proxy:["GB"]}},verify:{gb:[{url:"https://mediaplayer.itv.com/flash/playlists/ukonly/itv1.xml",ret:{status:403,client_only:true}},{url:"*://*.itv.com/playlist/*",ret:{status:403,client_only:true}}]}},hulu_com:{require_plus:true,premium_site:true,trial:{period:36e5,wait2:5e3,grace_time:6048e5,limits:{count:24,period:864e5},skip_signin:false},min_ver:"1.136.635",root_url:["hulu.com"],suggestion_popup:{US:null,"*":{proxy:["US"]}},verify:{us:[{url:"*://play.hulu.com/*/playlist",ret:{status:403,client_only:true}}]}},france_tv:{require_plus:true,premium_site:true,trial:{period:36e5,wait2:5e3,grace_time:6048e5,limits:{count:24,period:864e5},skip_signin:false},min_ver:"1.136.635",root_url:["france.tv"],suggestion_popup:{FR:null,"*":{proxy:["FR"]}}},channel4_com:{min_ver:"1.145.764",root_url:["channel4.com"],suggestion_popup:{GB:null,"*":{proxy:["GB"]}},require_plus:true,premium_site:true,trial:{period:36e5,wait2:5e3,grace_time:6048e5,limits:{count:24,period:864e5},skip_signin:false},tz_spoof:-60},vk_com:{min_ver:"1.145.764",root_url:["vk.com"],tz_spoof:-180,keep_cookies:true},tvnz_co_nz:{min_ver:"1.145.764",root_url:["tvnz.co.nz"],tz_spoof:-780},roblox_com:{min_ver:"1.145.764",root_url:["roblox.com"],tz_spoof:300},hbogo_pl:{min_ver:"1.158.502",root_url:["hbogo.pl"],site_storage:{"go-geostate":""}},vod_pl:{min_ver:"1.158.502",root_url:["vod.pl"],site_storage:{insiderTimeOnSiteData:"",insUserPermissionGranted:""}},hbogo_ro:{min_ver:"1.158.502",root_url:["hbogo.ro"],site_storage:{"go-geostate":""}},investopedia_com:{min_ver:"1.158.502",root_url:["investopedia.com"],site_storage:{tg_accessDeny_timeStamp:"",tg_accessDeny:"",tg_redirectURLremembered:"",tg_reaction:"",tg_redirectURL:"",tg_accessEntry:"",tg_ipInfosArray:""}},espn_com_co:{min_ver:"1.160.842",root_url:["espn.com.co"],site_storage:{geo:""}},ome_tv:{min_ver:"1.160.842",root_url:["ome.tv"],site_storage:{selected_country:""}},joyn_de:{min_ver:"1.160.842",root_url:["joyn.de"],site_storage:{token:""}},espn_com:{min_ver:"1.160.842",root_url:["espn.com"],suggestion_popup:{US:null,"*":{proxy:["US"]}},require_plus:true,premium_site:true,trial:{period:36e5,wait2:5e3,grace_time:6048e5,limits:{count:24,period:864e5},skip_signin:false},site_storage:{__btm__web_userLocation:""}},orf_at:{min_ver:"1.160.842",root_url:["orf.at"],site_storage:{"oonmedia-geoprotection":""},headers_conf:[{url:"*://*/playlist.m3u8",name:"Cache-Control",value:"no-cache"}]},rsi_ch:{min_ver:"1.160.842",root_url:["rsi.ch"],headers_conf:[{url:"*://*.rsi.ch/*",type:["xmlhttprequest"],name:"Cache-Control",value:"no-cache"},{url:"*://*.srgssr.ch/*",name:"Cache-Control",value:"no-cache"}]},rts_ch:{min_ver:"1.160.842",root_url:["rts.ch"],headers_conf:[{url:"*://*.rts.ch/*",type:["xmlhttprequest"],name:"Cache-Control",value:"no-cache"},{url:"*://*.srgssr.ch/*",name:"Cache-Control",value:"no-cache"}]},srf_ch:{min_ver:"1.160.842",root_url:["srf.ch"],headers_conf:[{url:"*://*.srf.ch/*",type:["xmlhttprequest"],name:"Cache-Control",value:"no-cache"},{url:"*://*.srgssr.ch/*",name:"Cache-Control",value:"no-cache"}]},bigbrothercanada_ca:{min_ver:"1.160.842",root_url:["bigbrothercanada.ca"],headers_conf:[{url:"*://*.livestream.com/*",name:"Cache-Control",value:"no-cache"}]},hbogo_com:{min_ver:"1.136.635",root_url:["hbogo.com","loginprodx.att.net"]},cablevisionflow_com_ar:{min_ver:"1.136.635",root_url:["cablevisionflow.com.ar","flow.com.ar"]},bandainamcoentstore_com:{min_ver:"1.136.635",root_url:["bandainamcoentstore.com","bandainamcoent.eu"]},vueling_com:{min_ver:"0.0.0",root_url:["vueling.com"]},cwtv_com:{min_ver:"1.136.635",root_url:["cwtv.com"],suggestion_popup:{US:null,"*":{proxy:["US"]}},require_plus:true,premium_site:true,trial:{period:36e5,wait2:5e3,grace_time:6048e5,limits:{count:24,period:864e5},skip_signin:false},verify:{us:[{url:"https://www.cwtv.com/",ret:{status:403,client_only:true}}]}},netflix_com:{require_plus:true,premium_site:true,trial:{period:36e5,wait2:5e3,grace_time:6048e5,limits:{count:24,period:864e5},skip_signin:false},min_ver:"1.136.635",root_url:["netflix.com"],suggestion_popup:{US:{proxy:["US","GB","CA","NL","FR","DE","SE","ES","IE","BE","PL","IT","RU","JP","HK","BR","AR","KR","SK","IS","CH","GR","HU","MX","RO","IL","SG","IN","UA"]},GB:{proxy:["US","GB","CA","NL","FR","DE","SE","ES","IE","BE","PL","IT","RU","JP","HK","BR","AR","KR","SK","IS","CH","GR","HU","MX","RO","IL","SG","IN","UA"]},"*":{proxy:["US","GB","CA","NL","FR","DE","SE","ES","IE","BE","PL","IT","RU","JP","HK","BR","AR","KR","SK","IS","CH","GR","HU","MX","RO","IL","SG","IN","UA"]}},keep_cookies:true,verify:{ca:[{url:"https://www.netflix.com",ret:{headers:{location:{}},client_only:true}},{url:"*://*.nflxvideo.net/*",ret:{status:420,client_only:true}},{url:"*://*.nflxso.net/*.bif",ret:{status:420,client_only:true},sid:"thumbnail"}],it:[{url:"https://www.netflix.com",ret:{headers:{location:{}},client_only:true}},{url:"*://*.nflxso.net/*.bif",ret:{status:420,client_only:true},sid:"thumbnail"}],us:[{url:"https://www.netflix.com",ret:{headers:{location:null},client_only:true}},{url:"*://*.nflxso.net/*.bif",ret:{status:420,client_only:true},sid:"thumbnail"}],gb:[{url:"https://www.netflix.com",ret:{headers:{location:{}},client_only:true}},{url:"*://*.nflxvideo.net/*",ret:{status:420,client_only:true}},{url:"*://*.nflxso.net/*.bif",ret:{status:420,client_only:true},sid:"thumbnail"}],"*":[{url:"*://*.nflxvideo.net/*",ret:{status:420,client_only:true}},{url:"*://*.nflxso.net/*.bif",ret:{status:420,client_only:true},sid:"thumbnail"}]},watermark:{pos:{default:"bottom_right",fullscreen:"top_right","/watch/**":"top_right"}},web_worker_proxy:true,redirect:[{url:"https://www.netflix.com/watch/0?origId=",action:"change_agent"}]},bbc:{require_plus:true,premium_site:true,trial:{period:36e5,wait2:5e3,grace_time:6048e5,limits:{count:24,period:864e5},skip_signin:false},min_ver:"1.144.716",root_url:["bbc.com","bbc.co.uk"],verify:{gb:[{url:"**.bbc.co.uk",ret:{status:403,client_only:true}},{url:"**.bbci.co.uk",ret:{status:403,client_only:true}},{url:"**.bbc.com",ret:{status:403,client_only:true}},{url:"**.bbcfmt.hs",ret:{status:403,client_only:true}},{url:"**.bbcdotcom.2cnt.net",ret:{status:403,client_only:true}},{url:"**.bbcfmt.hs.llnwd.net",ret:{status:403,client_only:true}}]},suggestion_popup:{GB:null,"*":{proxy:["GB"]}},watermark:{pos:{default:"bottom_right",fullscreen:"top_right"}},headers_conf:[{url:"*://*/*wor*/*i*/1*.js",name:"Cache-Control",value:"no-cache"},{url:"*://*/*wor*/*i*/2*.js*",name:"Cache-Control",value:"no-cache"},{url:"*://www.bbc.co.uk/userinfo",name:"Cache-Control",value:"no-cache"},{url:"*://www.bbc.com/userinfo",name:"Cache-Control",value:"no-cache"},{url:"*://open.live.bbc.co.uk/*callbacks*",name:"Cache-Control",value:"no-cache"}]},southparkstudios_nu:{min_ver:"1.158.502",root_url:["southparkstudios.nu","southparkstudios.com"],headers_conf:[{url:"*://www.southparkstudios.nu",type:["main_frame"],name:"Cache-Control",value:"no-cache"},{url:"*://www.southparkstudios.com",type:["main_frame"],name:"Cache-Control",value:"no-cache"}],trial:{trial_redirect:"https://www.southparkstudios.nu/"}},skaitv_gr:{min_ver:"1.158.502",root_url:["skaitv.gr"],headers_conf:[{url:"*://extreme-ip-lookup.com",name:"Cache-Control",value:"no-cache"}]},mitele_es:{min_ver:"1.158.502",root_url:["mitele.es"],headers_conf:[{url:"*://cerbero.pro.*.es",name:"Cache-Control",value:"no-cache"}]},telecinco_es:{min_ver:"1.158.502",root_url:["telecinco.es"],headers_conf:[{url:"*://cerbero.pro.*.es",name:"Cache-Control",value:"no-cache"}]},energytv_es:{min_ver:"1.158.502",root_url:["energytv.es"],headers_conf:[{url:"*://cerbero.pro.*.es",name:"Cache-Control",value:"no-cache"}]},ertflix_gr:{min_ver:"1.158.502",root_url:["ertflix.gr"],headers_conf:[{url:"*/geo.json",name:"Cache-Control",value:"no-cache"}]},unidragon_eu:{min_ver:"1.158.502",root_url:["unidragon.eu","unidragon.com"],headers_conf:[{url:"*://cozycountryredirect.addons.business",name:"Cache-Control",value:"no-cache"}]},google_com:{min_ver:"1.158.502",root_url:["google.com"],keep_cookies:true},facebook_com:{min_ver:"1.158.502",root_url:["facebook.com"],keep_cookies:true},youtube_com:{min_ver:"1.158.502",root_url:["youtube.com"],verify:{"*":[{url:"**.googlevideo.com",ret:{status:403,client_only:true}}]},keep_cookies:true,redirect:[{url:"https://www.google.com/sorry/",action:"change_agent"}]},reddit_com:{min_ver:"1.158.502",root_url:["reddit.com"],keep_cookies:true},omegle_com:{min_ver:"1.194.231",root_url:["omegle.com"],webrtc_spoof:{}},disney_com:{min_ver:"1.144.716",root_url:["disney.com","go.com","disneyinternational.com","disney.co.za","disney.com.cn","disney.com.hk","disney.id","disney.co.jp","disney.co.kr","disney.my","disney.ph","disney.sg","disney.com.tw","disney.co.th","disney.com.au","disney.be","disney.bg","disney.cz","disney.dk","disney.de","disney.es","disney.gr","disney.it","disney.hu","disney.nl","disney.no","disney.pl","disney.pt","disney.ro","disney.ch","disney.fi","disney.se","disneyturkiye.com.tr","disney.co.uk","disney.in","disney.com.br","disneylatino.com","disneyme.com","disney.co.il","disney.ca","disney.ru"],trial:{trial_redirect:"https://disney.com/"}},cbs_com:{min_ver:"1.144.716",root_url:["cbs.com"],suggestion_popup:{US:null,"*":{proxy:["US"]}},require_plus:true,premium_site:true,trial:{period:36e5,wait2:5e3,grace_time:6048e5,limits:{count:24,period:864e5},skip_signin:false},verify:{"*":[{url:"**.cbsaavideo.com",ret:{status:403,client_only:true}}]},skip_fix_req_err:["net::ERR_CONNECTION_CLOSED"],headers_conf:[{url:"*://*.cbsaavideo.com/*",name:"Cache-Control",value:"no-cache"},{url:"*://*.cbsivideo.com/*",name:"Cache-Control",value:"no-cache"}]},mtv_ca:{min_ver:"1.144.716",root_url:["mtv.ca"],skip_fix_req_err:["net::ERR_CONNECTION_CLOSED"]},_13tv_co_il:{min_ver:"1.144.716",root_url:["13tv.co.il"],skip_fix_req_err:["net::ERR_CONNECTION_CLOSED"],watermark:{pos:{default:"bottom_right",fullscreen:"top_right"}}},pornhub_com:{min_ver:"1.144.716",root_url:["pornhub.com","pornhubpremium.com"],verify:{"*":[{url:"**.phncdn.com/videos",ret:{status:403,client_only:true}},{url:"**.phncdn.com/hls/videos",ret:{status:403,client_only:true}}]}},xvideos_com:{min_ver:"1.144.716",root_url:["xvideos.com"]},line_me:{min_ver:"1.144.716",root_url:["line.me","linetv.tw"]},footpatrol_com:{min_ver:"1.144.716",root_url:["footpatrol.com","footpatrol.co.uk"]},tenplay_com_au:{min_ver:"1.144.716",root_url:["tenplay.com.au","10play.com.au"]},globaltv_com:{min_ver:"1.144.716",root_url:["globaltv.com"],suggestion_popup:{CA:null,"*":{proxy:["CA"]}},require_plus:true,premium_site:true,trial:{period:36e5,wait2:5e3,grace_time:6048e5,limits:{count:24,period:864e5},skip_signin:false},verify:{ca:[{url:"https://www.globaltv.com/favicon.ico",ret:{status:403,client_only:true}},{url:"https://global.corusappservices.com/location/getiprecord?format=json",ret:{data:{}}}]}},noovo_ca:{min_ver:"1.144.716",root_url:["noovo.ca"],verify:{ca:[{url:"https://edge.api.brightcove.com/playback/*",ret:{status:403,client_only:true}},{url:"https://edge.api.brightcove.com/playback/v1/accounts/618566855001/videos/6096502206001",ret:{data:{}}}]}},ondemandkorea_com:{min_ver:"1.158.340",root_url:["ondemandkorea.com"],verify:{us:[{url:"https://www.ondemandkorea.com/",ret:{status:403,client_only:true}}]}},sprint_com:{min_ver:"1.158.340",root_url:["sprint.com"],verify:{us:[{url:"https://www.sprint.com/",ret:{status:403,client_only:true}}]}},fastpeoplesearch_com:{min_ver:"1.158.340",root_url:["fastpeoplesearch.com"]},bet365_com:{min_ver:"1.158.340",root_url:["bet365.com"],verify:{gb:[{url:"https://www.bet365.com/defaultapi/sports-configuration",ret:{status:302,client_only:true}}]}},disneyplus_com:{require_plus:true,premium_site:true,trial:{period:36e5,wait2:5e3,grace_time:6048e5,limits:{count:24,period:864e5},skip_signin:false},min_ver:"1.157.668",root_url:["disneyplus.com"],suggestion_popup:{US:null,"*":{proxy:["US","GB","CA","NL","AU","NZ","PR","AT","DE","IE","IT","ES","CH","FR"]}},watermark:{pos:{default:"bottom_right",fullscreen:"top_right"}}},hbonow_com:{require_plus:true,premium_site:true,trial:{trial_redirect:"https://play.hbonow.com/"},min_ver:"1.157.668",root_url:["hbonow.com"],suggestion_popup:{US:null,"*":{proxy:["US"]}}},criteo_com:{require_plus:true,premium_site:true,trial:{period:36e5,wait2:5e3,grace_time:6048e5,limits:{count:24,period:864e5},skip_signin:false},min_ver:"1.157.668",root_url:["criteo.com"],suggestion_popup:{US:null,"*":{proxy:["US"]}}},vseinstrumenti_ru:{require_plus:true,premium_site:true,trial:{period:36e5,wait2:5e3,grace_time:6048e5,limits:{count:24,period:864e5},skip_signin:false},min_ver:"1.163.892",root_url:["vseinstrumenti.ru"],suggestion_popup:{RU:null,"*":{proxy:["RU"]}}},twitch_tv:{require_plus:true,premium_site:true,trial:{period:36e5,wait2:5e3,grace_time:6048e5,limits:{count:24,period:864e5},skip_signin:false},min_ver:"1.163.892",root_url:["twitch.tv"],suggestion_popup:{US:{proxy:["GB"]},"*":{proxy:["US"]}}},hotstar_com:{require_plus:true,premium_site:true,trial:{period:36e5,wait2:5e3,grace_time:6048e5,limits:{count:24,period:864e5},skip_signin:false},min_ver:"1.163.892",root_url:["hotstar.com"],suggestion_popup:{IN:null,"*":{proxy:["IN"]}},verify:{in:[{url:"**.akamaized.net",ret:{status:403,client_only:true}},{url:"**.akamaihd.net",ret:{status:403,client_only:true}}]}},pandora_com:{min_ver:"0.0.0",root_url:["pandora.com"],watermark:{pos:{default:"bottom_left"}}},player_pl:{min_ver:"1.163.892",root_url:["player.pl"],suggestion_popup:{PL:null,"*":{proxy:["PL"]}},require_plus:true,premium_site:true,trial:{period:36e5,wait2:5e3,grace_time:6048e5,limits:{count:24,period:864e5},skip_signin:false}},cc_com:{min_ver:"1.163.892",root_url:["cc.com"],suggestion_popup:{US:null,"*":{proxy:["US"]}},require_plus:true,premium_site:true,trial:{period:36e5,wait2:5e3,grace_time:6048e5,limits:{count:24,period:864e5},skip_signin:false},watermark:{pos:{default:"bottom_right",fullscreen:"top_right"}}},globo_com:{min_ver:"1.145.764",root_url:["globo.com"],suggestion_popup:{BR:null,"*":{proxy:["BR"]}},require_plus:true,premium_site:true,trial:{period:36e5,wait2:5e3,grace_time:6048e5,limits:{count:24,period:864e5},skip_signin:false},geo_spoof:{latitude:{from:-14.2400732,to:-15.2400732},longitude:{from:-53.1805017,to:-54.1805017}}},locast_org:{min_ver:"1.145.764",root_url:["locast.org"],geo_spoof:{latitude:{from:38.883333,to:38.883333},longitude:{from:-77,to:-77}}},tv4play_se:{min_ver:"1.163.892",root_url:["tv4play.se"],suggestion_popup:{SE:null,"*":{proxy:["SE"]}},require_plus:true,premium_site:true,trial:{period:36e5,wait2:5e3,grace_time:6048e5,limits:{count:24,period:864e5},skip_signin:false}},crunchyroll_com:{min_ver:"1.163.892",root_url:["crunchyroll.com"],suggestion_popup:{US:null,"*":{proxy:["US"]}},require_plus:true,premium_site:true,trial:{period:36e5,wait2:5e3,grace_time:6048e5,limits:{count:24,period:864e5},skip_signin:false}},mediaset_it:{min_ver:"1.163.892",root_url:["mediaset.it"],suggestion_popup:{IT:null,"*":{proxy:["IT"]}},require_plus:true,premium_site:true,trial:{period:36e5,wait2:5e3,grace_time:6048e5,limits:{count:24,period:864e5},skip_signin:false},site_storage:{"aws.cognito.identity-id.*":null}},raiplay_it:{min_ver:"1.144.716",root_url:["raiplay.it"],suggestion_popup:{IT:null,"*":{proxy:["IT"]}},require_plus:true,premium_site:true,trial:{period:36e5,wait2:5e3,grace_time:6048e5,limits:{count:24,period:864e5},skip_signin:false},verify:{it:[{url:"**.akamaized.net",ret:{status:302,client_only:true}}]}},nrk_no:{min_ver:"1.163.892",root_url:["nrk.no"],suggestion_popup:{NO:null,"*":{proxy:["NO"]}},require_plus:true,premium_site:true,trial:{period:36e5,wait2:5e3,grace_time:6048e5,limits:{count:24,period:864e5},skip_signin:false}},indavideo_hu:{min_ver:"1.163.892",root_url:["indavideo.hu"],suggestion_popup:{HU:null,"*":{proxy:["HU"]}},require_plus:true,premium_site:true,trial:{period:36e5,wait2:5e3,grace_time:6048e5,limits:{count:24,period:864e5},skip_signin:false}},tv2_hu:{min_ver:"1.163.892",root_url:["tv2.hu"],suggestion_popup:{HU:null,"*":{proxy:["HU"]}},require_plus:true,premium_site:true,trial:{period:36e5,wait2:5e3,grace_time:6048e5,limits:{count:24,period:864e5},skip_signin:false}},rtlmost_hu:{min_ver:"1.163.892",root_url:["rtlmost.hu"],suggestion_popup:{HU:null,"*":{proxy:["HU"]}},require_plus:true,premium_site:true,trial:{period:36e5,wait2:5e3,grace_time:6048e5,limits:{count:24,period:864e5},skip_signin:false}},dmdamedia_hu:{min_ver:"1.163.892",root_url:["dmdamedia.hu"],suggestion_popup:{HU:null,"*":{proxy:["HU"]}},require_plus:true,premium_site:true,trial:{period:36e5,wait2:5e3,grace_time:6048e5,limits:{count:24,period:864e5},skip_signin:false}},filmorias_com:{min_ver:"1.163.892",root_url:["filmorias.com"],suggestion_popup:{HU:null,"*":{proxy:["HU"]}},require_plus:true,premium_site:true,trial:{period:36e5,wait2:5e3,grace_time:6048e5,limits:{count:24,period:864e5},skip_signin:false}},dark_ro_com:{min_ver:"1.163.892",root_url:["dark-ro.com"],suggestion_popup:{HU:null,"*":{proxy:["HU"]}},require_plus:true,premium_site:true,trial:{period:36e5,wait2:5e3,grace_time:6048e5,limits:{count:24,period:864e5},skip_signin:false}},tv2_no:{min_ver:"1.163.892",root_url:["tv2.no"],suggestion_popup:{NO:null,"*":{proxy:["NO"]}},require_plus:true,premium_site:true,trial:{period:36e5,wait2:5e3,grace_time:6048e5,limits:{count:24,period:864e5},skip_signin:false}},rte_ie:{min_ver:"1.163.892",root_url:["rte.ie"],suggestion_popup:{IE:null,"*":{proxy:["IE"]}},require_plus:true,premium_site:true,trial:{period:36e5,wait2:5e3,grace_time:6048e5,limits:{count:24,period:864e5},skip_signin:false}},svtplay_se:{min_ver:"1.163.892",root_url:["svtplay.se"],suggestion_popup:{SE:null,"*":{proxy:["SE"]}},require_plus:true,premium_site:true,trial:{period:36e5,wait2:5e3,grace_time:6048e5,limits:{count:24,period:864e5},skip_signin:false}},livestream_com:{min_ver:"1.163.892",root_url:["livestream.com"],suggestion_popup:{DE:{proxy:["US","*"]},"*":{proxy:["DE","US","*"]}},require_plus:true,premium_site:true,trial:{period:36e5,wait2:5e3,grace_time:6048e5,limits:{count:24,period:864e5},skip_signin:false}},textnow_com:{min_ver:"1.163.892",root_url:["textnow.com"],suggestion_popup:{US:null,"*":{proxy:["US"]}},require_plus:true,premium_site:true,trial:{period:36e5,wait2:5e3,grace_time:6048e5,limits:{count:24,period:864e5},skip_signin:false}},scor_dk:{min_ver:"1.163.892",root_url:["scor.dk"],suggestion_popup:{DK:null,"*":{proxy:["DK"]}},require_plus:true,premium_site:true,trial:{period:36e5,wait2:5e3,grace_time:6048e5,limits:{count:24,period:864e5},skip_signin:false}},iwant_ph:{min_ver:"1.170.680",root_url:["iwant.ph"],web_worker_proxy:true},tvnow_de:{min_ver:"1.170.680",root_url:["tvnow.de"],web_worker_proxy:true},voot_com:{min_ver:"1.170.680",root_url:["voot.com"],web_worker_proxy:true},sonyliv_com:{min_ver:"1.170.680",root_url:["sonyliv.com"],web_worker_proxy:true},tinder_com:{min_ver:"1.170.680",root_url:["tinder.com"],web_worker_proxy:true},primevideo_com:{min_ver:"1.170.680",root_url:["primevideo.com"],web_worker_proxy:true},tsn_ca:{min_ver:"1.163.892",root_url:["tsn.ca"],suggestion_popup:{CA:null,"*":{proxy:["CA","*"]}},require_plus:true,premium_site:true,trial:{period:36e5,wait2:5e3,grace_time:6048e5,limits:{count:24,period:864e5},skip_signin:false}},sportsnet_ca:{min_ver:"1.163.892",root_url:["sportsnet.ca"],suggestion_popup:{CA:null,"*":{proxy:["CA","*"]}},require_plus:true,premium_site:true,trial:{period:36e5,wait2:5e3,grace_time:6048e5,limits:{count:24,period:864e5},skip_signin:false}},nba_com:{min_ver:"1.163.892",root_url:["nba.com"],suggestion_popup:{US:null,"*":{proxy:["US","*"]}},require_plus:true,premium_site:true,trial:{period:36e5,wait2:5e3,grace_time:6048e5,limits:{count:24,period:864e5},skip_signin:false}},atttvnow_com:{min_ver:"1.163.892",root_url:["atttvnow.com"],suggestion_popup:{US:null,"*":{proxy:["US","*"]}},require_plus:true,premium_site:true,trial:{period:36e5,wait2:5e3,grace_time:6048e5,limits:{count:24,period:864e5},skip_signin:false}},bleacherreport_com:{min_ver:"1.163.892",root_url:["bleacherreport.com"],suggestion_popup:{US:null,"*":{proxy:["US","*"]}},require_plus:true,premium_site:true,trial:{period:36e5,wait2:5e3,grace_time:6048e5,limits:{count:24,period:864e5},skip_signin:false},headers_conf:[{url:"https://live.bleacherreport.com/",type:["main_frame"],name:"Cache-Control",value:"no-cache"}]},tvplayer_com:{min_ver:"1.163.892",root_url:["tvplayer.com"],suggestion_popup:{US:null,"*":{proxy:["US","*"]}},require_plus:true,premium_site:true,trial:{period:36e5,wait2:5e3,grace_time:6048e5,limits:{count:24,period:864e5},skip_signin:false}},flobikes_com:{min_ver:"1.163.892",root_url:["flobikes.com"],suggestion_popup:{CA:null,"*":{proxy:["CA","*"]}},require_plus:true,premium_site:true,trial:{period:36e5,wait2:5e3,grace_time:6048e5,limits:{count:24,period:864e5},skip_signin:false}},nbcsports:{min_ver:"1.163.892",root_url:["nbcsports.com"],suggestion_popup:{US:null,"*":{proxy:["US","*"]}},require_plus:true,premium_site:true,trial:{period:36e5,wait2:5e3,grace_time:6048e5,limits:{count:24,period:864e5},skip_signin:false}},fubo_tv:{min_ver:"1.163.892",root_url:["fubo.tv"],suggestion_popup:{US:null,"*":{proxy:["US","*"]}},require_plus:true,premium_site:true,trial:{period:36e5,wait2:5e3,grace_time:6048e5,limits:{count:24,period:864e5},skip_signin:false}},"9now_com_au":{min_ver:"1.163.892",root_url:["9now.com.au"],suggestion_popup:{AU:null,"*":{proxy:["AU","*"]}},require_plus:true,premium_site:true,trial:{period:36e5,wait2:5e3,grace_time:6048e5,limits:{count:24,period:864e5},skip_signin:false}},sling_com:{min_ver:"1.163.892",root_url:["sling.com"],suggestion_popup:{US:null,"*":{proxy:["US","*"]}},require_plus:true,premium_site:true,trial:{period:36e5,wait2:5e3,grace_time:6048e5,limits:{count:24,period:864e5},skip_signin:false}},tennistv_com:{min_ver:"1.163.892",root_url:["tennistv.com"],suggestion_popup:{US:null,"*":{proxy:["US","GB","IT","*"]}},require_plus:true,premium_site:true,trial:{period:36e5,wait2:5e3,grace_time:6048e5,limits:{count:24,period:864e5},skip_signin:false}},willow_tv:{min_ver:"1.163.892",root_url:["willow.tv"],suggestion_popup:{US:null,"*":{proxy:["US","*"]}},require_plus:true,premium_site:true,trial:{period:36e5,wait2:5e3,grace_time:6048e5,limits:{count:24,period:864e5},skip_signin:false}},skysports_com:{min_ver:"1.163.892",root_url:["skysports.com"],suggestion_popup:{GB:null,"*":{proxy:["GB","*"]}},require_plus:true,premium_site:true,trial:{period:36e5,wait2:5e3,grace_time:6048e5,limits:{count:24,period:864e5},skip_signin:false}}},pool:{min_ver:"1.149.460"},debug_logs:{enabled_perc:100,domains:["bbc.co.uk","bbc.com","cbs.com","channel4.com","espn.com","facebook.com","globo.com","hotstar.com","hulu.com","mitele.es","mtv.ca","netflix.com","omegle.com","tvp.pl","vk.com","yahoo.com","itv.com","disneyplus.com","pornhub.com","pornhubpremium.com"],all_domains_perc:20,screenshot_conflict_rate:0},mitm:{disable:false,discovery:"auto",manual:{min_ver:"1.130.62",trigger:true,disable:false},auto:{disable:true,min_ver:"1.136.280",trigger:true,error:{trigger:true,disable:false},fake_resp:{min_ver:"1.138.399",trigger:true,disable:false},redirect:{min_ver:"1.138.399",trigger:true,disable:false}},min_version:"1.129.426",enable_ext_ui:1,popup:{enable:true,min_version:"1.131.310"},site_blacklist:["twitter.com","adpop.club","google.com","youtube.com"],send_dbg_log:10,log:{random:10,countries:["us"],uuids:["c07b61feb81ecc8a857c57874b166756"]},redirect_filter:[{domain:"accounts.google.com"},{domain:"www.google.com"},{domain:"login.live.com"},{domain:"login.microsoftonline.com"},{domain:"outlook.live.com"},{domain:"www.facebook.com"},{domain:"www.bing.com"}],response_filter:[{statusCode:503,server:"cloudflare","cache-control":"no-cache"}]},mitm2:{min_ver:"1.178.829",rule_min_ts:16073856e5,trace:{print_to_logs:true,add_to_perr:true},rules:[{conf:{exclude_sites:["google.com","youtube.com"],retry_after:36e5,inside_popup:false,reasons:{invalid_cert:{enable:true,mode:"auto"}}}},{filter:{root_url_in:["facebook.com"],src_country_in:["RU"]},conf:{reasons:{invalid_cert:{enable:true,mode:"auto"},redirect:{enable:true,mode:"auto"},conn_error:{enable:true,mode:"auto"}}}},{filter:{uuid_md5_in:["5c3265a6eed1b51922bff173effe714d","41df0af1934f978d041e7d51a3aa8114","41ca7545e6cc0531d70e32b3b3af90dd","5142fa47ac3f82985cff69b1a98ab78f","19f972fd0b275974dbf30ba3977c9222","921b6329c86e8e2c023e5c9c410dab6f","196edf22182fcb8cffc1f305ac848e3a","4244434f35ba5a1656ff2e754e42975a","3a6a6927bef553c38f3910f570a82b12","3ea879523c2ec3ba9fe7c67bcaf43b5c","954244c8feb7a940bff4b50105107b0f","912e8bb4d20ae3110af2249bb38a2dfa","f542472e29cf9d783bd0c9ea9460003e","31f551ed835ca9cb5c959e6f62938562","e84d278ba221be50b93790b3890c44f1"]},conf:{reasons:{redirect:{enable:true,mode:"auto"},timeout:{enable:true,mode:"manual"}}}}]},protect_ui2:{enable:true,enable_ratio:1,protect_browser:true,protect_pc_min_ver:"1.134.588",tooltips:true,test_name:"test_protect_ui2"},geo_popup:{watermark:{position:"bottom_right",position_fullscreen:"top_right",allow_hide:false,banner:{min_ver:"1.166.473",type:"upgrade"}}},popup:{disable:false,disable_max_ver:"1.130.481",dont_show_def_period:"30d"},perr_sample:{be_verify_proxy_ok:.01,be_bext_config_success:.01,be_mitm_ignore:.01,be_new_unblocker_api_init:.01,be_debug_no_agents:.01},media_failure:{disable:false,disable_set_err:false,new_media_fix:true,types:["xmlhttprequest","media"],extensions:["mp4","m3u8","ts","mpd","dash","m4s","m4v"],rules:[{domain:"bbc.com",set_err:true,max_retry:3},{domain:"bbc.co.uk",set_err:true,max_retry:3},{domain:"hulu.com",urls:["*://play.hulu.com/*/playlist"],set_err:true},{domain:"itv.com",urls:["*://*.itv.com/playlist/*"]},{domain:"netflix.com",urls:["*://*.nflxvideo.net/*"],set_err:true}],set_err_rate_limit:{ms:36e5,count:10}},browse_failure:{disable:false,types:["main_frame"],rules:[{domain:"netflix.com",urls:["*://*.netflix.com/login*","*://*.netflix.com/browse*"]}]},request_errors:{handle:["net::ERR_PROXY_CONNECTION_FAILED","net::ERR_CONNECTION_CLOSED","net::ERR_CONNECTION_RESET","net::ERR_TIMED_OUT","net:ERR_CONNECTION_TIMED_OUT"],retry:{disable_media_failure:false,sporadic_perc:5,max:5}},bg_ajax:{on:1,min_version:"1.167.61",disable_perr:0,client_uri:"/client_cgi/server_ts",disable_slow_perr:true,disable_agent_domain_fallback:true,enable_agent_domain_fallback_min_ver:"1.201.706"},payment:{all_plans:[],watermark_plan_ids:["josh_3y","y12005","m12005"],trial_plan_ids:["josh_3y","y12005","m12005"],bonus_plan_id:"y12005d"},verify_period_ms:864e5,verify_proxy:{min_ver:"1.156.341",period_ms:864e5,disable_verify:false,verify_err:{period:864e5,count:1e4}},proxy_error_ui:{min_ver:"9.999.999",icon:true,popup:true,dialog:false},reauth:{period:9e5},upgrade_link:{enabled:true,position:"right"},ip_check_min_ver:"1.160.558",is_zgettunnels_post2:0,is_zgettunnels_post3:1,is_zgettunnels_post4:1,rate_us:{urls:[{url:"https://www.trustpilot.com/evaluate/hola.org",rand:.2,countries:["AT","BE","CZ","FR","DE","IE","LI","LU","MC","NL","CH","GB","US","CA"]},{url:"store",rand:1}]},no_log_for_plus:false,no_log_for_uid:{},no_log_perrs:["be_install","be_update","be_vpn_ok","be_ui_vpn_click_no_fix_it","be_ui_vpn_click_no_fix_it_multi","be_report_problem","be_issue_report","be_etask_typeerror_known","be_etask_typeerror_unknown"],tpopup_window_min_ver:"1.168.477",disable_slow_load_monitor:true,popular_sites:{siteicon_url:"https://cdn4.hola.org/access/siteicon/${root_url}/${size}",sitepic_url:"https://sitepic-mirror-holanetworksltd.netdna-ssl.com/${root_url}.png"},new_design_min_ver:"1.169.230",new_wm_design_min_ver:"1.169.696",new_plans_design_min_ver:"9.999.999",tpopup:{allow_youtube_min_ver:"1.173.107",allow_google_min_ver:"9.999.999",allow_rule_rating_youtube_min_ver:"9.999.999",allow_rule_rating_google_min_ver:"9.999.999"},use_server_ts_min_ver:"1.173.522",trustpilot_rating:"4.5",dialogs:{trial_running:{free_text:"<a><b>Stay Free</b></a><br/>and keep using the Free VPN for %%root_url%%",plus_text:"<a><b>Upgrade to Premium</b></a><br/>and enjoy unlimited time",free_btn:"Continue Free",plus_btn:"Go Premium",free_content:"",plus_content:'<div style="text-align: center;"><div style="font-size: 12px;">Start from</div><div style="font-size: 24px; line-height: 40px">$2.99</div><div style="font-size: 12px;">/ month</div></div>',plus_template:'<div style="text-align: center;"><div style="font-size: 12px;">Start from</div><div style="font-size: 24px; line-height: 40px">%%price%%</div><div style="font-size: 12px;">/ %%every%%</div></div>',bonus_text:"",bonus_btn:"",bonus_obj:"",buttons:["free","plus"]},trial_end_wait:{free_text:"<a><b>Stay Free</b></a><br/>Time until your next free hour:",plus_text:"<a><b>Upgrade to Premium</b></a><br/>and enjoy unlimited time",free_btn:"Continue Free",plus_btn:"Go Premium",free_content:"",plus_content:'<div style="text-align: center;"><div style="font-size: 12px;">Start from</div><div style="font-size: 24px; line-height: 40px">$2.99</div><div style="font-size: 12px;">/ month</div></div>',plus_template:'<div style="text-align: center;"><div style="font-size: 12px;">Start from</div><div style="font-size: 24px; line-height: 40px">%%price%%</div><div style="font-size: 12px;">/ %%every%%</div></div>',bonus_text:"",bonus_btn:"",bonus_obj:"",buttons:["free","plus"]},trial_end:{free_text:"<a><b>Stay Free</b></a><br/>get more Free VPN time",plus_text:"<a><b>Upgrade to Premium</b></a><br/>and enjoy unlimited time",free_btn:"Continue Free",plus_btn:"Go Premium",free_content:'<div style="text-align: center;"><div style="font-size: 24px; line-height: 40px">Free</div><div style="font-size: 12px">time</div></div>',plus_content:'<div style="text-align: center;"><div style="font-size: 12px;">Start from</div><div style="font-size: 24px; line-height: 40px">$2.99</div><div style="font-size: 12px;">/ month</div></div>',plus_template:'<div style="text-align: center;"><div style="font-size: 12px;">Start from</div><div style="font-size: 24px; line-height: 40px">%%price%%</div><div style="font-size: 12px;">/ %%every%%</div></div>',bonus_text:"",bonus_btn:"",bonus_obj:"",buttons:["free","plus"]},trial_end_long:{free_btn:"Load more time"},trial_waiting:{free_text:"<a><b>Stay Free</b></a><br/>Loading free time...",plus_text:"<a><b>Upgrade to Premium</b></a><br/>and enjoy unlimited time",free_btn:"Continue for free",plus_btn:"Watch now",free_content:"",plus_content:'<div style="text-align: center;"><div style="font-size: 12px;">Start from</div><div style="font-size: 24px; line-height: 40px">$2.99</div><div style="font-size: 12px;">/ month</div></div>',plus_template:'<div style="text-align: center;"><div style="font-size: 12px;">Start from</div><div style="font-size: 24px; line-height: 40px">%%price%%</div><div style="font-size: 12px;">/ %%every%%</div></div>',bonus_text:"",bonus_btn:"",bonus_obj:"",buttons:["free","plus"]},trial_waiting_long:{free_t2:"You will get more free time in..."},trial_start:{free_text:"<a><b>Stay Free</b></a><br/>Enjoy free VPN time",plus_text:"<a><b>Upgrade to Premium</b></a><br/>and enjoy unlimited time",free_btn:"Start Now",plus_btn:"Upgrade to Premium",free_content:'<div style="text-align: center;"><div style="font-size: 24px; line-height: 40px">Free</div><div style="font-size: 12px">time</div></div>',plus_content:'<div style="text-align: center;"><div style="font-size: 12px;">Start from</div><div style="font-size: 24px; line-height: 40px">$2.99</div><div style="font-size: 12px;">/ month</div></div>',plus_template:'<div style="text-align: center;"><div style="font-size: 12px;">Start from</div><div style="font-size: 24px; line-height: 40px">%%price%%</div><div style="font-size: 12px;">/ %%every%%</div></div>',bonus_text:"",bonus_btn:"",bonus_obj:"",buttons:["free","plus"]},trial_ready:{free_btn:"Continue watching"},ext_trial_end:{free_title:"Stay Free",free_subtitle:"Enjoy limited VPN time",plus_title:"Upgrade to Premium",plus_subtitle:"Enjoy unlimited usage",moneyback:"100% money-back guarantee policy",free_btn:""},ext_trial_end_long:{free_btn:"Load more time"},ext_trial_end_wait:{free_title:"Stay Free",free_subtitle:"Wait for more free VPN time",plus_title:"Upgrade to Premium",plus_subtitle:"Enjoy unlimited usage",moneyback:"100% money-back guarantee policy",free_btn:""},ext_trial_waiting:{free_title:"Stay Free",free_subtitle:"Enjoy limited VPN time",plus_title:"Upgrade to Premium",plus_subtitle:"Enjoy unlimited usage",moneyback:"100% money-back guarantee policy",free_btn:"Loading free VPN time of %%root_url%%"},ext_trial_start:{free_title:"Stay Free",free_subtitle:"Enjoy limited VPN time",plus_title:"Upgrade to Premium",plus_subtitle:"Enjoy unlimited usage",moneyback:"100% money-back guarantee policy",free_btn:""},ext_trial_ready:{free_btn:"Continue watching"},ext_plans:{title:"Upgrade to Premium",subtitle:"Enjoy unlimited usage",moneyback:"100% money-back guarantee policy"}},redirect:[{url:"https://www.google.com/sorry/",action:"change_agent"}],headers_conf2:[{type:["main_frame"],name:"Cache-Control",value:"no-cache"}],show_plans_on_footer_click:true,main_frame_errors_only:true,ext_trial_dialog_min_ver:"1.175.169",ext_trial_watch_time_min_ver:"1.183.308",svc:{use_new_monitor2:true},signup_bonus_menu:{min_ver:"9.999.999",install_ts_gt:12096e5},disable_bext_config_etag_usage:true,disable_hola_hostname_fallback:false,rating_popup:{min_ver:"9.999.999"},exclude_countries:[],premium_countries:[],collect_proxied_hosts:{enabled:false,interval:6e4,threshold:6e5},proxy_rules:{exceptions:{dynamic:["netflix.com","hulu.com","hulu.jp","itv.com","channel4.com","rte.ie"],peer:["netflix.com","hulu.com","hulu.jp","itv.com","channel4.com","rte.ie"],pairs:[["bbc.com","bbc.co.uk"]],limited:[]},blacklist:{"equinix.com":true,"digitalocean.com":true,"oceanconservancy.org":true,"mail.yahoo.com":true,"mail.yahoo.co.jp":true,"mail.aol.com":true,"mail.aol.fr":true,"mail.com":true,"gmx.com":true,"couponcabin.com":true,"outlook.live.com":true,"hotmail.live.com":true,"outlook.com":true,"mailto.space":true,"e.mail.ru":true,"login.sso.bluewin.ch":true,"secure.centurylink.net":true,"secureserver.net":true,"webmail.usfamily.net":true,"webmail.skymesh.net.au":true,"hanmail.net":true,"mail.rambler.ru":true,"freeola.co.uk":true,"webmail-04.datacenter.cha.cantv.net":true,"linustechtips.com":true,"3capp-mailcom-lxa01.server.lan":true,"noiholiday.com":true,"hostedemail.com":true,"heyholla.com":true,"hellixeducation.com":true,"unisalento.it":true,"secrel.com.br":true,"mailorama.fr":true,"kiwiirc.com":true,"derpibooru.org":true,"trixiebooru.org":true,"derpiboo.ru":true,"derpicdn.net":true,"alice.it":true,"vcwebmail.ocn.ad.jp":true,"tentaciones18.com":true,"ocn.ad.jp":true,"ocn.ne.jp":true,"webmail.numericable.fr":true,"webmail.scarlet.be":true,"webmailer.de":true,"mail.uk.tiscali.com":true,"elisa.fi":true,"saunalahti.fi":true,"globalgiving.org":true,"knology.net":true,"netmail.pipex.net":true,"playstation.com":true,"playstation.net":true,"playstationnetwork.com":true,"sonymusic.com":true,"sonypictures.com":true,"sonyentertainmentnetwork.com":true,"perfora.net":true,"hmail.com":true,"gigablast.com":true,"126.com":true,"ono.com":true,"funded.today":true,"manenetheoffnewconne.ru":true,"dlfeed.com":true,"odbnfhbyagyz4.net":true,"pinformationbwarranties.ru":true,"musttthewithoutalsothas.ru":true,"bjkaolp4ds4z.com":true,"advseeking.com":true,"companolo.com":true,"mijnbankering-nl-server.com":true,"froekuge.com":true,"updateacces.org":true,"sophisticatiretaj.net":true,"soap4.me":true,"boriel.com":true,"ebb.mtn.co.za":true,"osbservices.vodacom.co.za":true,"apps.telkom.co.za":true,"holadebug.com":true,"fretebras.com.br":true,"megacupons.online":true,"vitacostapi.bbhosted.com":true,"mobilepayca.com":true,"mobilepayusa.org":true,"mobilepayusa.mobi":true,"mobilepayusa.net":true,"mobilepay-web.gaiareply.eu":true,"puffin.com":true,"miosmsclub.com":true,"linkedin.com":true,"ticketsnow.com":true,"playerline.com":true,"ticketmaster.com":true,"ticketmaster.com.mx":true,"livenation.com":true,"stubhub.com":true,"tickets.com":true,"kufar.by":true,"fastpeoplesearch.com":true,"btc4you.com":true,"elbitcoingratis.es":true,"btcmine.net":true,"virtualfaucet.net":true,"rawbitcoins.net":true,"freebitcoins4u.com":true,"canhasbitcoin.com":true,"bitcats.net":true,"faucetbtc.com":true,"bitcoins4free.me":true,"thefreebitcoins.net":true,"freebitcoins.me":true,"5mindoge.com":true,"freedoge.co.in":true,"moondoge.co.in":true,"moonbit.co.in":true,"bonusbitcoin.co":true,"bitcoinspace.net":true,"btc-faucet.co":true,"treebitcoin.com":true,"flatcoin.net":true,"baglitecoin.com":true,"moonliteco.in":true,"freebitco.in":true,"github.com":true,"smartadvices.com":true,"generictadalafilusa.com":true,"getitllc.com":true,"createyourownteeshirtonline.com":true,"mondino.it":true,"daum.net":true,"workbooks.com":true,"forum.qt.io":true,"radicalexploits.com":true,"craigslist.org":true,"craigslist.ca":true,"craigslist.co.uk":true,"bisaboard.de":true,"criusenergy.com":true,"arenagroup.com":true,"truqueira.com":true,"cratejoy.com":true,"gaynext.ca":true,"hispachan.org":true,"freenode.net":true,"sony.com":true,"exigent.com.au":true,"au.edu":true,"runsignup.com":true,"thegreekbookstore.com":true,"arriveonline.com.au":true,"reimageplus.com":true,"goso.info":true,"checkip.dyndns.org":true,"warezshare.org":true,"blocklist.de":true,"twiki.org":true,"intherooms.com":true,"globalinnovationexchange.org":true,"portal.webgods.de":true,"postfinance.ch":true,"synacor.com":true,"gvtc.com":true,"cantv.net":true,"homepage-baukasten.de":true,"paginawebgratis.es":true,"own-free-website.com":true,"sitowebfaidate.it":true,"ma-page.fr":true,"homepage-konstruktor.ru":true,"bedava-sitem.com":true,"stronygratis.pl":true,"news.ycombinator.com":true,"tdchosting.dk":true,"infusionsoft.com":true,"puregaming.es":true,"blogalizate.com":true,"teftv.com":true,"porticolegal.com":true,"physicalmed.es":true,"htcmania.com":true,"tebeosfera.com":true,"grupopuntacana.rubypanel.com":true,"fansdeapple.com":true,"cerebriti.com":true,"educaciontrespuntocero.com":true,"pymescomercial.com":true,"creativat.com":true,"financiacionparaempresas.net":true,"moon.rightdns.com":true,"uptodate.com":true,"judoprincast.com":true,"office365.com":true,"primalforce.net":true,"maszynykrzak.pl":true,"resdrob.com":true,"yumeiho.com":true,"bb.com.br":true,"esnb.org.uk":true,"claimantcommitments.org.uk":true,"comcloud.xyz":true,"nearsales.in":true,"frysztak.pl":true,"hostgator.com":true,"tpc-017.mach3builders.nl":true,"it-svbuero.de":true,"musicapassionata.com":true,"1nyecta.com":true,"10-4media.com":true,"10000dogturds.com":true,"innowee.eu":true},enable:true,stamp:0,unblocker_plus:{ads:{cmds:[{hosts:["google-analytics.com","analytics.twitter.com","googleadservices.com","p.adsymptotic.com","googletagmanager.com","bat.bing.com","adservice.google.com","doubleclick.net","gstatic.com","googlesyndication.com","2mdn.net","q.quora.com","analytics.edgekey.net","amazon-adsystem.com","users.quantumgraph.com","images-na.ssl-images-amazon.com","bh.contextweb.com","pixel-sync.sitescout.com","ads-twitter.com","googletagservices.com","scorecardresearch.com","outbrain.com","cdnjs.cloudflare.com","adservice.google.com.pk","adservice.google.com.ph","adroll.com","analytics.yahoo.com","spl.zeotap.com","a-ads.com"],then:"PROXY XX",if:[]}]},torrents:{cmds:[{hosts:["104.28.1.30","104.28.16.69","107.150.14.110","109.121.134.121","114.55.113.60","125.227.35.196","128.199.70.66","157.7.202.64","158.69.146.212","173.254.204.71","178.175.143.27","178.33.73.26","182.176.139.129","185.5.97.139","188.165.253.109","194.106.216.222","195.123.209.37","210.244.71.25","210.244.71.26","213.159.215.198","213.163.67.56","37.19.5.139","37.19.5.155","46.4.109.148","5.79.249.77","5.79.83.193","51.254.244.161","59.36.96.77","74.82.52.209","80.246.243.18","81.200.2.231","85.17.19.180","87.248.186.252","87.253.152.137","91.216.110.47","91.217.91.21","91.218.230.81","93.92.64.5","104.28.17.69","atrack.pow7.com","bt.henbt.com","bt.pusacg.org","bt2.careland.com.cn","coppersurfer.tk","explodie.org","fasttracker.foreverpirates.co","ipv4.tracker.harry.lu","mgtracker.org","open.acgtracker.com","open.lolicon.eu","open.stealth.si","open.touki.ru","opentor.org","opentracker.i2p.rocks","p4p.arenabg.ch","p4p.arenabg.com","pow7.com","retracker.gorcomnet.ru","retracker.krs-ix.ru","secure.pow7.com","t1.pow7.com","t2.pow7.com","thetracker.org","torrent.gresille.org","torrentsmd.com","tracker.aletorrenty.pl","tracker.baravik.org","tracker.birkenwald.de","tracker.bittor.pw","tracker.bittorrent.am","tracker.calculate.ru","tracker.cyberia.is","tracker.dler.org","tracker.dutchtracking.com","tracker.dutchtracking.nl","tracker.edoardocolombo.eu","tracker.ex.ua","tracker.filetracker.pl","tracker.flashtorrents.org","tracker.grepler.com","tracker.internetwarriors.net","tracker.kicks-ass.net","tracker.kuroy.me","tracker.leechers-paradise.org","tracker.mg64.net","tracker.moeking.me","tracker.opentrackr.org","tracker.skyts.net","tracker.tfile.me","tracker.tiny-vps.com","tracker.torrent.eu.org","tracker.tvunderground.org.ru","tracker.uw0.xyz","tracker.yoshi210.com","tracker.zer0day.to","tracker1.wasabii.com.tw","tracker2.itzmx.com","tracker2.wasabii.com.tw","www.wareztorrent.com"],then:"DIRECT",if:[]}]},proxy_from_agent:{cmds:[{hosts:["api.waxsweden.org","userstorage.mega.co.nz"],then:"PROXY XX",if:[]}]},facebook:{proxy_country:["AR","AT","AU","BE","BG","BR","CA","CH","CL","CO","CZ","DE","DK","ES","FI","FR","GB","GR","HK","HR","HU","ID","IE","IL","IN","IT","IS","JP","KR","MX","NL","NO","NZ","PL","RO","RU","SE","SG","SK","TR","US"],cmds:[{hosts:["facebook.com","facebook.net"],then:"PROXY XX",if:[]}]},google:{match:{root_urls:["google.com"],rules:[{proxy_country:["IT"],cmds:[{root_urls:["google.com"],then:"PROXY IT.POOL_lum_it_shared",if:[]},{hosts:["google.com","google.co.in","googleapis.com","ampproject.org","www.google.com","mtalk.google.com","clients4.google.com","play.google.com","maps.googleapis.com","accounts.google.com","safebrowsing.googleapis.com","history.google.com","optimizationguide-pa.googleapis.com","clients2.google.com","safebrowsing.google.com","fonts.googleapis.com","apis.google.com","content-autofill.googleapis.com"],then:"PROXY IT.POOL_lum_it_shared",if:[]}]},{proxy_country:["CA"],cmds:[{root_urls:["google.com"],then:"PROXY CA.POOL_lum_ca_shared"},{hosts:["google.com","google.co.in","googleapis.com","ampproject.org","www.google.com","mtalk.google.com","clients4.google.com","play.google.com","maps.googleapis.com","accounts.google.com","safebrowsing.googleapis.com","history.google.com","optimizationguide-pa.googleapis.com","clients2.google.com","safebrowsing.google.com","fonts.googleapis.com","apis.google.com","content-autofill.googleapis.com"],then:"PROXY CA.POOL_lum_ca_shared"}]},{proxy_country:["GB"],cmds:[{root_urls:["google.com"],then:"PROXY GB.POOL_lum_gb_shared"},{hosts:["google.com","google.co.in","googleapis.com","ampproject.org","www.google.com","mtalk.google.com","clients4.google.com","play.google.com","maps.googleapis.com","accounts.google.com","safebrowsing.googleapis.com","history.google.com","optimizationguide-pa.googleapis.com","clients2.google.com","safebrowsing.google.com","fonts.googleapis.com","apis.google.com","content-autofill.googleapis.com"],then:"PROXY GB.POOL_lum_gb_shared"}]},{proxy_country:["NL"],cmds:[{root_urls:["google.com"],then:"PROXY NL.POOL_lum_nl_shared"},{hosts:["google.com","google.co.in","googleapis.com","ampproject.org","www.google.com","mtalk.google.com","clients4.google.com","play.google.com","maps.googleapis.com","accounts.google.com","safebrowsing.googleapis.com","history.google.com","optimizationguide-pa.googleapis.com","clients2.google.com","safebrowsing.google.com","fonts.googleapis.com","apis.google.com","content-autofill.googleapis.com"],then:"PROXY NL.POOL_lum_nl_shared"}]},{proxy_country:["FR"],cmds:[{root_urls:["google.com"],then:"PROXY FR.POOL_lum_fr_shared"},{hosts:["google.com","google.co.in","googleapis.com","ampproject.org","www.google.com","mtalk.google.com","clients4.google.com","play.google.com","maps.googleapis.com","accounts.google.com","safebrowsing.googleapis.com","history.google.com","optimizationguide-pa.googleapis.com","clients2.google.com","safebrowsing.google.com","fonts.googleapis.com","apis.google.com","content-autofill.googleapis.com"],then:"PROXY FR.POOL_lum_fr_shared"}]},{proxy_country:["ES"],cmds:[{root_urls:["google.com"],then:"PROXY ES.POOL_lum_es_shared"},{hosts:["google.com","google.co.in","googleapis.com","ampproject.org","www.google.com","mtalk.google.com","clients4.google.com","play.google.com","maps.googleapis.com","accounts.google.com","safebrowsing.googleapis.com","history.google.com","optimizationguide-pa.googleapis.com","clients2.google.com","safebrowsing.google.com","fonts.googleapis.com","apis.google.com","content-autofill.googleapis.com"],then:"PROXY ES.POOL_lum_es_shared"}]},{proxy_country:["US"],cmds:[{root_urls:["google.com"],then:"PROXY US.POOL_lum_us_shared"},{hosts:["google.com","google.co.in","googleapis.com","ampproject.org","www.google.com","mtalk.google.com","clients4.google.com","play.google.com","maps.googleapis.com","accounts.google.com","safebrowsing.googleapis.com","history.google.com","optimizationguide-pa.googleapis.com","clients2.google.com","safebrowsing.google.com","fonts.googleapis.com","apis.google.com","content-autofill.googleapis.com"],then:"PROXY US.POOL_lum_us_shared"}]},{proxy_country:["KR"],cmds:[{root_urls:["google.com"],then:"PROXY KR.POOL_lum_kr_shared"},{hosts:["google.com","google.co.in","googleapis.com","ampproject.org","www.google.com","mtalk.google.com","clients4.google.com","play.google.com","maps.googleapis.com","accounts.google.com","safebrowsing.googleapis.com","history.google.com","optimizationguide-pa.googleapis.com","clients2.google.com","safebrowsing.google.com","fonts.googleapis.com","apis.google.com","content-autofill.googleapis.com"],then:"PROXY KR.POOL_lum_kr_shared"}]},{proxy_country:["BR"],cmds:[{root_urls:["google.com"],then:"PROXY BR.POOL_lum_br_shared"},{hosts:["google.com","google.co.in","googleapis.com","ampproject.org","www.google.com","mtalk.google.com","clients4.google.com","play.google.com","maps.googleapis.com","accounts.google.com","safebrowsing.googleapis.com","history.google.com","optimizationguide-pa.googleapis.com","clients2.google.com","safebrowsing.google.com","fonts.googleapis.com","apis.google.com","content-autofill.googleapis.com"],then:"PROXY BR.POOL_lum_br_shared"}]},{proxy_country:["NO","GR","DE","DK","SE","CL","SG","CH","EG","RU","PL","IE","CN","IL","AR","HU","BE","FI","MX","HR","SI","SK","TR","TW","TH","JM","VN","PE","PH","ID","RO","ZA","BG","AT","NZ","CZ","IS","PT","BZ","UA"],cmds:[{hosts:["google.com","google.co.in","googleapis.com","ampproject.org","www.google.com","mtalk.google.com","clients4.google.com","play.google.com","maps.googleapis.com","accounts.google.com","safebrowsing.googleapis.com","history.google.com","optimizationguide-pa.googleapis.com","clients2.google.com","safebrowsing.google.com","fonts.googleapis.com","apis.google.com","content-autofill.googleapis.com"],then:"PROXY XX"}]}]}},daycoval_com_br:{match:{root_urls:["daycoval.com.br"],rules:[{proxy_country:["BR"],cmds:[{hosts:["www.daycoval.com.br"],then:"PROXY BR.PEER",if:[]}]}]},cmds:[{hosts:["www.daycoval.com.br"],then:"PROXY BR.PEER",if:[]}]},salto_fr:{match:{root_urls:["salto.fr"],rules:[{proxy_country:["FR"],cmds:[{hosts:["geo.salto.fr","android.middleware.salto.fr","layout.salto.fr","front-auth.salto.fr","youboranqs01.com","youboranqs02.com","youboranqs03.com"],then:"PROXY FR.PEER",if:[]}]}]},cmds:[{hosts:["geo.salto.fr","android.middleware.salto.fr","layout.salto.fr","front-auth.salto.fr","youboranqs01.com","youboranqs02.com","youboranqs03.com"],then:"PROXY FR.PEER",if:[]}]},hibbett_com:{match:{root_urls:["hibbett.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["hibbett.com"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{hosts:["hibbett.com"],then:"PROXY US.PEER",if:[]}]},nowonline_com_br:{match:{root_urls:["nowonline.com.br"],rules:[{proxy_country:["BR"],cmds:[{hosts:["www.nowonline.com.br"],then:"PROXY BR.PEER",if:[]}]}]},cmds:[{hosts:["www.nowonline.com.br"],then:"PROXY BR.PEER",if:[]}]},nrk_no:{match:{root_urls:["nrk.no"],rules:[{proxy_country:["NO"],cmds:[{hosts:["nrk.no","dna.ip-only.net","nrk-od-00.akamaized.net","nrk-od-01.akamaized.net","nrk-od-02.akamaized.net","nrk-od-03.akamaized.net","nrk-od-04.akamaized.net","nrk-od-05.akamaized.net","nrk-od-06.akamaized.net","nrk-od-07.akamaized.net","nrk-od-08.akamaized.net","nrk-od-09.akamaized.net","nrk-od-10.akamaized.net","nrk-od-11.akamaized.net","nrk-od-12.akamaized.net","nrk-od-13.akamaized.net","nrk-od-14.akamaized.net","nrk-od-15.akamaized.net","nrk-od-16.akamaized.net","nrk-od-17.akamaized.net","nrk-od-18.akamaized.net","nrk-od-19.akamaized.net","nrk-od-20.akamaized.net","nrk-od-21.akamaized.net","nrk-od-22.akamaized.net","nrk-od-23.akamaized.net","nrk-od-24.akamaized.net","nrk-od-25.akamaized.net","nrk-od-26.akamaized.net","nrk-od-27.akamaized.net","nrk-od-28.akamaized.net","nrk-od-29.akamaized.net","nrk-od-30.akamaized.net","nrk-od-31.akamaized.net","nrk-od-32.akamaized.net","nrk-od-33.akamaized.net","nrk-od-34.akamaized.net","nrk-od-35.akamaized.net","nrk-od-36.akamaized.net","nrk-od-37.akamaized.net","nrk-od-38.akamaized.net","nrk-od-39.akamaized.net","nrk-od-40.akamaized.net","nrk-od-41.akamaized.net","nrk-od-42.akamaized.net","nrk-od-43.akamaized.net","nrk-od-44.akamaized.net","nrk-od-45.akamaized.net","nrk-od-46.akamaized.net","nrk-od-47.akamaized.net","nrk-od-48.akamaized.net","nrk-od-49.akamaized.net","nrk-od-50.akamaized.net","nrk-od-51.akamaized.net","nrk-od-52.akamaized.net","nrk-od-53.akamaized.net","nrk-od-54.akamaized.net","nrk-od-55.akamaized.net","nrk-od-56.akamaized.net","nrk-od-57.akamaized.net","nrk-od-58.akamaized.net","nrk-od-59.akamaized.net","nrk-od-60.akamaized.net","nrk-od-61.akamaized.net","nrk-od-62.akamaized.net","nrk-od-63.akamaized.net","nrk-od-64.akamaized.net","nrk-od-65.akamaized.net","nrk-od-66.akamaized.net","nrk-od-67.akamaized.net","nrk-od-68.akamaized.net","nrk-od-69.akamaized.net","nrk-od-70.akamaized.net","nrk-od-71.akamaized.net","nrk-od-72.akamaized.net","nrk-od-73.akamaized.net","nrk-od-74.akamaized.net","nrk-od-75.akamaized.net","nrk-od-76.akamaized.net","nrk-od-77.akamaized.net","nrk-od-78.akamaized.net","nrk-od-79.akamaized.net","nrk-od-80.akamaized.net","nrk-od-81.akamaized.net","nrk-od-82.akamaized.net","nrk-od-83.akamaized.net","nrk-od-84.akamaized.net","nrk-od-85.akamaized.net","nrk-od-86.akamaized.net","nrk-od-87.akamaized.net","nrk-od-88.akamaized.net","nrk-od-89.akamaized.net","nrk-od-90.akamaized.net","nrk-od-91.akamaized.net","nrk-od-92.akamaized.net","nrk-od-93.akamaized.net","nrk-od-94.akamaized.net","nrk-od-95.akamaized.net","nrk-od-96.akamaized.net","nrk-od-97.akamaized.net","nrk-od-98.akamaized.net","nrk-od-99.akamaized.net"],then:"PROXY NO.PEER",if:[]}]}]},cmds:[{hosts:["nrk.no","dna.ip-only.net","nrk-od-00.akamaized.net","nrk-od-01.akamaized.net","nrk-od-02.akamaized.net","nrk-od-03.akamaized.net","nrk-od-04.akamaized.net","nrk-od-05.akamaized.net","nrk-od-06.akamaized.net","nrk-od-07.akamaized.net","nrk-od-08.akamaized.net","nrk-od-09.akamaized.net","nrk-od-10.akamaized.net","nrk-od-11.akamaized.net","nrk-od-12.akamaized.net","nrk-od-13.akamaized.net","nrk-od-14.akamaized.net","nrk-od-15.akamaized.net","nrk-od-16.akamaized.net","nrk-od-17.akamaized.net","nrk-od-18.akamaized.net","nrk-od-19.akamaized.net","nrk-od-20.akamaized.net","nrk-od-21.akamaized.net","nrk-od-22.akamaized.net","nrk-od-23.akamaized.net","nrk-od-24.akamaized.net","nrk-od-25.akamaized.net","nrk-od-26.akamaized.net","nrk-od-27.akamaized.net","nrk-od-28.akamaized.net","nrk-od-29.akamaized.net","nrk-od-30.akamaized.net","nrk-od-31.akamaized.net","nrk-od-32.akamaized.net","nrk-od-33.akamaized.net","nrk-od-34.akamaized.net","nrk-od-35.akamaized.net","nrk-od-36.akamaized.net","nrk-od-37.akamaized.net","nrk-od-38.akamaized.net","nrk-od-39.akamaized.net","nrk-od-40.akamaized.net","nrk-od-41.akamaized.net","nrk-od-42.akamaized.net","nrk-od-43.akamaized.net","nrk-od-44.akamaized.net","nrk-od-45.akamaized.net","nrk-od-46.akamaized.net","nrk-od-47.akamaized.net","nrk-od-48.akamaized.net","nrk-od-49.akamaized.net","nrk-od-50.akamaized.net","nrk-od-51.akamaized.net","nrk-od-52.akamaized.net","nrk-od-53.akamaized.net","nrk-od-54.akamaized.net","nrk-od-55.akamaized.net","nrk-od-56.akamaized.net","nrk-od-57.akamaized.net","nrk-od-58.akamaized.net","nrk-od-59.akamaized.net","nrk-od-60.akamaized.net","nrk-od-61.akamaized.net","nrk-od-62.akamaized.net","nrk-od-63.akamaized.net","nrk-od-64.akamaized.net","nrk-od-65.akamaized.net","nrk-od-66.akamaized.net","nrk-od-67.akamaized.net","nrk-od-68.akamaized.net","nrk-od-69.akamaized.net","nrk-od-70.akamaized.net","nrk-od-71.akamaized.net","nrk-od-72.akamaized.net","nrk-od-73.akamaized.net","nrk-od-74.akamaized.net","nrk-od-75.akamaized.net","nrk-od-76.akamaized.net","nrk-od-77.akamaized.net","nrk-od-78.akamaized.net","nrk-od-79.akamaized.net","nrk-od-80.akamaized.net","nrk-od-81.akamaized.net","nrk-od-82.akamaized.net","nrk-od-83.akamaized.net","nrk-od-84.akamaized.net","nrk-od-85.akamaized.net","nrk-od-86.akamaized.net","nrk-od-87.akamaized.net","nrk-od-88.akamaized.net","nrk-od-89.akamaized.net","nrk-od-90.akamaized.net","nrk-od-91.akamaized.net","nrk-od-92.akamaized.net","nrk-od-93.akamaized.net","nrk-od-94.akamaized.net","nrk-od-95.akamaized.net","nrk-od-96.akamaized.net","nrk-od-97.akamaized.net","nrk-od-98.akamaized.net","nrk-od-99.akamaized.net"],then:"PROXY NO.PEER",if:[]}]},discoveryplus_in:{match:{root_urls:["discoveryplus.in"],rules:[{proxy_country:["IN"],cmds:[{root_urls:["discoveryplus.in"],then:"PROXY IN",if:[]},{hosts:["ap2-prod-direct.discoveryplus.in"],then:"PROXY IN.POOL_lum_in_shared",if:[]}]}]},cmds:[{root_urls:["discoveryplus.in"],then:"PROXY IN",if:[]},{hosts:["ap2-prod-direct.discoveryplus.in"],then:"PROXY IN.POOL_lum_in_shared",if:[]}]},spotify_com:{match:{root_urls:["spotify.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["spclient.wg.spotify.com"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{hosts:["spclient.wg.spotify.com"],then:"PROXY US.PEER",if:[]}]},ruv_is:{match:{root_urls:["ruv.is"],rules:[{proxy_country:["IS"],cmds:[{hosts:["ruv-vod-app-dcp-v4.secure.footprint.net"],then:"PROXY IS.PEER",if:[]}]}]},cmds:[{hosts:["ruv-vod-app-dcp-v4.secure.footprint.net"],then:"PROXY IS.PEER",if:[]}]},tf1_fr:{match:{root_urls:["tf1.fr"],rules:[{proxy_country:["FR"],cmds:[{root_urls:["tf1.fr"],then:"PROXY FR.POOL_lum_fr_shared",if:[]},{hosts:["mediainfo.tf1.fr","strmt.tf1.fr","tf1-das-live-ssl.tf1.fr"],then:"PROXY FR.PEER",if:[]}]}]},cmds:[{root_urls:["tf1.fr"],then:"PROXY FR.POOL_lum_fr_shared",if:[]},{hosts:["mediainfo.tf1.fr","strmt.tf1.fr","tf1-das-live-ssl.tf1.fr"],then:"PROXY FR.PEER",if:[]}]},dmm_co_jp:{match:{root_urls:["dmm.co.jp"],rules:[{proxy_country:["JP"],cmds:[{hosts:["www.dmm.co.jp"],then:"PROXY JP.PEER",if:[]}]}]},cmds:[{hosts:["www.dmm.co.jp"],then:"PROXY JP.PEER",if:[]}]},novasports_gr:{match:{root_urls:["novasports.gr"],rules:[{proxy_country:["GR"],cmds:[{hosts:["online.novasports.gr"],then:"PROXY GR.PEER",if:[]}]}]},cmds:[{hosts:["online.novasports.gr"],then:"PROXY GR.PEER",if:[]}]},albumartexchange_com:{match:{root_urls:["albumartexchange.com"],rules:[{proxy_country:["JP"],cmds:[{hosts:["albumartexchange.com"],then:"PROXY JP.PEER",if:[]}]}]},cmds:[{hosts:["albumartexchange.com"],then:"PROXY JP.PEER",if:[]}]},cablevisionflow_com_ar:{match:{root_urls:["cablevisionflow.com.ar"],rules:[{proxy_country:["AR"],cmds:[{hosts:["cablevisionflow.com.ar"],then:"PROXY AR.PEER",if:[]}]}]},cmds:[{hosts:["cablevisionflow.com.ar"],then:"PROXY AR.PEER",if:[]}]},flow_com_ar:{match:{root_urls:["flow.com.ar"],rules:[{proxy_country:["AR"],cmds:[{hosts:["flow.com.ar"],then:"PROXY AR.PEER",if:[]}]}]},cmds:[{hosts:["flow.com.ar"],then:"PROXY AR.PEER",if:[]}]},outback_sylt_de:{match:{root_urls:["outback-sylt.de"],rules:[{proxy_country:["DE"],cmds:[{hosts:["outback-sylt.de"],then:"PROXY DE.PEER",if:[]}]}]},cmds:[{hosts:["outback-sylt.de"],then:"PROXY DE.PEER",if:[]}]},tjx_com:{match:{root_urls:["tjx.com"],rules:[{proxy_country:["US"],cmds:[{root_urls:["tjx.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]}]},cmds:[{root_urls:["tjx.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},qvc_com:{match:{root_urls:["qvc.com"],rules:[{proxy_country:["US"],cmds:[{root_urls:["qvc.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]}]},cmds:[{root_urls:["qvc.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},gapfactory_com:{match:{root_urls:["gapfactory.com"],rules:[{proxy_country:["US"],cmds:[{root_urls:["gapfactory.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]}]},cmds:[{root_urls:["gapfactory.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},rsi_ch:{match:{root_urls:["rsi.ch"],rules:[{proxy_country:["CH"],cmds:[{hosts:["srg.live.ott.irdeto.com"],then:"PROXY CH.PEER",if:[]}]}]},cmds:[{hosts:["srg.live.ott.irdeto.com"],then:"PROXY CH.PEER",if:[]}]},rts_ch:{match:{root_urls:["rts.ch"],rules:[{proxy_country:["CH"],cmds:[{hosts:["srg.live.ott.irdeto.com"],then:"PROXY CH.PEER",if:[]}]}]},cmds:[{hosts:["srg.live.ott.irdeto.com"],then:"PROXY CH.PEER",if:[]}]},srf_ch:{match:{root_urls:["srf.ch"],rules:[{proxy_country:["CH"],cmds:[{hosts:["srg.live.ott.irdeto.com"],then:"PROXY CH.PEER",if:[]}]}]},cmds:[{hosts:["srg.live.ott.irdeto.com"],then:"PROXY CH.PEER",if:[]}]},premierplayer_tv:{match:{root_urls:["premierplayer.tv"],rules:[{proxy_country:["GB"],cmds:[{hosts:["www.premierplayer.tv","live.247cdn.net","b.247cdn.net","ondemand.247cdn.net"],then:"PROXY GB.PEER",if:[]},{root_urls:["premierplayer.tv"],then:"PROXY GB.POOL_lum_gb_shared",if:[]}]}]},cmds:[{hosts:["www.premierplayer.tv","live.247cdn.net","b.247cdn.net","ondemand.247cdn.net"],then:"PROXY GB.PEER",if:[]},{root_urls:["premierplayer.tv"],then:"PROXY GB.POOL_lum_gb_shared",if:[]}]},mtv_ca:{match:{root_urls:["mtv.ca"],rules:[{proxy_country:["CA"],cmds:[{root_urls:["mtv.ca"],then:"PROXY CA.POOL_lum_ca_shared",if:[]},{hosts:["capi.9c9media.com"],then:"PROXY CA.POOL_lum_ca_shared",if:[]}]}]},cmds:[{root_urls:["mtv.ca"],then:"PROXY CA.POOL_lum_ca_shared",if:[]},{hosts:["capi.9c9media.com"],then:"PROXY CA.POOL_lum_ca_shared",if:[]}]},radiko_jp:{match:{root_urls:["radiko.jp"],rules:[{proxy_country:["JP"],cmds:[{hosts:["radiko.jp"],then:"PROXY JP.PEER",if:[]}]}]},cmds:[{hosts:["radiko.jp"],then:"PROXY JP.PEER",if:[]}]},tver_jp:{match:{root_urls:["tver.jp"],rules:[{proxy_country:["JP"],cmds:[{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY JP"}],then:"PROXY JP.PEER"}]}]},cmds:[{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY JP"}],then:"PROXY JP.PEER"}]},allotalk_com:{match:{root_urls:["allotalk.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["allotalk.com"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{hosts:["allotalk.com"],then:"PROXY US.PEER",if:[]}]},williamhill_com:{match:{root_urls:["williamhill.com"],rules:[{proxy_country:["GB"],cmds:[{hosts:["williamhill.com"],then:"PROXY GB.PEER",if:[]}]}]},cmds:[{hosts:["williamhill.com"],then:"PROXY GB.PEER",if:[]}]},joyn_de:{match:{root_urls:["joyn.de"],rules:[{proxy_country:["DE"],cmds:[{hosts:["api.joyn.de","auth.joyn.de"],then:"PROXY DE.PEER",if:[]}]}]},cmds:[{hosts:["api.joyn.de","auth.joyn.de"],then:"PROXY DE.PEER",if:[]}]},_13tv_co_il:{match:{root_urls:["13tv.co.il"],rules:[{proxy_country:["IL"],cmds:[{hosts:["log.advsnx.net","banners.advsnx.net","pagead2.googlesyndication.com","www.google-analytics.com","securepubads.g.doubleclick.net","taboola.com","secure.adnx.com","adnxs.com"],then:"DIRECT",if:[]}]}]},cmds:[{hosts:["log.advsnx.net","banners.advsnx.net","pagead2.googlesyndication.com","www.google-analytics.com","securepubads.g.doubleclick.net","taboola.com","secure.adnx.com","adnxs.com"],then:"DIRECT",if:[]}]},abema_tv:{match:{root_urls:["abema.tv"],rules:[{proxy_country:["JP"],cmds:[{hosts:["abema.tv"],then:"PROXY JP.PEER",if:[]}]}]},cmds:[{hosts:["abema.tv"],then:"PROXY JP.PEER",if:[]}]},canal_plus_com:{match:{root_urls:["canal-plus.com"],rules:[{proxy_country:["FR"],cmds:[{root_urls:["canal-plus.com"],then:"PROXY FR.POOL_lum_fr_shared",if:[]}]}]},cmds:[{root_urls:["canal-plus.com"],then:"PROXY FR.POOL_lum_fr_shared",if:[]}]},zalando_fr:{match:{root_urls:["zalando.fr"],rules:[{proxy_country:["FR"],cmds:[{root_urls:["zalando.fr"],then:"PROXY FR.POOL_lum_fr_shared",if:[]}]}]},cmds:[{root_urls:["zalando.fr"],then:"PROXY FR.POOL_lum_fr_shared",if:[]}]},mewatch_sg:{match:{root_urls:["mewatch.sg"],rules:[{proxy_country:["SG"],cmds:[{hosts:["tvpapi-as.ott.kaltura.com","www.mewatch.sg","player-mc.sgp2.ott.kaltura.com","cdn.mewatch.sg"],then:"PROXY SG.PEER",if:[]}]}]},cmds:[{hosts:["tvpapi-as.ott.kaltura.com","www.mewatch.sg","player-mc.sgp2.ott.kaltura.com","cdn.mewatch.sg"],then:"PROXY SG.PEER",if:[]}]},_007song_co_kr:{match:{root_urls:["007song.co.kr"],rules:[{proxy_country:["KR"],cmds:[{hosts:["007song.co.kr"],then:"PROXY KR.PEER",if:[]}]}]},cmds:[{hosts:["007song.co.kr"],then:"PROXY KR.PEER",if:[]}]},yahoo_co_jp:{match:{root_urls:["yahoo.co.jp"],rules:[{proxy_country:["JP"],cmds:[{root_urls:["yahoo.co.jp"],then:"PROXY JP",if:[]},{hosts:["gyao.yahoo.co.jp"],if:[{url:".*gyao\\.yahoo\\.co\\.jp\\/apis\\/playback\\/graphql",type:"!~",then:"PROXY JP.PEER"}],then:"PROXY JP.PEER"}]}]},cmds:[{root_urls:["yahoo.co.jp"],then:"PROXY JP",if:[]},{hosts:["gyao.yahoo.co.jp"],if:[{url:".*gyao\\.yahoo\\.co\\.jp\\/apis\\/playback\\/graphql",type:"!~",then:"PROXY JP.PEER"}],then:"PROXY JP.PEER"}]},peacocktv_com:{match:{root_urls:["peacocktv.com"],rules:[{proxy_country:["US"],cmds:[{root_urls:["peacocktv.com"],then:"PROXY US.POOL_lum_us_shared",if:[]},{hosts:["ovp.peacocktv.com"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{root_urls:["peacocktv.com"],then:"PROXY US.POOL_lum_us_shared",if:[]},{hosts:["ovp.peacocktv.com"],then:"PROXY US.PEER",if:[]}]},snipesusa_com:{match:{root_urls:["snipesusa.com"],rules:[{proxy_country:["US"],cmds:[{root_urls:["snipesusa.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]}]},cmds:[{root_urls:["snipesusa.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},walgreens_com:{match:{root_urls:["walgreens.com"],rules:[{proxy_country:["US"],cmds:[{root_urls:["walgreens.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]}]},cmds:[{root_urls:["walgreens.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},qmee_com:{match:{root_urls:["qmee.com"],rules:[{proxy_country:["US"],cmds:[{root_urls:["qmee.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]}]},cmds:[{root_urls:["qmee.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},ctv_ca:{match:{root_urls:["ctv.ca"],rules:[{proxy_country:["CA"],cmds:[{root_urls:["ctv.ca"],then:"PROXY CA.POOL_lum_ca_shared",if:[]},{hosts:["capi.9c9media.com"],then:"PROXY CA.POOL_lum_ca_shared",if:[]}]}]},cmds:[{root_urls:["ctv.ca"],then:"PROXY CA.POOL_lum_ca_shared",if:[]},{hosts:["capi.9c9media.com"],then:"PROXY CA.POOL_lum_ca_shared",if:[]}]},foodnetwork_ca:{match:{root_urls:["foodnetwork.ca"],rules:[{proxy_country:["CA"],cmds:[{root_urls:["foodnetwork.ca"],then:"PROXY CA.POOL_lum_ca_shared",if:[]}]}]},cmds:[{root_urls:["foodnetwork.ca"],then:"PROXY CA.POOL_lum_ca_shared",if:[]}]},b2byellowpages_com:{match:{root_urls:["b2byellowpages.com"],rules:[{proxy_country:["US"],cmds:[{root_urls:["b2byellowpages.com"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{root_urls:["b2byellowpages.com"],then:"PROXY US.PEER",if:[]}]},engclip_com:{match:{root_urls:["engclip.com"],rules:[{proxy_country:["IN"],cmds:[{root_urls:["engclip.com"],then:"PROXY IN",if:[]},{hosts:["proxy-32.sg1.dailymotion.com"],then:"PROXY IN.POOL_lum_in_shared",if:[]}]}]},cmds:[{root_urls:["engclip.com"],then:"PROXY IN",if:[]},{hosts:["proxy-32.sg1.dailymotion.com"],then:"PROXY IN.POOL_lum_in_shared",if:[]}]},footpatrol_co_uk:{match:{root_urls:["footpatrol.co.uk","footpatrol.com"],rules:[{proxy_country:["GB"],cmds:[{root_urls:["footpatrol.co.uk","footpatrol.com"],then:"PROXY GB.POOL_lum_gb_shared",if:[]}]}]},cmds:[{root_urls:["footpatrol.co.uk","footpatrol.com"],then:"PROXY GB.POOL_lum_gb_shared",if:[]}]},jdsports_co_uk:{match:{root_urls:["jdsports.co.uk"],rules:[{proxy_country:["GB"],cmds:[{root_urls:["jdsports.co.uk"],then:"PROXY GB.POOL_lum_gb_shared",if:[]}]}]},cmds:[{root_urls:["jdsports.co.uk"],then:"PROXY GB.POOL_lum_gb_shared",if:[]}]},size_co_uk:{match:{root_urls:["size.co.uk"],rules:[{proxy_country:["GB"],cmds:[{root_urls:["size.co.uk"],then:"PROXY GB.POOL_lum_gb_shared",if:[]}]}]},cmds:[{root_urls:["size.co.uk"],then:"PROXY GB.POOL_lum_gb_shared",if:[]}]},tui_co_uk:{match:{root_urls:["tui.co.uk"],rules:[{proxy_country:["GB"],cmds:[{hosts:["tui.co.uk"],then:"PROXY GB.PEER",if:[]}]}]},cmds:[{hosts:["tui.co.uk"],then:"PROXY GB.PEER",if:[]}]},blutv_com:{match:{root_urls:["blutv.com"],rules:[{proxy_country:["TR"],cmds:[{hosts:["blutv.com"],then:"PROXY TR.PEER",if:[]}]}]},cmds:[{hosts:["blutv.com"],then:"PROXY TR.PEER",if:[]}]},garena_com:{match:{root_urls:["garena.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["garena.com"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{hosts:["garena.com"],then:"PROXY US.PEER",if:[]}]},offerup_com:{match:{root_urls:["offerup.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["offerup.com"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{hosts:["offerup.com"],then:"PROXY US.PEER",if:[]}]},mugenarchive_com:{match:{root_urls:["mugenarchive.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["mugenarchive.com"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{hosts:["mugenarchive.com"],then:"PROXY US.PEER",if:[]}]},lostfilm_tv:{match:{root_urls:["lostfilm.tv"],rules:[{proxy_country:["IT"],cmds:[{root_urls:["lostfilm.tv"],then:"PROXY IT.POOL_lum_it_shared",if:[]}]},{proxy_country:["CA"],cmds:[{root_urls:["lostfilm.tv"],then:"PROXY CA.POOL_lum_ca_shared"}]},{proxy_country:["GB"],cmds:[{root_urls:["lostfilm.tv"],then:"PROXY GB.POOL_lum_gb_shared"}]},{proxy_country:["NL"],cmds:[{root_urls:["lostfilm.tv"],then:"PROXY NL.POOL_lum_nl_shared"}]},{proxy_country:["FR"],cmds:[{root_urls:["lostfilm.tv"],then:"PROXY FR.POOL_lum_fr_shared"}]},{proxy_country:["ES"],cmds:[{root_urls:["lostfilm.tv"],then:"PROXY ES.POOL_lum_es_shared"}]},{proxy_country:["US"],cmds:[{root_urls:["lostfilm.tv"],then:"PROXY US.POOL_lum_us_shared"}]},{proxy_country:["KR"],cmds:[{root_urls:["lostfilm.tv"],then:"PROXY KR.POOL_lum_kr_shared"}]},{proxy_country:["BR"],cmds:[{root_urls:["lostfilm.tv"],then:"PROXY BR.POOL_lum_br_shared"}]}]},cmds:[{root_urls:["lostfilm.tv"],then:"PROXY IT.POOL_lum_it_shared",if:[]}]},prende_tv:{match:{root_urls:["lostfilm.tv"],rules:[{proxy_country:["IT"],cmds:[{root_urls:["lostfilm.tv"],then:"PROXY IT.POOL_lum_it_shared",if:[]}]},{proxy_country:["CA"],cmds:[{root_urls:["lostfilm.tv"],then:"PROXY CA.POOL_lum_ca_shared"}]},{proxy_country:["GB"],cmds:[{root_urls:["lostfilm.tv"],then:"PROXY GB.POOL_lum_gb_shared"}]},{proxy_country:["NL"],cmds:[{root_urls:["lostfilm.tv"],then:"PROXY NL.POOL_lum_nl_shared"}]},{proxy_country:["FR"],cmds:[{root_urls:["lostfilm.tv"],then:"PROXY FR.POOL_lum_fr_shared"}]},{proxy_country:["ES"],cmds:[{root_urls:["lostfilm.tv"],then:"PROXY ES.POOL_lum_es_shared"}]},{proxy_country:["US"],cmds:[{root_urls:["lostfilm.tv"],then:"PROXY US.POOL_lum_us_shared"}]},{proxy_country:["KR"],cmds:[{root_urls:["lostfilm.tv"],then:"PROXY KR.POOL_lum_kr_shared"}]},{proxy_country:["BR"],cmds:[{root_urls:["lostfilm.tv"],then:"PROXY BR.POOL_lum_br_shared"}]}]},cmds:[{root_urls:["lostfilm.tv"],then:"PROXY IT.POOL_lum_it_shared",if:[]}]},homify_com:{match:{root_urls:["homify.com"],rules:[{cmds:[{hosts:["homify.com"],then:"PROXY XX.PEER",if:[]}]}]},cmds:[{hosts:["homify.com"],then:"PROXY XX.PEER",if:[]}]},country_rule:{client_only:true,match:{min_ver:"1.170.260",root_urls:[""],rules:[{proxy_country:["KR"],cmds:[{proxy_country:["KR"],then:"PROXY KR.POOL_lum_kr_shared",if:[]}]}]},cmds:[{proxy_country:["KR"],then:"PROXY KR.POOL_lum_kr_shared",if:[]}]},sotostore_com:{match:{root_urls:["sotostore.com"],rules:[{proxy_country:["DE"],cmds:[{hosts:["www.sotostore.com"],then:"PROXY DE.PEER",if:[]}]}]},cmds:[{hosts:["www.sotostore.com"],then:"PROXY DE.PEER",if:[]}]},foxtel_com_au:{match:{root_urls:["foxtel.com.au"],rules:[{proxy_country:["AU"],cmds:[{hosts:["foxtel.com.au"],then:"PROXY AU.PEER",if:[]}]}]},cmds:[{hosts:["foxtel.com.au"],then:"PROXY AU.PEER",if:[]}]},indavideo_hu:{match:{root_urls:["indavideo.hu"],rules:[{proxy_country:["HU"],cmds:[{hosts:["embed.indavideo.hu"],then:"PROXY HU.PEER",if:[]}]}]},cmds:[{hosts:["embed.indavideo.hu"],then:"PROXY HU.PEER",if:[]}]},vroom_com:{match:{root_urls:["vroom.com"],rules:[{proxy_country:["US"],cmds:[{root_urls:["vroom.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]}]},cmds:[{root_urls:["vroom.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},pontofrio_com_br:{match:{root_urls:["pontofrio.com.br"],rules:[{proxy_country:["BR"],cmds:[{root_urls:["pontofrio.com.br"],then:"PROXY BR.POOL_lum_br_shared",if:[]}]}]},cmds:[{root_urls:["pontofrio.com.br"],then:"PROXY BR.POOL_lum_br_shared",if:[]}]},marshalls_com:{match:{root_urls:["marshalls.com"],rules:[{proxy_country:["US"],cmds:[{root_urls:["marshalls.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]}]},cmds:[{root_urls:["marshalls.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},dplay_co_uk:{match:{root_urls:["dplay.co.uk"],rules:[{proxy_country:["GB"],cmds:[{root_urls:["dplay.co.uk"],then:"PROXY GB.POOL_lum_gb_shared",if:[]}]}]},cmds:[{root_urls:["dplay.co.uk"],then:"PROXY GB.POOL_lum_gb_shared",if:[]}]},atresplayer_com:{match:{root_urls:["atresplayer.com"],rules:[{proxy_country:["ES"],cmds:[{root_urls:["atresplayer.com"],then:"PROXY ES.POOL_lum_es_shared",if:[]},{hosts:["api.atresplayer.com","directo.atresmedia.com","atres-live.atresmedia.com"],then:"PROXY ES.PEER",if:[]}]}]},cmds:[{root_urls:["atresplayer.com"],then:"PROXY ES.POOL_lum_es_shared",if:[]},{hosts:["api.atresplayer.com","directo.atresmedia.com","atres-live.atresmedia.com"],then:"PROXY ES.PEER",if:[]}]},footlocker_co_uk:{match:{root_urls:["footlocker.co.uk"],rules:[{proxy_country:["GB"],cmds:[{root_urls:["footlocker.co.uk"],then:"PROXY GB.POOL_lum_gb_shared",if:[]}]}]},cmds:[{root_urls:["footlocker.co.uk"],then:"PROXY GB.POOL_lum_gb_shared",if:[]}]},pxg_co_kr:{match:{root_urls:["pxg.co.kr"],rules:[{proxy_country:["US"],cmds:[{root_urls:["pxg.co.kr"],then:"PROXY US.POOL_lum_us_shared",if:[]}]}]},cmds:[{root_urls:["pxg.co.kr"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},udemy_com:{match:{root_urls:["udemy.com"],rules:[{proxy_country:["US"],cmds:[{root_urls:["udemy.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]}]},cmds:[{root_urls:["udemy.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},gamovideo_com:{match:{root_urls:["gamovideo.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["gamovideo.com"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{hosts:["gamovideo.com"],then:"PROXY US.PEER",if:[]}]},yellowpages_com:{match:{root_urls:["yellowpages.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["yellowpages.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]}]},cmds:[{hosts:["yellowpages.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},lawyers_com:{match:{root_urls:["lawyers.com"],rules:[{proxy_country:["US"],cmds:[{root_urls:["lawyers.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]}]},cmds:[{root_urls:["lawyers.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},filmizlesene_pw:{match:{root_urls:["filmizlesene.pw"],rules:[{proxy_country:["US"],cmds:[{hosts:["filmizlesene.pw"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{hosts:["filmizlesene.pw"],then:"PROXY US.PEER",if:[]}]},dizibox_pw:{match:{root_urls:["dizibox.pw"],rules:[{proxy_country:["US"],cmds:[{hosts:["dizibox.pw"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{hosts:["dizibox.pw"],then:"PROXY US.PEER",if:[]}]},skynews_com_au:{match:{root_urls:["skynews.com.au"],rules:[{proxy_country:["AU"],cmds:[{hosts:["www.skynews.com.au"],then:"PROXY AU.PEER",if:[]},{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY AU"}],then:"PROXY AU.PEER"}]}]},cmds:[{hosts:["www.skynews.com.au"],then:"PROXY AU.PEER",if:[]},{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY AU"}],then:"PROXY AU.PEER"}]},sbt_com_br:{match:{root_urls:["sbt.com.br"],rules:[{proxy_country:["BR"],cmds:[{hosts:["sbt.com.br"],then:"PROXY BR.PEER",if:[]}]}]},cmds:[{hosts:["sbt.com.br"],then:"PROXY BR.PEER",if:[]}]},bfi_org_uk:{match:{root_urls:["bfi.org.uk"],rules:[{proxy_country:["GB"],cmds:[{root_urls:["bfi.org.uk"],then:"PROXY GB.POOL_lum_gb_shared",if:[]}]}]},cmds:[{root_urls:["bfi.org.uk"],then:"PROXY GB.POOL_lum_gb_shared",if:[]}]},ocs_fr:{match:{root_urls:["ocs.fr"],rules:[{proxy_country:["FR"],cmds:[{root_urls:["ocs.fr"],then:"PROXY FR.POOL_lum_fr_shared",if:[]},{hosts:["www.ocs.fr","statics.ocs.fr","api.ocs.fr"],then:"PROXY FR.POOL_lum_fr_shared",if:[]}]}]},cmds:[{root_urls:["ocs.fr"],then:"PROXY FR.POOL_lum_fr_shared",if:[]},{hosts:["www.ocs.fr","statics.ocs.fr","api.ocs.fr"],then:"PROXY FR.POOL_lum_fr_shared",if:[]}]},line_me:{match:{root_urls:["line.me"],rules:[{cmds:[{proxy_country:["TW"],hosts:["line.me"],then:"PROXY TW.PEER",if:[]}]}]},cmds:[{proxy_country:["TW"],hosts:["line.me"],then:"PROXY TW.PEER",if:[]}]},cbc_ca:{match:{root_urls:["cbc.ca"],rules:[{proxy_country:["CA"],cmds:[{root_urls:["cbc.ca"],then:"PROXY CA.POOL_lum_ca_shared",if:[]}]}]},cmds:[{root_urls:["cbc.ca"],then:"PROXY CA.POOL_lum_ca_shared",if:[]}]},tving_com:{match:{root_urls:["tving.com"],rules:[{proxy_country:["KR"],cmds:[{root_urls:["tving.com"],then:"PROXY KR.POOL_lum_kr_shared",if:[]},{hosts:["api.tving.com"],then:"PROXY KR.PEER",if:[]}]}]},cmds:[{root_urls:["tving.com"],then:"PROXY KR.POOL_lum_kr_shared",if:[]},{hosts:["api.tving.com"],then:"PROXY KR.PEER",if:[]}]},afreecatv_com:{match:{root_urls:["afreecatv.com"],rules:[{proxy_country:["KR"],cmds:[{root_urls:["afreecatv.com"],then:"PROXY KR.POOL_lum_kr_shared",if:[]}]}]},cmds:[{root_urls:["afreecatv.com"],then:"PROXY KR.POOL_lum_kr_shared",if:[]}]},vlive_tv:{match:{root_urls:["vlive.tv"],rules:[{proxy_country:["KR"],cmds:[{root_urls:["vlive.tv"],then:"PROXY KR.POOL_lum_kr_shared",if:[]}]}]},cmds:[{root_urls:["vlive.tv"],then:"PROXY KR.POOL_lum_kr_shared",if:[]}]},viki_com:{match:{root_urls:["viki.com"],rules:[{proxy_country:["IT"],cmds:[{root_urls:["viki.com"],then:"PROXY IT.POOL_lum_it_shared",if:[]}]},{proxy_country:["CA"],cmds:[{root_urls:["viki.com"],then:"PROXY CA.POOL_lum_ca_shared"}]},{proxy_country:["GB"],cmds:[{root_urls:["viki.com"],then:"PROXY GB.POOL_lum_gb_shared"}]},{proxy_country:["NL"],cmds:[{root_urls:["viki.com"],then:"PROXY NL.POOL_lum_nl_shared"}]},{proxy_country:["FR"],cmds:[{root_urls:["viki.com"],then:"PROXY FR.POOL_lum_fr_shared"}]},{proxy_country:["ES"],cmds:[{root_urls:["viki.com"],then:"PROXY ES.POOL_lum_es_shared"}]},{proxy_country:["US"],cmds:[{root_urls:["viki.com"],then:"PROXY US.POOL_lum_us_shared"}]},{proxy_country:["KR"],cmds:[{root_urls:["viki.com"],then:"PROXY KR.POOL_lum_kr_shared"}]},{proxy_country:["BR"],cmds:[{root_urls:["viki.com"],then:"PROXY BR.POOL_lum_br_shared"}]}]},cmds:[{root_urls:["viki.com"],then:"PROXY IT.POOL_lum_it_shared",if:[]}]},ruliweb_com:{match:{root_urls:["ruliweb.com"],rules:[{proxy_country:["KR"],cmds:[{root_urls:["ruliweb.com"],then:"PROXY KR.POOL_lum_kr_shared",if:[]}]}]},cmds:[{root_urls:["ruliweb.com"],then:"PROXY KR.POOL_lum_kr_shared",if:[]}]},nexon_com:{match:{root_urls:["nexon.com"],rules:[{proxy_country:["KR"],cmds:[{root_urls:["nexon.com"],then:"PROXY KR.POOL_lum_kr_shared",if:[]}]}]},cmds:[{root_urls:["nexon.com"],then:"PROXY KR.POOL_lum_kr_shared",if:[]}]},dcinside_com:{match:{root_urls:["dcinside.com"],rules:[{proxy_country:["KR"],cmds:[{root_urls:["dcinside.com"],then:"PROXY KR.POOL_lum_kr_shared",if:[]}]}]},cmds:[{root_urls:["dcinside.com"],then:"PROXY KR.POOL_lum_kr_shared",if:[]}]},licindia_in:{match:{root_urls:["licindia.in"],rules:[{proxy_country:["IN"],cmds:[{root_urls:["licindia_in"],then:"PROXY IN",if:[]}]}]},cmds:[{root_urls:["licindia_in"],then:"PROXY IN",if:[]}]},yupptv_com:{match:{root_urls:["yupptv.com"],rules:[{proxy_country:["IN"],cmds:[{hosts:["www.yupptv.com"],then:"PROXY IN.POOL_lum_in_shared",if:[]}]}]},cmds:[{hosts:["www.yupptv.com"],then:"PROXY IN.POOL_lum_in_shared",if:[]}]},lenskart_com:{match:{root_urls:["lenskart.com"],rules:[{proxy_country:["IN"],cmds:[{hosts:["lenskart.com"],then:"PROXY IN.POOL_lum_in_shared",if:[]}]}]},cmds:[{hosts:["lenskart.com"],then:"PROXY IN.POOL_lum_in_shared",if:[]}]},sunnxt_com:{match:{root_urls:["sunnxt.com"],rules:[{proxy_country:["IN"],cmds:[{root_urls:["sunnxt.com"],then:"PROXY IN",if:[]}]}]},cmds:[{root_urls:["sunnxt.com"],then:"PROXY IN",if:[]}]},primevideo_com:{match:{root_urls:["primevideo.com"],rules:[{proxy_country:["IT"],cmds:[{root_urls:["primevideo.com"],then:"PROXY IT.POOL_lum_it_shared",if:[]}]},{proxy_country:["CA"],cmds:[{root_urls:["primevideo.com"],then:"PROXY CA.POOL_lum_ca_shared"}]},{proxy_country:["GB"],cmds:[{root_urls:["primevideo.com"],then:"PROXY GB.POOL_lum_gb_shared"}]},{proxy_country:["NL"],cmds:[{root_urls:["primevideo.com"],then:"PROXY NL.POOL_lum_nl_shared"}]},{proxy_country:["FR"],cmds:[{root_urls:["primevideo.com"],then:"PROXY FR.POOL_lum_fr_shared"}]},{proxy_country:["ES"],cmds:[{root_urls:["primevideo.com"],then:"PROXY ES.POOL_lum_es_shared"}]},{proxy_country:["US"],cmds:[{root_urls:["primevideo.com"],then:"PROXY US.POOL_lum_us_shared"}]},{proxy_country:["KR"],cmds:[{root_urls:["primevideo.com"],then:"PROXY KR.POOL_lum_kr_shared"}]},{proxy_country:["BR"],cmds:[{root_urls:["primevideo.com"],then:"PROXY BR.POOL_lum_br_shared"}]},{proxy_country:["NO","GR","DE","DK","SE","CL","SG","CH","EG","RU","PL","IE","CN","IL","AR","HU","BE","FI","MX","HR","SI","SK","TR","TW","TH","JM","VN","PE","PH","ID","RO","ZA","BG","AT","NZ","CZ","IS","PT","BZ","UA"],cmds:[{hosts:["atv-ps-eu.primevideo.com","primevideo.com","api.eu-west-1.aiv-delivery.net"],then:"PROXY XX.PEER"}]}]},cmds:[{root_urls:["primevideo.com"],then:"PROXY IT.POOL_lum_it_shared",if:[]}]},zee5_com:{match:{root_urls:["zee5.com"],rules:[{proxy_country:["IN"],cmds:[{hosts:["zee5.com"],then:"PROXY IN.POOL_lum_in_shared",if:[]}]}]},cmds:[{hosts:["zee5.com"],then:"PROXY IN.POOL_lum_in_shared",if:[]}]},voot_com:{match:{root_urls:["voot.com"],rules:[{proxy_country:["IN"],cmds:[{root_urls:["voot.com"],if:[{host:"(?:google-analytics\\.com|analytics\\.twitter\\.com|googleadservices\\.com|p\\.adsymptotic\\.com|googletagmanager\\.com|bat\\.bing\\.com|adservice\\.google\\.com|doubleclick\\.net|gstatic\\.com|googlesyndication\\.com|2mdn\\.net|q\\.quora\\.com|analytics\\.edgekey\\.net|amazon-adsystem\\.com|users\\.quantumgraph\\.com|images-na\\.ssl-images-amazon\\.com|bh\\.contextweb\\.com|pixel-sync\\.sitescout\\.com|ads-twitter\\.com|googletagservices\\.com|scorecardresearch\\.com|outbrain\\.com|cdnjs\\.cloudflare\\.com|adservice\\.google\\.com\\.pk|adservice\\.google\\.com\\.ph|adroll\\.com|analytics\\.yahoo\\.com|spl\\.zeotap\\.com|a-ads\\.com|google\\.com|google\\.co\\.in|facebook\\.com|facebook\\.net|t\\.co|rubiconproject\\.com|google\\.com\\.bd|mixpanel\\.com|go-mpulse\\.net|google\\.com\\.au|googleapis\\.com)$",type:"=~",then:"PROXY XX"}],then:"PROXY IN.POOL_lum_in_shared"}]}]},cmds:[{root_urls:["voot.com"],if:[{host:"(?:google-analytics\\.com|analytics\\.twitter\\.com|googleadservices\\.com|p\\.adsymptotic\\.com|googletagmanager\\.com|bat\\.bing\\.com|adservice\\.google\\.com|doubleclick\\.net|gstatic\\.com|googlesyndication\\.com|2mdn\\.net|q\\.quora\\.com|analytics\\.edgekey\\.net|amazon-adsystem\\.com|users\\.quantumgraph\\.com|images-na\\.ssl-images-amazon\\.com|bh\\.contextweb\\.com|pixel-sync\\.sitescout\\.com|ads-twitter\\.com|googletagservices\\.com|scorecardresearch\\.com|outbrain\\.com|cdnjs\\.cloudflare\\.com|adservice\\.google\\.com\\.pk|adservice\\.google\\.com\\.ph|adroll\\.com|analytics\\.yahoo\\.com|spl\\.zeotap\\.com|a-ads\\.com|google\\.com|google\\.co\\.in|facebook\\.com|facebook\\.net|t\\.co|rubiconproject\\.com|google\\.com\\.bd|mixpanel\\.com|go-mpulse\\.net|google\\.com\\.au|googleapis\\.com)$",type:"=~",then:"PROXY XX"}],then:"PROXY IN.POOL_lum_in_shared"}]},mxplayer_in:{match:{root_urls:["mxplayer.in"],rules:[{proxy_country:["IN"],cmds:[{root_urls:["mxplayer.in"],if:[{host:"(?:google-analytics\\.com|analytics\\.twitter\\.com|googleadservices\\.com|p\\.adsymptotic\\.com|googletagmanager\\.com|bat\\.bing\\.com|adservice\\.google\\.com|doubleclick\\.net|gstatic\\.com|googlesyndication\\.com|2mdn\\.net|q\\.quora\\.com|analytics\\.edgekey\\.net|amazon-adsystem\\.com|users\\.quantumgraph\\.com|images-na\\.ssl-images-amazon\\.com|bh\\.contextweb\\.com|pixel-sync\\.sitescout\\.com|ads-twitter\\.com|googletagservices\\.com|scorecardresearch\\.com|outbrain\\.com|cdnjs\\.cloudflare\\.com|adservice\\.google\\.com\\.pk|adservice\\.google\\.com\\.ph|adroll\\.com|analytics\\.yahoo\\.com|spl\\.zeotap\\.com|a-ads\\.com|google\\.com|google\\.co\\.in|facebook\\.com|facebook\\.net|t\\.co|rubiconproject\\.com|google\\.com\\.bd|mixpanel\\.com|go-mpulse\\.net|google\\.com\\.au|googleapis\\.com)$",type:"=~",then:"PROXY XX"}],then:"PROXY IN.POOL_lum_in_shared"}]}]},cmds:[{root_urls:["mxplayer.in"],if:[{host:"(?:google-analytics\\.com|analytics\\.twitter\\.com|googleadservices\\.com|p\\.adsymptotic\\.com|googletagmanager\\.com|bat\\.bing\\.com|adservice\\.google\\.com|doubleclick\\.net|gstatic\\.com|googlesyndication\\.com|2mdn\\.net|q\\.quora\\.com|analytics\\.edgekey\\.net|amazon-adsystem\\.com|users\\.quantumgraph\\.com|images-na\\.ssl-images-amazon\\.com|bh\\.contextweb\\.com|pixel-sync\\.sitescout\\.com|ads-twitter\\.com|googletagservices\\.com|scorecardresearch\\.com|outbrain\\.com|cdnjs\\.cloudflare\\.com|adservice\\.google\\.com\\.pk|adservice\\.google\\.com\\.ph|adroll\\.com|analytics\\.yahoo\\.com|spl\\.zeotap\\.com|a-ads\\.com|google\\.com|google\\.co\\.in|facebook\\.com|facebook\\.net|t\\.co|rubiconproject\\.com|google\\.com\\.bd|mixpanel\\.com|go-mpulse\\.net|google\\.com\\.au|googleapis\\.com)$",type:"=~",then:"PROXY XX"}],then:"PROXY IN.POOL_lum_in_shared"}]},huurwoningen_nl:{match:{root_urls:["huurwoningen.nl"],rules:[{proxy_country:["NL"],cmds:[{root_urls:["huurwoningen.nl"],then:"PROXY NL.POOL_lum_nl_shared",if:[]}]}]},cmds:[{root_urls:["huurwoningen.nl"],then:"PROXY NL.POOL_lum_nl_shared",if:[]}]},videoland_com:{match:{root_urls:["videoland.com","v2.videoland.com"],rules:[{proxy_country:["NL"],cmds:[{hosts:["geo.videoland.bedrock.tech"],then:"PROXY NL.POOL_lum_nl_shared",if:[]},{root_urls:["videoland.com","v2.videoland.com"],then:"PROXY NL.POOL_lum_nl_shared",if:[]}]}]},cmds:[{hosts:["geo.videoland.bedrock.tech"],then:"PROXY NL.POOL_lum_nl_shared",if:[]},{root_urls:["videoland.com","v2.videoland.com"],then:"PROXY NL.POOL_lum_nl_shared",if:[]}]},nos_nl:{match:{root_urls:["nos.nl"],rules:[{proxy_country:["NL"],cmds:[{root_urls:["nos.nl"],then:"PROXY NL.POOL_lum_nl_shared",if:[]},{hosts:["resolver.streaming.api.nos.nl","cdn.streamgate.nl"],then:"PROXY NL.PEER",if:[]},{hosts:["npo.nl","npostreaming.nl"],then:"PROXY NL.POOL_lum_nl_shared",if:[]}]}]},cmds:[{root_urls:["nos.nl"],then:"PROXY NL.POOL_lum_nl_shared",if:[]},{hosts:["resolver.streaming.api.nos.nl","cdn.streamgate.nl"],then:"PROXY NL.PEER",if:[]},{hosts:["npo.nl","npostreaming.nl"],then:"PROXY NL.POOL_lum_nl_shared",if:[]}]},kakao_com:{match:{root_urls:["kakao.com"],rules:[{proxy_country:["IT"],cmds:[{root_urls:["kakao.com"],then:"PROXY IT.POOL_lum_it_shared",if:[]}]},{proxy_country:["CA"],cmds:[{root_urls:["kakao.com"],then:"PROXY CA.POOL_lum_ca_shared"}]},{proxy_country:["GB"],cmds:[{root_urls:["kakao.com"],then:"PROXY GB.POOL_lum_gb_shared"}]},{proxy_country:["NL"],cmds:[{root_urls:["kakao.com"],then:"PROXY NL.POOL_lum_nl_shared"}]},{proxy_country:["FR"],cmds:[{root_urls:["kakao.com"],then:"PROXY FR.POOL_lum_fr_shared"}]},{proxy_country:["ES"],cmds:[{root_urls:["kakao.com"],then:"PROXY ES.POOL_lum_es_shared"}]},{proxy_country:["US"],cmds:[{root_urls:["kakao.com"],then:"PROXY US.POOL_lum_us_shared"}]},{proxy_country:["KR"],cmds:[{root_urls:["kakao.com"],then:"PROXY KR.POOL_lum_kr_shared"}]},{proxy_country:["BR"],cmds:[{root_urls:["kakao.com"],then:"PROXY BR.POOL_lum_br_shared"}]}]},cmds:[{root_urls:["kakao.com"],then:"PROXY IT.POOL_lum_it_shared",if:[]}]},npostart_nl:{match:{root_urls:["npostart.nl"],rules:[{proxy_country:["NL"],cmds:[{hosts:["npostart.nl","cdn.streamgate.nl","nepworldwide.nl","npo.prd.cdn.bcms.kpn.com","atconnect.npo.nl","start-player.npo.nl","tellerapi.npo.nl"],then:"PROXY NL.PEER",if:[]}]}]},cmds:[{hosts:["npostart.nl","cdn.streamgate.nl","nepworldwide.nl","npo.prd.cdn.bcms.kpn.com","atconnect.npo.nl","start-player.npo.nl","tellerapi.npo.nl"],then:"PROXY NL.PEER",if:[]}]},steampowered_com:{match:{root_urls:["steampowered.com"],rules:[{proxy_country:["IT"],cmds:[{root_urls:["steampowered.com"],then:"PROXY IT.POOL_lum_it_shared",if:[]}]},{proxy_country:["CA"],cmds:[{root_urls:["steampowered.com"],then:"PROXY CA.POOL_lum_ca_shared"}]},{proxy_country:["GB"],cmds:[{root_urls:["steampowered.com"],then:"PROXY GB.POOL_lum_gb_shared"}]},{proxy_country:["NL"],cmds:[{root_urls:["steampowered.com"],then:"PROXY NL.POOL_lum_nl_shared"}]},{proxy_country:["FR"],cmds:[{root_urls:["steampowered.com"],then:"PROXY FR.POOL_lum_fr_shared"}]},{proxy_country:["ES"],cmds:[{root_urls:["steampowered.com"],then:"PROXY ES.POOL_lum_es_shared"}]},{proxy_country:["US"],cmds:[{root_urls:["steampowered.com"],then:"PROXY US.POOL_lum_us_shared"}]},{proxy_country:["KR"],cmds:[{root_urls:["steampowered.com"],then:"PROXY KR.POOL_lum_kr_shared"}]},{proxy_country:["BR"],cmds:[{root_urls:["steampowered.com"],then:"PROXY BR.POOL_lum_br_shared"}]},{proxy_country:["NO","GR","DE","DK","SE","CL","SG","CH","EG","RU","PL","IE","CN","IL","AR","HU","BE","FI","MX","HR","SI","SK","TR","TW","TH","JM","VN","PE","PH","ID","RO","ZA","BG","AT","NZ","CZ","IS","PT","BZ","UA"],cmds:[{hosts:["steampowered.com","store.steampowered.com"],then:"PROXY XX.PEER"}]}]},cmds:[{root_urls:["steampowered.com"],then:"PROXY IT.POOL_lum_it_shared",if:[]}]},wormate_io:{match:{root_urls:["wormate.io"],rules:[{proxy_country:["IT"],cmds:[{root_urls:["wormate.io"],then:"PROXY IT.POOL_lum_it_shared",if:[]}]},{proxy_country:["CA"],cmds:[{root_urls:["wormate.io"],then:"PROXY CA.POOL_lum_ca_shared"}]},{proxy_country:["GB"],cmds:[{root_urls:["wormate.io"],then:"PROXY GB.POOL_lum_gb_shared"}]},{proxy_country:["NL"],cmds:[{root_urls:["wormate.io"],then:"PROXY NL.POOL_lum_nl_shared"}]},{proxy_country:["FR"],cmds:[{root_urls:["wormate.io"],then:"PROXY FR.POOL_lum_fr_shared"}]},{proxy_country:["ES"],cmds:[{root_urls:["wormate.io"],then:"PROXY ES.POOL_lum_es_shared"}]},{proxy_country:["US"],cmds:[{root_urls:["wormate.io"],then:"PROXY US.POOL_lum_us_shared"}]},{proxy_country:["KR"],cmds:[{root_urls:["wormate.io"],then:"PROXY KR.POOL_lum_kr_shared"}]},{proxy_country:["BR"],cmds:[{root_urls:["wormate.io"],then:"PROXY BR.POOL_lum_br_shared"}]}]},cmds:[{root_urls:["wormate.io"],then:"PROXY IT.POOL_lum_it_shared",if:[]}]},uol_com_br:{match:{root_urls:["uol.com.br"],rules:[{proxy_country:["BR"],cmds:[{root_urls:["uol.com.br"],then:"PROXY BR.POOL_lum_br_shared",if:[]}]}]},cmds:[{root_urls:["uol.com.br"],then:"PROXY BR.POOL_lum_br_shared",if:[]}]},metamask_io:{match:{root_urls:["metamask.io"],rules:[{proxy_country:["IT"],cmds:[{root_urls:["metamask.io"],then:"PROXY IT.POOL_lum_it_shared",if:[]}]},{proxy_country:["CA"],cmds:[{root_urls:["metamask.io"],then:"PROXY CA.POOL_lum_ca_shared"}]},{proxy_country:["GB"],cmds:[{root_urls:["metamask.io"],then:"PROXY GB.POOL_lum_gb_shared"}]},{proxy_country:["NL"],cmds:[{root_urls:["metamask.io"],then:"PROXY NL.POOL_lum_nl_shared"}]},{proxy_country:["FR"],cmds:[{root_urls:["metamask.io"],then:"PROXY FR.POOL_lum_fr_shared"}]},{proxy_country:["ES"],cmds:[{root_urls:["metamask.io"],then:"PROXY ES.POOL_lum_es_shared"}]},{proxy_country:["US"],cmds:[{root_urls:["metamask.io"],then:"PROXY US.POOL_lum_us_shared"}]},{proxy_country:["KR"],cmds:[{root_urls:["metamask.io"],then:"PROXY KR.POOL_lum_kr_shared"}]},{proxy_country:["BR"],cmds:[{root_urls:["metamask.io"],then:"PROXY BR.POOL_lum_br_shared"}]}]},cmds:[{root_urls:["metamask.io"],then:"PROXY IT.POOL_lum_it_shared",if:[]}]},globo_com:{match:{root_urls:["globo.com"],rules:[{proxy_country:["BR"],cmds:[{root_urls:["globo.com"],then:"PROXY BR.POOL_lum_br_shared",if:[]}]}]},cmds:[{root_urls:["globo.com"],then:"PROXY BR.POOL_lum_br_shared",if:[]}]},borderlands_com:{match:{root_urls:["borderlands.com"],rules:[{proxy_country:["IT"],cmds:[{root_urls:["borderlands.com"],then:"PROXY IT.POOL_lum_it_shared",if:[]}]},{proxy_country:["CA"],cmds:[{root_urls:["borderlands.com"],then:"PROXY CA.POOL_lum_ca_shared"}]},{proxy_country:["GB"],cmds:[{root_urls:["borderlands.com"],then:"PROXY GB.POOL_lum_gb_shared"}]},{proxy_country:["NL"],cmds:[{root_urls:["borderlands.com"],then:"PROXY NL.POOL_lum_nl_shared"}]},{proxy_country:["FR"],cmds:[{root_urls:["borderlands.com"],then:"PROXY FR.POOL_lum_fr_shared"}]},{proxy_country:["ES"],cmds:[{root_urls:["borderlands.com"],then:"PROXY ES.POOL_lum_es_shared"}]},{proxy_country:["US"],cmds:[{root_urls:["borderlands.com"],then:"PROXY US.POOL_lum_us_shared"}]},{proxy_country:["KR"],cmds:[{root_urls:["borderlands.com"],then:"PROXY KR.POOL_lum_kr_shared"}]},{proxy_country:["BR"],cmds:[{root_urls:["borderlands.com"],then:"PROXY BR.POOL_lum_br_shared"}]}]},cmds:[{root_urls:["borderlands.com"],then:"PROXY IT.POOL_lum_it_shared",if:[]}]},bet365_com:{match:{root_urls:["bet365.com"],rules:[{proxy_country:["GB"],cmds:[{root_urls:["bet365.com"],then:"PROXY GB.POOL_lum_gb_shared",if:[]}]},{proxy_country:["US"],cmds:[{root_urls:["bet365.com"],then:"PROXY US.POOL_lum_us_shared"}]}]},cmds:[{root_urls:["bet365.com"],then:"PROXY GB.POOL_lum_gb_shared",if:[]}]},totalwine_com:{match:{root_urls:["totalwine.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["www.totalwine.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]}]},cmds:[{hosts:["www.totalwine.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},lasestrellas_tv:{match:{root_urls:["lasestrellas_tv"],rules:[{proxy_country:["MX"],cmds:[{hosts:["onlymex-auth.televisa.com"],then:"PROXY MX.PEER",if:[]}]}]},cmds:[{hosts:["onlymex-auth.televisa.com"],then:"PROXY MX.PEER",if:[]}]},criteo_com:{match:{root_urls:["criteo.com"],rules:[{cmds:[{hosts:["criteo.com"],then:"PROXY XX",if:[]}]}]},cmds:[{hosts:["criteo.com"],then:"PROXY XX",if:[]}]},target_com:{match:{root_urls:["target.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["gsp.target.com","login.target.com"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{hosts:["gsp.target.com","login.target.com"],then:"PROXY US.PEER",if:[]}]},atv_at:{match:{root_urls:["atv.at"],rules:[{proxy_country:["AT"],cmds:[{hosts:["blocked-multiscreen.atv.cdn.tvnext.tv"],then:"PROXY AT.PEER",if:[]}]}]},cmds:[{hosts:["blocked-multiscreen.atv.cdn.tvnext.tv"],then:"PROXY AT.PEER",if:[]}]},williams_sonoma_com:{match:{root_urls:["williams-sonoma.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["williams-sonoma.com"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{hosts:["williams-sonoma.com"],then:"PROXY US.PEER",if:[]}]},player_pl:{match:{root_urls:["player.pl"],rules:[{proxy_country:["PL"],cmds:[{hosts:["player.pl"],if:[{url:"\\/playerapi\\/product\\/.*\\/player\\/configuration.*",type:"!~",then:"PROXY PL"}],then:"PROXY PL.PEER"}]}]},cmds:[{hosts:["player.pl"],if:[{url:"\\/playerapi\\/product\\/.*\\/player\\/configuration.*",type:"!~",then:"PROXY PL"}],then:"PROXY PL.PEER"}]},bigbrothercanada_ca:{match:{root_urls:["bigbrothercanada.ca"],rules:[{proxy_country:["CA"],cmds:[{hosts:["livestream.com","playback.akamaized.net","playback2.akamaized.net","global.corusappservices.com","bigbrothercanada.ca"],then:"PROXY CA.PEER",if:[]}]}]},cmds:[{hosts:["livestream.com","playback.akamaized.net","playback2.akamaized.net","global.corusappservices.com","bigbrothercanada.ca"],then:"PROXY CA.PEER",if:[]}]},backcountry_com:{match:{root_urls:["backcountry.com"],rules:[{proxy_country:["US"],cmds:[{root_urls:["backcountry.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]}]},cmds:[{root_urls:["backcountry.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},eclinicalweb_com:{match:{root_urls:["eclinicalweb.com"],rules:[{proxy_country:["US"],cmds:[{root_urls:["eclinicalweb.com"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{root_urls:["eclinicalweb.com"],then:"PROXY US.PEER",if:[]}]},sweetgreen_com:{match:{root_urls:["sweetgreen.com"],rules:[{proxy_country:["US"],cmds:[{root_urls:["sweetgreen.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]}]},cmds:[{root_urls:["sweetgreen.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},carvana_com:{proxy_country:["US"],cmds:[{root_urls:["carvana.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},investopedia_com:{match:{root_urls:["investopedia.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["trafficguardapp.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]}]},cmds:[{hosts:["trafficguardapp.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},orf_at:{match:{root_urls:["orf.at"],rules:[{proxy_country:["AT"],cmds:[{hosts:["apasfiis.sf.apa.at","apasfpd.sf.apa.at","api-tvthek.orf.at","orf2.mdn.ors.at","orfs.mdn.ors.at"],then:"PROXY AT.PEER",if:[]}]}]},cmds:[{hosts:["apasfiis.sf.apa.at","apasfpd.sf.apa.at","api-tvthek.orf.at","orf2.mdn.ors.at","orfs.mdn.ors.at"],then:"PROXY AT.PEER",if:[]}]},servustv_com:{match:{root_urls:["servustv.com"],rules:[{proxy_country:["AT"],cmds:[{hosts:["stv-live.akamaized.net","rbmn-live.akamaized.net"],then:"PROXY AT.PEER",if:[]}]}]},cmds:[{hosts:["stv-live.akamaized.net","rbmn-live.akamaized.net"],then:"PROXY AT.PEER",if:[]}]},mol_gov_sa:{match:{root_urls:["mol.gov.sa"],rules:[{proxy_country:["SA"],cmds:[{hosts:["mol.gov.sa"],then:"PROXY SA.PEER",if:[]}]}]},cmds:[{hosts:["mol.gov.sa"],then:"PROXY SA.PEER",if:[]}]},lsm_lv:{match:{root_urls:["lsm.lv"],rules:[{proxy_country:["LV"],cmds:[{hosts:["ltv.lsm.lv","embed.cloudycdn.services","ltv1060.cloudycdn.services","ltv2060.cloudycdn.services"],then:"PROXY LV.PEER",if:[]}]}]},cmds:[{hosts:["ltv.lsm.lv","embed.cloudycdn.services","ltv1060.cloudycdn.services","ltv2060.cloudycdn.services"],then:"PROXY LV.PEER",if:[]}]},eidf_co_kr:{match:{root_urls:["eidf.co.kr"],rules:[{proxy_country:["KR"],cmds:[{hosts:["www.eidf.co.kr"],then:"PROXY KR.POOL_lum_kr_shared",if:[]}]}]},cmds:[{hosts:["www.eidf.co.kr"],then:"PROXY KR.POOL_lum_kr_shared",if:[]}]},abercrombie_com:{proxy_country:["US"],cmds:[{root_urls:["abercrombie.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},amazon_com:{match:{root_urls:["amazon.com"],rules:[{proxy_country:["AU","CO","IT","CA","NL","FR","ES","US","KR","BR"],cmds:[{root_urls:["amazon.com"],if:[{host:"d2y5sgsy8bbmb8.cloudfront.net",type:"==",then:"PROXY US.PEER"},{host:"cloudfront\\.net$",type:"=~",then:"PROXY XX"}],then:"PROXY XX.PEER"},{hosts:["amazon-adsystem.com","images-na.ssl-images-amazon.com"],then:"PROXY XX",if:[]},{hosts:["amazon.com","api.amazonvideo.com","atv-ps.amazon.com","media-amazon.com","api.eu-west-1.aiv-delivery.net","a41avoddashs3ww-a.akamaihd.net","d2y5sgsy8bbmb8.cloudfront.net","api.us-east-1.aiv-delivery.net","merch.amazon.com","www.amazon.com"],then:"PROXY XX.PEER",if:[]}]}]}},amazon_co_uk:{match:{root_urls:["amazon.co.uk"],rules:[{proxy_country:["GB"],cmds:[{root_urls:["amazon.co.uk"],then:"PROXY GB.POOL_lum_gb_shared",if:[]},{hosts:["amazon.com","api.amazonvideo.com"],then:"PROXY GB.POOL_lum_gb_shared",if:[]}]}]},cmds:[{root_urls:["amazon.co.uk"],then:"PROXY GB.POOL_lum_gb_shared",if:[]},{hosts:["amazon.com","api.amazonvideo.com"],then:"PROXY GB.POOL_lum_gb_shared",if:[]}]},amazon_de:{match:{root_urls:["amazon.de"],rules:[{proxy_country:["DE"],cmds:[{hosts:["www.amazon.de","atv-ps-eu.amazon.de"],then:"PROXY DE.PEER",if:[]}]}]},cmds:[{hosts:["www.amazon.de","atv-ps-eu.amazon.de"],then:"PROXY DE.PEER",if:[]}]},amazon_co_jp:{match:{root_urls:["amazon.co.jp"],rules:[{proxy_country:["JP"],cmds:[{hosts:["www.amazon.co.jp","atv-ps-fe.amazon.co.jp"],then:"PROXY JP.PEER",if:[]}]}]},cmds:[{hosts:["www.amazon.co.jp","atv-ps-fe.amazon.co.jp"],then:"PROXY JP.PEER",if:[]}]},ondemandkorea_com:{proxy_country:["US"],cmds:[{root_urls:["ondemandkorea.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},eastbay_com:{proxy_country:["US"],cmds:[{hosts:["eastbay.com"],then:"PROXY US.PEER",if:[]}]},origin_com:{proxy_country:["US"],cmds:[{root_urls:["origin.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},disneyplus_com:{match:{root_urls:["disneyplus.com"],rules:[{proxy_country:["IT"],cmds:[{hosts:["global.edge.bamgrid.com","sdk.iad-03.braze.com","disney.api.edge.bamgrid.com","dialacrum.iad-03.braze.com","disney.demdex.net","disney.connections.edge.bamgrid.com","disney.content.edge.bamgrid.com","disney.playback.edge.bamgrid.com","star.api.edge.bamgrid.com"],then:"PROXY IT.PEER",if:[]},{root_urls:["disneyplus.com"],then:"PROXY IT.POOL_lum_it_shared",if:[]},{hosts:["disneyplus.com","www.disneyplus.com","svcs.dssott.com","egisterdisney.go.com","disney-plus.net"],then:"PROXY IT.POOL_lum_it_shared",if:[]}]},{proxy_country:["CA"],cmds:[{hosts:["global.edge.bamgrid.com","sdk.iad-03.braze.com","disney.api.edge.bamgrid.com","dialacrum.iad-03.braze.com","disney.demdex.net","disney.connections.edge.bamgrid.com","disney.content.edge.bamgrid.com","disney.playback.edge.bamgrid.com","star.api.edge.bamgrid.com"],then:"PROXY CA.PEER"},{root_urls:["disneyplus.com"],then:"PROXY CA.POOL_lum_ca_shared"},{hosts:["disneyplus.com","www.disneyplus.com","svcs.dssott.com","egisterdisney.go.com","disney-plus.net"],then:"PROXY CA.POOL_lum_ca_shared"}]},{proxy_country:["GB"],cmds:[{hosts:["global.edge.bamgrid.com","sdk.iad-03.braze.com","disney.api.edge.bamgrid.com","dialacrum.iad-03.braze.com","disney.demdex.net","disney.connections.edge.bamgrid.com","disney.content.edge.bamgrid.com","disney.playback.edge.bamgrid.com","star.api.edge.bamgrid.com"],then:"PROXY GB.PEER"},{root_urls:["disneyplus.com"],then:"PROXY GB.POOL_lum_gb_shared"},{hosts:["disneyplus.com","www.disneyplus.com","svcs.dssott.com","egisterdisney.go.com","disney-plus.net"],then:"PROXY GB.POOL_lum_gb_shared"}]},{proxy_country:["NL"],cmds:[{hosts:["global.edge.bamgrid.com","sdk.iad-03.braze.com","disney.api.edge.bamgrid.com","dialacrum.iad-03.braze.com","disney.demdex.net","disney.connections.edge.bamgrid.com","disney.content.edge.bamgrid.com","disney.playback.edge.bamgrid.com","star.api.edge.bamgrid.com"],then:"PROXY NL.PEER"},{root_urls:["disneyplus.com"],then:"PROXY NL.POOL_lum_nl_shared"},{hosts:["disneyplus.com","www.disneyplus.com","svcs.dssott.com","egisterdisney.go.com","disney-plus.net"],then:"PROXY NL.POOL_lum_nl_shared"}]},{proxy_country:["FR"],cmds:[{hosts:["global.edge.bamgrid.com","sdk.iad-03.braze.com","disney.api.edge.bamgrid.com","dialacrum.iad-03.braze.com","disney.demdex.net","disney.connections.edge.bamgrid.com","disney.content.edge.bamgrid.com","disney.playback.edge.bamgrid.com","star.api.edge.bamgrid.com"],then:"PROXY FR.PEER"},{root_urls:["disneyplus.com"],then:"PROXY FR.POOL_lum_fr_shared"},{hosts:["disneyplus.com","www.disneyplus.com","svcs.dssott.com","egisterdisney.go.com","disney-plus.net"],then:"PROXY FR.POOL_lum_fr_shared"}]},{proxy_country:["ES"],cmds:[{hosts:["global.edge.bamgrid.com","sdk.iad-03.braze.com","disney.api.edge.bamgrid.com","dialacrum.iad-03.braze.com","disney.demdex.net","disney.connections.edge.bamgrid.com","disney.content.edge.bamgrid.com","disney.playback.edge.bamgrid.com","star.api.edge.bamgrid.com"],then:"PROXY ES.PEER"},{root_urls:["disneyplus.com"],then:"PROXY ES.POOL_lum_es_shared"},{hosts:["disneyplus.com","www.disneyplus.com","svcs.dssott.com","egisterdisney.go.com","disney-plus.net"],then:"PROXY ES.POOL_lum_es_shared"}]},{proxy_country:["US"],cmds:[{hosts:["global.edge.bamgrid.com","sdk.iad-03.braze.com","disney.api.edge.bamgrid.com","dialacrum.iad-03.braze.com","disney.demdex.net","disney.connections.edge.bamgrid.com","disney.content.edge.bamgrid.com","disney.playback.edge.bamgrid.com","star.api.edge.bamgrid.com"],then:"PROXY US.PEER"},{root_urls:["disneyplus.com"],then:"PROXY US.POOL_lum_us_shared"},{hosts:["disneyplus.com","www.disneyplus.com","svcs.dssott.com","egisterdisney.go.com","disney-plus.net"],then:"PROXY US.POOL_lum_us_shared"}]},{proxy_country:["HK"],cmds:[{hosts:["global.edge.bamgrid.com","sdk.iad-03.braze.com","disney.api.edge.bamgrid.com","dialacrum.iad-03.braze.com","disney.demdex.net","disney.connections.edge.bamgrid.com","disney.content.edge.bamgrid.com","disney.playback.edge.bamgrid.com","star.api.edge.bamgrid.com"],then:"PROXY HK.PEER"},{root_urls:["disneyplus.com"],then:"PROXY HK.PEER"},{hosts:["disneyplus.com","www.disneyplus.com","svcs.dssott.com","egisterdisney.go.com","disney-plus.net"],then:"PROXY HK.PEER"}]},{proxy_country:["KR"],cmds:[{hosts:["global.edge.bamgrid.com","sdk.iad-03.braze.com","disney.api.edge.bamgrid.com","dialacrum.iad-03.braze.com","disney.demdex.net","disney.connections.edge.bamgrid.com","disney.content.edge.bamgrid.com","disney.playback.edge.bamgrid.com","star.api.edge.bamgrid.com"],then:"PROXY KR.PEER"},{root_urls:["disneyplus.com"],then:"PROXY KR.POOL_lum_kr_shared"},{hosts:["disneyplus.com","www.disneyplus.com","svcs.dssott.com","egisterdisney.go.com","disney-plus.net"],then:"PROXY KR.POOL_lum_kr_shared"}]},{proxy_country:["BR"],cmds:[{hosts:["global.edge.bamgrid.com","sdk.iad-03.braze.com","disney.api.edge.bamgrid.com","dialacrum.iad-03.braze.com","disney.demdex.net","disney.connections.edge.bamgrid.com","disney.content.edge.bamgrid.com","disney.playback.edge.bamgrid.com","star.api.edge.bamgrid.com"],then:"PROXY BR.PEER"},{root_urls:["disneyplus.com"],then:"PROXY BR.POOL_lum_br_shared"},{hosts:["disneyplus.com","www.disneyplus.com","svcs.dssott.com","egisterdisney.go.com","disney-plus.net"],then:"PROXY BR.POOL_lum_br_shared"}]},{proxy_country:["JP"],cmds:[{hosts:["global.edge.bamgrid.com","sdk.iad-03.braze.com","disney.api.edge.bamgrid.com","dialacrum.iad-03.braze.com","disney.demdex.net","disney.connections.edge.bamgrid.com","disney.content.edge.bamgrid.com","disney.playback.edge.bamgrid.com","star.api.edge.bamgrid.com"],then:"PROXY JP.PEER"},{root_urls:["disneyplus.com"],then:"PROXY JP.PEER"},{hosts:["disneyplus.com","www.disneyplus.com","svcs.dssott.com","egisterdisney.go.com","disney-plus.net"],then:"PROXY JP.PEER"}]},{proxy_country:["IN"],cmds:[{hosts:["global.edge.bamgrid.com","sdk.iad-03.braze.com","disney.api.edge.bamgrid.com","dialacrum.iad-03.braze.com","disney.demdex.net","disney.connections.edge.bamgrid.com","disney.content.edge.bamgrid.com","disney.playback.edge.bamgrid.com","star.api.edge.bamgrid.com"],then:"PROXY IN.PEER"},{root_urls:["disneyplus.com"],then:"PROXY IN.POOL_lum_in_shared"},{hosts:["disneyplus.com","www.disneyplus.com","svcs.dssott.com","egisterdisney.go.com","disney-plus.net"],then:"PROXY IN.POOL_lum_in_shared"}]},{proxy_country:["NO","GR","DE","DK","SE","CL","SG","CH","EG","RU","PL","IE","CN","IL","AR","HU","BE","FI","MX","HR","SI","SK","TR","TW","TH","JM","VN","PE","PH","ID","RO","ZA","BG","AT","NZ","CZ","IS","PT","BZ","UA"],cmds:[{hosts:["global.edge.bamgrid.com","sdk.iad-03.braze.com","disney.api.edge.bamgrid.com","dialacrum.iad-03.braze.com","disney.demdex.net","disney.connections.edge.bamgrid.com","disney.content.edge.bamgrid.com","disney.playback.edge.bamgrid.com","star.api.edge.bamgrid.com"],then:"PROXY XX.PEER"},{root_urls:["disneyplus.com"],then:"PROXY XX.PEER"},{hosts:["disneyplus.com","www.disneyplus.com","svcs.dssott.com","egisterdisney.go.com","disney-plus.net"],then:"PROXY XX.PEER"}]}]}},hbonow_com:{match:{root_urls:["hbonow.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["comet.api.hbo.com","play.hbonow.com"],then:"PROXY US.PEER",if:[]},{root_urls:["hbonow.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]}]}},hbomax_com:{match:{root_urls:["hbomax.com"],rules:[{proxy_country:["US"],cmds:[{client_only:true,hosts:["google.com","googleapis.com"],then:"DIRECT",if:[]},{root_urls:["hbomax.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},{proxy_country:["BR"],cmds:[{root_urls:["hbomax.com"],then:"PROXY BR.POOL_lum_br_shared"}]},{proxy_country:["AR","AT","AU","BE","BG","BR","CA","CH","CL","CO","CZ","DE","DK","ES","FI","FR","GB","GR","HK","HR","HU","ID","IE","IL","IN","IT","IS","JP","KR","MX","NL","NO","NZ","PL","RO","RU","SE","SG","SK","TR","US","NO","GR","DE","DK","SE","CL","SG","CH","EG","RU","PL","IE","CN","IL","AR","HU","BE","FI","MX","HR","SI","SK","TR","TW","TH","JM","VN","PE","PH","ID","RO","ZA","BG","AT","NZ","CZ","IS","PT","BZ","UA"],cmds:[{hosts:["gateway.api.hbo.com","comet.api.hbo.com","play.hbonow.com","oauth.api.hbo.com","oauth-emea.api.hbo.com","oauth-us.api.hbo.com","gateway-latam.api.hbo.com","telegraph.api.hbo.com","sessions.api.hbo.com","comet-latam.api.hbo.com","api.hbo.com"],then:"PROXY XX.PEER"}]}]}},cbs_com:{match:{root_urls:["cbs.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["cbsivideo.com","cbsaavideo.com","link.theplatform.com"],then:"PROXY US.POOL_lum_us_shared",if:[]},{root_urls:["cbs.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]}]},cmds:[{hosts:["cbsivideo.com","cbsaavideo.com","link.theplatform.com"],then:"PROXY US.POOL_lum_us_shared",if:[]},{root_urls:["cbs.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},canalplus_com:{proxy_country:["FR"],cmds:[{root_urls:["canalplus.com"],then:"PROXY FR.POOL_lum_fr_shared",if:[]}]},liverugby_net:{proxy_country:["GB"],cmds:[{root_urls:["liverugby.net"],then:"PROXY GB.POOL_lum_gb_shared",if:[]}]},zagonka_tv:{proxy_country:["GB"],cmds:[{root_urls:["zagonka.tv"],then:"PROXY GB.PEER",if:[]}]},areena_yle_fi:{match:{root_urls:["areena.yle.fi"],rules:[{proxy_country:["FI"],cmds:[{hosts:["locations.api.yle.fi"],then:"PROXY FI.PEER",if:[]}]}]},cmds:[{hosts:["locations.api.yle.fi"],then:"PROXY FI.PEER",if:[]}]},bbc_co_uk:{match:{root_urls:["bbc.co.uk","bbc.com"],rules:[{proxy_country:["GB"],cmds:[{hosts:["fig.bbc.co.uk","open.live.bbc.co.uk"],then:"PROXY GB.PEER",if:[]},{hosts:["bbc.co.uk","bbc.com"],then:"PROXY GB.PEER",if:[]},{hosts:["bbci.co.uk","live.cf.md.bbci.co.uk","files.bbci.co.uk","account.bbc.com","api.bbc.co.uk","ssl.bbc.co.uk","vod-dash-uk-live.bbcfmt.hs.llnwd.net","vod-thumb-uk-live.bbcfmt.hs.llnwd.net","vs-dash-uk-live.bbcfmt.hs.llnwd.net","vod-sub-uk-live.bbcfmt.hs.llnwd.net","bbcfmt.hs.llnwd.net","bbcfmt.s.llnwi.net","s.loris.llnwd.net","vod-thumb-uk-live.akamaized.net","vs-dash-uk-live.akamaized.net","aod-dash-uk-live.akamaized.net","cf.md.bbci.co.uk","www.bbc.co.uk","vod-dash-uk-live.akamaized.net","as-dash-uk-live.akamaized.net","bidi.bbc.co.uk","bidi.live.bbc.co.uk","live.bidi.net.uk"],then:"PROXY GB.PEER",if:[]}],error_codes:[403]}]},cmds:[{hosts:["fig.bbc.co.uk","open.live.bbc.co.uk"],then:"PROXY GB.PEER",if:[]},{hosts:["bbc.co.uk","bbc.com"],then:"PROXY GB.PEER",if:[]},{hosts:["bbci.co.uk","live.cf.md.bbci.co.uk","files.bbci.co.uk","account.bbc.com","api.bbc.co.uk","ssl.bbc.co.uk","vod-dash-uk-live.bbcfmt.hs.llnwd.net","vod-thumb-uk-live.bbcfmt.hs.llnwd.net","vs-dash-uk-live.bbcfmt.hs.llnwd.net","vod-sub-uk-live.bbcfmt.hs.llnwd.net","bbcfmt.hs.llnwd.net","bbcfmt.s.llnwi.net","s.loris.llnwd.net","vod-thumb-uk-live.akamaized.net","vs-dash-uk-live.akamaized.net","aod-dash-uk-live.akamaized.net","cf.md.bbci.co.uk","www.bbc.co.uk","vod-dash-uk-live.akamaized.net","as-dash-uk-live.akamaized.net","bidi.bbc.co.uk","bidi.live.bbc.co.uk","live.bidi.net.uk"],then:"PROXY GB.PEER",if:[]}]},bergdorfgoodman_com:{proxy_country:["US"],cmds:[{root_urls:["bergdorfgoodman.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},channel4_com:{match:{root_urls:["channel4.com"],rules:[{proxy_country:["GB"],cmds:[{client_only:true,hosts:["google.com","googleapis.com"],then:"DIRECT",if:[]},{root_urls:["channel4.com"],if:[{url:".*check-email",type:"=~",then:"DIRECT"}],then:"PROXY GB.POOL_lum_gb_shared"},{hosts:["ais.channel4.com"],then:"PROXY GB.PEER",if:[]}]}]},cmds:[{client_only:true,hosts:["google.com","googleapis.com"],then:"DIRECT",if:[]},{root_urls:["channel4.com"],if:[{url:".*check-email",type:"=~",then:"DIRECT"}],then:"PROXY GB.POOL_lum_gb_shared"},{hosts:["ais.channel4.com"],then:"PROXY GB.PEER",if:[]}]},criterionchannel_com:{proxy_country:["US"],cmds:[{root_urls:["criterionchannel.com"],then:"PROXY US.PEER",if:[]}]},textnow_com:{match:{root_urls:["textnow.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["textnow.com"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{hosts:["textnow.com"],then:"PROXY US.PEER",if:[]}]},mangago_me:{match:{root_urls:["mangago.me"],rules:[{proxy_country:["US"],cmds:[{hosts:["mangago.me"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{hosts:["mangago.me"],then:"PROXY US.PEER",if:[]}]},javhd_pro:{match:{root_urls:["javhd.pro"],rules:[{proxy_country:["US"],cmds:[{hosts:["javhd.pro"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{hosts:["javhd.pro"],then:"PROXY US.PEER",if:[]}]},ustvgo_tv:{match:{root_urls:["ustvgo.tv"],rules:[{proxy_country:["IL"],cmds:[{hosts:["ustvgo.tv"],then:"PROXY IL.PEER",if:[]},{hosts:["useast.quantumdex.io","ustv24h.live"],then:"PROXY IL.PEER",if:[]}]}]},cmds:[{hosts:["ustvgo.tv"],then:"PROXY IL.PEER",if:[]},{hosts:["useast.quantumdex.io","ustv24h.live"],then:"PROXY IL.PEER",if:[]}]},hpjav_tv:{match:{root_urls:["hpjav.tv"],rules:[{proxy_country:["US"],cmds:[{hosts:["hpjav.tv"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{hosts:["hpjav.tv"],then:"PROXY US.PEER",if:[]}]},anybunny_tv:{match:{root_urls:["anybunny.tv"],rules:[{proxy_country:["US"],cmds:[{hosts:["anybunny.tv"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{hosts:["anybunny.tv"],then:"PROXY US.PEER",if:[]}]},warning_or_kr:{match:{root_urls:["warning.or.kr"],rules:[{proxy_country:["KR"],cmds:[{hosts:["warning.or.kr"],then:"PROXY KR.PEER",if:[]}]}]},cmds:[{hosts:["warning.or.kr"],then:"PROXY KR.PEER",if:[]}]},crunchyroll_com:{match:{root_urls:["crunchyroll.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["crunchyroll.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]}]},cmds:[{hosts:["crunchyroll.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},dazn_com:{match:{root_urls:["dazn.com"],rules:[{cmds:[{hosts:["isl.dazn.com","isl-ca.dazn.com","isl-eu.dazn.com","isl-jp.dazn.com","isl-us.dazn.com","indazn.com"],then:"PROXY XX.PEER",if:[]}]}]},cmds:[{hosts:["isl.dazn.com","isl-ca.dazn.com","isl-eu.dazn.com","isl-jp.dazn.com","isl-us.dazn.com","indazn.com"],then:"PROXY XX.PEER",if:[]}]},dr_dk:{proxy_country:["DK"],cmds:[{hosts:["www.dr.dk","drlive01hls.akamaized.net","drlive02hls.akamaized.net","drlive03hls.akamaized.net"],then:"PROXY DK.PEER",if:[]}]},eversource_com:{proxy_country:["US"],cmds:[{root_urls:["eversource.com"],then:"PROXY US.POOL_lum_us_shared",if:[]},{hosts:["i-doxs.net"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},espn_com_co:{match:{root_urls:["espn.com.co"],rules:[{proxy_country:["CO"],cmds:[{hosts:["tredir.espn.com"],then:"PROXY CO.POOL",if:[]},{root_urls:["espn.com.co"],then:"PROXY CO.POOL",if:[]}]}]},cmds:[{hosts:["tredir.espn.com"],then:"PROXY CO.POOL",if:[]},{root_urls:["espn.com.co"],then:"PROXY CO.POOL",if:[]}]},espn_com:{match:{root_urls:["espn.com"],rules:[{proxy_country:["ES"],cmds:[{hosts:["us.edge.bamgrid.com"],then:"PROXY ES.POOL_lum_es_shared",if:[]},{root_urls:["espn.com"],then:"PROXY ES.POOL_lum_es_shared",if:[]}]}]},cmds:[{hosts:["us.edge.bamgrid.com"],then:"PROXY ES.POOL_lum_es_shared",if:[]},{root_urls:["espn.com"],then:"PROXY ES.POOL_lum_es_shared",if:[]}]},fastpeoplesearch_com:{proxy_country:["US"],cmds:[{hosts:["fastpeoplesearch.com","www.fastpeoplesearch.com"],then:"PROXY US.PEER",if:[]},{client_only:true,hosts:["google.com","googleapis.com"],then:"DIRECT",if:[]}]},searchpeoplefree_com:{proxy_country:["US"],cmds:[{hosts:["searchpeoplefree.com","www.searchpeoplefree.com"],then:"PROXY US.PEER",if:[]},{client_only:true,hosts:["google.com","googleapis.com"],then:"DIRECT",if:[]}]},peoplesearchnow_com:{proxy_country:["US"],cmds:[{hosts:["peoplesearchnow.com","www.peoplesearchnow.com"],then:"PROXY US.PEER",if:[]},{client_only:true,hosts:["google.com","googleapis.com"],then:"DIRECT",if:[]}]},truepeoplesearch_com:{proxy_country:["US"],cmds:[{hosts:["truepeoplesearch.com","www.truepeoplesearch.com"],then:"PROXY US.PEER",if:[]},{client_only:true,hosts:["google.com","googleapis.com"],then:"DIRECT",if:[]}]},usphonebook_com:{proxy_country:["US"],cmds:[{hosts:["usphonebook.com","www.usphonebook.com"],then:"PROXY US.PEER",if:[]},{client_only:true,hosts:["google.com","googleapis.com"],then:"DIRECT",if:[]}]},ffsng_com:{proxy_country:["US"],cmds:[{hosts:["ffsng.com"],if:[{url:"ffsng\\.com\\/ajax\\.php",type:"!~",then:"PROXY US"}],then:"PROXY US.PEER"}]},finishline_com:{proxy_country:["US"],cmds:[{hosts:["finishline.com"],then:"PROXY US.PEER",if:[]}]},footlocker_com:{proxy_country:["US"],cmds:[{root_urls:["footlocker.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},ulta_com:{proxy_country:["US"],cmds:[{root_urls:["ulta.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},jsnx_net:{proxy_country:["US"],cmds:[{hosts:["jsnx.net"],then:"PROXY US.PEER",if:[]}]},cwtv_com:{match:{root_urls:["cwtv.com"],rules:[{proxy_country:["US"],cmds:[{root_urls:["cwtv.com"],then:"PROXY US.POOL_lum_us_shared",if:[]},{hosts:["cwtv-amd-akamai.akamaized.net"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{root_urls:["cwtv.com"],then:"PROXY US.POOL_lum_us_shared",if:[]},{hosts:["cwtv-amd-akamai.akamaized.net"],then:"PROXY US.PEER",if:[]}]},france_tv:{proxy_country:["FR"],cmds:[{hosts:["cloudreplay.ftven.fr","hdfauth.ftven.fr"],then:"PROXY FR.PEER",if:[]}]},francetvinfo_fr:{proxy_country:["FR"],cmds:[{root_urls:["francetvinfo.fr"],then:"PROXY FR.POOL_lum_fr_shared",if:[]}]},gamestop_com:{proxy_country:["US"],cmds:[{root_urls:["gamestop.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},globaltv_ca:{proxy_country:["CA"],cmds:[{root_urls:["globaltv.com"],then:"PROXY CA.POOL_lum_ca_shared",if:[]},{hosts:["global.corusappservices.com"],then:"PROXY CA.PEER",if:[]}]},bell_ca:{proxy_country:["CA"],cmds:[{root_urls:["bell.ca"],then:"PROXY CA.POOL_lum_ca_shared",if:[]}]},go_com:{match:{root_urls:["go.com"],rules:[{cmds:[{hosts:["go.com","prod.gatekeeper.us-abc.symphony.edgedatg.com"],then:"PROXY XX.PEER",if:[]}]}]},cmds:[{hosts:["go.com","prod.gatekeeper.us-abc.symphony.edgedatg.com"],then:"PROXY XX.PEER",if:[]}]},go_us:{proxy_country:["US"],cmds:[{hosts:["prod.gatekeeper.us-abc.symphony.edgedatg.go.com","prod.gatekeeper.us-abc.symphony.edgedatg.com"],then:"PROXY US.PEER",if:[]}]},starz_com:{match:{root_urls:["starz.com"],rules:[{cmds:[{hosts:["auth.starz.com","msrem.starz.com"],then:"PROXY XX.PEER",if:[]}]}]},cmds:[{hosts:["auth.starz.com","msrem.starz.com"],then:"PROXY XX.PEER",if:[]}]},cf_sites:{cmds:[{hosts:["rutracker.org","ashleymadison.com","myshopify.com","visa.com","uakino.club","tvoj-onlajn.ru","gleam.io","exelab.ru","king368.com"],then:"PROXY XX.PEER",if:[]}]},hbogo:{match:{root_urls:["hbogo.pl","hbogo.ro"],rules:[{cmds:[{hosts:["api.ugw.hbogo.eu"],if:[{url:"api\\.ugw\\.hbogo\\.eu\\/v3\\.0\\/(GeoCheck|Authentication\\/(POL|ROU))\\/(json|JSON).*",type:"!~",then:"PROXY XX"}],then:"PROXY XX.PEER"}]}]},cmds:[{hosts:["api.ugw.hbogo.eu"],if:[{url:"api\\.ugw\\.hbogo\\.eu\\/v3\\.0\\/(GeoCheck|Authentication\\/(POL|ROU))\\/(json|JSON).*",type:"!~",then:"PROXY XX"}],then:"PROXY XX.PEER"}]},hbogola_com:{match:{root_urls:["hbogola.com"],rules:[{proxy_country:["MX","PE","CO"],cmds:[{hosts:["globalapi.hbogola.com","ais.directvla.com"],then:"PROXY XX.PEER",if:[]}]}]},cmds:[{hosts:["globalapi.hbogola.com","ais.directvla.com"],then:"PROXY XX.PEER",if:[]}]},hbogo_com_br:{match:{root_urls:["hbogo.com.br"],rules:[{proxy_country:["BR"],cmds:[{hosts:["globalapi.hbogola.com"],then:"PROXY BR.PEER",if:[]}]}]},cmds:[{hosts:["globalapi.hbogola.com"],then:"PROXY BR.PEER",if:[]}]},movistarplay_com_pe:{match:{root_urls:["movistarplay.com.pe"],rules:[{proxy_country:["PE"],cmds:[{hosts:["movistarplay.com.pe","wvcypherdrm.gvp.telefonica.com"],then:"PROXY PE.PEER",if:[]}]}]},cmds:[{hosts:["movistarplay.com.pe","wvcypherdrm.gvp.telefonica.com"],then:"PROXY PE.PEER",if:[]}]},directvgo_com:{match:{root_urls:["directvgo.com"],rules:[{proxy_country:["PE"],cmds:[{hosts:["directvgo.com"],then:"PROXY PE.PEER",if:[]}]}]},cmds:[{hosts:["directvgo.com"],then:"PROXY PE.PEER",if:[]}]},elevensports_pt:{match:{root_urls:["elevensports.pt"],rules:[{proxy_country:["PT"],cmds:[{hosts:["elevensports.pt","dce-frontoffice.imggaming.com"],then:"PROXY PT.PEER",if:[]}]}]},cmds:[{hosts:["elevensports.pt","dce-frontoffice.imggaming.com"],then:"PROXY PT.PEER",if:[]}]},hollisterco_com:{proxy_country:["US"],cmds:[{root_urls:["hollisterco.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},hotstar_com:{proxy_country:["IN","GB"],cmds:[{root_urls:["hotstar.com"],if:[{host:"(?:google-analytics\\.com|analytics\\.twitter\\.com|googleadservices\\.com|p\\.adsymptotic\\.com|googletagmanager\\.com|bat\\.bing\\.com|adservice\\.google\\.com|doubleclick\\.net|gstatic\\.com|googlesyndication\\.com|2mdn\\.net|q\\.quora\\.com|analytics\\.edgekey\\.net|amazon-adsystem\\.com|users\\.quantumgraph\\.com|images-na\\.ssl-images-amazon\\.com|bh\\.contextweb\\.com|pixel-sync\\.sitescout\\.com|ads-twitter\\.com|googletagservices\\.com|scorecardresearch\\.com|outbrain\\.com|cdnjs\\.cloudflare\\.com|adservice\\.google\\.com\\.pk|adservice\\.google\\.com\\.ph|adroll\\.com|analytics\\.yahoo\\.com|spl\\.zeotap\\.com|a-ads\\.com|google\\.com|google\\.co\\.in|facebook\\.com|facebook\\.net|t\\.co|rubiconproject\\.com|google\\.com\\.bd|mixpanel\\.com|go-mpulse\\.net|google\\.com\\.au|googleapis\\.com)$",type:"=~",then:"DIRECT"}],then:"PROXY IN.POOL_lum_in_shared"},{hosts:["www.hotstar.com","services.hotstar.com","segment.hotstar.com","api.hotstar.com","geoip.hotstar.com","e6858.dsce9.akamaiedge.net","ma312-r.analytics.edgesuite.net","service.hotstar.com","persona.hotstar.com","secure-media.hotstar.com"],then:"PROXY IN.POOL_lum_in_shared",if:[]},{hosts:["hses1.akamaized.net","hses.akamaized.net","hses2.akamaized.net","ds-aksb-a.akamaihd.net","hesads.akamaized.net","hsdesinova.akamaized.net","hses3.akamaized.net","hses4.akamaized.net","staragvod-vh.akamaihd.net","hsdesinova.akamaized.net","hsprepack.akamaized.net","staragvod1-vh.akamaihd.net","staragvod2-vh.akamaihd.net","staragvod3-vh.akamaihd.net","staragdash.akamaized.net","hssportsprepack.akamaized.net","live11.akt.hotstar-cdn.net","live15p.hotstar.com","hses4.hotstar.com","hotstar.com","hsdashgec1.akamaized.net","hsdashgec2.akamaized.net","hsnewsprepack.akamaized.net"],then:"PROXY IN.POOL_lum_in_shared",if:[]},{hosts:["in-star.videoplaza.tv","hotstar.worldgravity.com"],then:"PROXY IN.POOL_lum_in_shared",if:[]}]},sevenplus_com_au:{proxy_country:["AU"],cmds:[{hosts:["sevennetwork.akamaized.net","live-sevennetwork.akamaized.net","7plus-sevennetwork.akamaized.net","npc-live-sevennetwork.akamaized.net"],then:"PROXY AU.PEER",if:[]},{root_urls:["7plus.com.au"],then:"PROXY AU.POOL",if:[]}]},hulu_com:{match:{root_urls:["hulu.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["play.hulu.com"],if:[{url:".*(\\.)?play\\.hulu\\.com\\/.*\\/playlist",type:"!~",then:"PROXY US.POOL_lum_us_shared"}],then:"PROXY US.PEER"},{hosts:["discover.hulu.com"],if:[{url:"discover\\.hulu\\.com\\/content\\/",type:"!~",then:"PROXY US.POOL_lum_us_shared"}],then:"PROXY US.PEER"},{hosts:["secure.hulu.com","auth.hulu.com"],then:"PROXY US.PEER",if:[]},{hosts:["hulu-lr.hb-api.omtrdc.net","cws-hulu.conviva.com"],then:"PROXY US.POOL_lum_us_shared",if:[]},{root_urls:["hulu.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]}]},cmds:[{hosts:["play.hulu.com"],if:[{url:".*(\\.)?play\\.hulu\\.com\\/.*\\/playlist",type:"!~",then:"PROXY US.POOL_lum_us_shared"}],then:"PROXY US.PEER"},{hosts:["discover.hulu.com"],if:[{url:"discover\\.hulu\\.com\\/content\\/",type:"!~",then:"PROXY US.POOL_lum_us_shared"}],then:"PROXY US.PEER"},{hosts:["secure.hulu.com","auth.hulu.com"],then:"PROXY US.PEER",if:[]},{hosts:["hulu-lr.hb-api.omtrdc.net","cws-hulu.conviva.com"],then:"PROXY US.POOL_lum_us_shared",if:[]},{root_urls:["hulu.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},hulu_jp:{match:{root_urls:["hulu.jp"],rules:[{proxy_country:["JP"],cmds:[{hosts:["api.happyon.jp"],if:[{url:"api\\.happyon\\.jp\\/v1\\/(auth\\/token|playback\\/video)",type:"!~",then:"PROXY JP"}],then:"PROXY JP.PEER"},{hosts:["hulu.jp"],if:[{url:"hulu\\.jp\\/(account|signup).*",type:"!~",then:"PROXY JP"}],then:"PROXY JP.PEER"},{hosts:["papi.prod.hjholdings.tv"],then:"PROXY JP.PEER",if:[]}]}]},cmds:[{hosts:["api.happyon.jp"],if:[{url:"api\\.happyon\\.jp\\/v1\\/(auth\\/token|playback\\/video)",type:"!~",then:"PROXY JP"}],then:"PROXY JP.PEER"},{hosts:["hulu.jp"],if:[{url:"hulu\\.jp\\/(account|signup).*",type:"!~",then:"PROXY JP"}],then:"PROXY JP.PEER"},{hosts:["papi.prod.hjholdings.tv"],then:"PROXY JP.PEER",if:[]}]},itv_com:{proxy_country:["GB"],cmds:[{hosts:["itv.com"],then:"PROXY GB.PEER",if:[]},{hosts:["magni.itv.com","edge.api.brightcove.com"],then:"PROXY GB.PEER",if:[]},{hosts:["itv.com","itvpnp.live.ott.irdeto.com","itvstatic.com","itvpnpdotcom-a.akamaihd.net","ssl-itvdotcom.2cnt.net","play.dar.itv.com","csm-e-itv-eb.play.dar.itv.com","itvpnpdotcom.cdn1.content.itv.com","itvpnp.live.ott.irdeto.com"],then:"PROXY GB.PEER",if:[]}],error_codes:[403]},iqiyi_com:{proxy_country:["CN"],cmds:[{hosts:["cache.video.iqiyi.com"],if:[{url:".*cache\\.video\\.iqiyi\\.com\\/dash.*",type:"!~",then:"PROXY CN"}],then:"PROXY CN.PEER"}]},iview_abc_net_au:{cmds:[{hosts:["api.iview.abc.net.au"],if:[{url:"api\\.iview\\.abc\\.net\\.au\\/v2\\/(video|token\\/drm)\\/.*",type:"!~",then:"PROXY AU.POOL"}],then:"PROXY AU.PEER"},{hosts:["abc-iview-mediapackagestreams-1.akamaized.net"],if:[{url:"abc-iview-mediapackagestreams-1\\.akamaized\\.net\\/out\\/v1\\/\\w+\\/index\\.mpd",type:"!~",then:"PROXY AU.POOL"}],then:"PROXY AU.PEER"},{hosts:["iview-vod.akamaized.net"],if:[{url:"iview-vod\\.akamaized\\.net\\/prod\\/ck1\\/\\w+\\/\\w+\\/mpegdash\\/master\\.mpd",type:"!~",then:"PROXY AU.POOL"}],then:"PROXY AU.PEER"}]},kaltura_com:{proxy_country:["FI"],cmds:[{hosts:["cdnapisec.kaltura.com","cdnsecakmi.kaltura.com"],then:"PROXY FI.PEER",if:[]}]},kbs_co_kr:{proxy_country:["KR"],cmds:[{root_urls:["kbs.co.kr"],then:"PROXY KR.POOL_lum_kr_shared",if:[]},{hosts:["onair.kbs.co.kr","vod.kbs.co.kr"],then:"PROXY KR.PEER",if:[]}]},manga_line_me:{proxy_country:["JP"],cmds:[{hosts:["manga.line.me"],then:"PROXY JP.PEER",if:[]}]},marcus_com:{proxy_country:["US"],cmds:[{root_urls:["marcus.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},meiliboxi_fi:{proxy_country:["FI"],cmds:[{hosts:["meiliboxi.fi"],then:"PROXY FI.PEER",if:[]}]},mitele_es:{match:{root_urls:["mitele.es"],rules:[{proxy_country:["ES"],cmds:[{root_urls:["mitele.es"],then:"PROXY ES.POOL_lum_es_shared",if:[]},{hosts:["vod.mitele.es"],then:"PROXY ES.POOL_lum_es_shared",if:[]},{hosts:["miteleooyala-vh.akamaihd.net","livehlsdai-i.akamaihd.net","cerbero.pro.3d99a4cb092e6d20ff56d80b9efd9a8f8802ec81.es","live.mitele.es","directos.mitele.es"],then:"PROXY ES.PEER",if:[]}]}]},cmds:[{root_urls:["mitele.es"],then:"PROXY ES.POOL_lum_es_shared",if:[]},{hosts:["vod.mitele.es"],then:"PROXY ES.POOL_lum_es_shared",if:[]},{hosts:["miteleooyala-vh.akamaihd.net","livehlsdai-i.akamaihd.net","cerbero.pro.3d99a4cb092e6d20ff56d80b9efd9a8f8802ec81.es","live.mitele.es","directos.mitele.es"],then:"PROXY ES.PEER",if:[]}]},my5_tv:{match:{root_urls:["my5.tv"],rules:[{proxy_country:["GB"],cmds:[{root_urls:["my5.tv"],then:"PROXY GB.POOL_lum_gb_shared",if:[]},{hosts:["cassie.channel5.com"],then:"PROXY GB.POOL_lum_gb_shared",if:[]}]}]},cmds:[{root_urls:["my5.tv"],then:"PROXY GB.POOL_lum_gb_shared",if:[]},{hosts:["cassie.channel5.com"],then:"PROXY GB.POOL_lum_gb_shared",if:[]}]},britbox_co_uk:{match:{root_urls:["britbox.co.uk"],rules:[{proxy_country:["GB"],cmds:[{root_urls:["my5.tv"],then:"PROXY GB.POOL_lum_gb_shared",if:[]},{hosts:["dotcomcontent.britbox.co.uk"],then:"PROXY GB.POOL_lum_gb_shared",if:[]}]}]},cmds:[{root_urls:["my5.tv"],then:"PROXY GB.POOL_lum_gb_shared",if:[]},{hosts:["dotcomcontent.britbox.co.uk"],then:"PROXY GB.POOL_lum_gb_shared",if:[]}]},naver_com:{match:{root_urls:["naver.com"],rules:[{proxy_country:["KR"],cmds:[{root_urls:["naver.com"],if:[{url:"(smartmediarep.com|pstatic.net|vrixon.com).*.(mp4|m3u8|ts)",type:"=~",then:"DIRECT"}],then:"PROXY XX"},{hosts:["apis.naver.com","api-gw.sports.naver.com"],then:"PROXY KR.PEER",if:[]}]}]},cmds:[{root_urls:["naver.com"],if:[{url:"(smartmediarep.com|pstatic.net|vrixon.com).*.(mp4|m3u8|ts)",type:"=~",then:"DIRECT"}],then:"PROXY XX"},{hosts:["apis.naver.com","api-gw.sports.naver.com"],then:"PROXY KR.PEER",if:[]}]},netflix_com:{match:{min_ver:"1.155.76",root_urls:["netflix.com"],rules:[{proxy_country:[],cmds:[{hosts:["netflixparty.com"],then:"DIRECT",if:[]},{root_urls:["netflix.com"],if:[],then:"PROXY XX.POOL"},{hosts:["anycast.ftl.netflix.com","assets.nflxext.com","oca-api.netflix.com","push.prod.netflix.com","nflxvideo.net","nflxvideo.com","nflximg.com","nflximg.net","nflxso.com","nflxso.net","nflxext.com","nflxext.net","netflix.com","netflix.net"],then:"PROXY XX.POOL",if:[]}]},{proxy_country:["NL"],cmds:[{hosts:["netflixparty.com"],then:"DIRECT"},{root_urls:["netflix.com"],if:[],then:"PROXY NL.PEER"},{hosts:["anycast.ftl.netflix.com","assets.nflxext.com","oca-api.netflix.com","push.prod.netflix.com","nflxvideo.net","nflxvideo.com","nflximg.com","nflximg.net","nflxso.com","nflxso.net","nflxext.com","nflxext.net","netflix.com","netflix.net"],then:"PROXY NL.PEER"}]},{proxy_country:["CA"],cmds:[{hosts:["netflixparty.com"],then:"DIRECT"},{root_urls:["netflix.com"],if:[],then:"PROXY CA.PEER"},{hosts:["anycast.ftl.netflix.com","assets.nflxext.com","oca-api.netflix.com","push.prod.netflix.com","nflxvideo.net","nflxvideo.com","nflximg.com","nflximg.net","nflxso.com","nflxso.net","nflxext.com","nflxext.net","netflix.com","netflix.net"],then:"PROXY CA.PEER"}]},{proxy_country:["GB"],cmds:[{hosts:["netflixparty.com"],then:"DIRECT"},{root_urls:["netflix.com"],if:[],then:"PROXY GB.PEER"},{hosts:["anycast.ftl.netflix.com","assets.nflxext.com","oca-api.netflix.com","push.prod.netflix.com","nflxvideo.net","nflxvideo.com","nflximg.com","nflximg.net","nflxso.com","nflxso.net","nflxext.com","nflxext.net","netflix.com","netflix.net"],then:"PROXY GB.PEER"}]},{proxy_country:["FR"],cmds:[{hosts:["netflixparty.com"],then:"DIRECT"},{root_urls:["netflix.com"],if:[],then:"PROXY FR.PEER"},{hosts:["anycast.ftl.netflix.com","assets.nflxext.com","oca-api.netflix.com","push.prod.netflix.com","nflxvideo.net","nflxvideo.com","nflximg.com","nflximg.net","nflxso.com","nflxso.net","nflxext.com","nflxext.net","netflix.com","netflix.net"],then:"PROXY FR.PEER"}]},{proxy_country:["IT"],cmds:[{hosts:["netflixparty.com"],then:"DIRECT"},{root_urls:["netflix.com"],if:[],then:"PROXY IT.PEER"},{hosts:["anycast.ftl.netflix.com","assets.nflxext.com","oca-api.netflix.com","push.prod.netflix.com","nflxvideo.net","nflxvideo.com","nflximg.com","nflximg.net","nflxso.com","nflxso.net","nflxext.com","nflxext.net","netflix.com","netflix.net"],then:"PROXY IT.PEER"}]},{proxy_country:["ES"],cmds:[{hosts:["netflixparty.com"],then:"DIRECT"},{root_urls:["netflix.com"],if:[],then:"PROXY ES.PEER"},{hosts:["anycast.ftl.netflix.com","assets.nflxext.com","oca-api.netflix.com","push.prod.netflix.com","nflxvideo.net","nflxvideo.com","nflximg.com","nflximg.net","nflxso.com","nflxso.net","nflxext.com","nflxext.net","netflix.com","netflix.net"],then:"PROXY ES.PEER"}]},{proxy_country:["US"],cmds:[{hosts:["netflixparty.com"],then:"DIRECT"},{root_urls:["netflix.com"],if:[],then:"PROXY US.PEER"},{hosts:["anycast.ftl.netflix.com","assets.nflxext.com","oca-api.netflix.com","push.prod.netflix.com","nflxvideo.net","nflxvideo.com","nflximg.com","nflximg.net","nflxso.com","nflxso.net","nflxext.com","nflxext.net","netflix.com","netflix.net"],then:"PROXY US.PEER"}]},{proxy_country:["KR"],cmds:[{hosts:["netflixparty.com"],then:"DIRECT"},{root_urls:["netflix.com"],if:[],then:"PROXY KR.PEER"},{hosts:["anycast.ftl.netflix.com","assets.nflxext.com","oca-api.netflix.com","push.prod.netflix.com","nflxvideo.net","nflxvideo.com","nflximg.com","nflximg.net","nflxso.com","nflxso.net","nflxext.com","nflxext.net","netflix.com","netflix.net"],then:"PROXY KR.PEER"}]},{proxy_country:["HK"],cmds:[{hosts:["netflixparty.com"],then:"DIRECT"},{root_urls:["netflix.com"],if:[],then:"PROXY HK.PEER"},{hosts:["anycast.ftl.netflix.com","assets.nflxext.com","oca-api.netflix.com","push.prod.netflix.com","nflxvideo.net","nflxvideo.com","nflximg.com","nflximg.net","nflxso.com","nflxso.net","nflxext.com","nflxext.net","netflix.com","netflix.net"],then:"PROXY HK.PEER"}]},{proxy_country:["JP"],cmds:[{hosts:["netflixparty.com"],then:"DIRECT"},{root_urls:["netflix.com"],if:[],then:"PROXY JP.PEER"},{hosts:["anycast.ftl.netflix.com","assets.nflxext.com","oca-api.netflix.com","push.prod.netflix.com","nflxvideo.net","nflxvideo.com","nflximg.com","nflximg.net","nflxso.com","nflxso.net","nflxext.com","nflxext.net","netflix.com","netflix.net"],then:"PROXY JP.PEER"}]},{proxy_country:["BR"],cmds:[{hosts:["netflixparty.com"],then:"DIRECT"},{root_urls:["netflix.com"],if:[],then:"PROXY BR.PEER"},{hosts:["anycast.ftl.netflix.com","assets.nflxext.com","oca-api.netflix.com","push.prod.netflix.com","nflxvideo.net","nflxvideo.com","nflximg.com","nflximg.net","nflxso.com","nflxso.net","nflxext.com","nflxext.net","netflix.com","netflix.net"],then:"PROXY BR.PEER"}]},{proxy_country:["IN"],cmds:[{hosts:["netflixparty.com"],then:"DIRECT"},{root_urls:["netflix.com"],if:[],then:"PROXY IN.POOL_lum_in_shared"},{hosts:["anycast.ftl.netflix.com","assets.nflxext.com","oca-api.netflix.com","push.prod.netflix.com","nflxvideo.net","nflxvideo.com","nflximg.com","nflximg.net","nflxso.com","nflxso.net","nflxext.com","nflxext.net","netflix.com","netflix.net"],then:"PROXY IN.POOL_lum_in_shared"}]},{proxy_country:["NO","GR","DE","DK","SE","CL","SG","CH","EG","RU","PL","IE","CN","IL","AR","HU","BE","FI","MX","HR","SI","SK","TR","TW","TH","JM","VN","PE","PH","ID","RO","ZA","BG","AT","NZ","CZ","IS","PT","BZ","UA","CO","AU"],cmds:[{hosts:["netflixparty.com"],then:"DIRECT"},{root_urls:["netflix.com"],if:[],then:"PROXY XX.PEER"},{hosts:["anycast.ftl.netflix.com","assets.nflxext.com","oca-api.netflix.com","push.prod.netflix.com","nflxvideo.net","nflxvideo.com","nflximg.com","nflximg.net","nflxso.com","nflxso.net","nflxext.com","nflxext.net","netflix.com","netflix.net"],then:"PROXY XX.PEER"}]}]},error_codes:[420]},ome_tv:{match:{root_urls:["ome.tv"],rules:[{proxy_country:["IT"],cmds:[{root_urls:["ome.tv"],then:"PROXY IT.POOL_lum_it_shared",if:[]},{hosts:["roulette.apps-host.com"],then:"PROXY IT.POOL_lum_it_shared",if:[]}]},{proxy_country:["CA"],cmds:[{root_urls:["ome.tv"],then:"PROXY CA.POOL_lum_ca_shared"},{hosts:["roulette.apps-host.com"],then:"PROXY CA.POOL_lum_ca_shared"}]},{proxy_country:["GB"],cmds:[{root_urls:["ome.tv"],then:"PROXY GB.POOL_lum_gb_shared"},{hosts:["roulette.apps-host.com"],then:"PROXY GB.POOL_lum_gb_shared"}]},{proxy_country:["NL"],cmds:[{root_urls:["ome.tv"],then:"PROXY NL.POOL_lum_nl_shared"},{hosts:["roulette.apps-host.com"],then:"PROXY NL.POOL_lum_nl_shared"}]},{proxy_country:["FR"],cmds:[{root_urls:["ome.tv"],then:"PROXY FR.POOL_lum_fr_shared"},{hosts:["roulette.apps-host.com"],then:"PROXY FR.POOL_lum_fr_shared"}]},{proxy_country:["ES"],cmds:[{root_urls:["ome.tv"],then:"PROXY ES.POOL_lum_es_shared"},{hosts:["roulette.apps-host.com"],then:"PROXY ES.POOL_lum_es_shared"}]},{proxy_country:["US"],cmds:[{root_urls:["ome.tv"],then:"PROXY US.POOL_lum_us_shared"},{hosts:["roulette.apps-host.com"],then:"PROXY US.POOL_lum_us_shared"}]},{proxy_country:["KR"],cmds:[{root_urls:["ome.tv"],then:"PROXY KR.POOL_lum_kr_shared"},{hosts:["roulette.apps-host.com"],then:"PROXY KR.POOL_lum_kr_shared"}]},{proxy_country:["BR"],cmds:[{root_urls:["ome.tv"],then:"PROXY BR.POOL_lum_br_shared"},{hosts:["roulette.apps-host.com"],then:"PROXY BR.POOL_lum_br_shared"}]},{proxy_country:["NO","GR","DE","DK","SE","CL","SG","CH","EG","RU","PL","IE","CN","IL","AR","HU","BE","FI","MX","HR","SI","SK","TR","TW","TH","JM","VN","PE","PH","ID","RO","ZA","BG","AT","NZ","CZ","IS","PT","BZ","UA"],cmds:[{hosts:["roulette.apps-host.com"],then:"PROXY XX.PEER"}]}]},cmds:[{root_urls:["ome.tv"],then:"PROXY IT.POOL_lum_it_shared",if:[]},{hosts:["roulette.apps-host.com"],then:"PROXY IT.POOL_lum_it_shared",if:[]}]},omegle_com:{cmds:[{hosts:["www.omegle.com"],then:"PROXY XX.PEER",if:[]},{hosts:["omegle.com"],if:[{url:".*front\\d+\\.omegle\\.com\\/icecandidate",type:"=~",then:"BLOCK"},{url:".*front\\d+\\.omegle\\.com\\/(start|status|events)",type:"!~",then:"PROXY XX"}],then:"PROXY XX.PEER"}]},raiplay_it:{match:{min_ver:"1.155.77",root_urls:["raiplay.it"],rules:[{proxy_country:["IT"],cmds:[{root_urls:["rai.it"],then:"PROXY IT.POOL_lum_it_shared",if:[]},{hosts:["mediapolisvod.rai.it","mediapolis.rai.it","mediapolisgs.rai.it","8e7439fdb1694c8da3a0fd63e4dda518.msvdn.net","raitre1-live.akamaized.net","raitre2-live.akamaized.net","raitre3-live.akamaized.net","raitre4-live.akamaized.net","raitre5-live.akamaized.net","raitre6-live.akamaized.net","raitre7-live.akamaized.net","raitre8-live.akamaized.net","raitre9-live.akamaized.net","raiuno1-live.akamaized.net","raiuno2-live.akamaized.net","raiuno3-live.akamaized.net","raiuno4-live.akamaized.net","raiuno5-live.akamaized.net","raiuno6-live.akamaized.net","raiuno7-live.akamaized.net","raiuno8-live.akamaized.net","raiuno9-live.akamaized.net","raidue1-live.akamaized.net","raidue2-live.akamaized.net","raidue3-live.akamaized.net","raidue4-live.akamaized.net","raidue5-live.akamaized.net","raidue6-live.akamaized.net","raidue7-live.akamaized.net","raidue8-live.akamaized.net","raidue9-live.akamaized.net","raipremium1-live.akamaized.net","raipremium2-live.akamaized.net","raipremium3-live.akamaized.net","raipremium4-live.akamaized.net","raipremium5-live.akamaized.net","raipremium6-live.akamaized.net","raipremium7-live.akamaized.net","raipremium8-live.akamaized.net","raipremium9-live.akamaized.net","raicinque1-live.akamaized.net","raicinque2-live.akamaized.net","raicinque3-live.akamaized.net","raicinque4-live.akamaized.net","raicinque5-live.akamaized.net","raicinque6-live.akamaized.net","raicinque7-live.akamaized.net","raicinque8-live.akamaized.net","raicinque9-live.akamaized.net","raimovie1-live.akamaized.net","raimovie2-live.akamaized.net","raimovie3-live.akamaized.net","raimovie4-live.akamaized.net","raimovie5-live.akamaized.net","raimovie6-live.akamaized.net","raimovie7-live.akamaized.net","raimovie8-live.akamaized.net","raimovie9-live.akamaized.net","raiyoyo1-live.akamaized.net","raiyoyo2-live.akamaized.net","raiyoyo3-live.akamaized.net","raiyoyo4-live.akamaized.net","raiyoyo5-live.akamaized.net","raiyoyo6-live.akamaized.net","raiyoyo7-live.akamaized.net","raiyoyo8-live.akamaized.net","raiyoyo9-live.akamaized.net","raigulp1-live.akamaized.net","raigulp2-live.akamaized.net","raigulp3-live.akamaized.net","raigulp4-live.akamaized.net","raigulp5-live.akamaized.net","raigulp6-live.akamaized.net","raigulp7-live.akamaized.net","raigulp8-live.akamaized.net","raigulp9-live.akamaized.net","rainews1-live.akamaized.net","rainews2-live.akamaized.net","rainews3-live.akamaized.net","rainews4-live.akamaized.net","rainews5-live.akamaized.net","rainews6-live.akamaized.net","rainews7-live.akamaized.net","rainews8-live.akamaized.net","rainews9-live.akamaized.net","raiscuola1-live.akamaized.net","raiscuola2-live.akamaized.net","raiscuola3-live.akamaized.net","raiscuola4-live.akamaized.net","raiscuola5-live.akamaized.net","raiscuola6-live.akamaized.net","raiscuola7-live.akamaized.net","raiscuola8-live.akamaized.net","raiscuola9-live.akamaized.net","raievent1-live.akamaized.net","raievent2-live.akamaized.net","raievent3-live.akamaized.net","raievent4-live.akamaized.net","raievent5-live.akamaized.net","raievent6-live.akamaized.net","raievent7-live.akamaized.net","raievent8-live.akamaized.net","raievent9-live.akamaized.net","raiquattro1-live.akamaized.net","raiquattro2-live.akamaized.net","raiquattro3-live.akamaized.net","raiquattro4-live.akamaized.net","raiquattro5-live.akamaized.net","raiquattro6-live.akamaized.net","raiquattro7-live.akamaized.net","raiquattro8-live.akamaized.net","raiquattro9-live.akamaized.net","raisportuno1-live.akamaized.net","raisportuno2-live.akamaized.net","raisportuno3-live.akamaized.net","raisportuno4-live.akamaized.net","raisportuno5-live.akamaized.net","raisportuno6-live.akamaized.net","raisportuno7-live.akamaized.net","raisportuno8-live.akamaized.net","raisportuno9-live.akamaized.net","raistoria1-live.akamaized.net","raistoria2-live.akamaized.net","raistoria3-live.akamaized.net","raistoria4-live.akamaized.net","raistoria5-live.akamaized.net","raistoria6-live.akamaized.net","raistoria7-live.akamaized.net","raistoria8-live.akamaized.net","raistoria9-live.akamaized.net","raisportdue1-live.akamaized.net","raisportdue2-live.akamaized.net","raisportdue3-live.akamaized.net","raisportdue4-live.akamaized.net","raisportdue5-live.akamaized.net","raisportdue6-live.akamaized.net","raisportdue7-live.akamaized.net","raisportdue8-live.akamaized.net","raisportdue9-live.akamaized.net"],then:"PROXY IT.PEER",if:[]}]}]}},rai_it:{match:{min_ver:"1.155.77",root_urls:["rai.it"],rules:[{proxy_country:["IT"],cmds:[{root_urls:["rai.it"],then:"PROXY IT.POOL_lum_it_shared",if:[]}]}]},cmds:[{root_urls:["rai.it"],then:"PROXY IT.POOL_lum_it_shared",if:[]}]},rte_ie:{match:{root_urls:["rte.ie"],rules:[{proxy_country:["IE"],cmds:[{hosts:["rte.ie"],then:"PROXY IE.PEER",if:[]},{hosts:["link.eu.theplatform.com"],then:"PROXY IE.PEER",if:[]}]}]},cmds:[{hosts:["rte.ie"],then:"PROXY IE.PEER",if:[]},{hosts:["link.eu.theplatform.com"],then:"PROXY IE.PEER",if:[]}]},virginmediatelevision_ie:{match:{root_urls:["virginmediatelevision.ie"],rules:[{proxy_country:["IE"],cmds:[{hosts:["www.virginmediatelevision.ie"],then:"PROXY IE.PEER",if:[]},{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/\\d+",type:"!~",then:"PROXY IE.POOL"}],then:"PROXY IE.PEER"}]}]},cmds:[{hosts:["www.virginmediatelevision.ie"],then:"PROXY IE.PEER",if:[]},{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/\\d+",type:"!~",then:"PROXY IE.POOL"}],then:"PROXY IE.PEER"}]},rtlplay_be:{match:{root_urls:["rtlplay.be"],rules:[{proxy_country:["BE"],cmds:[{hosts:["6play.fr","m6web.fr"],then:"PROXY BE.PEER",if:[]}]}]},cmds:[{hosts:["6play.fr","m6web.fr"],then:"PROXY BE.PEER",if:[]}]},vier_be:{match:{root_urls:["vier.be"],rules:[{proxy_country:["BE"],cmds:[{hosts:["stream1-vod.cdn1.sbs.prd.telenet-ops.be","stream2-vod.cdn1.sbs.prd.telenet-ops.be"],then:"PROXY BE.PEER",if:[]}]}]},cmds:[{hosts:["stream1-vod.cdn1.sbs.prd.telenet-ops.be","stream2-vod.cdn1.sbs.prd.telenet-ops.be"],then:"PROXY BE.PEER",if:[]}]},sixplay_fr:{match:{root_urls:["6play.fr"],rules:[{proxy_country:["FR"],cmds:[{hosts:["6play.fr","m6web.fr","6cloud.fr","lic.drmtoday.com","backend.dna-delivery.com","layout.6cloud.fr","lbcdn.6cloud.fr","mon.m6web.fr","heartbeat-v2.6cloud.fr"],then:"PROXY FR.PEER",if:[]}]}]},cmds:[{hosts:["6play.fr","m6web.fr","6cloud.fr","lic.drmtoday.com","backend.dna-delivery.com","layout.6cloud.fr","lbcdn.6cloud.fr","mon.m6web.fr","heartbeat-v2.6cloud.fr"],then:"PROXY FR.PEER",if:[]}]},orange_fr:{match:{root_urls:["orange.fr"],rules:[{proxy_country:["FR"],cmds:[{hosts:["nec-ms.apigw.orange.fr","replay.orange.fr","mediation-tv.orange.fr","login.orange.fr"],then:"PROXY FR.PEER",if:[]}]}]},cmds:[{hosts:["nec-ms.apigw.orange.fr","replay.orange.fr","mediation-tv.orange.fr","login.orange.fr"],then:"PROXY FR.PEER",if:[]}]},sonyliv_com:{match:{root_urls:["sonyliv.com"],rules:[{proxy_country:["IN"],cmds:[{hosts:["sonyliv.com","apiv2.sonyliv.com","sony247channels.akamaized.net"],then:"PROXY IN.POOL_lum_in_shared",if:[]},{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY IN.POOL_lum_in_shared"}],then:"PROXY IN.POOL_lum_in_shared"}]}]},cmds:[{hosts:["sonyliv.com","apiv2.sonyliv.com","sony247channels.akamaized.net"],then:"PROXY IN.POOL_lum_in_shared",if:[]},{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY IN.POOL_lum_in_shared"}],then:"PROXY IN.POOL_lum_in_shared"}]},sprint_com:{proxy_country:["US"],cmds:[{root_urls:["sprint.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},stan_com_au:{cmds:[{hosts:["api.stan.com.au"],then:"PROXY AU.PEER",if:[]}]},tenplay_com_au:{match:{root_urls:["tenplay.com.au","10play.com.au"],rules:[{proxy_country:["AU"],cmds:[{root_urls:["tenplay.com.au","10play.com.au"],then:"PROXY AU.POOL",if:[]},{hosts:["10play.com.au","manifest.prod.boltdns.net","bcboltnet10tp.akamaized.net","10play-vod.global.ssl.fastly.net","10-selector.global.ssl.fastly.net","10-cms-feed.global.ssl.fastly.net"],then:"PROXY AU.POOL",if:[]},{hosts:["global.ssl.fastly.net"],then:"PROXY AU.PEER",if:[]},{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY AU.POOL"}],then:"PROXY AU.PEER"}]}]},cmds:[{root_urls:["tenplay.com.au","10play.com.au"],then:"PROXY AU.POOL",if:[]},{hosts:["10play.com.au","manifest.prod.boltdns.net","bcboltnet10tp.akamaized.net","10play-vod.global.ssl.fastly.net","10-selector.global.ssl.fastly.net","10-cms-feed.global.ssl.fastly.net"],then:"PROXY AU.POOL",if:[]},{hosts:["global.ssl.fastly.net"],then:"PROXY AU.PEER",if:[]},{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY AU.POOL"}],then:"PROXY AU.PEER"}]},ninenow_com_au:{match:{root_urls:["9now.com.au"],rules:[{proxy_country:["AU"],cmds:[{hosts:["www.9now.com.au"],then:"PROXY AU.PEER",if:[]}]}]},cmds:[{hosts:["www.9now.com.au"],then:"PROXY AU.PEER",if:[]}]},unidragon_eu:{match:{root_urls:["unidragon.eu","unidragon.com"],rules:[{proxy_country:["DE","US"],cmds:[{hosts:["cozycountryredirect.addons.business"],then:"PROXY XX.PEER",if:[]}]}]},cmds:[{hosts:["cozycountryredirect.addons.business"],then:"PROXY XX.PEER",if:[]}]},bfmtv_com:{match:{root_urls:["bfmtv.com"],rules:[{proxy_country:["FR"],cmds:[{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY FR"}],then:"PROXY FR.PEER"}]}]},cmds:[{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY FR"}],then:"PROXY FR.PEER"}]},tvbanywherena_com:{match:{root_urls:["tvbanywherena.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY US"}],then:"PROXY US.PEER"}]}]},cmds:[{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY US"}],then:"PROXY US.PEER"}]},tvnz_co_nz:{match:{root_urls:["tvnz.co.nz"],rules:[{proxy_country:["NZ"],cmds:[{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY NZ"}],then:"PROXY NZ.PEER"},{hosts:["bcbolttvnz3-a.akamaihd.net","tvnz-prod-01.brightcovecdn.com","apis-edge-prod.tech.tvnz.co.nz","playback.brightcovecdn.com"],then:"PROXY NZ.PEER",if:[]}]}]},cmds:[{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY NZ"}],then:"PROXY NZ.PEER"},{hosts:["bcbolttvnz3-a.akamaihd.net","tvnz-prod-01.brightcovecdn.com","apis-edge-prod.tech.tvnz.co.nz","playback.brightcovecdn.com"],then:"PROXY NZ.PEER",if:[]}]},toggle_sg:{match:{root_urls:["toggle.sg"],rules:[{proxy_country:["SG"],cmds:[{hosts:["player-as.ott.kaltura.com"],if:[{url:".*player-as\\.ott\\.kaltura\\.com\\/.*\\/mwEmbed\\/mwEmbedFrame\\.php.*",type:"!~",then:"PROXY SG"}],then:"PROXY SG.PEER"}]}]},cmds:[{hosts:["player-as.ott.kaltura.com"],if:[{url:".*player-as\\.ott\\.kaltura\\.com\\/.*\\/mwEmbed\\/mwEmbedFrame\\.php.*",type:"!~",then:"PROXY SG"}],then:"PROXY SG.PEER"}]},tv4play_se:{match:{root_urls:["tv4play.se"],rules:[{proxy_country:["SE"],cmds:[{hosts:["playback-api.b17g.net","playback2.a2d.tv","tv4-segments.a2d.tv"],then:"PROXY SE.PEER",if:[]}]}]},cmds:[{hosts:["playback-api.b17g.net","playback2.a2d.tv","tv4-segments.a2d.tv"],then:"PROXY SE.PEER",if:[]}]},viaplay_se:{match:{root_urls:["viaplay.se"],rules:[{proxy_country:["SE"],cmds:[{hosts:["play.viaplay.se"],then:"PROXY SE.PEER",if:[]}]}]},cmds:[{hosts:["play.viaplay.se"],then:"PROXY SE.PEER",if:[]}]},cmore_se:{match:{root_urls:["cmore.se"],rules:[{proxy_country:["SE"],cmds:[{hosts:["streaminggateway-cmore.clientapi-prod.live.tv.telia.net"],then:"PROXY SE.PEER",if:[]}]}]},cmds:[{hosts:["streaminggateway-cmore.clientapi-prod.live.tv.telia.net"],then:"PROXY SE.PEER",if:[]}]},telecinco_es:{match:{root_urls:["telecinco.es"],rules:[{proxy_country:["ES"],cmds:[{root_urls:["telecinco.es"],then:"PROXY ES.POOL_lum_es_shared",if:[]},{hosts:["mediaset.hb.omtrdc.net"],then:"PROXY ES.POOL_lum_es_shared",if:[]},{hosts:["gatekeeper.mediaset.es","livehlsdai-i.akamaihd.net","cerbero.pro.3d99a4cb092e6d20ff56d80b9efd9a8f8802ec81.es","telecinco1-vh.akamaihd.net","live.telecinco.es"],then:"PROXY ES.PEER",if:[]}]}]},cmds:[{root_urls:["telecinco.es"],then:"PROXY ES.POOL_lum_es_shared",if:[]},{hosts:["mediaset.hb.omtrdc.net"],then:"PROXY ES.POOL_lum_es_shared",if:[]},{hosts:["gatekeeper.mediaset.es","livehlsdai-i.akamaihd.net","cerbero.pro.3d99a4cb092e6d20ff56d80b9efd9a8f8802ec81.es","telecinco1-vh.akamaihd.net","live.telecinco.es"],then:"PROXY ES.PEER",if:[]}]},energytv_es:{match:{root_urls:["energytv.es"],rules:[{proxy_country:["ES"],cmds:[{root_urls:["energytv.es"],then:"PROXY ES.POOL_lum_es_shared",if:[]},{hosts:["mdslivehlsb-i.akamaihd.net","cerbero.pro.3d99a4cb092e6d20ff56d80b9efd9a8f8802ec81.es"],then:"PROXY ES.PEER",if:[]}]}]},cmds:[{root_urls:["energytv.es"],then:"PROXY ES.POOL_lum_es_shared",if:[]},{hosts:["mdslivehlsb-i.akamaihd.net","cerbero.pro.3d99a4cb092e6d20ff56d80b9efd9a8f8802ec81.es"],then:"PROXY ES.PEER",if:[]}]},mediaset_it:{match:{root_urls:["mediaset.it"],rules:[{proxy_country:["IT"],cmds:[{root_urls:["mediaset.it"],then:"PROXY IT.POOL_lum_it_shared",if:[]},{hosts:["api-ott-prod-fe.mediaset.net","theplatform.eu","link.theplatform.eu","feed.entertainment.tv.theplatform.eu","api.mediaset.net","secure-it.imrworldwide.com","vod06.msf.cdn.mediaset.net"],then:"PROXY IT.PEER",if:[]}]}]},cmds:[{root_urls:["mediaset.it"],then:"PROXY IT.POOL_lum_it_shared",if:[]},{hosts:["api-ott-prod-fe.mediaset.net","theplatform.eu","link.theplatform.eu","feed.entertainment.tv.theplatform.eu","api.mediaset.net","secure-it.imrworldwide.com","vod06.msf.cdn.mediaset.net"],then:"PROXY IT.PEER",if:[]}]},tibia_com:{match:{root_urls:["tibia.com"],rules:[{proxy_country:["IT"],cmds:[{root_urls:["tibia.com"],then:"PROXY IT.POOL_lum_it_shared",if:[]}]}]},cmds:[{root_urls:["tibia.com"],then:"PROXY IT.POOL_lum_it_shared",if:[]}]},tenk_fr:{match:{root_urls:["tenk.fr"],rules:[{proxy_country:["FR"],cmds:[{root_urls:["tenk.fr"],then:"PROXY FR.POOL_lum_fr_shared",if:[]}]}]},cmds:[{root_urls:["tenk.fr"],then:"PROXY FR.POOL_lum_fr_shared",if:[]}]},tva_ca:{match:{root_urls:["tva.ca"],rules:[{proxy_country:["CA"],cmds:[{root_urls:["tva.ca","chainetvauls-lh.akamaihd.net"],then:"PROXY CA.POOL_lum_ca_shared",if:[]},{hosts:["videos.tva.ca","video.tva.ca"],then:"PROXY CA.PEER",if:[]},{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY CA.POOL_lum_ca_shared"}],then:"PROXY CA.PEER"}]}]},cmds:[{root_urls:["tva.ca","chainetvauls-lh.akamaihd.net"],then:"PROXY CA.POOL_lum_ca_shared",if:[]},{hosts:["videos.tva.ca","video.tva.ca"],then:"PROXY CA.PEER",if:[]},{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY CA.POOL_lum_ca_shared"}],then:"PROXY CA.PEER"}]},aptnlumi_ca:{match:{root_urls:["aptnlumi.ca"],rules:[{proxy_country:["CA"],cmds:[{root_urls:["aptnlumi.ca"],then:"PROXY CA.POOL_lum_ca_shared",if:[]},{hosts:["cdnapisec.kaltura.com","cdnsecakmi.kaltura.com","cfvod.kaltura.com","analytics.kaltura.com"],then:"PROXY CA.POOL_lum_ca_shared",if:[]}]}]},cmds:[{root_urls:["aptnlumi.ca"],then:"PROXY CA.POOL_lum_ca_shared",if:[]},{hosts:["cdnapisec.kaltura.com","cdnsecakmi.kaltura.com","cfvod.kaltura.com","analytics.kaltura.com"],then:"PROXY CA.POOL_lum_ca_shared",if:[]}]},noovo_ca:{match:{root_urls:["noovo.ca"],rules:[{proxy_country:["CA"],cmds:[{root_urls:["noovo.ca"],then:"PROXY CA.POOL_lum_ca_shared",if:[]},{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY CA.POOL_lum_ca_shared"}],then:"PROXY CA.PEER"}]}]},cmds:[{root_urls:["noovo.ca"],then:"PROXY CA.POOL_lum_ca_shared",if:[]},{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY CA.POOL_lum_ca_shared"}],then:"PROXY CA.PEER"}]},skysports_com:{match:{root_urls:["skysports.com"],rules:[{proxy_country:["GB"],cmds:[{root_urls:["skysports.com"],then:"PROXY GB.POOL_lum_gb_shared",if:[]},{hosts:["edge-auth.api.brightcove.com"],then:"PROXY GB.PEER",if:[]}]}]},cmds:[{root_urls:["skysports.com"],then:"PROXY GB.POOL_lum_gb_shared",if:[]},{hosts:["edge-auth.api.brightcove.com"],then:"PROXY GB.PEER",if:[]}]},tvnow_de:{match:{root_urls:["tvnow.de"],rules:[{proxy_country:["DE"],cmds:[{hosts:["widevine.tvnow.de"],if:[{url:".*widevine\\.tvnow\\.de\\/index\\/proxy",type:"!~",then:"PROXY DE"}],then:"PROXY DE.PEER"},{hosts:["bff.apigw.tvnow.de","entitlement.player.tvnow.de"],then:"PROXY DE.PEER",if:[]}]}]},cmds:[{hosts:["widevine.tvnow.de"],if:[{url:".*widevine\\.tvnow\\.de\\/index\\/proxy",type:"!~",then:"PROXY DE"}],then:"PROXY DE.PEER"},{hosts:["bff.apigw.tvnow.de","entitlement.player.tvnow.de"],then:"PROXY DE.PEER",if:[]}]},youtube_com:{match:{root_urls:["youtube.com"],rules:[{proxy_country:["AU"],cmds:[{root_urls:["youtube.com"],then:"PROXY AU.POOL_lum_au_shared",if:[]},{hosts:["s.ytimg.com","googlevideo.com"],then:"PROXY AU",if:[]}]},{proxy_country:["CO"],cmds:[{root_urls:["youtube.com"],then:"PROXY CO.POOL_lum_co_shared"},{hosts:["s.ytimg.com","googlevideo.com"],then:"PROXY CO"}]},{proxy_country:["IT"],cmds:[{root_urls:["youtube.com"],then:"PROXY IT.POOL_lum_it_shared"},{hosts:["s.ytimg.com","googlevideo.com"],then:"PROXY IT"}]},{proxy_country:["CA"],cmds:[{root_urls:["youtube.com"],then:"PROXY CA.POOL_lum_ca_shared"},{hosts:["s.ytimg.com","googlevideo.com"],then:"PROXY CA"}]},{proxy_country:["GB"],cmds:[{root_urls:["youtube.com"],then:"PROXY GB.POOL_lum_gb_shared"},{hosts:["s.ytimg.com","googlevideo.com"],then:"PROXY GB"}]},{proxy_country:["NL"],cmds:[{root_urls:["youtube.com"],then:"PROXY NL.POOL_lum_nl_shared"},{hosts:["s.ytimg.com","googlevideo.com"],then:"PROXY NL"}]},{proxy_country:["FR"],cmds:[{root_urls:["youtube.com"],then:"PROXY FR.POOL_lum_fr_shared"},{hosts:["s.ytimg.com","googlevideo.com"],then:"PROXY FR"}]},{proxy_country:["ES"],cmds:[{root_urls:["youtube.com"],then:"PROXY ES.POOL_lum_es_shared"},{hosts:["s.ytimg.com","googlevideo.com"],then:"PROXY ES"}]},{proxy_country:["US"],cmds:[{root_urls:["youtube.com"],then:"PROXY US.POOL_lum_us_shared"},{hosts:["s.ytimg.com","googlevideo.com"],then:"PROXY US"}]},{proxy_country:["KR"],cmds:[{root_urls:["youtube.com"],then:"PROXY KR.POOL_lum_kr_shared"},{hosts:["s.ytimg.com","googlevideo.com"],then:"PROXY KR"}]},{proxy_country:["BR"],cmds:[{root_urls:["youtube.com"],then:"PROXY BR.POOL_lum_br_shared"},{hosts:["s.ytimg.com","googlevideo.com"],then:"PROXY BR"}]}]},cmds:[{root_urls:["youtube.com"],then:"PROXY XX",if:[]},{hosts:["www.youtube.com"],then:"PROXY XX",if:[]}]},cloudvideo_co:{proxy_country:["CO"],cmds:[{hosts:["rcnhd.cloudvideo.com.co"],if:[{url:"(/html5/.*/mwEmbedFrame.php/|playManifest|\\.m3u8)",type:"!~",then:"PROXY CO"}],then:"PROXY CO.PEER"}]},coomevaeps_com:{proxy_country:["CO"],cmds:[{hosts:["oficinavirtualeps.coomevaeps.com"],then:"PROXY CO.PEER",if:[]}]},tvp_pl:{proxy_country:["PL"],cmds:[{hosts:["vod.tvp.pl"],if:[{url:"\\/sess\\/tvplayer\\.php",type:"!~",then:"PROXY PL"}],then:"PROXY PL.PEER"}]},vod_pl:{match:{root_urls:["vod.pl"],rules:[{proxy_country:["PL"],cmds:[{hosts:["useinsider.com","player-api.dreamlab.pl"],then:"PROXY PL.PEER",if:[]}]}]},cmds:[{hosts:["useinsider.com","player-api.dreamlab.pl"],then:"PROXY PL.PEER",if:[]}]},tvp_info:{match:{root_urls:["tvp.info"],rules:[{proxy_country:["PL"],cmds:[{hosts:["www.tvp.info"],then:"PROXY PL.PEER",if:[]}]}]},cmds:[{hosts:["www.tvp.info"],then:"PROXY PL.PEER",if:[]}]},ipla_tv:{match:{root_urls:["ipla.tv"],rules:[{proxy_country:["PL"],cmds:[{hosts:["b2c-www.redefine.pl"],then:"PROXY PL.PEER",if:[]}]}]},cmds:[{hosts:["b2c-www.redefine.pl"],then:"PROXY PL.PEER",if:[]}]},starplus_com:{match:{root_urls:["starplus.com"],rules:[{proxy_country:["AR"],cmds:[{hosts:["global.edge.bamgrid.com","sdk.iad-03.braze.com","disney.api.edge.bamgrid.com","dialacrum.iad-03.braze.com","disney.demdex.net","disney.connections.edge.bamgrid.com","disney.content.edge.bamgrid.com","disney.playback.edge.bamgrid.com","star.api.edge.bamgrid.com"],then:"PROXY AR.PEER",if:[]},{root_urls:["disneyplus.com"],then:"PROXY AR.PEER",if:[]},{hosts:["disneyplus.com","www.disneyplus.com","svcs.dssott.com","egisterdisney.go.com","disney-plus.net"],then:"PROXY AR.PEER",if:[]}]}]},cmds:[{hosts:["global.edge.bamgrid.com","sdk.iad-03.braze.com","disney.api.edge.bamgrid.com","dialacrum.iad-03.braze.com","disney.demdex.net","disney.connections.edge.bamgrid.com","disney.content.edge.bamgrid.com","disney.playback.edge.bamgrid.com","star.api.edge.bamgrid.com"],then:"PROXY AR.PEER",if:[]},{root_urls:["disneyplus.com"],then:"PROXY AR.PEER",if:[]},{hosts:["disneyplus.com","www.disneyplus.com","svcs.dssott.com","egisterdisney.go.com","disney-plus.net"],then:"PROXY AR.PEER",if:[]}]},rtvs_sk:{match:{root_urls:["rtvs.sk"],rules:[{proxy_country:["SK"],cmds:[{hosts:["n0.stv.livebox.sk","n1.stv.livebox.sk","n2.stv.livebox.sk","n3.stv.livebox.sk","n4.stv.livebox.sk","n5.stv.livebox.sk","n6.stv.livebox.sk","n7.stv.livebox.sk","n8.stv.livebox.sk","n9.stv.livebox.sk","n10.stv.livebox.sk","n11.stv.livebox.sk","n12.stv.livebox.sk","n13.stv.livebox.sk","n14.stv.livebox.sk","n15.stv.livebox.sk","n16.stv.livebox.sk","n17.stv.livebox.sk","n18.stv.livebox.sk","n19.stv.livebox.sk","n20.stv.livebox.sk","n21.stv.livebox.sk","n22.stv.livebox.sk","n23.stv.livebox.sk","n24.stv.livebox.sk","n25.stv.livebox.sk","n26.stv.livebox.sk","n27.stv.livebox.sk","n28.stv.livebox.sk","n29.stv.livebox.sk","n30.stv.livebox.sk"],then:"PROXY SK.PEER",if:[]}]}]},cmds:[{hosts:["n0.stv.livebox.sk","n1.stv.livebox.sk","n2.stv.livebox.sk","n3.stv.livebox.sk","n4.stv.livebox.sk","n5.stv.livebox.sk","n6.stv.livebox.sk","n7.stv.livebox.sk","n8.stv.livebox.sk","n9.stv.livebox.sk","n10.stv.livebox.sk","n11.stv.livebox.sk","n12.stv.livebox.sk","n13.stv.livebox.sk","n14.stv.livebox.sk","n15.stv.livebox.sk","n16.stv.livebox.sk","n17.stv.livebox.sk","n18.stv.livebox.sk","n19.stv.livebox.sk","n20.stv.livebox.sk","n21.stv.livebox.sk","n22.stv.livebox.sk","n23.stv.livebox.sk","n24.stv.livebox.sk","n25.stv.livebox.sk","n26.stv.livebox.sk","n27.stv.livebox.sk","n28.stv.livebox.sk","n29.stv.livebox.sk","n30.stv.livebox.sk"],then:"PROXY SK.PEER",if:[]}]},latina_pe:{match:{root_urls:["latina.pe"],rules:[{proxy_country:["PE"],cmds:[{hosts:["mdstrm.com"],then:"PROXY PE.PEER",if:[]}]}]},cmds:[{hosts:["mdstrm.com"],then:"PROXY PE.PEER",if:[]}]},rtve_es:{match:{root_urls:["rtve.es"],rules:[{proxy_country:["ES"],cmds:[{hosts:["rtvelivestreamv1.akamaized.net","rtvelivestreamv2.akamaized.net","rtvelivestreamv3.akamaized.net","rtvelivestreamv4.akamaized.net","rtvelivestreamv5.akamaized.net","rtvelivestreamv6.akamaized.net","rtvelivestreamv7.akamaized.net","rtvelivestreamv8.akamaized.net","rtvelivestreamv9.akamaized.net","rtvelivestreamv10.akamaized.net"],then:"PROXY ES.PEER",if:[]}]}]},cmds:[{hosts:["rtvelivestreamv1.akamaized.net","rtvelivestreamv2.akamaized.net","rtvelivestreamv3.akamaized.net","rtvelivestreamv4.akamaized.net","rtvelivestreamv5.akamaized.net","rtvelivestreamv6.akamaized.net","rtvelivestreamv7.akamaized.net","rtvelivestreamv8.akamaized.net","rtvelivestreamv9.akamaized.net","rtvelivestreamv10.akamaized.net"],then:"PROXY ES.PEER",if:[]}]},iceland_co_uk:{proxy_country:["GB"],cmds:[{root_urls:["iceland.co.uk"],then:"PROXY GB.PEER",if:[]}]},play_rtl_hr:{match:{root_urls:["play.rtl.hr"],rules:[{proxy_country:["HR"],cmds:[{hosts:["geo.6play.fr"],then:"PROXY HR.PEER",if:[]}]}]},cmds:[{hosts:["geo.6play.fr"],then:"PROXY HR.PEER",if:[]}]},ticketmaster_com:{proxy_country:["US"],cmds:[{root_urls:["ticketmaster.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},zattoo_com:{match:{root_urls:["zattoo.com"],rules:[{proxy_country:["DE"],cmds:[{root_urls:["zahs.tv"],then:"PROXY DE.PEER",if:[]}]}]},cmds:[{root_urls:["zahs.tv"],then:"PROXY DE.PEER",if:[]}]},tv4_se:{match:{root_urls:["tv4.se"],rules:[{proxy_country:["SE"],cmds:[{hosts:["tv4.se","www.tv4.se","tv4se-graphql.a2d.tv"],then:"PROXY SE.PEER",if:[]}]}]},cmds:[{hosts:["tv4.se","www.tv4.se","tv4se-graphql.a2d.tv"],then:"PROXY SE.PEER",if:[]}]},picknsave_com:{match:{root_urls:["picknsave.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["picknsave.com"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{hosts:["picknsave.com"],then:"PROXY US.PEER",if:[]}]},homegoods_com:{match:{root_urls:["homegoods.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["homegoods.com"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{hosts:["homegoods.com"],then:"PROXY US.PEER",if:[]}]},tacobell_com:{match:{root_urls:["tacobell.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["tacobell.com"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{hosts:["tacobell.com"],then:"PROXY US.PEER",if:[]}]},fkr_spb_ru:{match:{root_urls:["fkr-spb.ru"],rules:[{proxy_country:["RU"],cmds:[{hosts:["fkr-spb.ru"],then:"PROXY RU.PEER",if:[]}]}]},cmds:[{hosts:["fkr-spb.ru"],then:"PROXY RU.PEER",if:[]}]},avail_co:{match:{root_urls:["avail.co","avail.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["avail.co","avail.com","www.avail.co","www.avail.com"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{hosts:["avail.co","avail.com","www.avail.co","www.avail.com"],then:"PROXY US.PEER",if:[]}]},fubo_tv:{match:{root_urls:["fubo.tv"],rules:[{cmds:[{hosts:["api.fubo.tv","gcs-streams-prod.fubo.tv"],then:"PROXY XX.PEER",if:[]}]}]},cmds:[{hosts:["api.fubo.tv","gcs-streams-prod.fubo.tv"],then:"PROXY XX.PEER",if:[]}]},abc:{proxy_country:["US"],cmds:[{hosts:["edgedatg.com","edgedatg.go.com"],if:[{host:"[^.]\\.?edgedatg(\\.go)?\\.com",type:"!~",then:"PROXY XX"}],then:"PROXY US.PEER"}]},stb_ua:{country:{list:["UA"],type:"in"},cmds:[{hosts:["vcms-api2.starlight.digital","vcms-api.starlight.digital"],then:"PROXY UA.PEER",if:[]}]},mediaklikk:{cmds:[{hosts:["connectmedia.hu"],if:[{url:".*cdn\\.connectmedia\\.hu\\/.*\\.m3u8",type:"=~",then:"PROXY XX"}],then:"PROXY XX"}]},zdf_de:{cmds:[{hosts:["zdfvodde-vh.akamaihd.net"],if:[{url:".*zdfvodde-vh\\.akamaihd\\.net\\/i\\/zdf\\/.*\\.m3u8",type:"=~",then:"PROXY XX"}],then:"PROXY XX"}]}},unblocker_globals:{ads:{cmds:[{hosts:["google-analytics.com","analytics.twitter.com","googleadservices.com","p.adsymptotic.com","googletagmanager.com","bat.bing.com","adservice.google.com","doubleclick.net","gstatic.com","googlesyndication.com","2mdn.net","q.quora.com","analytics.edgekey.net","amazon-adsystem.com","users.quantumgraph.com","images-na.ssl-images-amazon.com","bh.contextweb.com","pixel-sync.sitescout.com","ads-twitter.com","googletagservices.com","scorecardresearch.com","outbrain.com","cdnjs.cloudflare.com","adservice.google.com.pk","adservice.google.com.ph","adroll.com","analytics.yahoo.com","spl.zeotap.com","a-ads.com"],then:"PROXY XX",if:[]}]},torrents:{cmds:[{hosts:["104.28.1.30","104.28.16.69","107.150.14.110","109.121.134.121","114.55.113.60","125.227.35.196","128.199.70.66","157.7.202.64","158.69.146.212","173.254.204.71","178.175.143.27","178.33.73.26","182.176.139.129","185.5.97.139","188.165.253.109","194.106.216.222","195.123.209.37","210.244.71.25","210.244.71.26","213.159.215.198","213.163.67.56","37.19.5.139","37.19.5.155","46.4.109.148","5.79.249.77","5.79.83.193","51.254.244.161","59.36.96.77","74.82.52.209","80.246.243.18","81.200.2.231","85.17.19.180","87.248.186.252","87.253.152.137","91.216.110.47","91.217.91.21","91.218.230.81","93.92.64.5","104.28.17.69","atrack.pow7.com","bt.henbt.com","bt.pusacg.org","bt2.careland.com.cn","coppersurfer.tk","explodie.org","fasttracker.foreverpirates.co","ipv4.tracker.harry.lu","mgtracker.org","open.acgtracker.com","open.lolicon.eu","open.stealth.si","open.touki.ru","opentor.org","opentracker.i2p.rocks","p4p.arenabg.ch","p4p.arenabg.com","pow7.com","retracker.gorcomnet.ru","retracker.krs-ix.ru","secure.pow7.com","t1.pow7.com","t2.pow7.com","thetracker.org","torrent.gresille.org","torrentsmd.com","tracker.aletorrenty.pl","tracker.baravik.org","tracker.birkenwald.de","tracker.bittor.pw","tracker.bittorrent.am","tracker.calculate.ru","tracker.cyberia.is","tracker.dler.org","tracker.dutchtracking.com","tracker.dutchtracking.nl","tracker.edoardocolombo.eu","tracker.ex.ua","tracker.filetracker.pl","tracker.flashtorrents.org","tracker.grepler.com","tracker.internetwarriors.net","tracker.kicks-ass.net","tracker.kuroy.me","tracker.leechers-paradise.org","tracker.mg64.net","tracker.moeking.me","tracker.opentrackr.org","tracker.skyts.net","tracker.tfile.me","tracker.tiny-vps.com","tracker.torrent.eu.org","tracker.tvunderground.org.ru","tracker.uw0.xyz","tracker.yoshi210.com","tracker.zer0day.to","tracker1.wasabii.com.tw","tracker2.itzmx.com","tracker2.wasabii.com.tw","www.wareztorrent.com"],then:"DIRECT",if:[]}]},proxy_from_agent:{cmds:[{hosts:["api.waxsweden.org","userstorage.mega.co.nz"],then:"PROXY XX",if:[]}]},facebook:{proxy_country:["AR","AT","AU","BE","BG","BR","CA","CH","CL","CO","CZ","DE","DK","ES","FI","FR","GB","GR","HK","HR","HU","ID","IE","IL","IN","IT","IS","JP","KR","MX","NL","NO","NZ","PL","RO","RU","SE","SG","SK","TR","US"],cmds:[{hosts:["facebook.com","facebook.net"],then:"PROXY XX",if:[]}]},google:{match:{root_urls:["google.com"],rules:[{proxy_country:["IT"],cmds:[{root_urls:["google.com"],then:"PROXY IT.POOL_lum_it_shared",if:[]},{hosts:["google.com","google.co.in","googleapis.com","ampproject.org","www.google.com","mtalk.google.com","clients4.google.com","play.google.com","maps.googleapis.com","accounts.google.com","safebrowsing.googleapis.com","history.google.com","optimizationguide-pa.googleapis.com","clients2.google.com","safebrowsing.google.com","fonts.googleapis.com","apis.google.com","content-autofill.googleapis.com"],then:"PROXY IT.POOL_lum_it_shared",if:[]}]},{proxy_country:["CA"],cmds:[{root_urls:["google.com"],then:"PROXY CA.POOL_lum_ca_shared"},{hosts:["google.com","google.co.in","googleapis.com","ampproject.org","www.google.com","mtalk.google.com","clients4.google.com","play.google.com","maps.googleapis.com","accounts.google.com","safebrowsing.googleapis.com","history.google.com","optimizationguide-pa.googleapis.com","clients2.google.com","safebrowsing.google.com","fonts.googleapis.com","apis.google.com","content-autofill.googleapis.com"],then:"PROXY CA.POOL_lum_ca_shared"}]},{proxy_country:["GB"],cmds:[{root_urls:["google.com"],then:"PROXY GB.POOL_lum_gb_shared"},{hosts:["google.com","google.co.in","googleapis.com","ampproject.org","www.google.com","mtalk.google.com","clients4.google.com","play.google.com","maps.googleapis.com","accounts.google.com","safebrowsing.googleapis.com","history.google.com","optimizationguide-pa.googleapis.com","clients2.google.com","safebrowsing.google.com","fonts.googleapis.com","apis.google.com","content-autofill.googleapis.com"],then:"PROXY GB.POOL_lum_gb_shared"}]},{proxy_country:["NL"],cmds:[{root_urls:["google.com"],then:"PROXY NL.POOL_lum_nl_shared"},{hosts:["google.com","google.co.in","googleapis.com","ampproject.org","www.google.com","mtalk.google.com","clients4.google.com","play.google.com","maps.googleapis.com","accounts.google.com","safebrowsing.googleapis.com","history.google.com","optimizationguide-pa.googleapis.com","clients2.google.com","safebrowsing.google.com","fonts.googleapis.com","apis.google.com","content-autofill.googleapis.com"],then:"PROXY NL.POOL_lum_nl_shared"}]},{proxy_country:["FR"],cmds:[{root_urls:["google.com"],then:"PROXY FR.POOL_lum_fr_shared"},{hosts:["google.com","google.co.in","googleapis.com","ampproject.org","www.google.com","mtalk.google.com","clients4.google.com","play.google.com","maps.googleapis.com","accounts.google.com","safebrowsing.googleapis.com","history.google.com","optimizationguide-pa.googleapis.com","clients2.google.com","safebrowsing.google.com","fonts.googleapis.com","apis.google.com","content-autofill.googleapis.com"],then:"PROXY FR.POOL_lum_fr_shared"}]},{proxy_country:["ES"],cmds:[{root_urls:["google.com"],then:"PROXY ES.POOL_lum_es_shared"},{hosts:["google.com","google.co.in","googleapis.com","ampproject.org","www.google.com","mtalk.google.com","clients4.google.com","play.google.com","maps.googleapis.com","accounts.google.com","safebrowsing.googleapis.com","history.google.com","optimizationguide-pa.googleapis.com","clients2.google.com","safebrowsing.google.com","fonts.googleapis.com","apis.google.com","content-autofill.googleapis.com"],then:"PROXY ES.POOL_lum_es_shared"}]},{proxy_country:["US"],cmds:[{root_urls:["google.com"],then:"PROXY US.POOL_lum_us_shared"},{hosts:["google.com","google.co.in","googleapis.com","ampproject.org","www.google.com","mtalk.google.com","clients4.google.com","play.google.com","maps.googleapis.com","accounts.google.com","safebrowsing.googleapis.com","history.google.com","optimizationguide-pa.googleapis.com","clients2.google.com","safebrowsing.google.com","fonts.googleapis.com","apis.google.com","content-autofill.googleapis.com"],then:"PROXY US.POOL_lum_us_shared"}]},{proxy_country:["KR"],cmds:[{root_urls:["google.com"],then:"PROXY KR.POOL_lum_kr_shared"},{hosts:["google.com","google.co.in","googleapis.com","ampproject.org","www.google.com","mtalk.google.com","clients4.google.com","play.google.com","maps.googleapis.com","accounts.google.com","safebrowsing.googleapis.com","history.google.com","optimizationguide-pa.googleapis.com","clients2.google.com","safebrowsing.google.com","fonts.googleapis.com","apis.google.com","content-autofill.googleapis.com"],then:"PROXY KR.POOL_lum_kr_shared"}]},{proxy_country:["BR"],cmds:[{root_urls:["google.com"],then:"PROXY BR.POOL_lum_br_shared"},{hosts:["google.com","google.co.in","googleapis.com","ampproject.org","www.google.com","mtalk.google.com","clients4.google.com","play.google.com","maps.googleapis.com","accounts.google.com","safebrowsing.googleapis.com","history.google.com","optimizationguide-pa.googleapis.com","clients2.google.com","safebrowsing.google.com","fonts.googleapis.com","apis.google.com","content-autofill.googleapis.com"],then:"PROXY BR.POOL_lum_br_shared"}]},{proxy_country:["NO","GR","DE","DK","SE","CL","SG","CH","EG","RU","PL","IE","CN","IL","AR","HU","BE","FI","MX","HR","SI","SK","TR","TW","TH","JM","VN","PE","PH","ID","RO","ZA","BG","AT","NZ","CZ","IS","PT","BZ","UA"],cmds:[{hosts:["google.com","google.co.in","googleapis.com","ampproject.org","www.google.com","mtalk.google.com","clients4.google.com","play.google.com","maps.googleapis.com","accounts.google.com","safebrowsing.googleapis.com","history.google.com","optimizationguide-pa.googleapis.com","clients2.google.com","safebrowsing.google.com","fonts.googleapis.com","apis.google.com","content-autofill.googleapis.com"],then:"PROXY XX"}]}]}},daycoval_com_br:{match:{root_urls:["daycoval.com.br"],rules:[{proxy_country:["BR"],cmds:[{hosts:["www.daycoval.com.br"],then:"PROXY BR.PEER",if:[]}]}]},cmds:[{hosts:["www.daycoval.com.br"],then:"PROXY BR.PEER",if:[]}]},salto_fr:{match:{root_urls:["salto.fr"],rules:[{proxy_country:["FR"],cmds:[{hosts:["geo.salto.fr","android.middleware.salto.fr","layout.salto.fr","front-auth.salto.fr","youboranqs01.com","youboranqs02.com","youboranqs03.com"],then:"PROXY FR.PEER",if:[]}]}]},cmds:[{hosts:["geo.salto.fr","android.middleware.salto.fr","layout.salto.fr","front-auth.salto.fr","youboranqs01.com","youboranqs02.com","youboranqs03.com"],then:"PROXY FR.PEER",if:[]}]},hibbett_com:{match:{root_urls:["hibbett.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["hibbett.com"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{hosts:["hibbett.com"],then:"PROXY US.PEER",if:[]}]},nowonline_com_br:{match:{root_urls:["nowonline.com.br"],rules:[{proxy_country:["BR"],cmds:[{hosts:["www.nowonline.com.br"],then:"PROXY BR.PEER",if:[]}]}]},cmds:[{hosts:["www.nowonline.com.br"],then:"PROXY BR.PEER",if:[]}]},nrk_no:{match:{root_urls:["nrk.no"],rules:[{proxy_country:["NO"],cmds:[{hosts:["nrk.no","dna.ip-only.net","nrk-od-00.akamaized.net","nrk-od-01.akamaized.net","nrk-od-02.akamaized.net","nrk-od-03.akamaized.net","nrk-od-04.akamaized.net","nrk-od-05.akamaized.net","nrk-od-06.akamaized.net","nrk-od-07.akamaized.net","nrk-od-08.akamaized.net","nrk-od-09.akamaized.net","nrk-od-10.akamaized.net","nrk-od-11.akamaized.net","nrk-od-12.akamaized.net","nrk-od-13.akamaized.net","nrk-od-14.akamaized.net","nrk-od-15.akamaized.net","nrk-od-16.akamaized.net","nrk-od-17.akamaized.net","nrk-od-18.akamaized.net","nrk-od-19.akamaized.net","nrk-od-20.akamaized.net","nrk-od-21.akamaized.net","nrk-od-22.akamaized.net","nrk-od-23.akamaized.net","nrk-od-24.akamaized.net","nrk-od-25.akamaized.net","nrk-od-26.akamaized.net","nrk-od-27.akamaized.net","nrk-od-28.akamaized.net","nrk-od-29.akamaized.net","nrk-od-30.akamaized.net","nrk-od-31.akamaized.net","nrk-od-32.akamaized.net","nrk-od-33.akamaized.net","nrk-od-34.akamaized.net","nrk-od-35.akamaized.net","nrk-od-36.akamaized.net","nrk-od-37.akamaized.net","nrk-od-38.akamaized.net","nrk-od-39.akamaized.net","nrk-od-40.akamaized.net","nrk-od-41.akamaized.net","nrk-od-42.akamaized.net","nrk-od-43.akamaized.net","nrk-od-44.akamaized.net","nrk-od-45.akamaized.net","nrk-od-46.akamaized.net","nrk-od-47.akamaized.net","nrk-od-48.akamaized.net","nrk-od-49.akamaized.net","nrk-od-50.akamaized.net","nrk-od-51.akamaized.net","nrk-od-52.akamaized.net","nrk-od-53.akamaized.net","nrk-od-54.akamaized.net","nrk-od-55.akamaized.net","nrk-od-56.akamaized.net","nrk-od-57.akamaized.net","nrk-od-58.akamaized.net","nrk-od-59.akamaized.net","nrk-od-60.akamaized.net","nrk-od-61.akamaized.net","nrk-od-62.akamaized.net","nrk-od-63.akamaized.net","nrk-od-64.akamaized.net","nrk-od-65.akamaized.net","nrk-od-66.akamaized.net","nrk-od-67.akamaized.net","nrk-od-68.akamaized.net","nrk-od-69.akamaized.net","nrk-od-70.akamaized.net","nrk-od-71.akamaized.net","nrk-od-72.akamaized.net","nrk-od-73.akamaized.net","nrk-od-74.akamaized.net","nrk-od-75.akamaized.net","nrk-od-76.akamaized.net","nrk-od-77.akamaized.net","nrk-od-78.akamaized.net","nrk-od-79.akamaized.net","nrk-od-80.akamaized.net","nrk-od-81.akamaized.net","nrk-od-82.akamaized.net","nrk-od-83.akamaized.net","nrk-od-84.akamaized.net","nrk-od-85.akamaized.net","nrk-od-86.akamaized.net","nrk-od-87.akamaized.net","nrk-od-88.akamaized.net","nrk-od-89.akamaized.net","nrk-od-90.akamaized.net","nrk-od-91.akamaized.net","nrk-od-92.akamaized.net","nrk-od-93.akamaized.net","nrk-od-94.akamaized.net","nrk-od-95.akamaized.net","nrk-od-96.akamaized.net","nrk-od-97.akamaized.net","nrk-od-98.akamaized.net","nrk-od-99.akamaized.net"],then:"PROXY NO.PEER",if:[]}]}]},cmds:[{hosts:["nrk.no","dna.ip-only.net","nrk-od-00.akamaized.net","nrk-od-01.akamaized.net","nrk-od-02.akamaized.net","nrk-od-03.akamaized.net","nrk-od-04.akamaized.net","nrk-od-05.akamaized.net","nrk-od-06.akamaized.net","nrk-od-07.akamaized.net","nrk-od-08.akamaized.net","nrk-od-09.akamaized.net","nrk-od-10.akamaized.net","nrk-od-11.akamaized.net","nrk-od-12.akamaized.net","nrk-od-13.akamaized.net","nrk-od-14.akamaized.net","nrk-od-15.akamaized.net","nrk-od-16.akamaized.net","nrk-od-17.akamaized.net","nrk-od-18.akamaized.net","nrk-od-19.akamaized.net","nrk-od-20.akamaized.net","nrk-od-21.akamaized.net","nrk-od-22.akamaized.net","nrk-od-23.akamaized.net","nrk-od-24.akamaized.net","nrk-od-25.akamaized.net","nrk-od-26.akamaized.net","nrk-od-27.akamaized.net","nrk-od-28.akamaized.net","nrk-od-29.akamaized.net","nrk-od-30.akamaized.net","nrk-od-31.akamaized.net","nrk-od-32.akamaized.net","nrk-od-33.akamaized.net","nrk-od-34.akamaized.net","nrk-od-35.akamaized.net","nrk-od-36.akamaized.net","nrk-od-37.akamaized.net","nrk-od-38.akamaized.net","nrk-od-39.akamaized.net","nrk-od-40.akamaized.net","nrk-od-41.akamaized.net","nrk-od-42.akamaized.net","nrk-od-43.akamaized.net","nrk-od-44.akamaized.net","nrk-od-45.akamaized.net","nrk-od-46.akamaized.net","nrk-od-47.akamaized.net","nrk-od-48.akamaized.net","nrk-od-49.akamaized.net","nrk-od-50.akamaized.net","nrk-od-51.akamaized.net","nrk-od-52.akamaized.net","nrk-od-53.akamaized.net","nrk-od-54.akamaized.net","nrk-od-55.akamaized.net","nrk-od-56.akamaized.net","nrk-od-57.akamaized.net","nrk-od-58.akamaized.net","nrk-od-59.akamaized.net","nrk-od-60.akamaized.net","nrk-od-61.akamaized.net","nrk-od-62.akamaized.net","nrk-od-63.akamaized.net","nrk-od-64.akamaized.net","nrk-od-65.akamaized.net","nrk-od-66.akamaized.net","nrk-od-67.akamaized.net","nrk-od-68.akamaized.net","nrk-od-69.akamaized.net","nrk-od-70.akamaized.net","nrk-od-71.akamaized.net","nrk-od-72.akamaized.net","nrk-od-73.akamaized.net","nrk-od-74.akamaized.net","nrk-od-75.akamaized.net","nrk-od-76.akamaized.net","nrk-od-77.akamaized.net","nrk-od-78.akamaized.net","nrk-od-79.akamaized.net","nrk-od-80.akamaized.net","nrk-od-81.akamaized.net","nrk-od-82.akamaized.net","nrk-od-83.akamaized.net","nrk-od-84.akamaized.net","nrk-od-85.akamaized.net","nrk-od-86.akamaized.net","nrk-od-87.akamaized.net","nrk-od-88.akamaized.net","nrk-od-89.akamaized.net","nrk-od-90.akamaized.net","nrk-od-91.akamaized.net","nrk-od-92.akamaized.net","nrk-od-93.akamaized.net","nrk-od-94.akamaized.net","nrk-od-95.akamaized.net","nrk-od-96.akamaized.net","nrk-od-97.akamaized.net","nrk-od-98.akamaized.net","nrk-od-99.akamaized.net"],then:"PROXY NO.PEER",if:[]}]},discoveryplus_in:{match:{root_urls:["discoveryplus.in"],rules:[{proxy_country:["IN"],cmds:[{root_urls:["discoveryplus.in"],then:"PROXY IN",if:[]},{hosts:["ap2-prod-direct.discoveryplus.in"],then:"PROXY IN.POOL_lum_in_shared",if:[]}]}]},cmds:[{root_urls:["discoveryplus.in"],then:"PROXY IN",if:[]},{hosts:["ap2-prod-direct.discoveryplus.in"],then:"PROXY IN.POOL_lum_in_shared",if:[]}]},spotify_com:{match:{root_urls:["spotify.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["spclient.wg.spotify.com"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{hosts:["spclient.wg.spotify.com"],then:"PROXY US.PEER",if:[]}]},ruv_is:{match:{root_urls:["ruv.is"],rules:[{proxy_country:["IS"],cmds:[{hosts:["ruv-vod-app-dcp-v4.secure.footprint.net"],then:"PROXY IS.PEER",if:[]}]}]},cmds:[{hosts:["ruv-vod-app-dcp-v4.secure.footprint.net"],then:"PROXY IS.PEER",if:[]}]},tf1_fr:{match:{root_urls:["tf1.fr"],rules:[{proxy_country:["FR"],cmds:[{root_urls:["tf1.fr"],then:"PROXY FR.POOL_lum_fr_shared",if:[]},{hosts:["mediainfo.tf1.fr","strmt.tf1.fr","tf1-das-live-ssl.tf1.fr"],then:"PROXY FR.PEER",if:[]}]}]},cmds:[{root_urls:["tf1.fr"],then:"PROXY FR.POOL_lum_fr_shared",if:[]},{hosts:["mediainfo.tf1.fr","strmt.tf1.fr","tf1-das-live-ssl.tf1.fr"],then:"PROXY FR.PEER",if:[]}]},dmm_co_jp:{match:{root_urls:["dmm.co.jp"],rules:[{proxy_country:["JP"],cmds:[{hosts:["www.dmm.co.jp"],then:"PROXY JP.PEER",if:[]}]}]},cmds:[{hosts:["www.dmm.co.jp"],then:"PROXY JP.PEER",if:[]}]},novasports_gr:{match:{root_urls:["novasports.gr"],rules:[{proxy_country:["GR"],cmds:[{hosts:["online.novasports.gr"],then:"PROXY GR.PEER",if:[]}]}]},cmds:[{hosts:["online.novasports.gr"],then:"PROXY GR.PEER",if:[]}]},albumartexchange_com:{match:{root_urls:["albumartexchange.com"],rules:[{proxy_country:["JP"],cmds:[{hosts:["albumartexchange.com"],then:"PROXY JP.PEER",if:[]}]}]},cmds:[{hosts:["albumartexchange.com"],then:"PROXY JP.PEER",if:[]}]},cablevisionflow_com_ar:{match:{root_urls:["cablevisionflow.com.ar"],rules:[{proxy_country:["AR"],cmds:[{hosts:["cablevisionflow.com.ar"],then:"PROXY AR.PEER",if:[]}]}]},cmds:[{hosts:["cablevisionflow.com.ar"],then:"PROXY AR.PEER",if:[]}]},flow_com_ar:{match:{root_urls:["flow.com.ar"],rules:[{proxy_country:["AR"],cmds:[{hosts:["flow.com.ar"],then:"PROXY AR.PEER",if:[]}]}]},cmds:[{hosts:["flow.com.ar"],then:"PROXY AR.PEER",if:[]}]},outback_sylt_de:{match:{root_urls:["outback-sylt.de"],rules:[{proxy_country:["DE"],cmds:[{hosts:["outback-sylt.de"],then:"PROXY DE.PEER",if:[]}]}]},cmds:[{hosts:["outback-sylt.de"],then:"PROXY DE.PEER",if:[]}]},tjx_com:{match:{root_urls:["tjx.com"],rules:[{proxy_country:["US"],cmds:[{root_urls:["tjx.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]}]},cmds:[{root_urls:["tjx.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},qvc_com:{match:{root_urls:["qvc.com"],rules:[{proxy_country:["US"],cmds:[{root_urls:["qvc.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]}]},cmds:[{root_urls:["qvc.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},gapfactory_com:{match:{root_urls:["gapfactory.com"],rules:[{proxy_country:["US"],cmds:[{root_urls:["gapfactory.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]}]},cmds:[{root_urls:["gapfactory.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},rsi_ch:{match:{root_urls:["rsi.ch"],rules:[{proxy_country:["CH"],cmds:[{hosts:["srg.live.ott.irdeto.com"],then:"PROXY CH.PEER",if:[]}]}]},cmds:[{hosts:["srg.live.ott.irdeto.com"],then:"PROXY CH.PEER",if:[]}]},rts_ch:{match:{root_urls:["rts.ch"],rules:[{proxy_country:["CH"],cmds:[{hosts:["srg.live.ott.irdeto.com"],then:"PROXY CH.PEER",if:[]}]}]},cmds:[{hosts:["srg.live.ott.irdeto.com"],then:"PROXY CH.PEER",if:[]}]},srf_ch:{match:{root_urls:["srf.ch"],rules:[{proxy_country:["CH"],cmds:[{hosts:["srg.live.ott.irdeto.com"],then:"PROXY CH.PEER",if:[]}]}]},cmds:[{hosts:["srg.live.ott.irdeto.com"],then:"PROXY CH.PEER",if:[]}]},premierplayer_tv:{match:{root_urls:["premierplayer.tv"],rules:[{proxy_country:["GB"],cmds:[{hosts:["www.premierplayer.tv","live.247cdn.net","b.247cdn.net","ondemand.247cdn.net"],then:"PROXY GB.PEER",if:[]},{root_urls:["premierplayer.tv"],then:"PROXY GB.POOL_lum_gb_shared",if:[]}]}]},cmds:[{hosts:["www.premierplayer.tv","live.247cdn.net","b.247cdn.net","ondemand.247cdn.net"],then:"PROXY GB.PEER",if:[]},{root_urls:["premierplayer.tv"],then:"PROXY GB.POOL_lum_gb_shared",if:[]}]},mtv_ca:{match:{root_urls:["mtv.ca"],rules:[{proxy_country:["CA"],cmds:[{root_urls:["mtv.ca"],then:"PROXY CA.POOL_lum_ca_shared",if:[]},{hosts:["capi.9c9media.com"],then:"PROXY CA.POOL_lum_ca_shared",if:[]}]}]},cmds:[{root_urls:["mtv.ca"],then:"PROXY CA.POOL_lum_ca_shared",if:[]},{hosts:["capi.9c9media.com"],then:"PROXY CA.POOL_lum_ca_shared",if:[]}]},radiko_jp:{match:{root_urls:["radiko.jp"],rules:[{proxy_country:["JP"],cmds:[{hosts:["radiko.jp"],then:"PROXY JP.PEER",if:[]}]}]},cmds:[{hosts:["radiko.jp"],then:"PROXY JP.PEER",if:[]}]},tver_jp:{match:{root_urls:["tver.jp"],rules:[{proxy_country:["JP"],cmds:[{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY JP"}],then:"PROXY JP.PEER"}]}]},cmds:[{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY JP"}],then:"PROXY JP.PEER"}]},allotalk_com:{match:{root_urls:["allotalk.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["allotalk.com"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{hosts:["allotalk.com"],then:"PROXY US.PEER",if:[]}]},williamhill_com:{match:{root_urls:["williamhill.com"],rules:[{proxy_country:["GB"],cmds:[{hosts:["williamhill.com"],then:"PROXY GB.PEER",if:[]}]}]},cmds:[{hosts:["williamhill.com"],then:"PROXY GB.PEER",if:[]}]},joyn_de:{match:{root_urls:["joyn.de"],rules:[{proxy_country:["DE"],cmds:[{hosts:["api.joyn.de","auth.joyn.de"],then:"PROXY DE.PEER",if:[]}]}]},cmds:[{hosts:["api.joyn.de","auth.joyn.de"],then:"PROXY DE.PEER",if:[]}]},_13tv_co_il:{match:{root_urls:["13tv.co.il"],rules:[{proxy_country:["IL"],cmds:[{hosts:["log.advsnx.net","banners.advsnx.net","pagead2.googlesyndication.com","www.google-analytics.com","securepubads.g.doubleclick.net","taboola.com","secure.adnx.com","adnxs.com"],then:"DIRECT",if:[]}]}]},cmds:[{hosts:["log.advsnx.net","banners.advsnx.net","pagead2.googlesyndication.com","www.google-analytics.com","securepubads.g.doubleclick.net","taboola.com","secure.adnx.com","adnxs.com"],then:"DIRECT",if:[]}]},abema_tv:{match:{root_urls:["abema.tv"],rules:[{proxy_country:["JP"],cmds:[{hosts:["abema.tv"],then:"PROXY JP.PEER",if:[]}]}]},cmds:[{hosts:["abema.tv"],then:"PROXY JP.PEER",if:[]}]},canal_plus_com:{match:{root_urls:["canal-plus.com"],rules:[{proxy_country:["FR"],cmds:[{root_urls:["canal-plus.com"],then:"PROXY FR.POOL_lum_fr_shared",if:[]}]}]},cmds:[{root_urls:["canal-plus.com"],then:"PROXY FR.POOL_lum_fr_shared",if:[]}]},zalando_fr:{match:{root_urls:["zalando.fr"],rules:[{proxy_country:["FR"],cmds:[{root_urls:["zalando.fr"],then:"PROXY FR.POOL_lum_fr_shared",if:[]}]}]},cmds:[{root_urls:["zalando.fr"],then:"PROXY FR.POOL_lum_fr_shared",if:[]}]},mewatch_sg:{match:{root_urls:["mewatch.sg"],rules:[{proxy_country:["SG"],cmds:[{hosts:["tvpapi-as.ott.kaltura.com","www.mewatch.sg","player-mc.sgp2.ott.kaltura.com","cdn.mewatch.sg"],then:"PROXY SG.PEER",if:[]}]}]},cmds:[{hosts:["tvpapi-as.ott.kaltura.com","www.mewatch.sg","player-mc.sgp2.ott.kaltura.com","cdn.mewatch.sg"],then:"PROXY SG.PEER",if:[]}]},_007song_co_kr:{match:{root_urls:["007song.co.kr"],rules:[{proxy_country:["KR"],cmds:[{hosts:["007song.co.kr"],then:"PROXY KR.PEER",if:[]}]}]},cmds:[{hosts:["007song.co.kr"],then:"PROXY KR.PEER",if:[]}]},yahoo_co_jp:{match:{root_urls:["yahoo.co.jp"],rules:[{proxy_country:["JP"],cmds:[{root_urls:["yahoo.co.jp"],then:"PROXY JP",if:[]},{hosts:["gyao.yahoo.co.jp"],if:[{url:".*gyao\\.yahoo\\.co\\.jp\\/apis\\/playback\\/graphql",type:"!~",then:"PROXY JP.PEER"}],then:"PROXY JP.PEER"}]}]},cmds:[{root_urls:["yahoo.co.jp"],then:"PROXY JP",if:[]},{hosts:["gyao.yahoo.co.jp"],if:[{url:".*gyao\\.yahoo\\.co\\.jp\\/apis\\/playback\\/graphql",type:"!~",then:"PROXY JP.PEER"}],then:"PROXY JP.PEER"}]},peacocktv_com:{match:{root_urls:["peacocktv.com"],rules:[{proxy_country:["US"],cmds:[{root_urls:["peacocktv.com"],then:"PROXY US.POOL_lum_us_shared",if:[]},{hosts:["ovp.peacocktv.com"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{root_urls:["peacocktv.com"],then:"PROXY US.POOL_lum_us_shared",if:[]},{hosts:["ovp.peacocktv.com"],then:"PROXY US.PEER",if:[]}]},snipesusa_com:{match:{root_urls:["snipesusa.com"],rules:[{proxy_country:["US"],cmds:[{root_urls:["snipesusa.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]}]},cmds:[{root_urls:["snipesusa.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},walgreens_com:{match:{root_urls:["walgreens.com"],rules:[{proxy_country:["US"],cmds:[{root_urls:["walgreens.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]}]},cmds:[{root_urls:["walgreens.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},qmee_com:{match:{root_urls:["qmee.com"],rules:[{proxy_country:["US"],cmds:[{root_urls:["qmee.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]}]},cmds:[{root_urls:["qmee.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},ctv_ca:{match:{root_urls:["ctv.ca"],rules:[{proxy_country:["CA"],cmds:[{root_urls:["ctv.ca"],then:"PROXY CA.POOL_lum_ca_shared",if:[]},{hosts:["capi.9c9media.com"],then:"PROXY CA.POOL_lum_ca_shared",if:[]}]}]},cmds:[{root_urls:["ctv.ca"],then:"PROXY CA.POOL_lum_ca_shared",if:[]},{hosts:["capi.9c9media.com"],then:"PROXY CA.POOL_lum_ca_shared",if:[]}]},foodnetwork_ca:{match:{root_urls:["foodnetwork.ca"],rules:[{proxy_country:["CA"],cmds:[{root_urls:["foodnetwork.ca"],then:"PROXY CA.POOL_lum_ca_shared",if:[]}]}]},cmds:[{root_urls:["foodnetwork.ca"],then:"PROXY CA.POOL_lum_ca_shared",if:[]}]},b2byellowpages_com:{match:{root_urls:["b2byellowpages.com"],rules:[{proxy_country:["US"],cmds:[{root_urls:["b2byellowpages.com"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{root_urls:["b2byellowpages.com"],then:"PROXY US.PEER",if:[]}]},engclip_com:{match:{root_urls:["engclip.com"],rules:[{proxy_country:["IN"],cmds:[{root_urls:["engclip.com"],then:"PROXY IN",if:[]},{hosts:["proxy-32.sg1.dailymotion.com"],then:"PROXY IN.POOL_lum_in_shared",if:[]}]}]},cmds:[{root_urls:["engclip.com"],then:"PROXY IN",if:[]},{hosts:["proxy-32.sg1.dailymotion.com"],then:"PROXY IN.POOL_lum_in_shared",if:[]}]},footpatrol_co_uk:{match:{root_urls:["footpatrol.co.uk","footpatrol.com"],rules:[{proxy_country:["GB"],cmds:[{root_urls:["footpatrol.co.uk","footpatrol.com"],then:"PROXY GB.POOL_lum_gb_shared",if:[]}]}]},cmds:[{root_urls:["footpatrol.co.uk","footpatrol.com"],then:"PROXY GB.POOL_lum_gb_shared",if:[]}]},jdsports_co_uk:{match:{root_urls:["jdsports.co.uk"],rules:[{proxy_country:["GB"],cmds:[{root_urls:["jdsports.co.uk"],then:"PROXY GB.POOL_lum_gb_shared",if:[]}]}]},cmds:[{root_urls:["jdsports.co.uk"],then:"PROXY GB.POOL_lum_gb_shared",if:[]}]},size_co_uk:{match:{root_urls:["size.co.uk"],rules:[{proxy_country:["GB"],cmds:[{root_urls:["size.co.uk"],then:"PROXY GB.POOL_lum_gb_shared",if:[]}]}]},cmds:[{root_urls:["size.co.uk"],then:"PROXY GB.POOL_lum_gb_shared",if:[]}]},tui_co_uk:{match:{root_urls:["tui.co.uk"],rules:[{proxy_country:["GB"],cmds:[{hosts:["tui.co.uk"],then:"PROXY GB.PEER",if:[]}]}]},cmds:[{hosts:["tui.co.uk"],then:"PROXY GB.PEER",if:[]}]},blutv_com:{match:{root_urls:["blutv.com"],rules:[{proxy_country:["TR"],cmds:[{hosts:["blutv.com"],then:"PROXY TR.PEER",if:[]}]}]},cmds:[{hosts:["blutv.com"],then:"PROXY TR.PEER",if:[]}]},garena_com:{match:{root_urls:["garena.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["garena.com"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{hosts:["garena.com"],then:"PROXY US.PEER",if:[]}]},offerup_com:{match:{root_urls:["offerup.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["offerup.com"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{hosts:["offerup.com"],then:"PROXY US.PEER",if:[]}]},mugenarchive_com:{match:{root_urls:["mugenarchive.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["mugenarchive.com"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{hosts:["mugenarchive.com"],then:"PROXY US.PEER",if:[]}]},lostfilm_tv:{match:{root_urls:["lostfilm.tv"],rules:[{proxy_country:["IT"],cmds:[{root_urls:["lostfilm.tv"],then:"PROXY IT.POOL_lum_it_shared",if:[]}]},{proxy_country:["CA"],cmds:[{root_urls:["lostfilm.tv"],then:"PROXY CA.POOL_lum_ca_shared"}]},{proxy_country:["GB"],cmds:[{root_urls:["lostfilm.tv"],then:"PROXY GB.POOL_lum_gb_shared"}]},{proxy_country:["NL"],cmds:[{root_urls:["lostfilm.tv"],then:"PROXY NL.POOL_lum_nl_shared"}]},{proxy_country:["FR"],cmds:[{root_urls:["lostfilm.tv"],then:"PROXY FR.POOL_lum_fr_shared"}]},{proxy_country:["ES"],cmds:[{root_urls:["lostfilm.tv"],then:"PROXY ES.POOL_lum_es_shared"}]},{proxy_country:["US"],cmds:[{root_urls:["lostfilm.tv"],then:"PROXY US.POOL_lum_us_shared"}]},{proxy_country:["KR"],cmds:[{root_urls:["lostfilm.tv"],then:"PROXY KR.POOL_lum_kr_shared"}]},{proxy_country:["BR"],cmds:[{root_urls:["lostfilm.tv"],then:"PROXY BR.POOL_lum_br_shared"}]}]},cmds:[{root_urls:["lostfilm.tv"],then:"PROXY IT.POOL_lum_it_shared",if:[]}]},prende_tv:{match:{root_urls:["lostfilm.tv"],rules:[{proxy_country:["IT"],cmds:[{root_urls:["lostfilm.tv"],then:"PROXY IT.POOL_lum_it_shared",if:[]}]},{proxy_country:["CA"],cmds:[{root_urls:["lostfilm.tv"],then:"PROXY CA.POOL_lum_ca_shared"}]},{proxy_country:["GB"],cmds:[{root_urls:["lostfilm.tv"],then:"PROXY GB.POOL_lum_gb_shared"}]},{proxy_country:["NL"],cmds:[{root_urls:["lostfilm.tv"],then:"PROXY NL.POOL_lum_nl_shared"}]},{proxy_country:["FR"],cmds:[{root_urls:["lostfilm.tv"],then:"PROXY FR.POOL_lum_fr_shared"}]},{proxy_country:["ES"],cmds:[{root_urls:["lostfilm.tv"],then:"PROXY ES.POOL_lum_es_shared"}]},{proxy_country:["US"],cmds:[{root_urls:["lostfilm.tv"],then:"PROXY US.POOL_lum_us_shared"}]},{proxy_country:["KR"],cmds:[{root_urls:["lostfilm.tv"],then:"PROXY KR.POOL_lum_kr_shared"}]},{proxy_country:["BR"],cmds:[{root_urls:["lostfilm.tv"],then:"PROXY BR.POOL_lum_br_shared"}]}]},cmds:[{root_urls:["lostfilm.tv"],then:"PROXY IT.POOL_lum_it_shared",if:[]}]},homify_com:{match:{root_urls:["homify.com"],rules:[{cmds:[{hosts:["homify.com"],then:"PROXY XX.PEER",if:[]}]}]},cmds:[{hosts:["homify.com"],then:"PROXY XX.PEER",if:[]}]},country_rule:{client_only:true,match:{min_ver:"1.170.260",root_urls:[""],rules:[{proxy_country:["KR"],cmds:[{proxy_country:["KR"],then:"PROXY KR.POOL_lum_kr_shared",if:[]}]}]},cmds:[{proxy_country:["KR"],then:"PROXY KR.POOL_lum_kr_shared",if:[]}]},sotostore_com:{match:{root_urls:["sotostore.com"],rules:[{proxy_country:["DE"],cmds:[{hosts:["www.sotostore.com"],then:"PROXY DE.PEER",if:[]}]}]},cmds:[{hosts:["www.sotostore.com"],then:"PROXY DE.PEER",if:[]}]},foxtel_com_au:{match:{root_urls:["foxtel.com.au"],rules:[{proxy_country:["AU"],cmds:[{hosts:["foxtel.com.au"],then:"PROXY AU.PEER",if:[]}]}]},cmds:[{hosts:["foxtel.com.au"],then:"PROXY AU.PEER",if:[]}]},indavideo_hu:{match:{root_urls:["indavideo.hu"],rules:[{proxy_country:["HU"],cmds:[{hosts:["embed.indavideo.hu"],then:"PROXY HU.PEER",if:[]}]}]},cmds:[{hosts:["embed.indavideo.hu"],then:"PROXY HU.PEER",if:[]}]},vroom_com:{match:{root_urls:["vroom.com"],rules:[{proxy_country:["US"],cmds:[{root_urls:["vroom.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]}]},cmds:[{root_urls:["vroom.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},pontofrio_com_br:{match:{root_urls:["pontofrio.com.br"],rules:[{proxy_country:["BR"],cmds:[{root_urls:["pontofrio.com.br"],then:"PROXY BR.POOL_lum_br_shared",if:[]}]}]},cmds:[{root_urls:["pontofrio.com.br"],then:"PROXY BR.POOL_lum_br_shared",if:[]}]},marshalls_com:{match:{root_urls:["marshalls.com"],rules:[{proxy_country:["US"],cmds:[{root_urls:["marshalls.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]}]},cmds:[{root_urls:["marshalls.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},dplay_co_uk:{match:{root_urls:["dplay.co.uk"],rules:[{proxy_country:["GB"],cmds:[{root_urls:["dplay.co.uk"],then:"PROXY GB.POOL_lum_gb_shared",if:[]}]}]},cmds:[{root_urls:["dplay.co.uk"],then:"PROXY GB.POOL_lum_gb_shared",if:[]}]},atresplayer_com:{match:{root_urls:["atresplayer.com"],rules:[{proxy_country:["ES"],cmds:[{root_urls:["atresplayer.com"],then:"PROXY ES.POOL_lum_es_shared",if:[]},{hosts:["api.atresplayer.com","directo.atresmedia.com","atres-live.atresmedia.com"],then:"PROXY ES.PEER",if:[]}]}]},cmds:[{root_urls:["atresplayer.com"],then:"PROXY ES.POOL_lum_es_shared",if:[]},{hosts:["api.atresplayer.com","directo.atresmedia.com","atres-live.atresmedia.com"],then:"PROXY ES.PEER",if:[]}]},footlocker_co_uk:{match:{root_urls:["footlocker.co.uk"],rules:[{proxy_country:["GB"],cmds:[{root_urls:["footlocker.co.uk"],then:"PROXY GB.POOL_lum_gb_shared",if:[]}]}]},cmds:[{root_urls:["footlocker.co.uk"],then:"PROXY GB.POOL_lum_gb_shared",if:[]}]},pxg_co_kr:{match:{root_urls:["pxg.co.kr"],rules:[{proxy_country:["US"],cmds:[{root_urls:["pxg.co.kr"],then:"PROXY US.POOL_lum_us_shared",if:[]}]}]},cmds:[{root_urls:["pxg.co.kr"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},udemy_com:{match:{root_urls:["udemy.com"],rules:[{proxy_country:["US"],cmds:[{root_urls:["udemy.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]}]},cmds:[{root_urls:["udemy.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},gamovideo_com:{match:{root_urls:["gamovideo.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["gamovideo.com"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{hosts:["gamovideo.com"],then:"PROXY US.PEER",if:[]}]},yellowpages_com:{match:{root_urls:["yellowpages.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["yellowpages.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]}]},cmds:[{hosts:["yellowpages.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},lawyers_com:{match:{root_urls:["lawyers.com"],rules:[{proxy_country:["US"],cmds:[{root_urls:["lawyers.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]}]},cmds:[{root_urls:["lawyers.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},filmizlesene_pw:{match:{root_urls:["filmizlesene.pw"],rules:[{proxy_country:["US"],cmds:[{hosts:["filmizlesene.pw"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{hosts:["filmizlesene.pw"],then:"PROXY US.PEER",if:[]}]},dizibox_pw:{match:{root_urls:["dizibox.pw"],rules:[{proxy_country:["US"],cmds:[{hosts:["dizibox.pw"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{hosts:["dizibox.pw"],then:"PROXY US.PEER",if:[]}]},skynews_com_au:{match:{root_urls:["skynews.com.au"],rules:[{proxy_country:["AU"],cmds:[{hosts:["www.skynews.com.au"],then:"PROXY AU.PEER",if:[]},{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY AU"}],then:"PROXY AU.PEER"}]}]},cmds:[{hosts:["www.skynews.com.au"],then:"PROXY AU.PEER",if:[]},{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY AU"}],then:"PROXY AU.PEER"}]},sbt_com_br:{match:{root_urls:["sbt.com.br"],rules:[{proxy_country:["BR"],cmds:[{hosts:["sbt.com.br"],then:"PROXY BR.PEER",if:[]}]}]},cmds:[{hosts:["sbt.com.br"],then:"PROXY BR.PEER",if:[]}]},bfi_org_uk:{match:{root_urls:["bfi.org.uk"],rules:[{proxy_country:["GB"],cmds:[{root_urls:["bfi.org.uk"],then:"PROXY GB.POOL_lum_gb_shared",if:[]}]}]},cmds:[{root_urls:["bfi.org.uk"],then:"PROXY GB.POOL_lum_gb_shared",if:[]}]},ocs_fr:{match:{root_urls:["ocs.fr"],rules:[{proxy_country:["FR"],cmds:[{root_urls:["ocs.fr"],then:"PROXY FR.POOL_lum_fr_shared",if:[]},{hosts:["www.ocs.fr","statics.ocs.fr","api.ocs.fr"],then:"PROXY FR.POOL_lum_fr_shared",if:[]}]}]},cmds:[{root_urls:["ocs.fr"],then:"PROXY FR.POOL_lum_fr_shared",if:[]},{hosts:["www.ocs.fr","statics.ocs.fr","api.ocs.fr"],then:"PROXY FR.POOL_lum_fr_shared",if:[]}]},line_me:{match:{root_urls:["line.me"],rules:[{cmds:[{proxy_country:["TW"],hosts:["line.me"],then:"PROXY TW.PEER",if:[]}]}]},cmds:[{proxy_country:["TW"],hosts:["line.me"],then:"PROXY TW.PEER",if:[]}]},cbc_ca:{match:{root_urls:["cbc.ca"],rules:[{proxy_country:["CA"],cmds:[{root_urls:["cbc.ca"],then:"PROXY CA.POOL_lum_ca_shared",if:[]}]}]},cmds:[{root_urls:["cbc.ca"],then:"PROXY CA.POOL_lum_ca_shared",if:[]}]},tving_com:{match:{root_urls:["tving.com"],rules:[{proxy_country:["KR"],cmds:[{root_urls:["tving.com"],then:"PROXY KR.POOL_lum_kr_shared",if:[]},{hosts:["api.tving.com"],then:"PROXY KR.PEER",if:[]}]}]},cmds:[{root_urls:["tving.com"],then:"PROXY KR.POOL_lum_kr_shared",if:[]},{hosts:["api.tving.com"],then:"PROXY KR.PEER",if:[]}]},afreecatv_com:{match:{root_urls:["afreecatv.com"],rules:[{proxy_country:["KR"],cmds:[{root_urls:["afreecatv.com"],then:"PROXY KR.POOL_lum_kr_shared",if:[]}]}]},cmds:[{root_urls:["afreecatv.com"],then:"PROXY KR.POOL_lum_kr_shared",if:[]}]},vlive_tv:{match:{root_urls:["vlive.tv"],rules:[{proxy_country:["KR"],cmds:[{root_urls:["vlive.tv"],then:"PROXY KR.POOL_lum_kr_shared",if:[]}]}]},cmds:[{root_urls:["vlive.tv"],then:"PROXY KR.POOL_lum_kr_shared",if:[]}]},viki_com:{match:{root_urls:["viki.com"],rules:[{proxy_country:["IT"],cmds:[{root_urls:["viki.com"],then:"PROXY IT.POOL_lum_it_shared",if:[]}]},{proxy_country:["CA"],cmds:[{root_urls:["viki.com"],then:"PROXY CA.POOL_lum_ca_shared"}]},{proxy_country:["GB"],cmds:[{root_urls:["viki.com"],then:"PROXY GB.POOL_lum_gb_shared"}]},{proxy_country:["NL"],cmds:[{root_urls:["viki.com"],then:"PROXY NL.POOL_lum_nl_shared"}]},{proxy_country:["FR"],cmds:[{root_urls:["viki.com"],then:"PROXY FR.POOL_lum_fr_shared"}]},{proxy_country:["ES"],cmds:[{root_urls:["viki.com"],then:"PROXY ES.POOL_lum_es_shared"}]},{proxy_country:["US"],cmds:[{root_urls:["viki.com"],then:"PROXY US.POOL_lum_us_shared"}]},{proxy_country:["KR"],cmds:[{root_urls:["viki.com"],then:"PROXY KR.POOL_lum_kr_shared"}]},{proxy_country:["BR"],cmds:[{root_urls:["viki.com"],then:"PROXY BR.POOL_lum_br_shared"}]}]},cmds:[{root_urls:["viki.com"],then:"PROXY IT.POOL_lum_it_shared",if:[]}]},ruliweb_com:{match:{root_urls:["ruliweb.com"],rules:[{proxy_country:["KR"],cmds:[{root_urls:["ruliweb.com"],then:"PROXY KR.POOL_lum_kr_shared",if:[]}]}]},cmds:[{root_urls:["ruliweb.com"],then:"PROXY KR.POOL_lum_kr_shared",if:[]}]},nexon_com:{match:{root_urls:["nexon.com"],rules:[{proxy_country:["KR"],cmds:[{root_urls:["nexon.com"],then:"PROXY KR.POOL_lum_kr_shared",if:[]}]}]},cmds:[{root_urls:["nexon.com"],then:"PROXY KR.POOL_lum_kr_shared",if:[]}]},dcinside_com:{match:{root_urls:["dcinside.com"],rules:[{proxy_country:["KR"],cmds:[{root_urls:["dcinside.com"],then:"PROXY KR.POOL_lum_kr_shared",if:[]}]}]},cmds:[{root_urls:["dcinside.com"],then:"PROXY KR.POOL_lum_kr_shared",if:[]}]},licindia_in:{match:{root_urls:["licindia.in"],rules:[{proxy_country:["IN"],cmds:[{root_urls:["licindia_in"],then:"PROXY IN",if:[]}]}]},cmds:[{root_urls:["licindia_in"],then:"PROXY IN",if:[]}]},yupptv_com:{match:{root_urls:["yupptv.com"],rules:[{proxy_country:["IN"],cmds:[{hosts:["www.yupptv.com"],then:"PROXY IN.POOL_lum_in_shared",if:[]}]}]},cmds:[{hosts:["www.yupptv.com"],then:"PROXY IN.POOL_lum_in_shared",if:[]}]},lenskart_com:{match:{root_urls:["lenskart.com"],rules:[{proxy_country:["IN"],cmds:[{hosts:["lenskart.com"],then:"PROXY IN.POOL_lum_in_shared",if:[]}]}]},cmds:[{hosts:["lenskart.com"],then:"PROXY IN.POOL_lum_in_shared",if:[]}]},sunnxt_com:{match:{root_urls:["sunnxt.com"],rules:[{proxy_country:["IN"],cmds:[{root_urls:["sunnxt.com"],then:"PROXY IN",if:[]}]}]},cmds:[{root_urls:["sunnxt.com"],then:"PROXY IN",if:[]}]},primevideo_com:{match:{root_urls:["primevideo.com"],rules:[{proxy_country:["IT"],cmds:[{root_urls:["primevideo.com"],then:"PROXY IT.POOL_lum_it_shared",if:[]}]},{proxy_country:["CA"],cmds:[{root_urls:["primevideo.com"],then:"PROXY CA.POOL_lum_ca_shared"}]},{proxy_country:["GB"],cmds:[{root_urls:["primevideo.com"],then:"PROXY GB.POOL_lum_gb_shared"}]},{proxy_country:["NL"],cmds:[{root_urls:["primevideo.com"],then:"PROXY NL.POOL_lum_nl_shared"}]},{proxy_country:["FR"],cmds:[{root_urls:["primevideo.com"],then:"PROXY FR.POOL_lum_fr_shared"}]},{proxy_country:["ES"],cmds:[{root_urls:["primevideo.com"],then:"PROXY ES.POOL_lum_es_shared"}]},{proxy_country:["US"],cmds:[{root_urls:["primevideo.com"],then:"PROXY US.POOL_lum_us_shared"}]},{proxy_country:["KR"],cmds:[{root_urls:["primevideo.com"],then:"PROXY KR.POOL_lum_kr_shared"}]},{proxy_country:["BR"],cmds:[{root_urls:["primevideo.com"],then:"PROXY BR.POOL_lum_br_shared"}]},{proxy_country:["NO","GR","DE","DK","SE","CL","SG","CH","EG","RU","PL","IE","CN","IL","AR","HU","BE","FI","MX","HR","SI","SK","TR","TW","TH","JM","VN","PE","PH","ID","RO","ZA","BG","AT","NZ","CZ","IS","PT","BZ","UA"],cmds:[{hosts:["atv-ps-eu.primevideo.com","primevideo.com","api.eu-west-1.aiv-delivery.net"],then:"PROXY XX.PEER"}]}]},cmds:[{root_urls:["primevideo.com"],then:"PROXY IT.POOL_lum_it_shared",if:[]}]},zee5_com:{match:{root_urls:["zee5.com"],rules:[{proxy_country:["IN"],cmds:[{hosts:["zee5.com"],then:"PROXY IN.POOL_lum_in_shared",if:[]}]}]},cmds:[{hosts:["zee5.com"],then:"PROXY IN.POOL_lum_in_shared",if:[]}]},voot_com:{match:{root_urls:["voot.com"],rules:[{proxy_country:["IN"],cmds:[{root_urls:["voot.com"],if:[{host:"(?:google-analytics\\.com|analytics\\.twitter\\.com|googleadservices\\.com|p\\.adsymptotic\\.com|googletagmanager\\.com|bat\\.bing\\.com|adservice\\.google\\.com|doubleclick\\.net|gstatic\\.com|googlesyndication\\.com|2mdn\\.net|q\\.quora\\.com|analytics\\.edgekey\\.net|amazon-adsystem\\.com|users\\.quantumgraph\\.com|images-na\\.ssl-images-amazon\\.com|bh\\.contextweb\\.com|pixel-sync\\.sitescout\\.com|ads-twitter\\.com|googletagservices\\.com|scorecardresearch\\.com|outbrain\\.com|cdnjs\\.cloudflare\\.com|adservice\\.google\\.com\\.pk|adservice\\.google\\.com\\.ph|adroll\\.com|analytics\\.yahoo\\.com|spl\\.zeotap\\.com|a-ads\\.com|google\\.com|google\\.co\\.in|facebook\\.com|facebook\\.net|t\\.co|rubiconproject\\.com|google\\.com\\.bd|mixpanel\\.com|go-mpulse\\.net|google\\.com\\.au|googleapis\\.com)$",type:"=~",then:"PROXY XX"}],then:"PROXY IN.POOL_lum_in_shared"}]}]},cmds:[{root_urls:["voot.com"],if:[{host:"(?:google-analytics\\.com|analytics\\.twitter\\.com|googleadservices\\.com|p\\.adsymptotic\\.com|googletagmanager\\.com|bat\\.bing\\.com|adservice\\.google\\.com|doubleclick\\.net|gstatic\\.com|googlesyndication\\.com|2mdn\\.net|q\\.quora\\.com|analytics\\.edgekey\\.net|amazon-adsystem\\.com|users\\.quantumgraph\\.com|images-na\\.ssl-images-amazon\\.com|bh\\.contextweb\\.com|pixel-sync\\.sitescout\\.com|ads-twitter\\.com|googletagservices\\.com|scorecardresearch\\.com|outbrain\\.com|cdnjs\\.cloudflare\\.com|adservice\\.google\\.com\\.pk|adservice\\.google\\.com\\.ph|adroll\\.com|analytics\\.yahoo\\.com|spl\\.zeotap\\.com|a-ads\\.com|google\\.com|google\\.co\\.in|facebook\\.com|facebook\\.net|t\\.co|rubiconproject\\.com|google\\.com\\.bd|mixpanel\\.com|go-mpulse\\.net|google\\.com\\.au|googleapis\\.com)$",type:"=~",then:"PROXY XX"}],then:"PROXY IN.POOL_lum_in_shared"}]},mxplayer_in:{match:{root_urls:["mxplayer.in"],rules:[{proxy_country:["IN"],cmds:[{root_urls:["mxplayer.in"],if:[{host:"(?:google-analytics\\.com|analytics\\.twitter\\.com|googleadservices\\.com|p\\.adsymptotic\\.com|googletagmanager\\.com|bat\\.bing\\.com|adservice\\.google\\.com|doubleclick\\.net|gstatic\\.com|googlesyndication\\.com|2mdn\\.net|q\\.quora\\.com|analytics\\.edgekey\\.net|amazon-adsystem\\.com|users\\.quantumgraph\\.com|images-na\\.ssl-images-amazon\\.com|bh\\.contextweb\\.com|pixel-sync\\.sitescout\\.com|ads-twitter\\.com|googletagservices\\.com|scorecardresearch\\.com|outbrain\\.com|cdnjs\\.cloudflare\\.com|adservice\\.google\\.com\\.pk|adservice\\.google\\.com\\.ph|adroll\\.com|analytics\\.yahoo\\.com|spl\\.zeotap\\.com|a-ads\\.com|google\\.com|google\\.co\\.in|facebook\\.com|facebook\\.net|t\\.co|rubiconproject\\.com|google\\.com\\.bd|mixpanel\\.com|go-mpulse\\.net|google\\.com\\.au|googleapis\\.com)$",type:"=~",then:"PROXY XX"}],then:"PROXY IN.POOL_lum_in_shared"}]}]},cmds:[{root_urls:["mxplayer.in"],if:[{host:"(?:google-analytics\\.com|analytics\\.twitter\\.com|googleadservices\\.com|p\\.adsymptotic\\.com|googletagmanager\\.com|bat\\.bing\\.com|adservice\\.google\\.com|doubleclick\\.net|gstatic\\.com|googlesyndication\\.com|2mdn\\.net|q\\.quora\\.com|analytics\\.edgekey\\.net|amazon-adsystem\\.com|users\\.quantumgraph\\.com|images-na\\.ssl-images-amazon\\.com|bh\\.contextweb\\.com|pixel-sync\\.sitescout\\.com|ads-twitter\\.com|googletagservices\\.com|scorecardresearch\\.com|outbrain\\.com|cdnjs\\.cloudflare\\.com|adservice\\.google\\.com\\.pk|adservice\\.google\\.com\\.ph|adroll\\.com|analytics\\.yahoo\\.com|spl\\.zeotap\\.com|a-ads\\.com|google\\.com|google\\.co\\.in|facebook\\.com|facebook\\.net|t\\.co|rubiconproject\\.com|google\\.com\\.bd|mixpanel\\.com|go-mpulse\\.net|google\\.com\\.au|googleapis\\.com)$",type:"=~",then:"PROXY XX"}],then:"PROXY IN.POOL_lum_in_shared"}]},huurwoningen_nl:{match:{root_urls:["huurwoningen.nl"],rules:[{proxy_country:["NL"],cmds:[{root_urls:["huurwoningen.nl"],then:"PROXY NL.POOL_lum_nl_shared",if:[]}]}]},cmds:[{root_urls:["huurwoningen.nl"],then:"PROXY NL.POOL_lum_nl_shared",if:[]}]},videoland_com:{match:{root_urls:["videoland.com","v2.videoland.com"],rules:[{proxy_country:["NL"],cmds:[{hosts:["geo.videoland.bedrock.tech"],then:"PROXY NL.POOL_lum_nl_shared",if:[]},{root_urls:["videoland.com","v2.videoland.com"],then:"PROXY NL.POOL_lum_nl_shared",if:[]}]}]},cmds:[{hosts:["geo.videoland.bedrock.tech"],then:"PROXY NL.POOL_lum_nl_shared",if:[]},{root_urls:["videoland.com","v2.videoland.com"],then:"PROXY NL.POOL_lum_nl_shared",if:[]}]},nos_nl:{match:{root_urls:["nos.nl"],rules:[{proxy_country:["NL"],cmds:[{root_urls:["nos.nl"],then:"PROXY NL.POOL_lum_nl_shared",if:[]},{hosts:["resolver.streaming.api.nos.nl","cdn.streamgate.nl"],then:"PROXY NL.PEER",if:[]},{hosts:["npo.nl","npostreaming.nl"],then:"PROXY NL.POOL_lum_nl_shared",if:[]}]}]},cmds:[{root_urls:["nos.nl"],then:"PROXY NL.POOL_lum_nl_shared",if:[]},{hosts:["resolver.streaming.api.nos.nl","cdn.streamgate.nl"],then:"PROXY NL.PEER",if:[]},{hosts:["npo.nl","npostreaming.nl"],then:"PROXY NL.POOL_lum_nl_shared",if:[]}]},kakao_com:{match:{root_urls:["kakao.com"],rules:[{proxy_country:["IT"],cmds:[{root_urls:["kakao.com"],then:"PROXY IT.POOL_lum_it_shared",if:[]}]},{proxy_country:["CA"],cmds:[{root_urls:["kakao.com"],then:"PROXY CA.POOL_lum_ca_shared"}]},{proxy_country:["GB"],cmds:[{root_urls:["kakao.com"],then:"PROXY GB.POOL_lum_gb_shared"}]},{proxy_country:["NL"],cmds:[{root_urls:["kakao.com"],then:"PROXY NL.POOL_lum_nl_shared"}]},{proxy_country:["FR"],cmds:[{root_urls:["kakao.com"],then:"PROXY FR.POOL_lum_fr_shared"}]},{proxy_country:["ES"],cmds:[{root_urls:["kakao.com"],then:"PROXY ES.POOL_lum_es_shared"}]},{proxy_country:["US"],cmds:[{root_urls:["kakao.com"],then:"PROXY US.POOL_lum_us_shared"}]},{proxy_country:["KR"],cmds:[{root_urls:["kakao.com"],then:"PROXY KR.POOL_lum_kr_shared"}]},{proxy_country:["BR"],cmds:[{root_urls:["kakao.com"],then:"PROXY BR.POOL_lum_br_shared"}]}]},cmds:[{root_urls:["kakao.com"],then:"PROXY IT.POOL_lum_it_shared",if:[]}]},npostart_nl:{match:{root_urls:["npostart.nl"],rules:[{proxy_country:["NL"],cmds:[{hosts:["npostart.nl","cdn.streamgate.nl","nepworldwide.nl","npo.prd.cdn.bcms.kpn.com","atconnect.npo.nl","start-player.npo.nl","tellerapi.npo.nl"],then:"PROXY NL.PEER",if:[]}]}]},cmds:[{hosts:["npostart.nl","cdn.streamgate.nl","nepworldwide.nl","npo.prd.cdn.bcms.kpn.com","atconnect.npo.nl","start-player.npo.nl","tellerapi.npo.nl"],then:"PROXY NL.PEER",if:[]}]},steampowered_com:{match:{root_urls:["steampowered.com"],rules:[{proxy_country:["IT"],cmds:[{root_urls:["steampowered.com"],then:"PROXY IT.POOL_lum_it_shared",if:[]}]},{proxy_country:["CA"],cmds:[{root_urls:["steampowered.com"],then:"PROXY CA.POOL_lum_ca_shared"}]},{proxy_country:["GB"],cmds:[{root_urls:["steampowered.com"],then:"PROXY GB.POOL_lum_gb_shared"}]},{proxy_country:["NL"],cmds:[{root_urls:["steampowered.com"],then:"PROXY NL.POOL_lum_nl_shared"}]},{proxy_country:["FR"],cmds:[{root_urls:["steampowered.com"],then:"PROXY FR.POOL_lum_fr_shared"}]},{proxy_country:["ES"],cmds:[{root_urls:["steampowered.com"],then:"PROXY ES.POOL_lum_es_shared"}]},{proxy_country:["US"],cmds:[{root_urls:["steampowered.com"],then:"PROXY US.POOL_lum_us_shared"}]},{proxy_country:["KR"],cmds:[{root_urls:["steampowered.com"],then:"PROXY KR.POOL_lum_kr_shared"}]},{proxy_country:["BR"],cmds:[{root_urls:["steampowered.com"],then:"PROXY BR.POOL_lum_br_shared"}]},{proxy_country:["NO","GR","DE","DK","SE","CL","SG","CH","EG","RU","PL","IE","CN","IL","AR","HU","BE","FI","MX","HR","SI","SK","TR","TW","TH","JM","VN","PE","PH","ID","RO","ZA","BG","AT","NZ","CZ","IS","PT","BZ","UA"],cmds:[{hosts:["steampowered.com","store.steampowered.com"],then:"PROXY XX.PEER"}]}]},cmds:[{root_urls:["steampowered.com"],then:"PROXY IT.POOL_lum_it_shared",if:[]}]},wormate_io:{match:{root_urls:["wormate.io"],rules:[{proxy_country:["IT"],cmds:[{root_urls:["wormate.io"],then:"PROXY IT.POOL_lum_it_shared",if:[]}]},{proxy_country:["CA"],cmds:[{root_urls:["wormate.io"],then:"PROXY CA.POOL_lum_ca_shared"}]},{proxy_country:["GB"],cmds:[{root_urls:["wormate.io"],then:"PROXY GB.POOL_lum_gb_shared"}]},{proxy_country:["NL"],cmds:[{root_urls:["wormate.io"],then:"PROXY NL.POOL_lum_nl_shared"}]},{proxy_country:["FR"],cmds:[{root_urls:["wormate.io"],then:"PROXY FR.POOL_lum_fr_shared"}]},{proxy_country:["ES"],cmds:[{root_urls:["wormate.io"],then:"PROXY ES.POOL_lum_es_shared"}]},{proxy_country:["US"],cmds:[{root_urls:["wormate.io"],then:"PROXY US.POOL_lum_us_shared"}]},{proxy_country:["KR"],cmds:[{root_urls:["wormate.io"],then:"PROXY KR.POOL_lum_kr_shared"}]},{proxy_country:["BR"],cmds:[{root_urls:["wormate.io"],then:"PROXY BR.POOL_lum_br_shared"}]}]},cmds:[{root_urls:["wormate.io"],then:"PROXY IT.POOL_lum_it_shared",if:[]}]},uol_com_br:{match:{root_urls:["uol.com.br"],rules:[{proxy_country:["BR"],cmds:[{root_urls:["uol.com.br"],then:"PROXY BR.POOL_lum_br_shared",if:[]}]}]},cmds:[{root_urls:["uol.com.br"],then:"PROXY BR.POOL_lum_br_shared",if:[]}]},metamask_io:{match:{root_urls:["metamask.io"],rules:[{proxy_country:["IT"],cmds:[{root_urls:["metamask.io"],then:"PROXY IT.POOL_lum_it_shared",if:[]}]},{proxy_country:["CA"],cmds:[{root_urls:["metamask.io"],then:"PROXY CA.POOL_lum_ca_shared"}]},{proxy_country:["GB"],cmds:[{root_urls:["metamask.io"],then:"PROXY GB.POOL_lum_gb_shared"}]},{proxy_country:["NL"],cmds:[{root_urls:["metamask.io"],then:"PROXY NL.POOL_lum_nl_shared"}]},{proxy_country:["FR"],cmds:[{root_urls:["metamask.io"],then:"PROXY FR.POOL_lum_fr_shared"}]},{proxy_country:["ES"],cmds:[{root_urls:["metamask.io"],then:"PROXY ES.POOL_lum_es_shared"}]},{proxy_country:["US"],cmds:[{root_urls:["metamask.io"],then:"PROXY US.POOL_lum_us_shared"}]},{proxy_country:["KR"],cmds:[{root_urls:["metamask.io"],then:"PROXY KR.POOL_lum_kr_shared"}]},{proxy_country:["BR"],cmds:[{root_urls:["metamask.io"],then:"PROXY BR.POOL_lum_br_shared"}]}]},cmds:[{root_urls:["metamask.io"],then:"PROXY IT.POOL_lum_it_shared",if:[]}]},globo_com:{match:{root_urls:["globo.com"],rules:[{proxy_country:["BR"],cmds:[{root_urls:["globo.com"],then:"PROXY BR.POOL_lum_br_shared",if:[]}]}]},cmds:[{root_urls:["globo.com"],then:"PROXY BR.POOL_lum_br_shared",if:[]}]},borderlands_com:{match:{root_urls:["borderlands.com"],rules:[{proxy_country:["IT"],cmds:[{root_urls:["borderlands.com"],then:"PROXY IT.POOL_lum_it_shared",if:[]}]},{proxy_country:["CA"],cmds:[{root_urls:["borderlands.com"],then:"PROXY CA.POOL_lum_ca_shared"}]},{proxy_country:["GB"],cmds:[{root_urls:["borderlands.com"],then:"PROXY GB.POOL_lum_gb_shared"}]},{proxy_country:["NL"],cmds:[{root_urls:["borderlands.com"],then:"PROXY NL.POOL_lum_nl_shared"}]},{proxy_country:["FR"],cmds:[{root_urls:["borderlands.com"],then:"PROXY FR.POOL_lum_fr_shared"}]},{proxy_country:["ES"],cmds:[{root_urls:["borderlands.com"],then:"PROXY ES.POOL_lum_es_shared"}]},{proxy_country:["US"],cmds:[{root_urls:["borderlands.com"],then:"PROXY US.POOL_lum_us_shared"}]},{proxy_country:["KR"],cmds:[{root_urls:["borderlands.com"],then:"PROXY KR.POOL_lum_kr_shared"}]},{proxy_country:["BR"],cmds:[{root_urls:["borderlands.com"],then:"PROXY BR.POOL_lum_br_shared"}]}]},cmds:[{root_urls:["borderlands.com"],then:"PROXY IT.POOL_lum_it_shared",if:[]}]},bet365_com:{match:{root_urls:["bet365.com"],rules:[{proxy_country:["GB"],cmds:[{root_urls:["bet365.com"],then:"PROXY GB.POOL_lum_gb_shared",if:[]}]},{proxy_country:["US"],cmds:[{root_urls:["bet365.com"],then:"PROXY US.POOL_lum_us_shared"}]}]},cmds:[{root_urls:["bet365.com"],then:"PROXY GB.POOL_lum_gb_shared",if:[]}]},totalwine_com:{match:{root_urls:["totalwine.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["www.totalwine.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]}]},cmds:[{hosts:["www.totalwine.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},lasestrellas_tv:{match:{root_urls:["lasestrellas_tv"],rules:[{proxy_country:["MX"],cmds:[{hosts:["onlymex-auth.televisa.com"],then:"PROXY MX.PEER",if:[]}]}]},cmds:[{hosts:["onlymex-auth.televisa.com"],then:"PROXY MX.PEER",if:[]}]},criteo_com:{match:{root_urls:["criteo.com"],rules:[{cmds:[{hosts:["criteo.com"],then:"PROXY XX",if:[]}]}]},cmds:[{hosts:["criteo.com"],then:"PROXY XX",if:[]}]},target_com:{match:{root_urls:["target.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["gsp.target.com","login.target.com"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{hosts:["gsp.target.com","login.target.com"],then:"PROXY US.PEER",if:[]}]},atv_at:{match:{root_urls:["atv.at"],rules:[{proxy_country:["AT"],cmds:[{hosts:["blocked-multiscreen.atv.cdn.tvnext.tv"],then:"PROXY AT.PEER",if:[]}]}]},cmds:[{hosts:["blocked-multiscreen.atv.cdn.tvnext.tv"],then:"PROXY AT.PEER",if:[]}]},williams_sonoma_com:{match:{root_urls:["williams-sonoma.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["williams-sonoma.com"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{hosts:["williams-sonoma.com"],then:"PROXY US.PEER",if:[]}]},player_pl:{match:{root_urls:["player.pl"],rules:[{proxy_country:["PL"],cmds:[{hosts:["player.pl"],if:[{url:"\\/playerapi\\/product\\/.*\\/player\\/configuration.*",type:"!~",then:"PROXY PL"}],then:"PROXY PL.PEER"}]}]},cmds:[{hosts:["player.pl"],if:[{url:"\\/playerapi\\/product\\/.*\\/player\\/configuration.*",type:"!~",then:"PROXY PL"}],then:"PROXY PL.PEER"}]},bigbrothercanada_ca:{match:{root_urls:["bigbrothercanada.ca"],rules:[{proxy_country:["CA"],cmds:[{hosts:["livestream.com","playback.akamaized.net","playback2.akamaized.net","global.corusappservices.com","bigbrothercanada.ca"],then:"PROXY CA.PEER",if:[]}]}]},cmds:[{hosts:["livestream.com","playback.akamaized.net","playback2.akamaized.net","global.corusappservices.com","bigbrothercanada.ca"],then:"PROXY CA.PEER",if:[]}]},backcountry_com:{match:{root_urls:["backcountry.com"],rules:[{proxy_country:["US"],cmds:[{root_urls:["backcountry.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]}]},cmds:[{root_urls:["backcountry.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},eclinicalweb_com:{match:{root_urls:["eclinicalweb.com"],rules:[{proxy_country:["US"],cmds:[{root_urls:["eclinicalweb.com"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{root_urls:["eclinicalweb.com"],then:"PROXY US.PEER",if:[]}]},sweetgreen_com:{match:{root_urls:["sweetgreen.com"],rules:[{proxy_country:["US"],cmds:[{root_urls:["sweetgreen.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]}]},cmds:[{root_urls:["sweetgreen.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},carvana_com:{proxy_country:["US"],cmds:[{root_urls:["carvana.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},investopedia_com:{match:{root_urls:["investopedia.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["trafficguardapp.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]}]},cmds:[{hosts:["trafficguardapp.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},orf_at:{match:{root_urls:["orf.at"],rules:[{proxy_country:["AT"],cmds:[{hosts:["apasfiis.sf.apa.at","apasfpd.sf.apa.at","api-tvthek.orf.at","orf2.mdn.ors.at","orfs.mdn.ors.at"],then:"PROXY AT.PEER",if:[]}]}]},cmds:[{hosts:["apasfiis.sf.apa.at","apasfpd.sf.apa.at","api-tvthek.orf.at","orf2.mdn.ors.at","orfs.mdn.ors.at"],then:"PROXY AT.PEER",if:[]}]},servustv_com:{match:{root_urls:["servustv.com"],rules:[{proxy_country:["AT"],cmds:[{hosts:["stv-live.akamaized.net","rbmn-live.akamaized.net"],then:"PROXY AT.PEER",if:[]}]}]},cmds:[{hosts:["stv-live.akamaized.net","rbmn-live.akamaized.net"],then:"PROXY AT.PEER",if:[]}]},mol_gov_sa:{match:{root_urls:["mol.gov.sa"],rules:[{proxy_country:["SA"],cmds:[{hosts:["mol.gov.sa"],then:"PROXY SA.PEER",if:[]}]}]},cmds:[{hosts:["mol.gov.sa"],then:"PROXY SA.PEER",if:[]}]},lsm_lv:{match:{root_urls:["lsm.lv"],rules:[{proxy_country:["LV"],cmds:[{hosts:["ltv.lsm.lv","embed.cloudycdn.services","ltv1060.cloudycdn.services","ltv2060.cloudycdn.services"],then:"PROXY LV.PEER",if:[]}]}]},cmds:[{hosts:["ltv.lsm.lv","embed.cloudycdn.services","ltv1060.cloudycdn.services","ltv2060.cloudycdn.services"],then:"PROXY LV.PEER",if:[]}]},eidf_co_kr:{match:{root_urls:["eidf.co.kr"],rules:[{proxy_country:["KR"],cmds:[{hosts:["www.eidf.co.kr"],then:"PROXY KR.POOL_lum_kr_shared",if:[]}]}]},cmds:[{hosts:["www.eidf.co.kr"],then:"PROXY KR.POOL_lum_kr_shared",if:[]}]},abercrombie_com:{proxy_country:["US"],cmds:[{root_urls:["abercrombie.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},amazon_com:{match:{root_urls:["amazon.com"],rules:[{proxy_country:["AU","CO","IT","CA","NL","FR","ES","US","KR","BR"],cmds:[{root_urls:["amazon.com"],if:[{host:"d2y5sgsy8bbmb8.cloudfront.net",type:"==",then:"PROXY US.PEER"},{host:"cloudfront\\.net$",type:"=~",then:"PROXY XX"}],then:"PROXY XX.PEER"},{hosts:["amazon-adsystem.com","images-na.ssl-images-amazon.com"],then:"PROXY XX",if:[]},{hosts:["amazon.com","api.amazonvideo.com","atv-ps.amazon.com","media-amazon.com","api.eu-west-1.aiv-delivery.net","a41avoddashs3ww-a.akamaihd.net","d2y5sgsy8bbmb8.cloudfront.net","api.us-east-1.aiv-delivery.net","merch.amazon.com","www.amazon.com"],then:"PROXY XX.PEER",if:[]}]}]}},amazon_co_uk:{match:{root_urls:["amazon.co.uk"],rules:[{proxy_country:["GB"],cmds:[{root_urls:["amazon.co.uk"],then:"PROXY GB.POOL_lum_gb_shared",if:[]},{hosts:["amazon.com","api.amazonvideo.com"],then:"PROXY GB.POOL_lum_gb_shared",if:[]}]}]},cmds:[{root_urls:["amazon.co.uk"],then:"PROXY GB.POOL_lum_gb_shared",if:[]},{hosts:["amazon.com","api.amazonvideo.com"],then:"PROXY GB.POOL_lum_gb_shared",if:[]}]},amazon_de:{match:{root_urls:["amazon.de"],rules:[{proxy_country:["DE"],cmds:[{hosts:["www.amazon.de","atv-ps-eu.amazon.de"],then:"PROXY DE.PEER",if:[]}]}]},cmds:[{hosts:["www.amazon.de","atv-ps-eu.amazon.de"],then:"PROXY DE.PEER",if:[]}]},amazon_co_jp:{match:{root_urls:["amazon.co.jp"],rules:[{proxy_country:["JP"],cmds:[{hosts:["www.amazon.co.jp","atv-ps-fe.amazon.co.jp"],then:"PROXY JP.PEER",if:[]}]}]},cmds:[{hosts:["www.amazon.co.jp","atv-ps-fe.amazon.co.jp"],then:"PROXY JP.PEER",if:[]}]},ondemandkorea_com:{proxy_country:["US"],cmds:[{root_urls:["ondemandkorea.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},eastbay_com:{proxy_country:["US"],cmds:[{hosts:["eastbay.com"],then:"PROXY US.PEER",if:[]}]},origin_com:{proxy_country:["US"],cmds:[{root_urls:["origin.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},disneyplus_com:{match:{root_urls:["disneyplus.com"],rules:[{proxy_country:["IT"],cmds:[{hosts:["global.edge.bamgrid.com","sdk.iad-03.braze.com","disney.api.edge.bamgrid.com","dialacrum.iad-03.braze.com","disney.demdex.net","disney.connections.edge.bamgrid.com","disney.content.edge.bamgrid.com","disney.playback.edge.bamgrid.com","star.api.edge.bamgrid.com"],then:"PROXY IT.PEER",if:[]},{root_urls:["disneyplus.com"],then:"PROXY IT.POOL_lum_it_shared",if:[]},{hosts:["disneyplus.com","www.disneyplus.com","svcs.dssott.com","egisterdisney.go.com","disney-plus.net"],then:"PROXY IT.POOL_lum_it_shared",if:[]}]},{proxy_country:["CA"],cmds:[{hosts:["global.edge.bamgrid.com","sdk.iad-03.braze.com","disney.api.edge.bamgrid.com","dialacrum.iad-03.braze.com","disney.demdex.net","disney.connections.edge.bamgrid.com","disney.content.edge.bamgrid.com","disney.playback.edge.bamgrid.com","star.api.edge.bamgrid.com"],then:"PROXY CA.PEER"},{root_urls:["disneyplus.com"],then:"PROXY CA.POOL_lum_ca_shared"},{hosts:["disneyplus.com","www.disneyplus.com","svcs.dssott.com","egisterdisney.go.com","disney-plus.net"],then:"PROXY CA.POOL_lum_ca_shared"}]},{proxy_country:["GB"],cmds:[{hosts:["global.edge.bamgrid.com","sdk.iad-03.braze.com","disney.api.edge.bamgrid.com","dialacrum.iad-03.braze.com","disney.demdex.net","disney.connections.edge.bamgrid.com","disney.content.edge.bamgrid.com","disney.playback.edge.bamgrid.com","star.api.edge.bamgrid.com"],then:"PROXY GB.PEER"},{root_urls:["disneyplus.com"],then:"PROXY GB.POOL_lum_gb_shared"},{hosts:["disneyplus.com","www.disneyplus.com","svcs.dssott.com","egisterdisney.go.com","disney-plus.net"],then:"PROXY GB.POOL_lum_gb_shared"}]},{proxy_country:["NL"],cmds:[{hosts:["global.edge.bamgrid.com","sdk.iad-03.braze.com","disney.api.edge.bamgrid.com","dialacrum.iad-03.braze.com","disney.demdex.net","disney.connections.edge.bamgrid.com","disney.content.edge.bamgrid.com","disney.playback.edge.bamgrid.com","star.api.edge.bamgrid.com"],then:"PROXY NL.PEER"},{root_urls:["disneyplus.com"],then:"PROXY NL.POOL_lum_nl_shared"},{hosts:["disneyplus.com","www.disneyplus.com","svcs.dssott.com","egisterdisney.go.com","disney-plus.net"],then:"PROXY NL.POOL_lum_nl_shared"}]},{proxy_country:["FR"],cmds:[{hosts:["global.edge.bamgrid.com","sdk.iad-03.braze.com","disney.api.edge.bamgrid.com","dialacrum.iad-03.braze.com","disney.demdex.net","disney.connections.edge.bamgrid.com","disney.content.edge.bamgrid.com","disney.playback.edge.bamgrid.com","star.api.edge.bamgrid.com"],then:"PROXY FR.PEER"},{root_urls:["disneyplus.com"],then:"PROXY FR.POOL_lum_fr_shared"},{hosts:["disneyplus.com","www.disneyplus.com","svcs.dssott.com","egisterdisney.go.com","disney-plus.net"],then:"PROXY FR.POOL_lum_fr_shared"}]},{proxy_country:["ES"],cmds:[{hosts:["global.edge.bamgrid.com","sdk.iad-03.braze.com","disney.api.edge.bamgrid.com","dialacrum.iad-03.braze.com","disney.demdex.net","disney.connections.edge.bamgrid.com","disney.content.edge.bamgrid.com","disney.playback.edge.bamgrid.com","star.api.edge.bamgrid.com"],then:"PROXY ES.PEER"},{root_urls:["disneyplus.com"],then:"PROXY ES.POOL_lum_es_shared"},{hosts:["disneyplus.com","www.disneyplus.com","svcs.dssott.com","egisterdisney.go.com","disney-plus.net"],then:"PROXY ES.POOL_lum_es_shared"}]},{proxy_country:["US"],cmds:[{hosts:["global.edge.bamgrid.com","sdk.iad-03.braze.com","disney.api.edge.bamgrid.com","dialacrum.iad-03.braze.com","disney.demdex.net","disney.connections.edge.bamgrid.com","disney.content.edge.bamgrid.com","disney.playback.edge.bamgrid.com","star.api.edge.bamgrid.com"],then:"PROXY US.PEER"},{root_urls:["disneyplus.com"],then:"PROXY US.POOL_lum_us_shared"},{hosts:["disneyplus.com","www.disneyplus.com","svcs.dssott.com","egisterdisney.go.com","disney-plus.net"],then:"PROXY US.POOL_lum_us_shared"}]},{proxy_country:["HK"],cmds:[{hosts:["global.edge.bamgrid.com","sdk.iad-03.braze.com","disney.api.edge.bamgrid.com","dialacrum.iad-03.braze.com","disney.demdex.net","disney.connections.edge.bamgrid.com","disney.content.edge.bamgrid.com","disney.playback.edge.bamgrid.com","star.api.edge.bamgrid.com"],then:"PROXY HK.PEER"},{root_urls:["disneyplus.com"],then:"PROXY HK.PEER"},{hosts:["disneyplus.com","www.disneyplus.com","svcs.dssott.com","egisterdisney.go.com","disney-plus.net"],then:"PROXY HK.PEER"}]},{proxy_country:["KR"],cmds:[{hosts:["global.edge.bamgrid.com","sdk.iad-03.braze.com","disney.api.edge.bamgrid.com","dialacrum.iad-03.braze.com","disney.demdex.net","disney.connections.edge.bamgrid.com","disney.content.edge.bamgrid.com","disney.playback.edge.bamgrid.com","star.api.edge.bamgrid.com"],then:"PROXY KR.PEER"},{root_urls:["disneyplus.com"],then:"PROXY KR.POOL_lum_kr_shared"},{hosts:["disneyplus.com","www.disneyplus.com","svcs.dssott.com","egisterdisney.go.com","disney-plus.net"],then:"PROXY KR.POOL_lum_kr_shared"}]},{proxy_country:["BR"],cmds:[{hosts:["global.edge.bamgrid.com","sdk.iad-03.braze.com","disney.api.edge.bamgrid.com","dialacrum.iad-03.braze.com","disney.demdex.net","disney.connections.edge.bamgrid.com","disney.content.edge.bamgrid.com","disney.playback.edge.bamgrid.com","star.api.edge.bamgrid.com"],then:"PROXY BR.PEER"},{root_urls:["disneyplus.com"],then:"PROXY BR.POOL_lum_br_shared"},{hosts:["disneyplus.com","www.disneyplus.com","svcs.dssott.com","egisterdisney.go.com","disney-plus.net"],then:"PROXY BR.POOL_lum_br_shared"}]},{proxy_country:["JP"],cmds:[{hosts:["global.edge.bamgrid.com","sdk.iad-03.braze.com","disney.api.edge.bamgrid.com","dialacrum.iad-03.braze.com","disney.demdex.net","disney.connections.edge.bamgrid.com","disney.content.edge.bamgrid.com","disney.playback.edge.bamgrid.com","star.api.edge.bamgrid.com"],then:"PROXY JP.PEER"},{root_urls:["disneyplus.com"],then:"PROXY JP.PEER"},{hosts:["disneyplus.com","www.disneyplus.com","svcs.dssott.com","egisterdisney.go.com","disney-plus.net"],then:"PROXY JP.PEER"}]},{proxy_country:["IN"],cmds:[{hosts:["global.edge.bamgrid.com","sdk.iad-03.braze.com","disney.api.edge.bamgrid.com","dialacrum.iad-03.braze.com","disney.demdex.net","disney.connections.edge.bamgrid.com","disney.content.edge.bamgrid.com","disney.playback.edge.bamgrid.com","star.api.edge.bamgrid.com"],then:"PROXY IN.PEER"},{root_urls:["disneyplus.com"],then:"PROXY IN.POOL_lum_in_shared"},{hosts:["disneyplus.com","www.disneyplus.com","svcs.dssott.com","egisterdisney.go.com","disney-plus.net"],then:"PROXY IN.POOL_lum_in_shared"}]},{proxy_country:["NO","GR","DE","DK","SE","CL","SG","CH","EG","RU","PL","IE","CN","IL","AR","HU","BE","FI","MX","HR","SI","SK","TR","TW","TH","JM","VN","PE","PH","ID","RO","ZA","BG","AT","NZ","CZ","IS","PT","BZ","UA"],cmds:[{hosts:["global.edge.bamgrid.com","sdk.iad-03.braze.com","disney.api.edge.bamgrid.com","dialacrum.iad-03.braze.com","disney.demdex.net","disney.connections.edge.bamgrid.com","disney.content.edge.bamgrid.com","disney.playback.edge.bamgrid.com","star.api.edge.bamgrid.com"],then:"PROXY XX.PEER"},{root_urls:["disneyplus.com"],then:"PROXY XX.PEER"},{hosts:["disneyplus.com","www.disneyplus.com","svcs.dssott.com","egisterdisney.go.com","disney-plus.net"],then:"PROXY XX.PEER"}]}]}},hbonow_com:{match:{root_urls:["hbonow.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["comet.api.hbo.com","play.hbonow.com"],then:"PROXY US.PEER",if:[]},{root_urls:["hbonow.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]}]}},hbomax_com:{match:{root_urls:["hbomax.com"],rules:[{proxy_country:["US"],cmds:[{client_only:true,hosts:["google.com","googleapis.com"],then:"DIRECT",if:[]},{root_urls:["hbomax.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},{proxy_country:["BR"],cmds:[{root_urls:["hbomax.com"],then:"PROXY BR.POOL_lum_br_shared"}]},{proxy_country:["AR","AT","AU","BE","BG","BR","CA","CH","CL","CO","CZ","DE","DK","ES","FI","FR","GB","GR","HK","HR","HU","ID","IE","IL","IN","IT","IS","JP","KR","MX","NL","NO","NZ","PL","RO","RU","SE","SG","SK","TR","US","NO","GR","DE","DK","SE","CL","SG","CH","EG","RU","PL","IE","CN","IL","AR","HU","BE","FI","MX","HR","SI","SK","TR","TW","TH","JM","VN","PE","PH","ID","RO","ZA","BG","AT","NZ","CZ","IS","PT","BZ","UA"],cmds:[{hosts:["gateway.api.hbo.com","comet.api.hbo.com","play.hbonow.com","oauth.api.hbo.com","oauth-emea.api.hbo.com","oauth-us.api.hbo.com","gateway-latam.api.hbo.com","telegraph.api.hbo.com","sessions.api.hbo.com","comet-latam.api.hbo.com","api.hbo.com"],then:"PROXY XX.PEER"}]}]}},cbs_com:{match:{root_urls:["cbs.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["cbsivideo.com","cbsaavideo.com","link.theplatform.com"],then:"PROXY US.POOL_lum_us_shared",if:[]},{root_urls:["cbs.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]}]},cmds:[{hosts:["cbsivideo.com","cbsaavideo.com","link.theplatform.com"],then:"PROXY US.POOL_lum_us_shared",if:[]},{root_urls:["cbs.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},canalplus_com:{proxy_country:["FR"],cmds:[{root_urls:["canalplus.com"],then:"PROXY FR.POOL_lum_fr_shared",if:[]}]},liverugby_net:{proxy_country:["GB"],cmds:[{root_urls:["liverugby.net"],then:"PROXY GB.POOL_lum_gb_shared",if:[]}]},zagonka_tv:{proxy_country:["GB"],cmds:[{root_urls:["zagonka.tv"],then:"PROXY GB.PEER",if:[]}]},areena_yle_fi:{match:{root_urls:["areena.yle.fi"],rules:[{proxy_country:["FI"],cmds:[{hosts:["locations.api.yle.fi"],then:"PROXY FI.PEER",if:[]}]}]},cmds:[{hosts:["locations.api.yle.fi"],then:"PROXY FI.PEER",if:[]}]},bbc_co_uk:{match:{root_urls:["bbc.co.uk","bbc.com"],rules:[{proxy_country:["GB"],cmds:[{hosts:["fig.bbc.co.uk","open.live.bbc.co.uk"],then:"PROXY GB.PEER",if:[]},{hosts:["bbc.co.uk","bbc.com"],then:"PROXY GB.PEER",if:[]},{hosts:["bbci.co.uk","live.cf.md.bbci.co.uk","files.bbci.co.uk","account.bbc.com","api.bbc.co.uk","ssl.bbc.co.uk","vod-dash-uk-live.bbcfmt.hs.llnwd.net","vod-thumb-uk-live.bbcfmt.hs.llnwd.net","vs-dash-uk-live.bbcfmt.hs.llnwd.net","vod-sub-uk-live.bbcfmt.hs.llnwd.net","bbcfmt.hs.llnwd.net","bbcfmt.s.llnwi.net","s.loris.llnwd.net","vod-thumb-uk-live.akamaized.net","vs-dash-uk-live.akamaized.net","aod-dash-uk-live.akamaized.net","cf.md.bbci.co.uk","www.bbc.co.uk","vod-dash-uk-live.akamaized.net","as-dash-uk-live.akamaized.net","bidi.bbc.co.uk","bidi.live.bbc.co.uk","live.bidi.net.uk"],then:"PROXY GB.PEER",if:[]}],error_codes:[403]}]},cmds:[{hosts:["fig.bbc.co.uk","open.live.bbc.co.uk"],then:"PROXY GB.PEER",if:[]},{hosts:["bbc.co.uk","bbc.com"],then:"PROXY GB.PEER",if:[]},{hosts:["bbci.co.uk","live.cf.md.bbci.co.uk","files.bbci.co.uk","account.bbc.com","api.bbc.co.uk","ssl.bbc.co.uk","vod-dash-uk-live.bbcfmt.hs.llnwd.net","vod-thumb-uk-live.bbcfmt.hs.llnwd.net","vs-dash-uk-live.bbcfmt.hs.llnwd.net","vod-sub-uk-live.bbcfmt.hs.llnwd.net","bbcfmt.hs.llnwd.net","bbcfmt.s.llnwi.net","s.loris.llnwd.net","vod-thumb-uk-live.akamaized.net","vs-dash-uk-live.akamaized.net","aod-dash-uk-live.akamaized.net","cf.md.bbci.co.uk","www.bbc.co.uk","vod-dash-uk-live.akamaized.net","as-dash-uk-live.akamaized.net","bidi.bbc.co.uk","bidi.live.bbc.co.uk","live.bidi.net.uk"],then:"PROXY GB.PEER",if:[]}]},bergdorfgoodman_com:{proxy_country:["US"],cmds:[{root_urls:["bergdorfgoodman.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},channel4_com:{match:{root_urls:["channel4.com"],rules:[{proxy_country:["GB"],cmds:[{client_only:true,hosts:["google.com","googleapis.com"],then:"DIRECT",if:[]},{root_urls:["channel4.com"],if:[{url:".*check-email",type:"=~",then:"DIRECT"}],then:"PROXY GB.POOL_lum_gb_shared"},{hosts:["ais.channel4.com"],then:"PROXY GB.PEER",if:[]}]}]},cmds:[{client_only:true,hosts:["google.com","googleapis.com"],then:"DIRECT",if:[]},{root_urls:["channel4.com"],if:[{url:".*check-email",type:"=~",then:"DIRECT"}],then:"PROXY GB.POOL_lum_gb_shared"},{hosts:["ais.channel4.com"],then:"PROXY GB.PEER",if:[]}]},criterionchannel_com:{proxy_country:["US"],cmds:[{root_urls:["criterionchannel.com"],then:"PROXY US.PEER",if:[]}]},textnow_com:{match:{root_urls:["textnow.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["textnow.com"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{hosts:["textnow.com"],then:"PROXY US.PEER",if:[]}]},mangago_me:{match:{root_urls:["mangago.me"],rules:[{proxy_country:["US"],cmds:[{hosts:["mangago.me"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{hosts:["mangago.me"],then:"PROXY US.PEER",if:[]}]},javhd_pro:{match:{root_urls:["javhd.pro"],rules:[{proxy_country:["US"],cmds:[{hosts:["javhd.pro"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{hosts:["javhd.pro"],then:"PROXY US.PEER",if:[]}]},ustvgo_tv:{match:{root_urls:["ustvgo.tv"],rules:[{proxy_country:["IL"],cmds:[{hosts:["ustvgo.tv"],then:"PROXY IL.PEER",if:[]},{hosts:["useast.quantumdex.io","ustv24h.live"],then:"PROXY IL.PEER",if:[]}]}]},cmds:[{hosts:["ustvgo.tv"],then:"PROXY IL.PEER",if:[]},{hosts:["useast.quantumdex.io","ustv24h.live"],then:"PROXY IL.PEER",if:[]}]},hpjav_tv:{match:{root_urls:["hpjav.tv"],rules:[{proxy_country:["US"],cmds:[{hosts:["hpjav.tv"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{hosts:["hpjav.tv"],then:"PROXY US.PEER",if:[]}]},anybunny_tv:{match:{root_urls:["anybunny.tv"],rules:[{proxy_country:["US"],cmds:[{hosts:["anybunny.tv"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{hosts:["anybunny.tv"],then:"PROXY US.PEER",if:[]}]},warning_or_kr:{match:{root_urls:["warning.or.kr"],rules:[{proxy_country:["KR"],cmds:[{hosts:["warning.or.kr"],then:"PROXY KR.PEER",if:[]}]}]},cmds:[{hosts:["warning.or.kr"],then:"PROXY KR.PEER",if:[]}]},crunchyroll_com:{match:{root_urls:["crunchyroll.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["crunchyroll.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]}]},cmds:[{hosts:["crunchyroll.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},dazn_com:{match:{root_urls:["dazn.com"],rules:[{cmds:[{hosts:["isl.dazn.com","isl-ca.dazn.com","isl-eu.dazn.com","isl-jp.dazn.com","isl-us.dazn.com","indazn.com"],then:"PROXY XX.PEER",if:[]}]}]},cmds:[{hosts:["isl.dazn.com","isl-ca.dazn.com","isl-eu.dazn.com","isl-jp.dazn.com","isl-us.dazn.com","indazn.com"],then:"PROXY XX.PEER",if:[]}]},dr_dk:{proxy_country:["DK"],cmds:[{hosts:["www.dr.dk","drlive01hls.akamaized.net","drlive02hls.akamaized.net","drlive03hls.akamaized.net"],then:"PROXY DK.PEER",if:[]}]},eversource_com:{proxy_country:["US"],cmds:[{root_urls:["eversource.com"],then:"PROXY US.POOL_lum_us_shared",if:[]},{hosts:["i-doxs.net"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},espn_com_co:{match:{root_urls:["espn.com.co"],rules:[{proxy_country:["CO"],cmds:[{hosts:["tredir.espn.com"],then:"PROXY CO.POOL",if:[]},{root_urls:["espn.com.co"],then:"PROXY CO.POOL",if:[]}]}]},cmds:[{hosts:["tredir.espn.com"],then:"PROXY CO.POOL",if:[]},{root_urls:["espn.com.co"],then:"PROXY CO.POOL",if:[]}]},espn_com:{match:{root_urls:["espn.com"],rules:[{proxy_country:["ES"],cmds:[{hosts:["us.edge.bamgrid.com"],then:"PROXY ES.POOL_lum_es_shared",if:[]},{root_urls:["espn.com"],then:"PROXY ES.POOL_lum_es_shared",if:[]}]}]},cmds:[{hosts:["us.edge.bamgrid.com"],then:"PROXY ES.POOL_lum_es_shared",if:[]},{root_urls:["espn.com"],then:"PROXY ES.POOL_lum_es_shared",if:[]}]},fastpeoplesearch_com:{proxy_country:["US"],cmds:[{hosts:["fastpeoplesearch.com","www.fastpeoplesearch.com"],then:"PROXY US.PEER",if:[]},{client_only:true,hosts:["google.com","googleapis.com"],then:"DIRECT",if:[]}]},searchpeoplefree_com:{proxy_country:["US"],cmds:[{hosts:["searchpeoplefree.com","www.searchpeoplefree.com"],then:"PROXY US.PEER",if:[]},{client_only:true,hosts:["google.com","googleapis.com"],then:"DIRECT",if:[]}]},peoplesearchnow_com:{proxy_country:["US"],cmds:[{hosts:["peoplesearchnow.com","www.peoplesearchnow.com"],then:"PROXY US.PEER",if:[]},{client_only:true,hosts:["google.com","googleapis.com"],then:"DIRECT",if:[]}]},truepeoplesearch_com:{proxy_country:["US"],cmds:[{hosts:["truepeoplesearch.com","www.truepeoplesearch.com"],then:"PROXY US.PEER",if:[]},{client_only:true,hosts:["google.com","googleapis.com"],then:"DIRECT",if:[]}]},usphonebook_com:{proxy_country:["US"],cmds:[{hosts:["usphonebook.com","www.usphonebook.com"],then:"PROXY US.PEER",if:[]},{client_only:true,hosts:["google.com","googleapis.com"],then:"DIRECT",if:[]}]},ffsng_com:{proxy_country:["US"],cmds:[{hosts:["ffsng.com"],if:[{url:"ffsng\\.com\\/ajax\\.php",type:"!~",then:"PROXY US"}],then:"PROXY US.PEER"}]},finishline_com:{proxy_country:["US"],cmds:[{hosts:["finishline.com"],then:"PROXY US.PEER",if:[]}]},footlocker_com:{proxy_country:["US"],cmds:[{root_urls:["footlocker.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},ulta_com:{proxy_country:["US"],cmds:[{root_urls:["ulta.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},jsnx_net:{proxy_country:["US"],cmds:[{hosts:["jsnx.net"],then:"PROXY US.PEER",if:[]}]},cwtv_com:{match:{root_urls:["cwtv.com"],rules:[{proxy_country:["US"],cmds:[{root_urls:["cwtv.com"],then:"PROXY US.POOL_lum_us_shared",if:[]},{hosts:["cwtv-amd-akamai.akamaized.net"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{root_urls:["cwtv.com"],then:"PROXY US.POOL_lum_us_shared",if:[]},{hosts:["cwtv-amd-akamai.akamaized.net"],then:"PROXY US.PEER",if:[]}]},france_tv:{proxy_country:["FR"],cmds:[{hosts:["cloudreplay.ftven.fr","hdfauth.ftven.fr"],then:"PROXY FR.PEER",if:[]}]},francetvinfo_fr:{proxy_country:["FR"],cmds:[{root_urls:["francetvinfo.fr"],then:"PROXY FR.POOL_lum_fr_shared",if:[]}]},gamestop_com:{proxy_country:["US"],cmds:[{root_urls:["gamestop.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},globaltv_ca:{proxy_country:["CA"],cmds:[{root_urls:["globaltv.com"],then:"PROXY CA.POOL_lum_ca_shared",if:[]},{hosts:["global.corusappservices.com"],then:"PROXY CA.PEER",if:[]}]},bell_ca:{proxy_country:["CA"],cmds:[{root_urls:["bell.ca"],then:"PROXY CA.POOL_lum_ca_shared",if:[]}]},go_com:{match:{root_urls:["go.com"],rules:[{cmds:[{hosts:["go.com","prod.gatekeeper.us-abc.symphony.edgedatg.com"],then:"PROXY XX.PEER",if:[]}]}]},cmds:[{hosts:["go.com","prod.gatekeeper.us-abc.symphony.edgedatg.com"],then:"PROXY XX.PEER",if:[]}]},go_us:{proxy_country:["US"],cmds:[{hosts:["prod.gatekeeper.us-abc.symphony.edgedatg.go.com","prod.gatekeeper.us-abc.symphony.edgedatg.com"],then:"PROXY US.PEER",if:[]}]},starz_com:{match:{root_urls:["starz.com"],rules:[{cmds:[{hosts:["auth.starz.com","msrem.starz.com"],then:"PROXY XX.PEER",if:[]}]}]},cmds:[{hosts:["auth.starz.com","msrem.starz.com"],then:"PROXY XX.PEER",if:[]}]},cf_sites:{cmds:[{hosts:["rutracker.org","ashleymadison.com","myshopify.com","visa.com","uakino.club","tvoj-onlajn.ru","gleam.io","exelab.ru","king368.com"],then:"PROXY XX.PEER",if:[]}]},hbogo:{match:{root_urls:["hbogo.pl","hbogo.ro"],rules:[{cmds:[{hosts:["api.ugw.hbogo.eu"],if:[{url:"api\\.ugw\\.hbogo\\.eu\\/v3\\.0\\/(GeoCheck|Authentication\\/(POL|ROU))\\/(json|JSON).*",type:"!~",then:"PROXY XX"}],then:"PROXY XX.PEER"}]}]},cmds:[{hosts:["api.ugw.hbogo.eu"],if:[{url:"api\\.ugw\\.hbogo\\.eu\\/v3\\.0\\/(GeoCheck|Authentication\\/(POL|ROU))\\/(json|JSON).*",type:"!~",then:"PROXY XX"}],then:"PROXY XX.PEER"}]},hbogola_com:{match:{root_urls:["hbogola.com"],rules:[{proxy_country:["MX","PE","CO"],cmds:[{hosts:["globalapi.hbogola.com","ais.directvla.com"],then:"PROXY XX.PEER",if:[]}]}]},cmds:[{hosts:["globalapi.hbogola.com","ais.directvla.com"],then:"PROXY XX.PEER",if:[]}]},hbogo_com_br:{match:{root_urls:["hbogo.com.br"],rules:[{proxy_country:["BR"],cmds:[{hosts:["globalapi.hbogola.com"],then:"PROXY BR.PEER",if:[]}]}]},cmds:[{hosts:["globalapi.hbogola.com"],then:"PROXY BR.PEER",if:[]}]},movistarplay_com_pe:{match:{root_urls:["movistarplay.com.pe"],rules:[{proxy_country:["PE"],cmds:[{hosts:["movistarplay.com.pe","wvcypherdrm.gvp.telefonica.com"],then:"PROXY PE.PEER",if:[]}]}]},cmds:[{hosts:["movistarplay.com.pe","wvcypherdrm.gvp.telefonica.com"],then:"PROXY PE.PEER",if:[]}]},directvgo_com:{match:{root_urls:["directvgo.com"],rules:[{proxy_country:["PE"],cmds:[{hosts:["directvgo.com"],then:"PROXY PE.PEER",if:[]}]}]},cmds:[{hosts:["directvgo.com"],then:"PROXY PE.PEER",if:[]}]},elevensports_pt:{match:{root_urls:["elevensports.pt"],rules:[{proxy_country:["PT"],cmds:[{hosts:["elevensports.pt","dce-frontoffice.imggaming.com"],then:"PROXY PT.PEER",if:[]}]}]},cmds:[{hosts:["elevensports.pt","dce-frontoffice.imggaming.com"],then:"PROXY PT.PEER",if:[]}]},hollisterco_com:{proxy_country:["US"],cmds:[{root_urls:["hollisterco.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},hotstar_com:{proxy_country:["IN","GB"],cmds:[{root_urls:["hotstar.com"],if:[{host:"(?:google-analytics\\.com|analytics\\.twitter\\.com|googleadservices\\.com|p\\.adsymptotic\\.com|googletagmanager\\.com|bat\\.bing\\.com|adservice\\.google\\.com|doubleclick\\.net|gstatic\\.com|googlesyndication\\.com|2mdn\\.net|q\\.quora\\.com|analytics\\.edgekey\\.net|amazon-adsystem\\.com|users\\.quantumgraph\\.com|images-na\\.ssl-images-amazon\\.com|bh\\.contextweb\\.com|pixel-sync\\.sitescout\\.com|ads-twitter\\.com|googletagservices\\.com|scorecardresearch\\.com|outbrain\\.com|cdnjs\\.cloudflare\\.com|adservice\\.google\\.com\\.pk|adservice\\.google\\.com\\.ph|adroll\\.com|analytics\\.yahoo\\.com|spl\\.zeotap\\.com|a-ads\\.com|google\\.com|google\\.co\\.in|facebook\\.com|facebook\\.net|t\\.co|rubiconproject\\.com|google\\.com\\.bd|mixpanel\\.com|go-mpulse\\.net|google\\.com\\.au|googleapis\\.com)$",type:"=~",then:"DIRECT"}],then:"PROXY IN.POOL_lum_in_shared"},{hosts:["www.hotstar.com","services.hotstar.com","segment.hotstar.com","api.hotstar.com","geoip.hotstar.com","e6858.dsce9.akamaiedge.net","ma312-r.analytics.edgesuite.net","service.hotstar.com","persona.hotstar.com","secure-media.hotstar.com"],then:"PROXY IN.POOL_lum_in_shared",if:[]},{hosts:["hses1.akamaized.net","hses.akamaized.net","hses2.akamaized.net","ds-aksb-a.akamaihd.net","hesads.akamaized.net","hsdesinova.akamaized.net","hses3.akamaized.net","hses4.akamaized.net","staragvod-vh.akamaihd.net","hsdesinova.akamaized.net","hsprepack.akamaized.net","staragvod1-vh.akamaihd.net","staragvod2-vh.akamaihd.net","staragvod3-vh.akamaihd.net","staragdash.akamaized.net","hssportsprepack.akamaized.net","live11.akt.hotstar-cdn.net","live15p.hotstar.com","hses4.hotstar.com","hotstar.com","hsdashgec1.akamaized.net","hsdashgec2.akamaized.net","hsnewsprepack.akamaized.net"],then:"PROXY IN.POOL_lum_in_shared",if:[]},{hosts:["in-star.videoplaza.tv","hotstar.worldgravity.com"],then:"PROXY IN.POOL_lum_in_shared",if:[]}]},sevenplus_com_au:{proxy_country:["AU"],cmds:[{hosts:["sevennetwork.akamaized.net","live-sevennetwork.akamaized.net","7plus-sevennetwork.akamaized.net","npc-live-sevennetwork.akamaized.net"],then:"PROXY AU.PEER",if:[]},{root_urls:["7plus.com.au"],then:"PROXY AU.POOL",if:[]}]},hulu_com:{match:{root_urls:["hulu.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["play.hulu.com"],if:[{url:".*(\\.)?play\\.hulu\\.com\\/.*\\/playlist",type:"!~",then:"PROXY US.POOL_lum_us_shared"}],then:"PROXY US.PEER"},{hosts:["discover.hulu.com"],if:[{url:"discover\\.hulu\\.com\\/content\\/",type:"!~",then:"PROXY US.POOL_lum_us_shared"}],then:"PROXY US.PEER"},{hosts:["secure.hulu.com","auth.hulu.com"],then:"PROXY US.PEER",if:[]},{hosts:["hulu-lr.hb-api.omtrdc.net","cws-hulu.conviva.com"],then:"PROXY US.POOL_lum_us_shared",if:[]},{root_urls:["hulu.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]}]},cmds:[{hosts:["play.hulu.com"],if:[{url:".*(\\.)?play\\.hulu\\.com\\/.*\\/playlist",type:"!~",then:"PROXY US.POOL_lum_us_shared"}],then:"PROXY US.PEER"},{hosts:["discover.hulu.com"],if:[{url:"discover\\.hulu\\.com\\/content\\/",type:"!~",then:"PROXY US.POOL_lum_us_shared"}],then:"PROXY US.PEER"},{hosts:["secure.hulu.com","auth.hulu.com"],then:"PROXY US.PEER",if:[]},{hosts:["hulu-lr.hb-api.omtrdc.net","cws-hulu.conviva.com"],then:"PROXY US.POOL_lum_us_shared",if:[]},{root_urls:["hulu.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},hulu_jp:{match:{root_urls:["hulu.jp"],rules:[{proxy_country:["JP"],cmds:[{hosts:["api.happyon.jp"],if:[{url:"api\\.happyon\\.jp\\/v1\\/(auth\\/token|playback\\/video)",type:"!~",then:"PROXY JP"}],then:"PROXY JP.PEER"},{hosts:["hulu.jp"],if:[{url:"hulu\\.jp\\/(account|signup).*",type:"!~",then:"PROXY JP"}],then:"PROXY JP.PEER"},{hosts:["papi.prod.hjholdings.tv"],then:"PROXY JP.PEER",if:[]}]}]},cmds:[{hosts:["api.happyon.jp"],if:[{url:"api\\.happyon\\.jp\\/v1\\/(auth\\/token|playback\\/video)",type:"!~",then:"PROXY JP"}],then:"PROXY JP.PEER"},{hosts:["hulu.jp"],if:[{url:"hulu\\.jp\\/(account|signup).*",type:"!~",then:"PROXY JP"}],then:"PROXY JP.PEER"},{hosts:["papi.prod.hjholdings.tv"],then:"PROXY JP.PEER",if:[]}]},itv_com:{proxy_country:["GB"],cmds:[{hosts:["itv.com"],then:"PROXY GB.PEER",if:[]},{hosts:["magni.itv.com","edge.api.brightcove.com"],then:"PROXY GB.PEER",if:[]},{hosts:["itv.com","itvpnp.live.ott.irdeto.com","itvstatic.com","itvpnpdotcom-a.akamaihd.net","ssl-itvdotcom.2cnt.net","play.dar.itv.com","csm-e-itv-eb.play.dar.itv.com","itvpnpdotcom.cdn1.content.itv.com","itvpnp.live.ott.irdeto.com"],then:"PROXY GB.PEER",if:[]}],error_codes:[403]},iqiyi_com:{proxy_country:["CN"],cmds:[{hosts:["cache.video.iqiyi.com"],if:[{url:".*cache\\.video\\.iqiyi\\.com\\/dash.*",type:"!~",then:"PROXY CN"}],then:"PROXY CN.PEER"}]},iview_abc_net_au:{cmds:[{hosts:["api.iview.abc.net.au"],if:[{url:"api\\.iview\\.abc\\.net\\.au\\/v2\\/(video|token\\/drm)\\/.*",type:"!~",then:"PROXY AU.POOL"}],then:"PROXY AU.PEER"},{hosts:["abc-iview-mediapackagestreams-1.akamaized.net"],if:[{url:"abc-iview-mediapackagestreams-1\\.akamaized\\.net\\/out\\/v1\\/\\w+\\/index\\.mpd",type:"!~",then:"PROXY AU.POOL"}],then:"PROXY AU.PEER"},{hosts:["iview-vod.akamaized.net"],if:[{url:"iview-vod\\.akamaized\\.net\\/prod\\/ck1\\/\\w+\\/\\w+\\/mpegdash\\/master\\.mpd",type:"!~",then:"PROXY AU.POOL"}],then:"PROXY AU.PEER"}]},kaltura_com:{proxy_country:["FI"],cmds:[{hosts:["cdnapisec.kaltura.com","cdnsecakmi.kaltura.com"],then:"PROXY FI.PEER",if:[]}]},kbs_co_kr:{proxy_country:["KR"],cmds:[{root_urls:["kbs.co.kr"],then:"PROXY KR.POOL_lum_kr_shared",if:[]},{hosts:["onair.kbs.co.kr","vod.kbs.co.kr"],then:"PROXY KR.PEER",if:[]}]},manga_line_me:{proxy_country:["JP"],cmds:[{hosts:["manga.line.me"],then:"PROXY JP.PEER",if:[]}]},marcus_com:{proxy_country:["US"],cmds:[{root_urls:["marcus.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},meiliboxi_fi:{proxy_country:["FI"],cmds:[{hosts:["meiliboxi.fi"],then:"PROXY FI.PEER",if:[]}]},mitele_es:{match:{root_urls:["mitele.es"],rules:[{proxy_country:["ES"],cmds:[{root_urls:["mitele.es"],then:"PROXY ES.POOL_lum_es_shared",if:[]},{hosts:["vod.mitele.es"],then:"PROXY ES.POOL_lum_es_shared",if:[]},{hosts:["miteleooyala-vh.akamaihd.net","livehlsdai-i.akamaihd.net","cerbero.pro.3d99a4cb092e6d20ff56d80b9efd9a8f8802ec81.es","live.mitele.es","directos.mitele.es"],then:"PROXY ES.PEER",if:[]}]}]},cmds:[{root_urls:["mitele.es"],then:"PROXY ES.POOL_lum_es_shared",if:[]},{hosts:["vod.mitele.es"],then:"PROXY ES.POOL_lum_es_shared",if:[]},{hosts:["miteleooyala-vh.akamaihd.net","livehlsdai-i.akamaihd.net","cerbero.pro.3d99a4cb092e6d20ff56d80b9efd9a8f8802ec81.es","live.mitele.es","directos.mitele.es"],then:"PROXY ES.PEER",if:[]}]},my5_tv:{match:{root_urls:["my5.tv"],rules:[{proxy_country:["GB"],cmds:[{root_urls:["my5.tv"],then:"PROXY GB.POOL_lum_gb_shared",if:[]},{hosts:["cassie.channel5.com"],then:"PROXY GB.POOL_lum_gb_shared",if:[]}]}]},cmds:[{root_urls:["my5.tv"],then:"PROXY GB.POOL_lum_gb_shared",if:[]},{hosts:["cassie.channel5.com"],then:"PROXY GB.POOL_lum_gb_shared",if:[]}]},britbox_co_uk:{match:{root_urls:["britbox.co.uk"],rules:[{proxy_country:["GB"],cmds:[{root_urls:["my5.tv"],then:"PROXY GB.POOL_lum_gb_shared",if:[]},{hosts:["dotcomcontent.britbox.co.uk"],then:"PROXY GB.POOL_lum_gb_shared",if:[]}]}]},cmds:[{root_urls:["my5.tv"],then:"PROXY GB.POOL_lum_gb_shared",if:[]},{hosts:["dotcomcontent.britbox.co.uk"],then:"PROXY GB.POOL_lum_gb_shared",if:[]}]},naver_com:{match:{root_urls:["naver.com"],rules:[{proxy_country:["KR"],cmds:[{root_urls:["naver.com"],if:[{url:"(smartmediarep.com|pstatic.net|vrixon.com).*.(mp4|m3u8|ts)",type:"=~",then:"DIRECT"}],then:"PROXY XX"},{hosts:["apis.naver.com","api-gw.sports.naver.com"],then:"PROXY KR.PEER",if:[]}]}]},cmds:[{root_urls:["naver.com"],if:[{url:"(smartmediarep.com|pstatic.net|vrixon.com).*.(mp4|m3u8|ts)",type:"=~",then:"DIRECT"}],then:"PROXY XX"},{hosts:["apis.naver.com","api-gw.sports.naver.com"],then:"PROXY KR.PEER",if:[]}]},netflix_com:{match:{min_ver:"1.155.76",root_urls:["netflix.com"],rules:[{proxy_country:[],cmds:[{hosts:["netflixparty.com"],then:"DIRECT",if:[]},{root_urls:["netflix.com"],if:[],then:"PROXY XX.POOL"},{hosts:["anycast.ftl.netflix.com","assets.nflxext.com","oca-api.netflix.com","push.prod.netflix.com","nflxvideo.net","nflxvideo.com","nflximg.com","nflximg.net","nflxso.com","nflxso.net","nflxext.com","nflxext.net","netflix.com","netflix.net"],then:"PROXY XX.POOL",if:[]}]},{proxy_country:["NL"],cmds:[{hosts:["netflixparty.com"],then:"DIRECT"},{root_urls:["netflix.com"],if:[],then:"PROXY NL.PEER"},{hosts:["anycast.ftl.netflix.com","assets.nflxext.com","oca-api.netflix.com","push.prod.netflix.com","nflxvideo.net","nflxvideo.com","nflximg.com","nflximg.net","nflxso.com","nflxso.net","nflxext.com","nflxext.net","netflix.com","netflix.net"],then:"PROXY NL.PEER"}]},{proxy_country:["CA"],cmds:[{hosts:["netflixparty.com"],then:"DIRECT"},{root_urls:["netflix.com"],if:[],then:"PROXY CA.PEER"},{hosts:["anycast.ftl.netflix.com","assets.nflxext.com","oca-api.netflix.com","push.prod.netflix.com","nflxvideo.net","nflxvideo.com","nflximg.com","nflximg.net","nflxso.com","nflxso.net","nflxext.com","nflxext.net","netflix.com","netflix.net"],then:"PROXY CA.PEER"}]},{proxy_country:["GB"],cmds:[{hosts:["netflixparty.com"],then:"DIRECT"},{root_urls:["netflix.com"],if:[],then:"PROXY GB.PEER"},{hosts:["anycast.ftl.netflix.com","assets.nflxext.com","oca-api.netflix.com","push.prod.netflix.com","nflxvideo.net","nflxvideo.com","nflximg.com","nflximg.net","nflxso.com","nflxso.net","nflxext.com","nflxext.net","netflix.com","netflix.net"],then:"PROXY GB.PEER"}]},{proxy_country:["FR"],cmds:[{hosts:["netflixparty.com"],then:"DIRECT"},{root_urls:["netflix.com"],if:[],then:"PROXY FR.PEER"},{hosts:["anycast.ftl.netflix.com","assets.nflxext.com","oca-api.netflix.com","push.prod.netflix.com","nflxvideo.net","nflxvideo.com","nflximg.com","nflximg.net","nflxso.com","nflxso.net","nflxext.com","nflxext.net","netflix.com","netflix.net"],then:"PROXY FR.PEER"}]},{proxy_country:["IT"],cmds:[{hosts:["netflixparty.com"],then:"DIRECT"},{root_urls:["netflix.com"],if:[],then:"PROXY IT.PEER"},{hosts:["anycast.ftl.netflix.com","assets.nflxext.com","oca-api.netflix.com","push.prod.netflix.com","nflxvideo.net","nflxvideo.com","nflximg.com","nflximg.net","nflxso.com","nflxso.net","nflxext.com","nflxext.net","netflix.com","netflix.net"],then:"PROXY IT.PEER"}]},{proxy_country:["ES"],cmds:[{hosts:["netflixparty.com"],then:"DIRECT"},{root_urls:["netflix.com"],if:[],then:"PROXY ES.PEER"},{hosts:["anycast.ftl.netflix.com","assets.nflxext.com","oca-api.netflix.com","push.prod.netflix.com","nflxvideo.net","nflxvideo.com","nflximg.com","nflximg.net","nflxso.com","nflxso.net","nflxext.com","nflxext.net","netflix.com","netflix.net"],then:"PROXY ES.PEER"}]},{proxy_country:["US"],cmds:[{hosts:["netflixparty.com"],then:"DIRECT"},{root_urls:["netflix.com"],if:[],then:"PROXY US.PEER"},{hosts:["anycast.ftl.netflix.com","assets.nflxext.com","oca-api.netflix.com","push.prod.netflix.com","nflxvideo.net","nflxvideo.com","nflximg.com","nflximg.net","nflxso.com","nflxso.net","nflxext.com","nflxext.net","netflix.com","netflix.net"],then:"PROXY US.PEER"}]},{proxy_country:["KR"],cmds:[{hosts:["netflixparty.com"],then:"DIRECT"},{root_urls:["netflix.com"],if:[],then:"PROXY KR.PEER"},{hosts:["anycast.ftl.netflix.com","assets.nflxext.com","oca-api.netflix.com","push.prod.netflix.com","nflxvideo.net","nflxvideo.com","nflximg.com","nflximg.net","nflxso.com","nflxso.net","nflxext.com","nflxext.net","netflix.com","netflix.net"],then:"PROXY KR.PEER"}]},{proxy_country:["HK"],cmds:[{hosts:["netflixparty.com"],then:"DIRECT"},{root_urls:["netflix.com"],if:[],then:"PROXY HK.PEER"},{hosts:["anycast.ftl.netflix.com","assets.nflxext.com","oca-api.netflix.com","push.prod.netflix.com","nflxvideo.net","nflxvideo.com","nflximg.com","nflximg.net","nflxso.com","nflxso.net","nflxext.com","nflxext.net","netflix.com","netflix.net"],then:"PROXY HK.PEER"}]},{proxy_country:["JP"],cmds:[{hosts:["netflixparty.com"],then:"DIRECT"},{root_urls:["netflix.com"],if:[],then:"PROXY JP.PEER"},{hosts:["anycast.ftl.netflix.com","assets.nflxext.com","oca-api.netflix.com","push.prod.netflix.com","nflxvideo.net","nflxvideo.com","nflximg.com","nflximg.net","nflxso.com","nflxso.net","nflxext.com","nflxext.net","netflix.com","netflix.net"],then:"PROXY JP.PEER"}]},{proxy_country:["BR"],cmds:[{hosts:["netflixparty.com"],then:"DIRECT"},{root_urls:["netflix.com"],if:[],then:"PROXY BR.PEER"},{hosts:["anycast.ftl.netflix.com","assets.nflxext.com","oca-api.netflix.com","push.prod.netflix.com","nflxvideo.net","nflxvideo.com","nflximg.com","nflximg.net","nflxso.com","nflxso.net","nflxext.com","nflxext.net","netflix.com","netflix.net"],then:"PROXY BR.PEER"}]},{proxy_country:["IN"],cmds:[{hosts:["netflixparty.com"],then:"DIRECT"},{root_urls:["netflix.com"],if:[],then:"PROXY IN.POOL_lum_in_shared"},{hosts:["anycast.ftl.netflix.com","assets.nflxext.com","oca-api.netflix.com","push.prod.netflix.com","nflxvideo.net","nflxvideo.com","nflximg.com","nflximg.net","nflxso.com","nflxso.net","nflxext.com","nflxext.net","netflix.com","netflix.net"],then:"PROXY IN.POOL_lum_in_shared"}]},{proxy_country:["NO","GR","DE","DK","SE","CL","SG","CH","EG","RU","PL","IE","CN","IL","AR","HU","BE","FI","MX","HR","SI","SK","TR","TW","TH","JM","VN","PE","PH","ID","RO","ZA","BG","AT","NZ","CZ","IS","PT","BZ","UA","CO","AU"],cmds:[{hosts:["netflixparty.com"],then:"DIRECT"},{root_urls:["netflix.com"],if:[],then:"PROXY XX.PEER"},{hosts:["anycast.ftl.netflix.com","assets.nflxext.com","oca-api.netflix.com","push.prod.netflix.com","nflxvideo.net","nflxvideo.com","nflximg.com","nflximg.net","nflxso.com","nflxso.net","nflxext.com","nflxext.net","netflix.com","netflix.net"],then:"PROXY XX.PEER"}]}]},error_codes:[420]},ome_tv:{match:{root_urls:["ome.tv"],rules:[{proxy_country:["IT"],cmds:[{root_urls:["ome.tv"],then:"PROXY IT.POOL_lum_it_shared",if:[]},{hosts:["roulette.apps-host.com"],then:"PROXY IT.POOL_lum_it_shared",if:[]}]},{proxy_country:["CA"],cmds:[{root_urls:["ome.tv"],then:"PROXY CA.POOL_lum_ca_shared"},{hosts:["roulette.apps-host.com"],then:"PROXY CA.POOL_lum_ca_shared"}]},{proxy_country:["GB"],cmds:[{root_urls:["ome.tv"],then:"PROXY GB.POOL_lum_gb_shared"},{hosts:["roulette.apps-host.com"],then:"PROXY GB.POOL_lum_gb_shared"}]},{proxy_country:["NL"],cmds:[{root_urls:["ome.tv"],then:"PROXY NL.POOL_lum_nl_shared"},{hosts:["roulette.apps-host.com"],then:"PROXY NL.POOL_lum_nl_shared"}]},{proxy_country:["FR"],cmds:[{root_urls:["ome.tv"],then:"PROXY FR.POOL_lum_fr_shared"},{hosts:["roulette.apps-host.com"],then:"PROXY FR.POOL_lum_fr_shared"}]},{proxy_country:["ES"],cmds:[{root_urls:["ome.tv"],then:"PROXY ES.POOL_lum_es_shared"},{hosts:["roulette.apps-host.com"],then:"PROXY ES.POOL_lum_es_shared"}]},{proxy_country:["US"],cmds:[{root_urls:["ome.tv"],then:"PROXY US.POOL_lum_us_shared"},{hosts:["roulette.apps-host.com"],then:"PROXY US.POOL_lum_us_shared"}]},{proxy_country:["KR"],cmds:[{root_urls:["ome.tv"],then:"PROXY KR.POOL_lum_kr_shared"},{hosts:["roulette.apps-host.com"],then:"PROXY KR.POOL_lum_kr_shared"}]},{proxy_country:["BR"],cmds:[{root_urls:["ome.tv"],then:"PROXY BR.POOL_lum_br_shared"},{hosts:["roulette.apps-host.com"],then:"PROXY BR.POOL_lum_br_shared"}]},{proxy_country:["NO","GR","DE","DK","SE","CL","SG","CH","EG","RU","PL","IE","CN","IL","AR","HU","BE","FI","MX","HR","SI","SK","TR","TW","TH","JM","VN","PE","PH","ID","RO","ZA","BG","AT","NZ","CZ","IS","PT","BZ","UA"],cmds:[{hosts:["roulette.apps-host.com"],then:"PROXY XX.PEER"}]}]},cmds:[{root_urls:["ome.tv"],then:"PROXY IT.POOL_lum_it_shared",if:[]},{hosts:["roulette.apps-host.com"],then:"PROXY IT.POOL_lum_it_shared",if:[]}]},omegle_com:{cmds:[{hosts:["www.omegle.com"],then:"PROXY XX.PEER",if:[]},{hosts:["omegle.com"],if:[{url:".*front\\d+\\.omegle\\.com\\/icecandidate",type:"=~",then:"BLOCK"},{url:".*front\\d+\\.omegle\\.com\\/(start|status|events)",type:"!~",then:"PROXY XX"}],then:"PROXY XX.PEER"}]},raiplay_it:{match:{min_ver:"1.155.77",root_urls:["raiplay.it"],rules:[{proxy_country:["IT"],cmds:[{root_urls:["rai.it"],then:"PROXY IT.POOL_lum_it_shared",if:[]},{hosts:["mediapolisvod.rai.it","mediapolis.rai.it","mediapolisgs.rai.it","8e7439fdb1694c8da3a0fd63e4dda518.msvdn.net","raitre1-live.akamaized.net","raitre2-live.akamaized.net","raitre3-live.akamaized.net","raitre4-live.akamaized.net","raitre5-live.akamaized.net","raitre6-live.akamaized.net","raitre7-live.akamaized.net","raitre8-live.akamaized.net","raitre9-live.akamaized.net","raiuno1-live.akamaized.net","raiuno2-live.akamaized.net","raiuno3-live.akamaized.net","raiuno4-live.akamaized.net","raiuno5-live.akamaized.net","raiuno6-live.akamaized.net","raiuno7-live.akamaized.net","raiuno8-live.akamaized.net","raiuno9-live.akamaized.net","raidue1-live.akamaized.net","raidue2-live.akamaized.net","raidue3-live.akamaized.net","raidue4-live.akamaized.net","raidue5-live.akamaized.net","raidue6-live.akamaized.net","raidue7-live.akamaized.net","raidue8-live.akamaized.net","raidue9-live.akamaized.net","raipremium1-live.akamaized.net","raipremium2-live.akamaized.net","raipremium3-live.akamaized.net","raipremium4-live.akamaized.net","raipremium5-live.akamaized.net","raipremium6-live.akamaized.net","raipremium7-live.akamaized.net","raipremium8-live.akamaized.net","raipremium9-live.akamaized.net","raicinque1-live.akamaized.net","raicinque2-live.akamaized.net","raicinque3-live.akamaized.net","raicinque4-live.akamaized.net","raicinque5-live.akamaized.net","raicinque6-live.akamaized.net","raicinque7-live.akamaized.net","raicinque8-live.akamaized.net","raicinque9-live.akamaized.net","raimovie1-live.akamaized.net","raimovie2-live.akamaized.net","raimovie3-live.akamaized.net","raimovie4-live.akamaized.net","raimovie5-live.akamaized.net","raimovie6-live.akamaized.net","raimovie7-live.akamaized.net","raimovie8-live.akamaized.net","raimovie9-live.akamaized.net","raiyoyo1-live.akamaized.net","raiyoyo2-live.akamaized.net","raiyoyo3-live.akamaized.net","raiyoyo4-live.akamaized.net","raiyoyo5-live.akamaized.net","raiyoyo6-live.akamaized.net","raiyoyo7-live.akamaized.net","raiyoyo8-live.akamaized.net","raiyoyo9-live.akamaized.net","raigulp1-live.akamaized.net","raigulp2-live.akamaized.net","raigulp3-live.akamaized.net","raigulp4-live.akamaized.net","raigulp5-live.akamaized.net","raigulp6-live.akamaized.net","raigulp7-live.akamaized.net","raigulp8-live.akamaized.net","raigulp9-live.akamaized.net","rainews1-live.akamaized.net","rainews2-live.akamaized.net","rainews3-live.akamaized.net","rainews4-live.akamaized.net","rainews5-live.akamaized.net","rainews6-live.akamaized.net","rainews7-live.akamaized.net","rainews8-live.akamaized.net","rainews9-live.akamaized.net","raiscuola1-live.akamaized.net","raiscuola2-live.akamaized.net","raiscuola3-live.akamaized.net","raiscuola4-live.akamaized.net","raiscuola5-live.akamaized.net","raiscuola6-live.akamaized.net","raiscuola7-live.akamaized.net","raiscuola8-live.akamaized.net","raiscuola9-live.akamaized.net","raievent1-live.akamaized.net","raievent2-live.akamaized.net","raievent3-live.akamaized.net","raievent4-live.akamaized.net","raievent5-live.akamaized.net","raievent6-live.akamaized.net","raievent7-live.akamaized.net","raievent8-live.akamaized.net","raievent9-live.akamaized.net","raiquattro1-live.akamaized.net","raiquattro2-live.akamaized.net","raiquattro3-live.akamaized.net","raiquattro4-live.akamaized.net","raiquattro5-live.akamaized.net","raiquattro6-live.akamaized.net","raiquattro7-live.akamaized.net","raiquattro8-live.akamaized.net","raiquattro9-live.akamaized.net","raisportuno1-live.akamaized.net","raisportuno2-live.akamaized.net","raisportuno3-live.akamaized.net","raisportuno4-live.akamaized.net","raisportuno5-live.akamaized.net","raisportuno6-live.akamaized.net","raisportuno7-live.akamaized.net","raisportuno8-live.akamaized.net","raisportuno9-live.akamaized.net","raistoria1-live.akamaized.net","raistoria2-live.akamaized.net","raistoria3-live.akamaized.net","raistoria4-live.akamaized.net","raistoria5-live.akamaized.net","raistoria6-live.akamaized.net","raistoria7-live.akamaized.net","raistoria8-live.akamaized.net","raistoria9-live.akamaized.net","raisportdue1-live.akamaized.net","raisportdue2-live.akamaized.net","raisportdue3-live.akamaized.net","raisportdue4-live.akamaized.net","raisportdue5-live.akamaized.net","raisportdue6-live.akamaized.net","raisportdue7-live.akamaized.net","raisportdue8-live.akamaized.net","raisportdue9-live.akamaized.net"],then:"PROXY IT.PEER",if:[]}]}]}},rai_it:{match:{min_ver:"1.155.77",root_urls:["rai.it"],rules:[{proxy_country:["IT"],cmds:[{root_urls:["rai.it"],then:"PROXY IT.POOL_lum_it_shared",if:[]}]}]},cmds:[{root_urls:["rai.it"],then:"PROXY IT.POOL_lum_it_shared",if:[]}]},rte_ie:{match:{root_urls:["rte.ie"],rules:[{proxy_country:["IE"],cmds:[{hosts:["rte.ie"],then:"PROXY IE.PEER",if:[]},{hosts:["link.eu.theplatform.com"],then:"PROXY IE.PEER",if:[]}]}]},cmds:[{hosts:["rte.ie"],then:"PROXY IE.PEER",if:[]},{hosts:["link.eu.theplatform.com"],then:"PROXY IE.PEER",if:[]}]},virginmediatelevision_ie:{match:{root_urls:["virginmediatelevision.ie"],rules:[{proxy_country:["IE"],cmds:[{hosts:["www.virginmediatelevision.ie"],then:"PROXY IE.PEER",if:[]},{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/\\d+",type:"!~",then:"PROXY IE.POOL"}],then:"PROXY IE.PEER"}]}]},cmds:[{hosts:["www.virginmediatelevision.ie"],then:"PROXY IE.PEER",if:[]},{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/\\d+",type:"!~",then:"PROXY IE.POOL"}],then:"PROXY IE.PEER"}]},rtlplay_be:{match:{root_urls:["rtlplay.be"],rules:[{proxy_country:["BE"],cmds:[{hosts:["6play.fr","m6web.fr"],then:"PROXY BE.PEER",if:[]}]}]},cmds:[{hosts:["6play.fr","m6web.fr"],then:"PROXY BE.PEER",if:[]}]},vier_be:{match:{root_urls:["vier.be"],rules:[{proxy_country:["BE"],cmds:[{hosts:["stream1-vod.cdn1.sbs.prd.telenet-ops.be","stream2-vod.cdn1.sbs.prd.telenet-ops.be"],then:"PROXY BE.PEER",if:[]}]}]},cmds:[{hosts:["stream1-vod.cdn1.sbs.prd.telenet-ops.be","stream2-vod.cdn1.sbs.prd.telenet-ops.be"],then:"PROXY BE.PEER",if:[]}]},sixplay_fr:{match:{root_urls:["6play.fr"],rules:[{proxy_country:["FR"],cmds:[{hosts:["6play.fr","m6web.fr","6cloud.fr","lic.drmtoday.com","backend.dna-delivery.com","layout.6cloud.fr","lbcdn.6cloud.fr","mon.m6web.fr","heartbeat-v2.6cloud.fr"],then:"PROXY FR.PEER",if:[]}]}]},cmds:[{hosts:["6play.fr","m6web.fr","6cloud.fr","lic.drmtoday.com","backend.dna-delivery.com","layout.6cloud.fr","lbcdn.6cloud.fr","mon.m6web.fr","heartbeat-v2.6cloud.fr"],then:"PROXY FR.PEER",if:[]}]},orange_fr:{match:{root_urls:["orange.fr"],rules:[{proxy_country:["FR"],cmds:[{hosts:["nec-ms.apigw.orange.fr","replay.orange.fr","mediation-tv.orange.fr","login.orange.fr"],then:"PROXY FR.PEER",if:[]}]}]},cmds:[{hosts:["nec-ms.apigw.orange.fr","replay.orange.fr","mediation-tv.orange.fr","login.orange.fr"],then:"PROXY FR.PEER",if:[]}]},sonyliv_com:{match:{root_urls:["sonyliv.com"],rules:[{proxy_country:["IN"],cmds:[{hosts:["sonyliv.com","apiv2.sonyliv.com","sony247channels.akamaized.net"],then:"PROXY IN.POOL_lum_in_shared",if:[]},{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY IN.POOL_lum_in_shared"}],then:"PROXY IN.POOL_lum_in_shared"}]}]},cmds:[{hosts:["sonyliv.com","apiv2.sonyliv.com","sony247channels.akamaized.net"],then:"PROXY IN.POOL_lum_in_shared",if:[]},{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY IN.POOL_lum_in_shared"}],then:"PROXY IN.POOL_lum_in_shared"}]},sprint_com:{proxy_country:["US"],cmds:[{root_urls:["sprint.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},stan_com_au:{cmds:[{hosts:["api.stan.com.au"],then:"PROXY AU.PEER",if:[]}]},tenplay_com_au:{match:{root_urls:["tenplay.com.au","10play.com.au"],rules:[{proxy_country:["AU"],cmds:[{root_urls:["tenplay.com.au","10play.com.au"],then:"PROXY AU.POOL",if:[]},{hosts:["10play.com.au","manifest.prod.boltdns.net","bcboltnet10tp.akamaized.net","10play-vod.global.ssl.fastly.net","10-selector.global.ssl.fastly.net","10-cms-feed.global.ssl.fastly.net"],then:"PROXY AU.POOL",if:[]},{hosts:["global.ssl.fastly.net"],then:"PROXY AU.PEER",if:[]},{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY AU.POOL"}],then:"PROXY AU.PEER"}]}]},cmds:[{root_urls:["tenplay.com.au","10play.com.au"],then:"PROXY AU.POOL",if:[]},{hosts:["10play.com.au","manifest.prod.boltdns.net","bcboltnet10tp.akamaized.net","10play-vod.global.ssl.fastly.net","10-selector.global.ssl.fastly.net","10-cms-feed.global.ssl.fastly.net"],then:"PROXY AU.POOL",if:[]},{hosts:["global.ssl.fastly.net"],then:"PROXY AU.PEER",if:[]},{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY AU.POOL"}],then:"PROXY AU.PEER"}]},ninenow_com_au:{match:{root_urls:["9now.com.au"],rules:[{proxy_country:["AU"],cmds:[{hosts:["www.9now.com.au"],then:"PROXY AU.PEER",if:[]}]}]},cmds:[{hosts:["www.9now.com.au"],then:"PROXY AU.PEER",if:[]}]},unidragon_eu:{match:{root_urls:["unidragon.eu","unidragon.com"],rules:[{proxy_country:["DE","US"],cmds:[{hosts:["cozycountryredirect.addons.business"],then:"PROXY XX.PEER",if:[]}]}]},cmds:[{hosts:["cozycountryredirect.addons.business"],then:"PROXY XX.PEER",if:[]}]},bfmtv_com:{match:{root_urls:["bfmtv.com"],rules:[{proxy_country:["FR"],cmds:[{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY FR"}],then:"PROXY FR.PEER"}]}]},cmds:[{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY FR"}],then:"PROXY FR.PEER"}]},tvbanywherena_com:{match:{root_urls:["tvbanywherena.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY US"}],then:"PROXY US.PEER"}]}]},cmds:[{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY US"}],then:"PROXY US.PEER"}]},tvnz_co_nz:{match:{root_urls:["tvnz.co.nz"],rules:[{proxy_country:["NZ"],cmds:[{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY NZ"}],then:"PROXY NZ.PEER"},{hosts:["bcbolttvnz3-a.akamaihd.net","tvnz-prod-01.brightcovecdn.com","apis-edge-prod.tech.tvnz.co.nz","playback.brightcovecdn.com"],then:"PROXY NZ.PEER",if:[]}]}]},cmds:[{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY NZ"}],then:"PROXY NZ.PEER"},{hosts:["bcbolttvnz3-a.akamaihd.net","tvnz-prod-01.brightcovecdn.com","apis-edge-prod.tech.tvnz.co.nz","playback.brightcovecdn.com"],then:"PROXY NZ.PEER",if:[]}]},toggle_sg:{match:{root_urls:["toggle.sg"],rules:[{proxy_country:["SG"],cmds:[{hosts:["player-as.ott.kaltura.com"],if:[{url:".*player-as\\.ott\\.kaltura\\.com\\/.*\\/mwEmbed\\/mwEmbedFrame\\.php.*",type:"!~",then:"PROXY SG"}],then:"PROXY SG.PEER"}]}]},cmds:[{hosts:["player-as.ott.kaltura.com"],if:[{url:".*player-as\\.ott\\.kaltura\\.com\\/.*\\/mwEmbed\\/mwEmbedFrame\\.php.*",type:"!~",then:"PROXY SG"}],then:"PROXY SG.PEER"}]},tv4play_se:{match:{root_urls:["tv4play.se"],rules:[{proxy_country:["SE"],cmds:[{hosts:["playback-api.b17g.net","playback2.a2d.tv","tv4-segments.a2d.tv"],then:"PROXY SE.PEER",if:[]}]}]},cmds:[{hosts:["playback-api.b17g.net","playback2.a2d.tv","tv4-segments.a2d.tv"],then:"PROXY SE.PEER",if:[]}]},viaplay_se:{match:{root_urls:["viaplay.se"],rules:[{proxy_country:["SE"],cmds:[{hosts:["play.viaplay.se"],then:"PROXY SE.PEER",if:[]}]}]},cmds:[{hosts:["play.viaplay.se"],then:"PROXY SE.PEER",if:[]}]},cmore_se:{match:{root_urls:["cmore.se"],rules:[{proxy_country:["SE"],cmds:[{hosts:["streaminggateway-cmore.clientapi-prod.live.tv.telia.net"],then:"PROXY SE.PEER",if:[]}]}]},cmds:[{hosts:["streaminggateway-cmore.clientapi-prod.live.tv.telia.net"],then:"PROXY SE.PEER",if:[]}]},telecinco_es:{match:{root_urls:["telecinco.es"],rules:[{proxy_country:["ES"],cmds:[{root_urls:["telecinco.es"],then:"PROXY ES.POOL_lum_es_shared",if:[]},{hosts:["mediaset.hb.omtrdc.net"],then:"PROXY ES.POOL_lum_es_shared",if:[]},{hosts:["gatekeeper.mediaset.es","livehlsdai-i.akamaihd.net","cerbero.pro.3d99a4cb092e6d20ff56d80b9efd9a8f8802ec81.es","telecinco1-vh.akamaihd.net","live.telecinco.es"],then:"PROXY ES.PEER",if:[]}]}]},cmds:[{root_urls:["telecinco.es"],then:"PROXY ES.POOL_lum_es_shared",if:[]},{hosts:["mediaset.hb.omtrdc.net"],then:"PROXY ES.POOL_lum_es_shared",if:[]},{hosts:["gatekeeper.mediaset.es","livehlsdai-i.akamaihd.net","cerbero.pro.3d99a4cb092e6d20ff56d80b9efd9a8f8802ec81.es","telecinco1-vh.akamaihd.net","live.telecinco.es"],then:"PROXY ES.PEER",if:[]}]},energytv_es:{match:{root_urls:["energytv.es"],rules:[{proxy_country:["ES"],cmds:[{root_urls:["energytv.es"],then:"PROXY ES.POOL_lum_es_shared",if:[]},{hosts:["mdslivehlsb-i.akamaihd.net","cerbero.pro.3d99a4cb092e6d20ff56d80b9efd9a8f8802ec81.es"],then:"PROXY ES.PEER",if:[]}]}]},cmds:[{root_urls:["energytv.es"],then:"PROXY ES.POOL_lum_es_shared",if:[]},{hosts:["mdslivehlsb-i.akamaihd.net","cerbero.pro.3d99a4cb092e6d20ff56d80b9efd9a8f8802ec81.es"],then:"PROXY ES.PEER",if:[]}]},mediaset_it:{match:{root_urls:["mediaset.it"],rules:[{proxy_country:["IT"],cmds:[{root_urls:["mediaset.it"],then:"PROXY IT.POOL_lum_it_shared",if:[]},{hosts:["api-ott-prod-fe.mediaset.net","theplatform.eu","link.theplatform.eu","feed.entertainment.tv.theplatform.eu","api.mediaset.net","secure-it.imrworldwide.com","vod06.msf.cdn.mediaset.net"],then:"PROXY IT.PEER",if:[]}]}]},cmds:[{root_urls:["mediaset.it"],then:"PROXY IT.POOL_lum_it_shared",if:[]},{hosts:["api-ott-prod-fe.mediaset.net","theplatform.eu","link.theplatform.eu","feed.entertainment.tv.theplatform.eu","api.mediaset.net","secure-it.imrworldwide.com","vod06.msf.cdn.mediaset.net"],then:"PROXY IT.PEER",if:[]}]},tibia_com:{match:{root_urls:["tibia.com"],rules:[{proxy_country:["IT"],cmds:[{root_urls:["tibia.com"],then:"PROXY IT.POOL_lum_it_shared",if:[]}]}]},cmds:[{root_urls:["tibia.com"],then:"PROXY IT.POOL_lum_it_shared",if:[]}]},tenk_fr:{match:{root_urls:["tenk.fr"],rules:[{proxy_country:["FR"],cmds:[{root_urls:["tenk.fr"],then:"PROXY FR.POOL_lum_fr_shared",if:[]}]}]},cmds:[{root_urls:["tenk.fr"],then:"PROXY FR.POOL_lum_fr_shared",if:[]}]},tva_ca:{match:{root_urls:["tva.ca"],rules:[{proxy_country:["CA"],cmds:[{root_urls:["tva.ca","chainetvauls-lh.akamaihd.net"],then:"PROXY CA.POOL_lum_ca_shared",if:[]},{hosts:["videos.tva.ca","video.tva.ca"],then:"PROXY CA.PEER",if:[]},{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY CA.POOL_lum_ca_shared"}],then:"PROXY CA.PEER"}]}]},cmds:[{root_urls:["tva.ca","chainetvauls-lh.akamaihd.net"],then:"PROXY CA.POOL_lum_ca_shared",if:[]},{hosts:["videos.tva.ca","video.tva.ca"],then:"PROXY CA.PEER",if:[]},{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY CA.POOL_lum_ca_shared"}],then:"PROXY CA.PEER"}]},aptnlumi_ca:{match:{root_urls:["aptnlumi.ca"],rules:[{proxy_country:["CA"],cmds:[{root_urls:["aptnlumi.ca"],then:"PROXY CA.POOL_lum_ca_shared",if:[]},{hosts:["cdnapisec.kaltura.com","cdnsecakmi.kaltura.com","cfvod.kaltura.com","analytics.kaltura.com"],then:"PROXY CA.POOL_lum_ca_shared",if:[]}]}]},cmds:[{root_urls:["aptnlumi.ca"],then:"PROXY CA.POOL_lum_ca_shared",if:[]},{hosts:["cdnapisec.kaltura.com","cdnsecakmi.kaltura.com","cfvod.kaltura.com","analytics.kaltura.com"],then:"PROXY CA.POOL_lum_ca_shared",if:[]}]},noovo_ca:{match:{root_urls:["noovo.ca"],rules:[{proxy_country:["CA"],cmds:[{root_urls:["noovo.ca"],then:"PROXY CA.POOL_lum_ca_shared",if:[]},{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY CA.POOL_lum_ca_shared"}],then:"PROXY CA.PEER"}]}]},cmds:[{root_urls:["noovo.ca"],then:"PROXY CA.POOL_lum_ca_shared",if:[]},{hosts:["edge.api.brightcove.com"],if:[{url:".*edge\\.api\\.brightcove\\.com\\/playback\\/v1\\/accounts\\/\\d+\\/videos\\/(ref:)?\\d+",type:"!~",then:"PROXY CA.POOL_lum_ca_shared"}],then:"PROXY CA.PEER"}]},skysports_com:{match:{root_urls:["skysports.com"],rules:[{proxy_country:["GB"],cmds:[{root_urls:["skysports.com"],then:"PROXY GB.POOL_lum_gb_shared",if:[]},{hosts:["edge-auth.api.brightcove.com"],then:"PROXY GB.PEER",if:[]}]}]},cmds:[{root_urls:["skysports.com"],then:"PROXY GB.POOL_lum_gb_shared",if:[]},{hosts:["edge-auth.api.brightcove.com"],then:"PROXY GB.PEER",if:[]}]},tvnow_de:{match:{root_urls:["tvnow.de"],rules:[{proxy_country:["DE"],cmds:[{hosts:["widevine.tvnow.de"],if:[{url:".*widevine\\.tvnow\\.de\\/index\\/proxy",type:"!~",then:"PROXY DE"}],then:"PROXY DE.PEER"},{hosts:["bff.apigw.tvnow.de","entitlement.player.tvnow.de"],then:"PROXY DE.PEER",if:[]}]}]},cmds:[{hosts:["widevine.tvnow.de"],if:[{url:".*widevine\\.tvnow\\.de\\/index\\/proxy",type:"!~",then:"PROXY DE"}],then:"PROXY DE.PEER"},{hosts:["bff.apigw.tvnow.de","entitlement.player.tvnow.de"],then:"PROXY DE.PEER",if:[]}]},youtube_com:{match:{root_urls:["youtube.com"],rules:[{proxy_country:["AU"],cmds:[{root_urls:["youtube.com"],then:"PROXY AU.POOL_lum_au_shared",if:[]},{hosts:["s.ytimg.com","googlevideo.com"],then:"PROXY AU",if:[]}]},{proxy_country:["CO"],cmds:[{root_urls:["youtube.com"],then:"PROXY CO.POOL_lum_co_shared"},{hosts:["s.ytimg.com","googlevideo.com"],then:"PROXY CO"}]},{proxy_country:["IT"],cmds:[{root_urls:["youtube.com"],then:"PROXY IT.POOL_lum_it_shared"},{hosts:["s.ytimg.com","googlevideo.com"],then:"PROXY IT"}]},{proxy_country:["CA"],cmds:[{root_urls:["youtube.com"],then:"PROXY CA.POOL_lum_ca_shared"},{hosts:["s.ytimg.com","googlevideo.com"],then:"PROXY CA"}]},{proxy_country:["GB"],cmds:[{root_urls:["youtube.com"],then:"PROXY GB.POOL_lum_gb_shared"},{hosts:["s.ytimg.com","googlevideo.com"],then:"PROXY GB"}]},{proxy_country:["NL"],cmds:[{root_urls:["youtube.com"],then:"PROXY NL.POOL_lum_nl_shared"},{hosts:["s.ytimg.com","googlevideo.com"],then:"PROXY NL"}]},{proxy_country:["FR"],cmds:[{root_urls:["youtube.com"],then:"PROXY FR.POOL_lum_fr_shared"},{hosts:["s.ytimg.com","googlevideo.com"],then:"PROXY FR"}]},{proxy_country:["ES"],cmds:[{root_urls:["youtube.com"],then:"PROXY ES.POOL_lum_es_shared"},{hosts:["s.ytimg.com","googlevideo.com"],then:"PROXY ES"}]},{proxy_country:["US"],cmds:[{root_urls:["youtube.com"],then:"PROXY US.POOL_lum_us_shared"},{hosts:["s.ytimg.com","googlevideo.com"],then:"PROXY US"}]},{proxy_country:["KR"],cmds:[{root_urls:["youtube.com"],then:"PROXY KR.POOL_lum_kr_shared"},{hosts:["s.ytimg.com","googlevideo.com"],then:"PROXY KR"}]},{proxy_country:["BR"],cmds:[{root_urls:["youtube.com"],then:"PROXY BR.POOL_lum_br_shared"},{hosts:["s.ytimg.com","googlevideo.com"],then:"PROXY BR"}]}]},cmds:[{root_urls:["youtube.com"],then:"PROXY XX",if:[]},{hosts:["www.youtube.com"],then:"PROXY XX",if:[]}]},cloudvideo_co:{proxy_country:["CO"],cmds:[{hosts:["rcnhd.cloudvideo.com.co"],if:[{url:"(/html5/.*/mwEmbedFrame.php/|playManifest|\\.m3u8)",type:"!~",then:"PROXY CO"}],then:"PROXY CO.PEER"}]},coomevaeps_com:{proxy_country:["CO"],cmds:[{hosts:["oficinavirtualeps.coomevaeps.com"],then:"PROXY CO.PEER",if:[]}]},tvp_pl:{proxy_country:["PL"],cmds:[{hosts:["vod.tvp.pl"],if:[{url:"\\/sess\\/tvplayer\\.php",type:"!~",then:"PROXY PL"}],then:"PROXY PL.PEER"}]},vod_pl:{match:{root_urls:["vod.pl"],rules:[{proxy_country:["PL"],cmds:[{hosts:["useinsider.com","player-api.dreamlab.pl"],then:"PROXY PL.PEER",if:[]}]}]},cmds:[{hosts:["useinsider.com","player-api.dreamlab.pl"],then:"PROXY PL.PEER",if:[]}]},tvp_info:{match:{root_urls:["tvp.info"],rules:[{proxy_country:["PL"],cmds:[{hosts:["www.tvp.info"],then:"PROXY PL.PEER",if:[]}]}]},cmds:[{hosts:["www.tvp.info"],then:"PROXY PL.PEER",if:[]}]},ipla_tv:{match:{root_urls:["ipla.tv"],rules:[{proxy_country:["PL"],cmds:[{hosts:["b2c-www.redefine.pl"],then:"PROXY PL.PEER",if:[]}]}]},cmds:[{hosts:["b2c-www.redefine.pl"],then:"PROXY PL.PEER",if:[]}]},starplus_com:{match:{root_urls:["starplus.com"],rules:[{proxy_country:["AR"],cmds:[{hosts:["global.edge.bamgrid.com","sdk.iad-03.braze.com","disney.api.edge.bamgrid.com","dialacrum.iad-03.braze.com","disney.demdex.net","disney.connections.edge.bamgrid.com","disney.content.edge.bamgrid.com","disney.playback.edge.bamgrid.com","star.api.edge.bamgrid.com"],then:"PROXY AR.PEER",if:[]},{root_urls:["disneyplus.com"],then:"PROXY AR.PEER",if:[]},{hosts:["disneyplus.com","www.disneyplus.com","svcs.dssott.com","egisterdisney.go.com","disney-plus.net"],then:"PROXY AR.PEER",if:[]}]}]},cmds:[{hosts:["global.edge.bamgrid.com","sdk.iad-03.braze.com","disney.api.edge.bamgrid.com","dialacrum.iad-03.braze.com","disney.demdex.net","disney.connections.edge.bamgrid.com","disney.content.edge.bamgrid.com","disney.playback.edge.bamgrid.com","star.api.edge.bamgrid.com"],then:"PROXY AR.PEER",if:[]},{root_urls:["disneyplus.com"],then:"PROXY AR.PEER",if:[]},{hosts:["disneyplus.com","www.disneyplus.com","svcs.dssott.com","egisterdisney.go.com","disney-plus.net"],then:"PROXY AR.PEER",if:[]}]},rtvs_sk:{match:{root_urls:["rtvs.sk"],rules:[{proxy_country:["SK"],cmds:[{hosts:["n0.stv.livebox.sk","n1.stv.livebox.sk","n2.stv.livebox.sk","n3.stv.livebox.sk","n4.stv.livebox.sk","n5.stv.livebox.sk","n6.stv.livebox.sk","n7.stv.livebox.sk","n8.stv.livebox.sk","n9.stv.livebox.sk","n10.stv.livebox.sk","n11.stv.livebox.sk","n12.stv.livebox.sk","n13.stv.livebox.sk","n14.stv.livebox.sk","n15.stv.livebox.sk","n16.stv.livebox.sk","n17.stv.livebox.sk","n18.stv.livebox.sk","n19.stv.livebox.sk","n20.stv.livebox.sk","n21.stv.livebox.sk","n22.stv.livebox.sk","n23.stv.livebox.sk","n24.stv.livebox.sk","n25.stv.livebox.sk","n26.stv.livebox.sk","n27.stv.livebox.sk","n28.stv.livebox.sk","n29.stv.livebox.sk","n30.stv.livebox.sk"],then:"PROXY SK.PEER",if:[]}]}]},cmds:[{hosts:["n0.stv.livebox.sk","n1.stv.livebox.sk","n2.stv.livebox.sk","n3.stv.livebox.sk","n4.stv.livebox.sk","n5.stv.livebox.sk","n6.stv.livebox.sk","n7.stv.livebox.sk","n8.stv.livebox.sk","n9.stv.livebox.sk","n10.stv.livebox.sk","n11.stv.livebox.sk","n12.stv.livebox.sk","n13.stv.livebox.sk","n14.stv.livebox.sk","n15.stv.livebox.sk","n16.stv.livebox.sk","n17.stv.livebox.sk","n18.stv.livebox.sk","n19.stv.livebox.sk","n20.stv.livebox.sk","n21.stv.livebox.sk","n22.stv.livebox.sk","n23.stv.livebox.sk","n24.stv.livebox.sk","n25.stv.livebox.sk","n26.stv.livebox.sk","n27.stv.livebox.sk","n28.stv.livebox.sk","n29.stv.livebox.sk","n30.stv.livebox.sk"],then:"PROXY SK.PEER",if:[]}]},latina_pe:{match:{root_urls:["latina.pe"],rules:[{proxy_country:["PE"],cmds:[{hosts:["mdstrm.com"],then:"PROXY PE.PEER",if:[]}]}]},cmds:[{hosts:["mdstrm.com"],then:"PROXY PE.PEER",if:[]}]},rtve_es:{match:{root_urls:["rtve.es"],rules:[{proxy_country:["ES"],cmds:[{hosts:["rtvelivestreamv1.akamaized.net","rtvelivestreamv2.akamaized.net","rtvelivestreamv3.akamaized.net","rtvelivestreamv4.akamaized.net","rtvelivestreamv5.akamaized.net","rtvelivestreamv6.akamaized.net","rtvelivestreamv7.akamaized.net","rtvelivestreamv8.akamaized.net","rtvelivestreamv9.akamaized.net","rtvelivestreamv10.akamaized.net"],then:"PROXY ES.PEER",if:[]}]}]},cmds:[{hosts:["rtvelivestreamv1.akamaized.net","rtvelivestreamv2.akamaized.net","rtvelivestreamv3.akamaized.net","rtvelivestreamv4.akamaized.net","rtvelivestreamv5.akamaized.net","rtvelivestreamv6.akamaized.net","rtvelivestreamv7.akamaized.net","rtvelivestreamv8.akamaized.net","rtvelivestreamv9.akamaized.net","rtvelivestreamv10.akamaized.net"],then:"PROXY ES.PEER",if:[]}]},iceland_co_uk:{proxy_country:["GB"],cmds:[{root_urls:["iceland.co.uk"],then:"PROXY GB.PEER",if:[]}]},play_rtl_hr:{match:{root_urls:["play.rtl.hr"],rules:[{proxy_country:["HR"],cmds:[{hosts:["geo.6play.fr"],then:"PROXY HR.PEER",if:[]}]}]},cmds:[{hosts:["geo.6play.fr"],then:"PROXY HR.PEER",if:[]}]},ticketmaster_com:{proxy_country:["US"],cmds:[{root_urls:["ticketmaster.com"],then:"PROXY US.POOL_lum_us_shared",if:[]}]},zattoo_com:{match:{root_urls:["zattoo.com"],rules:[{proxy_country:["DE"],cmds:[{root_urls:["zahs.tv"],then:"PROXY DE.PEER",if:[]}]}]},cmds:[{root_urls:["zahs.tv"],then:"PROXY DE.PEER",if:[]}]},tv4_se:{match:{root_urls:["tv4.se"],rules:[{proxy_country:["SE"],cmds:[{hosts:["tv4.se","www.tv4.se","tv4se-graphql.a2d.tv"],then:"PROXY SE.PEER",if:[]}]}]},cmds:[{hosts:["tv4.se","www.tv4.se","tv4se-graphql.a2d.tv"],then:"PROXY SE.PEER",if:[]}]},picknsave_com:{match:{root_urls:["picknsave.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["picknsave.com"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{hosts:["picknsave.com"],then:"PROXY US.PEER",if:[]}]},homegoods_com:{match:{root_urls:["homegoods.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["homegoods.com"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{hosts:["homegoods.com"],then:"PROXY US.PEER",if:[]}]},tacobell_com:{match:{root_urls:["tacobell.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["tacobell.com"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{hosts:["tacobell.com"],then:"PROXY US.PEER",if:[]}]},fkr_spb_ru:{match:{root_urls:["fkr-spb.ru"],rules:[{proxy_country:["RU"],cmds:[{hosts:["fkr-spb.ru"],then:"PROXY RU.PEER",if:[]}]}]},cmds:[{hosts:["fkr-spb.ru"],then:"PROXY RU.PEER",if:[]}]},avail_co:{match:{root_urls:["avail.co","avail.com"],rules:[{proxy_country:["US"],cmds:[{hosts:["avail.co","avail.com","www.avail.co","www.avail.com"],then:"PROXY US.PEER",if:[]}]}]},cmds:[{hosts:["avail.co","avail.com","www.avail.co","www.avail.com"],then:"PROXY US.PEER",if:[]}]},fubo_tv:{match:{root_urls:["fubo.tv"],rules:[{cmds:[{hosts:["api.fubo.tv","gcs-streams-prod.fubo.tv"],then:"PROXY XX.PEER",if:[]}]}]},cmds:[{hosts:["api.fubo.tv","gcs-streams-prod.fubo.tv"],then:"PROXY XX.PEER",if:[]}]},abc:{proxy_country:["US"],cmds:[{hosts:["edgedatg.com","edgedatg.go.com"],if:[{host:"[^.]\\.?edgedatg(\\.go)?\\.com",type:"!~",then:"PROXY XX"}],then:"PROXY US.PEER"}]},stb_ua:{country:{list:["UA"],type:"in"},cmds:[{hosts:["vcms-api2.starlight.digital","vcms-api.starlight.digital"],then:"PROXY UA.PEER",if:[]}]},mediaklikk:{cmds:[{hosts:["connectmedia.hu"],if:[{url:".*cdn\\.connectmedia\\.hu\\/.*\\.m3u8",type:"=~",then:"PROXY XX"}],then:"PROXY XX"}]},zdf_de:{cmds:[{hosts:["zdfvodde-vh.akamaihd.net"],if:[{url:".*zdfvodde-vh\\.akamaihd\\.net\\/i\\/zdf\\/.*\\.m3u8",type:"=~",then:"PROXY XX"}],then:"PROXY XX"}]},fubotv:{cmds:[{hosts:["fubo.tv"],then:"PROXY XX",if:[]}]}}}}}.call(exports,__webpack_require__,exports,module),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},3727:(module,exports,__webpack_require__)=>{"use strict";var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;// LICENSE_CODE ZON
!(__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(6969),__webpack_require__(1211),__webpack_require__(7345),__webpack_require__(5250)],__WEBPACK_AMD_DEFINE_RESULT__=((be_backbone,B,be_util,be_vpn_util)=>{be_vpn_util.assert_bg("be_ext");const assign=Object.assign;const E=new(be_backbone.model.extend({model_name:"ext",_defaults:function(){this.on("destroy",(()=>E.uninit()))}}));E.init=()=>{if(E.inited)return;E.inited=true};E.uninit=()=>{if(!E.inited)return;E.stopListening();E.clear();E.inited=false};E.auth=o=>{const info=be_util.qs_ajax();info.uuid=E.get("uuid");info.session_key=E.get("session_key")||0;return assign(info,o)};E.is_disabled=()=>!E.get("ext.active")||E.get("ext.suspended");return E}).apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},5974:(module,exports,__webpack_require__)=>{"use strict";var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;// LICENSE_CODE ZON
!(__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(1889),__webpack_require__(4336)],__WEBPACK_AMD_DEFINE_RESULT__=((hash,zescape)=>{const E={};const GA_POST_URL="https://www.google-analytics.com/collect";let xhr_send_t;let enabled=true;let proc_msg=ga_msg=>{let t,targs;let defaults={dp:"%2F",dl:"%2F",pa:"checkout"};switch(ga_msg[0]){case"event":t="event";targs=["ec","ea","el","ev"];break;case"ec_checkout":t="event";targs=["ec","ea","el","cos","col","pa"];break;case"ec_impression_view":case"pageview":t="pageview";targs=["dh","dp","dt"];break;default:return}let args=targs.map(((v,i)=>{let arg=ga_msg[i+1]||defaults[v];return arg&&v+"="+encodeURIComponent(arg)})).filter((v=>!!v)).join("&");let ga_params=Object.assign({v:1,t},E.xhr_opt);return zescape.qs(ga_params)+"&"+args};E.inited={};E.init=(id,opt={})=>{if(E.inited[id])return;E.inited[id]=true;E.xhr_opt=Object.assign({tid:id},opt);if(opt.pageview)E.qpush(["pageview"])};E.pageview=(hostname,page,title)=>{E.qpush(["pageview",hostname,page,title])};E.event=(category,action,label,value)=>{E.qpush(["event",category,action,label,value])};E.ec_checkout=(step,option,action,label)=>{action=action||`Checkout step ${step}`;E.qpush(["ec_checkout","Ecommerce",action,label,step,option])};E.ec_impression_view=(list_name,products)=>{let prod_keys={id:"id",name:"nm",category:"ca"};let opt=products.reduce(((a,p,i)=>{Object.keys(p).forEach(((k,v)=>{a[`il1pi${i+1}${prod_keys[k]||k}`]=v}));return a}),{il1nm:list_name});E.qpush(["ec_impression_view"],opt)};E.qpush=ar=>{if(!enabled)return;let _gaq=self._gaq=self._gaq||[];_gaq.push(ar);if(!E.xhr_opt)return;if(xhr_send_t)clearTimeout(xhr_send_t);xhr_send_t=setTimeout(E.send_gaq,1)};E.send_gaq=()=>{if(!enabled)return;xhr_send_t=0;let _gaq=self._gaq=self._gaq||[];self._gaq=[];let messages=_gaq.map(proc_msg).filter((msg=>!!msg));if(!messages.length)return;messages.forEach((msg=>fetch(GA_POST_URL,{method:"POST",body:msg})))};E.set_enabled=_enabled=>enabled=_enabled;return E}).apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},9651:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var underscore__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(7439);var underscore__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(underscore__WEBPACK_IMPORTED_MODULE_0__);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(6969);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1__);var _bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(1211);var _bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_2__);var _util_etask_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(6386);var _util_etask_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_util_etask_js__WEBPACK_IMPORTED_MODULE_3__);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(3727);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_4__);var _util_ajax_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(918);var _util_ajax_js__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(_util_ajax_js__WEBPACK_IMPORTED_MODULE_5__);var _svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(2227);var _svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_6__);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(9824);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(_util_zerr_js__WEBPACK_IMPORTED_MODULE_7__);var _util_escape_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(4336);var _util_escape_js__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(_util_escape_js__WEBPACK_IMPORTED_MODULE_8__);var _util_url_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(5305);var _util_url_js__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(_util_url_js__WEBPACK_IMPORTED_MODULE_9__);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(7345);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default=__webpack_require__.n(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10__);var _util_date_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(932);var _util_date_js__WEBPACK_IMPORTED_MODULE_11___default=__webpack_require__.n(_util_date_js__WEBPACK_IMPORTED_MODULE_11__);var _util_version_util_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(6262);var _util_version_util_js__WEBPACK_IMPORTED_MODULE_12___default=__webpack_require__.n(_util_version_util_js__WEBPACK_IMPORTED_MODULE_12__);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(5250);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_13___default=__webpack_require__.n(_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_13__);var _util_util_js__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(1291);var _util_util_js__WEBPACK_IMPORTED_MODULE_14___default=__webpack_require__.n(_util_util_js__WEBPACK_IMPORTED_MODULE_14__);var _util_storage_js__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(8915);var _util_storage_js__WEBPACK_IMPORTED_MODULE_15___default=__webpack_require__.n(_util_storage_js__WEBPACK_IMPORTED_MODULE_15__);var _util_rand_js__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(4135);var _util_rand_js__WEBPACK_IMPORTED_MODULE_16___default=__webpack_require__.n(_util_rand_js__WEBPACK_IMPORTED_MODULE_16__);var _bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(8552);var conf__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(9641);
// LICENSE_CODE ZON
_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_13___default().assert_bg("be_bg_ajax");let chrome=self.chrome;let is_agent_fallback,stats={};const assign=Object.assign;let bg_ajax,rand_subset=_util_rand_js__WEBPACK_IMPORTED_MODULE_16___default().rand_subset;const E=new(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1___default().task_model.extend({model_name:"bg_ajax",_defaults:function(){this.on("destroy",(()=>E.uninit()))}}));let bext_config={},cloud_agents={url:"",agents:[]};const{www_host}=conf__WEBPACK_IMPORTED_MODULE_18__;const test_info={hola:{cookie:{name:"connect.sid",url:`https://${www_host}/`},host:www_host},zspeed:{cookie:{name:"connect.sid",url:"https://zspeed-cdn.com/"},host:"zspeed-cdn.com"},hvpn:{cookie:{name:"connect.sid",url:"https://h-vpn.org/"},host:"h-vpn.org"},holavpnextension:{cookie:{name:"connect.sid",url:"https://holavpnextension.com/"},host:"holavpnextension.com"},hola_vpn:{cookie:{name:"connect.sid",url:"https://hola-vpn.com/"},host:"hola-vpn.com"},holavpnrussia:{cookie:{name:"connect.sid",url:"https://holavpnrussia.com/"},host:"holavpnrussia.com"},http:{host:www_host}};const tests=["ccgi","hola","perr"];const ZG=_util_util_js__WEBPACK_IMPORTED_MODULE_14___default().get,ZS=_util_util_js__WEBPACK_IMPORTED_MODULE_14___default().set;const CG=(path,def)=>ZG(bext_config,path,def);const CGA=(path,def)=>ZG(bext_config.bg_ajax,path,def);const CSA=(path,val)=>ZS(bext_config.bg_ajax,path,val);_util_ajax_js__WEBPACK_IMPORTED_MODULE_5___default().events.on("timeout",(()=>{_util_storage_js__WEBPACK_IMPORTED_MODULE_15___default().set("ajax_timeout",_util_storage_js__WEBPACK_IMPORTED_MODULE_15___default().get_int("ajax_timeout")+1)}));_util_ajax_js__WEBPACK_IMPORTED_MODULE_5___default().events.on("server_ts",(server_ts=>_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_17__["default"].update_ts(server_ts)));_util_ajax_js__WEBPACK_IMPORTED_MODULE_5___default().events.on("conf_ver",(conf_ver=>_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_17__["default"].check_conf_ver(conf_ver)));const do_ajax=opt=>_util_etask_js__WEBPACK_IMPORTED_MODULE_3___default()((function*do_ajax_(){this.on("cancel",(()=>_util_ajax_js__WEBPACK_IMPORTED_MODULE_5___default().abort(et)));let et=_util_ajax_js__WEBPACK_IMPORTED_MODULE_5___default()(assign({},opt,{perr:_opt=>_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default().perr(_opt.id,_opt.info,_opt)}));return yield et}));const load_agents=()=>{let url=CGA("agents_url","https://www.dropbox.com/s/jemizcvpmf2qb9v/cloud_failover.conf?dl=1");if(!url||url==cloud_agents.url&&!cloud_agents.et)return cloud_agents.agents;return _util_etask_js__WEBPACK_IMPORTED_MODULE_3___default()({name:"load_agents",cancel:true,async:true},(function*load_agents_(){this.finally((()=>delete cloud_agents.et));let res;if(cloud_agents.et)res=yield this.wait_ext(cloud_agents.et);else{assign(cloud_agents,{agents:[],url,et:this});res=yield do_ajax({url,text:1})}if(!res||cloud_agents.agents.length)return cloud_agents.agents;try{res=res.substr(res.length-3)+res.substr(0,res.length-3);if(res.length%4)res+="=".repeat(4-res.length%4);res=JSON.parse(atob(res));res=res instanceof Array?res:res.agents;res=res.map((a=>({ip:a.ip,port:a.port,name:a.name,host:a.host||a.name&&a.name+".hola.org"||undefined})));cloud_agents.agents=_util_rand_js__WEBPACK_IMPORTED_MODULE_16___default().rand_subset(res,res.length)}catch(e){}return cloud_agents.agents}))};const on_lib_event=o=>{if(o.id!="verify_done")return;let ts=Date.now();if(!stats.ts||ts-stats.ts>15*_util_date_js__WEBPACK_IMPORTED_MODULE_11___default().ms.MIN)stats={ts,verify_host:{s:0,f:0},verify_ip:{s:0,f:0}};let name=o.data.url.startsWith("http:")?"verify_ip":"verify_host";stats[name][o.data.err&&o.data.err!="agent_err"?"f":"s"]++;is_agent_fallback=stats.verify_ip.s>0&&!stats.verify_host.s&&stats.verify_host.f};function BgAjax(){}BgAjax.prototype.init=function(){const copy=opt=>{opt.mem_agents=(opt.mem_agents||[]).map((a=>({port:22224,ip:a.ip,host:a.host})));opt.build_agents=(opt.build_agents||[]).map((a=>({ip:a.ip,port:a.port,host:a.host||a.name&&a.name+".hola.org"||undefined})));return assign({},opt)};const set_url=(opt,pref,uri)=>{for(let name in test_info)opt[name]=pref+test_info[name].host+uri;return opt};const perr=opt=>{if(!CGA("disable_perr_all")&&!CGA("disable_perr",{})[opt.id])_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default().perr(opt.id,opt.info,opt)};const def={ignore:[],api:{perr,ajax_via_proxy:E.be_tab_unblocker.ajax_via_proxy},dbg_logs:CGA("dbg_logs")};const agents_opt={mem_agents:E.be_tab_unblocker.get_all_agents(),build_agents:rand_subset(conf__WEBPACK_IMPORTED_MODULE_18__.agents,conf__WEBPACK_IMPORTED_MODULE_18__.agents.length),cloud_agents:load_agents};const agents=Object.keys(agents_opt);const direct=["hola","zspeed","hvpn","holavpnextension","hola_vpn","holavpnrussia","http"];direct.concat(agents).forEach((name=>{if(CGA("disable_"+name))def.ignore.push(name)}));if(CGA("disable_agents"))def.ignore=def.ignore.concat(agents).concat("common_agents");const client_uri=CGA("client_uri","/client_cgi/conn_test");const ccgi_opt=set_url({def_url:conf__WEBPACK_IMPORTED_MODULE_18__.url_ccgi},"client.",client_uri);let opt=assign({},ccgi_opt,def,agents_opt,{ignore:def.ignore.concat(direct).concat("common_agents")});this.agents_check=new(_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_6___default().ConnectivityCheck)(copy(opt));def.common_agents=this.agents_check;opt=assign({},ccgi_opt,agents_opt,def);this.ccgi_check=new(_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_6___default().ConnectivityCheck)(copy(opt));const www_uri=CGA("www_uri","/conn_test");opt=assign(set_url({def_url:`https://${www_host}/`},"",www_uri),agents_opt,def);this.hola_check=new(_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_6___default().ConnectivityCheck)(copy(opt));const perr_uri=CGA("perr_uri","/client_cgi/perr/conn_test");opt=assign(set_url({def_url:conf__WEBPACK_IMPORTED_MODULE_18__.url_perr},"perr.",perr_uri),agents_opt,def);this.perr_check=new(_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_6___default().ConnectivityCheck)(copy(opt));this.inited=true;_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_6___default().on("lib_event",on_lib_event);this.check_agent_domain_fallback()};BgAjax.prototype.uninit=function(){let _this=this;this.inited=false;tests.forEach((function(name){name+="_check";if(_this[name])_this[name]=_this[name].uninit()}));if(this.agents_check)this.agents_check=this.agents_check.uninit();if(cloud_agents.et)cloud_agents.et.return();if(this.cookies_et)this.cookies_et.return();E.be_tab_unblocker.uninit_ajax_via_proxy();_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_6___default().off("lib_event",on_lib_event);_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_4___default().set("bg_ajax.is_active",false)};const get_query_params=qs=>{if(!qs)return;let res={};qs=typeof qs=="object"?qs:_util_url_js__WEBPACK_IMPORTED_MODULE_9___default().qs_parse(qs);for(let p in qs){if(qs[p]===undefined)continue;res[p]=qs[p]}return res};BgAjax.prototype._ajax=function(conn_info,req){let url=E.get_selected_url({info:conn_info,url:req.url});if(req.qs)url=_util_url_js__WEBPACK_IMPORTED_MODULE_9___default().qs_add(url,get_query_params(req.qs));if(!conn_info.agent||req.no_proxy){req=underscore__WEBPACK_IMPORTED_MODULE_0___default().omit(req,"url","qs");req.url=url;return do_ajax(req)}let opt=assign({always:true,ignore_redir:true,hdrs:assign({"Cache-Control":"no-cache,no-store,must-revalidate,"+"max-age=-1"},req.headers),force_headers:true,fix_307:true,src:"bg_ajax",agent:conn_info.agent,force:"proxy",prot:"proxy"},underscore__WEBPACK_IMPORTED_MODULE_0___default().pick(req,"data","with_credentials"));let method=req.method||"GET";if(opt.data){if(method=="GET"){url=_util_url_js__WEBPACK_IMPORTED_MODULE_9___default().qs_add(url,get_query_params(opt.data));delete opt.data}else{if(typeof opt.data=="object")opt.data=_util_escape_js__WEBPACK_IMPORTED_MODULE_8___default().qs(opt.data);opt.hdrs["Content-Type"]="application/x-www-form-urlencoded; "+"charset=UTF-8"}}let t=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_13___default().set_timeout((()=>et.throw(new Error(conn_info.agent.ip+" timeout"))),req.timeout||20*_util_date_js__WEBPACK_IMPORTED_MODULE_11___default().ms.SEC);let et=_util_etask_js__WEBPACK_IMPORTED_MODULE_3___default()({cancel:true},(function*ajax_via_proxy_(){this.finally((()=>_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_13___default().clear_timeout(t)));let res=yield E.be_tab_unblocker.ajax_via_proxy({url,type:method},opt);res=res||{};let err;if(err=res.orig_res&&(res.orig_res.error||res.orig_res.statusCode>=400&&"bad status code")){if(opt.no_throw)return{err,status:res.status||0};throw new Error(conn_info.agent.ip+" "+err)}let status=_util_util_js__WEBPACK_IMPORTED_MODULE_14___default().get(res.orig_res,"statusCode");let etag=_util_util_js__WEBPACK_IMPORTED_MODULE_14___default().get(res.orig_res,"headers.etag");try{res=res.data&&req.json?JSON.parse(res.data):res.data}catch(e){_util_zerr_js__WEBPACK_IMPORTED_MODULE_7___default()(_util_zerr_js__WEBPACK_IMPORTED_MODULE_7___default().e2s(e))}if(req.full_response)return{data:res,status,etag};return res}));return et};BgAjax.prototype.update_cookies=function(){let _this=this;return _util_etask_js__WEBPACK_IMPORTED_MODULE_3___default()({name:"update_cookies",cancel:true},(function*(){if(_this.cookies_et)return yield this.wait_ext(_this.cookies_et);_this.cookies_et=_util_etask_js__WEBPACK_IMPORTED_MODULE_3___default()((function*cookies_et_(){try{const res=yield _util_etask_js__WEBPACK_IMPORTED_MODULE_3___default().all({allow_fail:true},{hola:_util_etask_js__WEBPACK_IMPORTED_MODULE_3___default().cb_apply(chrome.cookies,".get",[test_info.hola.cookie]),zspeed:_util_etask_js__WEBPACK_IMPORTED_MODULE_3___default().cb_apply(chrome.cookies,".get",[test_info.zspeed.cookie]),hvpn:_util_etask_js__WEBPACK_IMPORTED_MODULE_3___default().cb_apply(chrome.cookies,".get",[test_info.hvpn.cookie]),holavpnextension:_util_etask_js__WEBPACK_IMPORTED_MODULE_3___default().cb_apply(chrome.cookies,".get",[test_info.holavpnextension.cookie]),hola_vpn:_util_etask_js__WEBPACK_IMPORTED_MODULE_3___default().cb_apply(chrome.cookies,".get",[test_info.hola_vpn.cookie]),holavpnrussia:_util_etask_js__WEBPACK_IMPORTED_MODULE_3___default().cb_apply(chrome.cookies,".get",[test_info.holavpnrussia.cookie])});if(!res.hola&&!res.zspeed&&!res.hvpn&&!res.holavpnextension&&!res.hola_vpn&&!res.holavpnrussia||res.hola&&res.zspeed&&res.hvpn&&res.holavpnextension&&res.hola_vpn&&res.holavpnrussia&&res.hola.value==res.zspeed.value&&res.hola.value==res.hvpn.value&&res.hola.value==res.holavpnextension.value&&res.hola.value==res.hola_vpn.value&&res.hola.value==res.holavpnrussia.value){return this.return()}let exp=[];for(let c in test_info){if(!test_info[c].cookie)continue;if(res[c]&&res[c].expirationDate)exp.push({name:c,date:res[c].expirationDate})}exp=exp.sort(((a,b)=>b.date-a.date))[0];for(let c in test_info){if(!test_info[c].cookie||res[c]&&res[c].expirationDate==exp.date){continue}yield _util_etask_js__WEBPACK_IMPORTED_MODULE_3___default().cb_apply(chrome.cookies,".remove",[test_info[c].cookie]);yield _util_etask_js__WEBPACK_IMPORTED_MODULE_3___default().cb_apply(chrome.cookies,".set",[assign(_util_util_js__WEBPACK_IMPORTED_MODULE_14___default().pick(res[exp.name],"expirationDate","sameSite","value","httpOnly","secure"),test_info[c].cookie)])}}catch(e){_util_zerr_js__WEBPACK_IMPORTED_MODULE_7___default()(_util_zerr_js__WEBPACK_IMPORTED_MODULE_7___default().e2s(e))}finally{delete _this.cookies_et}}));return yield _this.cookies_et}))};BgAjax.prototype.check_agent_domain_fallback=function(){if(!_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default().check_min_ver(CGA("enable_agent_domain_fallback_min_ver")))return;let _this=this;return _util_etask_js__WEBPACK_IMPORTED_MODULE_3___default()((function*check_agents_connectivity_(){let run_mode=CGA("parallel",true)?"run_parallel":"run";yield _this.agents_check[run_mode]();let selected=_this.agents_check&&_this.agents_check.selected;let domain=selected&&selected.agent&&selected.agent.fallback_domain;_this.agent_domain_fallback=domain;if(domain)_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default().perr("be_agent_domain_fallback",{agent:selected.agent})}))};BgAjax.prototype.need_agent_domain_fallback=function(){return!!this.agent_domain_fallback};BgAjax.prototype.get_agent_fallback_host=function(host){if(!this.agent_domain_fallback)return host;return host.replace("hola.org",this.agent_domain_fallback)};BgAjax.prototype.make_ajax=function(name,e,req){if(e.selected)return this._ajax(e.get_backend_link(),req);_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_4___default().set("bg_ajax.is_active",true);let _this=this;return _util_etask_js__WEBPACK_IMPORTED_MODULE_3___default()((function*make_ajax_(){if(e.run_et)yield this.wait_ext(e.run_et);else{this.finally((()=>e.run_et=undefined));yield E.be_tab_unblocker.init_ajax_via_proxy();e.run_et=e["run"+(CGA("parallel",true)?"_parallel":"")]();yield e.run_et;let link;if(e.selected&&(link=e.get_backend_link())&&!link.agent){E.set(name+"_selected",e.selected.name);let hostname=e.selected.success_url&&_util_url_js__WEBPACK_IMPORTED_MODULE_9___default().parse(e.selected.success_url).hostname;E.set(name+"_conn_hostname",hostname)}}return yield _this._ajax(e.get_backend_link(),req)}))};BgAjax.prototype.ccgi_ajax=function(req){return this.make_ajax("ccgi",this.ccgi_check,req)};BgAjax.prototype.hola_ajax=function(req){const _this=this,hc=this.hola_check;return _util_etask_js__WEBPACK_IMPORTED_MODULE_3___default()((function*hola_ajax_(){let link;if(hc.selected&&(link=hc.get_backend_link())&&!link.agent)yield _this.update_cookies();return yield _this.make_ajax("hola",hc,req)}))};BgAjax.prototype.perr_ajax=function(req){return this.make_ajax("perr",this.perr_check,req)};BgAjax.prototype.reset=function(type){let c=type+"_check",now=Date.now();if(!this[c]||this[c].error_ts&&now-this[c].error_ts<5*_util_date_js__WEBPACK_IMPORTED_MODULE_11___default().ms.MIN)return;this[c].reset();this[c].error_ts=now};function _ajax(req,type){req=assign({json:!req.text},req);return _util_etask_js__WEBPACK_IMPORTED_MODULE_3___default()((function*_ajax_(){try{const name=type+"_ajax";return bg_ajax&&bg_ajax.inited&&bg_ajax[name]?yield bg_ajax[name](req):yield do_ajax(req)}catch(e){let is_on=CGA("enable");if(is_on&&bg_ajax&&!req.no_proxy){if(E.get_agent_fallback(type)){bg_ajax.reset("agents");for(let t of tests){if(t!=type&&E.get_agent_fallback(t))bg_ajax.reset(t)}}bg_ajax.reset(type)}else if(!is_on&&bg_ajax)bg_ajax=bg_ajax.uninit();throw e}}))}const get_myip=proxy=>_util_etask_js__WEBPACK_IMPORTED_MODULE_3___default()((function*_get_myip(){let host=proxy.host||(proxy.name?proxy.name+".hola.org":null);let proto=host?"https":"http";let url=`${proto}://${host||proxy.ip}:${proxy.port}/myip`;try{return yield do_ajax({url,retry:3,expect:200,json:true})}catch(e){_util_zerr_js__WEBPACK_IMPORTED_MODULE_7___default()("failed to detect location - "+_util_zerr_js__WEBPACK_IMPORTED_MODULE_7___default().e2s(e))}}));E.need_agent_domain_fallback=()=>bg_ajax&&bg_ajax.need_agent_domain_fallback();E.get_agent_fallback_host=host=>bg_ajax&&bg_ajax.get_agent_fallback_host(host);E.is_agent_fallback=()=>{if(is_agent_fallback)return true;for(let t of tests){if(E.get_agent_fallback(t))return true}};E.is_http_fallback=()=>{for(let t of tests){const e=get_selected(t);if(e&&e.name=="http")return true}};const get_selected=name=>{name=name||"ccgi";let e=bg_ajax&&bg_ajax[name+"_check"];return e&&e.selected&&e.get_backend_link()};E.get_agent_fallback=name=>{const e=get_selected(name);return e&&e.agent};E.get_selected_url=opt=>{let url,e=opt.info||get_selected(opt.name);if(url=e&&e.url){let burl=_util_url_js__WEBPACK_IMPORTED_MODULE_9___default().parse(url),rurl=_util_url_js__WEBPACK_IMPORTED_MODULE_9___default().parse(opt.url);url=burl.protocol+"//"+burl.hostname+rurl.path}return url||opt.url};const find_agent=ip=>{let agents=_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_6___default().find_agents({ip});if(agents&&agents.length)return agents[0];if(cloud_agents.agents){let agent=cloud_agents.agents.find((a=>a.ip==ip));if(agent)return agent}if(conf__WEBPACK_IMPORTED_MODULE_18__.agents){let agent=conf__WEBPACK_IMPORTED_MODULE_18__.agents.find((a=>a.ip==ip));if(agent)return agent}};E.get_location=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_3___default()((function*get_location(){let info,agent;if(agent=E.get_agent_fallback()){_util_zerr_js__WEBPACK_IMPORTED_MODULE_7___default().notice("get_location: use agent");return yield get_myip(agent)}try{_util_zerr_js__WEBPACK_IMPORTED_MODULE_7___default().notice("get_location: use ccgi");info=yield E.ccgi_ajax({qs:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_4___default().auth(),url:conf__WEBPACK_IMPORTED_MODULE_18__.url_ccgi+"/fetch_info",retry:1,no_proxy:true})}catch(e){_util_zerr_js__WEBPACK_IMPORTED_MODULE_7___default()("get_location failed: "+_util_zerr_js__WEBPACK_IMPORTED_MODULE_7___default().e2s(e))}if(info&&info.req&&info.req.ip){agent=find_agent(info.req.ip);if(agent)info=null}if(agent=E.get_agent_fallback()||agent){_util_zerr_js__WEBPACK_IMPORTED_MODULE_7___default().notice("get_location: use agent");return yield get_myip(agent)}return(info||{}).req}));E.is_active=()=>_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_4___default().get("bg_ajax.is_active");E.ccgi_ajax=req=>_ajax(req,"ccgi");E.hola_ajax=req=>_ajax(req,"hola");E.perr_ajax=req=>_ajax(req,"perr");E.ajax=(req,type)=>{type=type||(_util_url_js__WEBPACK_IMPORTED_MODULE_9___default().parse(req.url).hostname||"").split(".")[0];if(type=="client")type="ccgi";return _ajax(req,type)};E.hola_hostname=()=>{if(CG("disable_hola_hostname_fallback"))return www_host;return E.get("hola_conn_hostname")||www_host};E.hola_url=()=>"https://"+E.hola_hostname();function update_config(){bext_config=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_4___default().get("bext_config")||{};let s;if((s=CGA("on"))&&_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default().is_conf_allowed(s))CSA("enable",true);if((s=CGA("min_version"))&&_util_version_util_js__WEBPACK_IMPORTED_MODULE_12___default().cmp(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default().version(),s)<0)CSA("enable",false);if(CGA("enable")==E.is_enabled)return;if(E.is_enabled=CGA("enable"))init();else uninit()}const update_state=()=>{let is_enabled=!!_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_4___default().get("enabled");if(is_enabled==E.is_enabled)return;E.is_enabled=is_enabled;if(E.is_enabled=is_enabled)init();else uninit()};E.init=function(be_tab_unblocker){E.uninit();chrome=self.chrome;if(E.be_tab_unblocker=be_tab_unblocker)E.be_tab_unblocker.be_bg_ajax=this;E.listen_to(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_4___default(),"change:bext_config",update_config);E.listen_to(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_4___default(),"change:ext.active",update_state);update_config()};E.reset=function(force){if(!bg_ajax&&!force)return;if(bg_ajax)bg_ajax.uninit();bg_ajax=new BgAjax;bg_ajax.init()};function init(){if(bg_ajax||!CGA("enable"))return;bg_ajax=new BgAjax;bg_ajax.init();_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default().set_ajax_cb((req=>E.perr_ajax(req)))}function is_dev_build(){return _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default().browser()=="chrome"&&(_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_2___default().runtime.id!="gkojfkhlekighikafcpjkiklfbnlmeio"&&_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_2___default().runtime.id!="bbjkgcbckkalmlpimfinpdmaelnknlee")||_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default().browser()=="opera"&&_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_2___default().runtime.id!="ekmmelpnmfdegjhnmadddcfjcahpajnm"||_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default().browser()=="edge"&&_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_2___default().runtime.id!="eibinhpjpbkmjeohlclnebmkhdfehpbf"}E.hola_api_call=(path,opt)=>{opt=opt||{};opt.method=opt.method||"GET";const xsrf_header=(conf__WEBPACK_IMPORTED_MODULE_18__.firefox_web_ext||is_dev_build())&&!["GET","HEAD","OPTIONS"].includes(opt.method);return _util_etask_js__WEBPACK_IMPORTED_MODULE_3___default()((function*hola_api_call_(){const c=!xsrf_header?undefined:yield _util_etask_js__WEBPACK_IMPORTED_MODULE_3___default().cb_apply(chrome.cookies,".get",[{url:`https://${www_host}/`,name:"XSRF-TOKEN"}]);return yield E.hola_ajax({url:`https://${www_host}/`+path,qs:opt.qs,data:opt.data,method:opt.method,headers:c&&{"x-xsrf-token":c.value},text:opt.text,json:!opt.text,with_credentials:true})}))};function uninit(){if(bg_ajax)bg_ajax=bg_ajax.uninit();_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default().set_ajax_cb()}E.uninit=()=>{uninit();E.stopListening()};if(_util_util_js__WEBPACK_IMPORTED_MODULE_14___default().is_mocha())E.t={BgAjax,cloud_agents,load_agents};const __WEBPACK_DEFAULT_EXPORT__=E},7362:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var underscore__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(7439);var underscore__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(underscore__WEBPACK_IMPORTED_MODULE_0__);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(6969);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1__);var _util_etask_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(6386);var _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_util_etask_js__WEBPACK_IMPORTED_MODULE_2__);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(9824);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_util_zerr_js__WEBPACK_IMPORTED_MODULE_3__);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(7345);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4__);var _bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(8552);var _bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(737);var _bext_vpn_bg_mode_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(1002);var _bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(8076);var _bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(3886);var _bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(4130);var _bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_10___default=__webpack_require__.n(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_10__);var _bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(6210);var _bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(9265);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(5250);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_13___default=__webpack_require__.n(_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_13__);var _bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(7666);var zon_config__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(4118);var conf__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(9641);
// LICENSE_CODE ZON
_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_13___default().assert_bg("be_ccgi");const E=new(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1___default().model),chrome=self.chrome;E.init=be_ext=>{if(E.inited)return;E.inited=true;E.init_ts=Date.now();E.sp=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_13___default().new_etask("be_ccgi");E.be_ext=be_ext;E.be_mode=_bext_vpn_bg_mode_js__WEBPACK_IMPORTED_MODULE_7__.Z;E.listening=false;start_listen();E.on("destroy",E.uninit)};E.uninit=()=>{E.sp.return();stop_listen()};function start_listen(){if(E.listening)return;chrome.runtime.onMessage.addListener(ccgi_ipc_handler);E.listening=true}function stop_listen(){if(!E.listening)return;chrome.runtime.onMessage.removeListener(ccgi_ipc_handler);E.listening=false}function send_msg(msg,resp_cb){try{return resp_cb(msg)}catch(e){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().perr("be_ccgi_send_err",msg.id,{err:e,filehead:_util_zerr_js__WEBPACK_IMPORTED_MODULE_3___default().json(msg)})}}function ccgi_resp(msg,resp_cb){underscore__WEBPACK_IMPORTED_MODULE_0___default().defer(send_msg,msg,resp_cb);return true}function ccgi_ipc_handler(msg,sender,resp_cb){if(!E.inited||msg._type&&msg._type!="ccgi")return;switch(msg.id){case"callback":msg.data={init_ts:E.init_ts,install_ts:E.be_ext.get("install_ts"),connected:E.be_ext.get("enabled"),disable:!E.be_ext.get("enabled"),uuid:E.be_ext.get("uuid"),session_key:E.be_ext.get("session_key")||0,ver:_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().version(),mode:E.be_mode.get("mode"),mode_duration:Date.now()-E.be_mode.get("ts"),pending:E.be_mode.get("pending"),type:conf__WEBPACK_IMPORTED_MODULE_16__.type,browser:_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().browser(),release:zon_config__WEBPACK_IMPORTED_MODULE_15__._RELEASE,svc_mode:_bext_vpn_bg_mode_js__WEBPACK_IMPORTED_MODULE_7__.Z.get("mode"),svc_mode_pending:_bext_vpn_bg_mode_js__WEBPACK_IMPORTED_MODULE_7__.Z.get("pending"),svc_info:E.be_mode.get("svc.info"),build_info:_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().build_info(),has_opened_popup:_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_11__["default"].get("has_opened_popup")};return ccgi_resp(msg,resp_cb);case"enable":E.be_ext.set("enabled",!!msg.data);break;case"ping":msg.data={uuid:E.get("uuid"),session_key:E.get("session_key")||0,ver:_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().version(),type:conf__WEBPACK_IMPORTED_MODULE_16__.type,browser:E.get("browser")};return ccgi_resp(msg,resp_cb);case"open_be_tab":_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_5__["default"].open_be_tab(msg.opt);break}if(!_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_9__.Z.get("inited")){_util_zerr_js__WEBPACK_IMPORTED_MODULE_3___default().notice("skip msg.id %s, be_vpn not inited",msg.id);return}switch(msg.id){case"svc_callback":msg.data=null;E.sp.spawn(_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({name:"svc_callback",cancel:true},(function*(){try{const r=yield _bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_6__["default"].callback({raw:1});r.from_be=true;msg.data=r;ccgi_resp(msg,resp_cb)}catch(e){ccgi_resp(msg,resp_cb)}})));return true;case"update_rules":msg.data={};try{_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_8__.Z.trigger("fetch_rules",false)}catch(e){}return ccgi_resp(msg,resp_cb);case"vpn_enable":msg.data={};E.sp.spawn(_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({name:"vpn_enable",cancel:true},[function(){},function catch$(err){return msg.data.err=""+err},function finally$(){return ccgi_resp(msg,resp_cb)}]));return true;case"perr":_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().perr(msg.perr_id,JSON.parse(msg.info));break;case"set_rule":msg.data={};E.sp.spawn(_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({name:"set_rule",cancel:true},(function*(){try{return yield _bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_8__.Z.set_rule(msg.opt)}catch(e){return msg.data.err=""+e}finally{if(!msg.no_resp)ccgi_resp(msg,resp_cb)}})));return!msg.no_resp;case"fetch_rules":msg.data={};E.sp.spawn(_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({name:"fetch_rules",cancel:true},(function*(){try{yield _bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_8__.Z.update_rules();return msg.data.rules=yield _bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_8__.Z.get("rules")}catch(e){return msg.data.err=""+e}finally{if(!msg.no_resp)ccgi_resp(msg,resp_cb)}})));return!msg.no_resp;case"enable_root_url":msg.data={};E.sp.spawn(_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({name:"enable_root_url",cancel:true},(function*(){try{return msg.data.rule=yield _bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_9__.Z.enable_root_url(msg.opt)}catch(e){return msg.data.err=""+e}finally{if(!msg.no_resp)ccgi_resp(msg,resp_cb)}})));return!msg.no_resp;case"refresh_membership":_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_12__["default"].schedule_refresh_user(Object.assign({force_premium:true,reason:"ccgi_call"},msg.data));break;case"get_log":break;case"set_dont_show_again":try{E.sp.spawn(_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_11__["default"].set_dont_show_again(msg.data))}catch(e){}break;case"set_svc_downloaded":return ccgi_resp(msg,resp_cb);case"is_dont_show":E.sp.spawn(_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function(){try{msg.data={is_dont_show:_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_11__["default"].is_dont_show(msg.data.root_url)};ccgi_resp(msg,resp_cb)}catch(e){ccgi_resp(msg,resp_cb)}})));return true;case"set_enabled_for_browser":try{E.sp.spawn(_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_9__.Z.set_enabled_for_browser(msg.data.enable,{country:"us"}))}catch(e){}break;case"is_enabled_for_browser":E.sp.spawn(_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function(){try{msg.data={enable:_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_9__.Z.is_enabled_for_browser()};ccgi_resp(msg,resp_cb)}catch(e){ccgi_resp(msg,resp_cb)}})));return true;case"set_browser_country":try{let{country}=msg.data;E.sp.spawn(_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*(){try{msg.data.result=yield _bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_9__.Z.set_browser_country({country,tab_id:sender.tab.id,src:"new_tab"});ccgi_resp(msg,resp_cb)}catch(e){msg.data.err=""+e;ccgi_resp(msg,resp_cb)}})))}catch(e){}return true;case"get_browser_country":E.sp.spawn(_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function(){try{let rule=_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_9__.Z.get_all_browser_rule();msg.data={enable:_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_9__.Z.is_enabled_for_browser(),country:rule&&rule.country};ccgi_resp(msg,resp_cb)}catch(e){ccgi_resp(msg,resp_cb)}})));return true;case"force_full_browser_mode":try{E.sp.spawn(_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*(){try{yield _bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_9__.Z.force_full_browser_mode(msg.data.enable);ccgi_resp(msg,resp_cb)}catch(e){msg.data.err=""+e;ccgi_resp(msg,resp_cb)}})))}catch(e){}return true;case"get_full_browser_mode":E.sp.spawn(_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function(){try{msg.data={enabled:_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().full_browser_mode()};ccgi_resp(msg,resp_cb)}catch(e){ccgi_resp(msg,resp_cb)}})));return true;case"force_suggestion":E.sp.spawn(_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({name:"force_suggestion",cancel:true},(function*(){try{return yield _bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_10___default().set_force_suggestion(msg.tab_id||sender.tab.id,true)}catch(e){return msg.data.err=""+e}finally{if(!msg.no_resp)ccgi_resp(msg,resp_cb)}})));return!msg.no_resp;case"set_trial_experiment":return ccgi_resp(msg,resp_cb);case"shoop_force_url":return;case"get_ext_timer":E.sp.spawn(_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function(){try{const trial=_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_14__["default"].get_trial_active("newtab");if(!trial)msg.data={trial:false};else{const timer_trial=trial.interval_ts||trial.start_ts;const add=_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_14__["default"].get_used_cycle_time("newtab",true);msg.data={trial:true,timer:timer_trial-add}}msg.data.is_premium=E.be_ext.get("is_premium");ccgi_resp(msg,resp_cb)}catch(e){ccgi_resp(msg,resp_cb)}})));return true;default:_util_zerr_js__WEBPACK_IMPORTED_MODULE_3___default()("unknown ccgi message "+_util_zerr_js__WEBPACK_IMPORTED_MODULE_3___default().json(msg))}}if(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().is_v3)start_listen();const __WEBPACK_DEFAULT_EXPORT__=E},1679:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(6969);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_0__);var _bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(6210);var _bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(8076);var _bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(4130);var _bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_3__);var _svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(843);var _svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_4__);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(3727);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_5__);var _bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(8552);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(5250);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_7__);var _util_etask_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(6386);var _util_etask_js__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(_util_etask_js__WEBPACK_IMPORTED_MODULE_8__);var _util_util_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(1291);var _util_util_js__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(_util_util_js__WEBPACK_IMPORTED_MODULE_9__);var _util_ajax_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(918);var _util_ajax_js__WEBPACK_IMPORTED_MODULE_10___default=__webpack_require__.n(_util_ajax_js__WEBPACK_IMPORTED_MODULE_10__);var _util_date_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(932);var _util_date_js__WEBPACK_IMPORTED_MODULE_11___default=__webpack_require__.n(_util_date_js__WEBPACK_IMPORTED_MODULE_11__);var _svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(2227);var _svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_12___default=__webpack_require__.n(_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_12__);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(7345);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_13___default=__webpack_require__.n(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_13__);
// LICENSE_CODE ZON
const chrome=self.chrome;const E=new(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_0___default().task_model.extend({model_name:"dev_mode"}));const assign=Object.assign;E.force_tpopup=type=>{var tab_url=_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_3___default().get("active.url");var tab_id=_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_3___default().get("active.id");if(!tab_url||!tab_id)return;var domain=_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().get_root_url(tab_url);_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_1__["default"].set_force_tpopup(domain,type);if(type=="suggestion")_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_3___default().set_force_suggestion(tab_id,true);chrome.tabs.reload(tab_id)};const on_change_mode=()=>{_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_5___default().set("dev_mode",E.get("dev_mode"));_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().enable_events_logging(E.get("dev_mode"))};function on_change(e){_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_6__["default"].storage_local_set({dev_mode_conf:e.attributes});E.trigger("change:dev_mode")}const get_debug_peer_rule=opt=>{let popt;if(!(popt=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_7___default().get_peer_filter_opt(opt.filter)))return;const rule={name:"debug_peer",root_url:"debug_peer",enabled:+!!(opt.on&&E.get("debug_proxy")&&(opt.proxy_traffic||opt.def_traffic)),country:popt.country||"us",no_reload:true,def_traffic:opt.def_traffic,proxy_traffic:opt.proxy_traffic};_util_util_js__WEBPACK_IMPORTED_MODULE_9___default().if_set(popt.asn,rule,"asnum");_util_util_js__WEBPACK_IMPORTED_MODULE_9___default().if_set(popt.cid,rule,"cid");_util_util_js__WEBPACK_IMPORTED_MODULE_9___default().if_set(popt.country,rule,"peer_country");_util_util_js__WEBPACK_IMPORTED_MODULE_9___default().if_set(popt.ip,rule,"peer_ip");return rule};function on_change_debug_peer(e){let rule,debug_peer=E.get("debug_peer")||{filter:""};if(!(rule=get_debug_peer_rule(debug_peer)))return;_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_2__.Z.trigger("set_rule",rule)}E.enable=dev_mode=>E.set("dev_mode",!!dev_mode);E.init=()=>{E.on("change:dev_mode",on_change_mode);E.on("change:debug_peer change:debug_proxy",on_change_debug_peer);return _util_etask_js__WEBPACK_IMPORTED_MODULE_8___default()((function*dev_mod_init(){let o=yield _bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_6__["default"].storage_local_get("dev_mode_conf");_util_util_js__WEBPACK_IMPORTED_MODULE_9___default().forEach(o,((name,val)=>E.set(name,val)));E.on("change",on_change)}))};E.uninit=()=>{E.off("change",on_change);E.off("change:dev_mode",on_change_mode);E.off("change:debug_peer change:debug_proxy",on_change_debug_peer)};E.get_debug_peer_info=(top_url,opt)=>_util_etask_js__WEBPACK_IMPORTED_MODULE_8___default()((function*get_debug_peer_info(){const res={curl:"",cid:""};const rule=get_debug_peer_rule(opt);if(!rule||!rule.enabled)return assign({err:"rule not found or disabled"},res);let agent=_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_12___default().get_chosen_agent({country:rule.country},rule);if(!agent)return assign({err:"agent not found"},res);let port,plist;if(plist=agent.port_list)port=agent.port==plist.direct?25333:+agent.port+1e3;port=port||agent.port;let qs=assign({proxy_country:rule.country,ping_id:"debug_peer",root_url:rule.name},_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_13___default().qs_ajax({uuid:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_5___default().get("uuid")}));try{qs.key=(yield _bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_6__["default"].storage_local_get("agent_key")).agent_key}catch(e){}_util_util_js__WEBPACK_IMPORTED_MODULE_9___default().if_set(rule.asnum,qs,"asnum");_util_util_js__WEBPACK_IMPORTED_MODULE_9___default().if_set(rule.cid,qs,"peer_cid");_util_util_js__WEBPACK_IMPORTED_MODULE_9___default().if_set(rule.peer_country,qs,"peer_country");_util_util_js__WEBPACK_IMPORTED_MODULE_9___default().if_set(rule.peer_ip,qs,"peer_ip");let url="https://"+(agent.host||agent.ip)+":"+port+"/verify_proxy";let verify,t0=Date.now();try{verify=yield _util_ajax_js__WEBPACK_IMPORTED_MODULE_10___default().json({timeout:20*_util_date_js__WEBPACK_IMPORTED_MODULE_11___default().ms.SEC,url,qs})}catch(e){}if(!verify||verify.error)return assign({error:verify.error||"verify request failed"},res);res.cid=verify.cid||"not_found";let m;if(verify.cid&&(m=verify.cid.match(/_(\d+\.\d+\.\d+\.\d+)_/)))res.peer_ip=m[1];res.curl=`curl '${top_url}' --proxy 'http://${agent.host}:${port}' `+"--proxy-user "+_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_7___default().get_user_name(qs)+":"+qs.key;return res}));E.change_peer=opt=>_util_etask_js__WEBPACK_IMPORTED_MODULE_8___default()((function*change_peer(){const rule=get_debug_peer_rule(opt);yield _bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_2__.Z.change_proxy_wait({rule,desc:"not_working",root_url:rule.root_url,tab_id:rule.name})}));const __WEBPACK_DEFAULT_EXPORT__=E},7310:(module,exports,__webpack_require__)=>{var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;var module;
// LICENSE_CODE ZON
"use strict";(function(){const is_node=typeof module=="object"&&module.exports&&module.children;if(!is_node);else;!(__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(6386),__webpack_require__(5305),__webpack_require__(1291)],__WEBPACK_AMD_DEFINE_RESULT__=((etask,zurl,zutil)=>{const E={},assign=Object.assign;const is_force_rule_for_country=(rule,country)=>{if(!country)return true;if(rule.countries)return rule.countries.includes(country);if(rule.exclude_countries)return!rule.exclude_countries.includes(country);return true};E.convert_blob2check=(conf,name)=>{const rules=conf&&conf[name]&&conf[name].rules;if(!rules)return;conf[name].rules=rules.map((rule=>assign({},rule,{domain:new RegExp("^"+zurl.http_glob_host(rule.domain)+"$")})))};E.find_rule=(root_url,conf,name,src_country)=>{const rules=conf&&conf[name]&&conf[name].rules;if(!rules||!root_url)return;return rules.find((rule=>{if(!rule.domain.test(root_url))return false;return is_force_rule_for_country(rule,src_country)}))};return E}).apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))})()},8084:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var underscore__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(7439);var underscore__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(underscore__WEBPACK_IMPORTED_MODULE_0__);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(6969);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1__);var _util_etask_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(6386);var _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_util_etask_js__WEBPACK_IMPORTED_MODULE_2__);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(3727);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3__);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(7345);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4__);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(9824);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(_util_zerr_js__WEBPACK_IMPORTED_MODULE_5__);var _util_util_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(1291);var _util_util_js__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(_util_util_js__WEBPACK_IMPORTED_MODULE_6__);var _bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(8076);var _bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(5371);var _bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_8__);var _bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(4130);var _bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_9__);var _bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(1211);var _bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_10___default=__webpack_require__.n(_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_10__);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(5250);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_11___default=__webpack_require__.n(_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_11__);
// LICENSE_CODE ZON
_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_11___default().assert_bg("be_icon");const E=new(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1___default().task_model.extend({model_name:"icon"}));const chrome=self.chrome,assign=Object.assign;const v3=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().is_v3;const action=v3?chrome.action:chrome.browserAction;let icons={},cache_icons={};const images={gray:{19:"js/bext/vpn/ui/img/icon19_gray.png",38:"js/bext/vpn/ui/img/icon38_gray.png"},ok:{19:"js/bext/vpn/ui/img/icon19.png",38:"js/bext/vpn/ui/img/icon38.png"},mitm_icon:{19:"js/bext/vpn/ui/img/ic_unblock19.png",38:"js/bext/vpn/ui/img/ic_unblock38.png"},error_icon:{19:"js/bext/vpn/ui/img/ic_error_19.png",38:"js/bext/vpn/ui/img/ic_error_38.png"}};const FLAGS_PATH=v3?"svc/vpn/pub/img/flag/32/":"js/svc/vpn/pub/img/flag/svg_4x3/";E.uninit=()=>{if(!E.get("inited"))return;cache_icons={};E.off("destroy",E.uninit);E.off("refresh",on_refresh);E.stopListening();E.sp.return();E.clear()};E.init=()=>{if(E.get("inited"))return;cache_icons={};E.set("inited",true);E.sp=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_11___default().new_etask("be_icon");E.on("destroy",E.uninit);E.on("refresh",on_refresh);E.listenTo(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default(),"change:enabled",refresh_all);E.listenTo(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default(),"change:ext.conflict",refresh_all);E.listenTo(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default(),"change:no_permission",refresh_all);E.listenTo(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default(),"mitm_change",refresh_active);E.listenTo(_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_7__.Z,"change:stamp",refresh_active);E.listenTo(_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_7__.Z,"change:rules",refresh_active);E.listenTo(_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_7__.Z,"change:tabs_stub_rules",refresh_active);E.listenTo(_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_8___default(),"change:tab_load_err",refresh_active);E.listenTo(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_9___default(),"change:active.url change:active.id",refresh_active);E.listenTo(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_9___default(),"updated",(o=>{if(!o.info.url&&!o.info.status)return;E.refresh({tab:o.tab})}));E.listenTo(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_9___default(),"completed",(o=>{if(!o.frameId&&o.tabId>=0)E.refresh({tabId:o.tabId})}));refresh_all()};function refresh_active(){E.refresh({retry:1})}function refresh_all(){icons={};refresh(null);chrome.tabs.query({},(tabs=>tabs.forEach((tab=>{var url=tab&&tab.url||"",rule=get_rule(url,tab&&tab.id);if(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().get("enabled")&&(!rule||!rule.enabled||!rule.country))return;refresh(tab)}))))}function tab_opt(tab,opt){return assign(opt,tab?{tabId:tab.id}:{})}function set_icon_cb(retry){return function(){if(!_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_10___default().runtime.last_error)return;var err=_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_10___default().runtime.last_error.message||_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_10___default().runtime.last_error;_util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default()("set_icon_err: ",err);if(!underscore__WEBPACK_IMPORTED_MODULE_0___default().isNumber(retry))return;if(retry>0)return E.refresh({retry:retry-1});_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().perr("set_icon_err",{retry},{rate_limit:{count:1},err})}}function is_path_eq(a,b){if(!a||!b)return;if(typeof a=="string"||typeof b=="string")return a==b;var keys=Object.keys(a);if(keys.length!=Object.keys(b).length)return;for(var i=0;i<keys.length;i++){if(a[keys[i]]!=b[keys[i]])return}return true}const get_image_data=(path,size)=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*_get_image_data(){path=chrome.runtime.getURL(path);let image=yield load_image(path);size=(self.devicePixelRatio||1)*size;const canvas=document.createElement("canvas");const ctx=canvas.getContext("2d");if(typeof ctx.filter!="undefined")image=smooth_image(image,size);canvas.width=canvas.height=size;let dwidth=size,dheight=size;if(image.width>=image.height)dheight*=image.height/image.width;else dwidth*=image.width/image.height;ctx.drawImage(image,(size-dwidth)/2,(size-dheight)/2,dwidth,dheight);return ctx.getImageData(0,0,size,size)}));const get_icon=(name,data)=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*_get_icon(){if(cache_icons[name]){return cache_icons[name].et?yield this.wait_ext(cache_icons[name].et):cache_icons[name].data}this.on("finally",(()=>cache_icons[name].et=undefined));let e=cache_icons[name]={et:this,data:{}};for(let size in data)e.data[size]=yield get_image_data(data[size],size);return e.data}));const set_icon=(opt,cb)=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*_set_icon(){const id=opt.tabId!==undefined?opt.tabId:"global";const name=opt.name;let path=images[name]||FLAGS_PATH+name+(v3?".png":".svg");if(v3){if(typeof path=="object"){for(let key in path)path[key]=path[key].replace("js/bext","bext")}else path=path.replace("js/bext","bext")}if(is_path_eq(icons[id],path)&&is_path_eq(icons.global,path))return cb&&cb();icons[id]=path;let data=typeof path=="string"?{32:path}:path;if(v3)action.setIcon(assign(_util_util_js__WEBPACK_IMPORTED_MODULE_6___default().pick(opt,"tabId"),{path:data}),cb);else{action.setIcon(assign(_util_util_js__WEBPACK_IMPORTED_MODULE_6___default().pick(opt,"tabId"),{imageData:yield get_icon(name,data)}),cb)}}));let get_rule=(url,tab_id)=>{let stub_rule=tab_id&&_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_7__.Z.get_stub_rule(tab_id);if(stub_rule&&stub_rule.enabled&&_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_11___default().is_stub_url(url,_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().get("is_premium"))){return stub_rule}return _bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_7__.Z.get_rules(url)[0]};const load_image=url=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*_load_image_(){const img=new Image;img.onload=()=>this.return(img);img.src=url;yield this.wait()}));function smooth_image(image,max_size){var steps=Math.max(image.width,image.height)/max_size>>1;var canvas=document.createElement("canvas");var ctx=canvas.getContext("2d");canvas.width=image.width;canvas.height=image.height;ctx.filter="blur("+steps+"px)";ctx.drawImage(image,0,0);return canvas}const refresh=(tab,retry)=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*_refresh(){const cb=set_icon_cb(retry);if(!_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().get("enabled")||_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().get("ext.conflict")||_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().get("ext.suspended")||_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().get("no_permission")){yield set_icon(tab_opt(tab,{name:"gray"}),cb);action.setBadgeText(tab_opt(tab,{text:"off"}));action.setBadgeBackgroundColor(tab_opt(tab,{color:"#FF8800"}));return}const url=tab&&tab.url||"",tab_id=tab&&tab.id;action.setBadgeText(tab_opt(tab,{text:""}));if(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().proxy_error_ui_enabled("icon")&&tab_id&&_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_8___default().get_tab_load_err(tab_id)){yield set_icon(tab_opt(tab,{name:"error_icon"}),cb);return}const rule=get_rule(url,tab_id);if(!_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().get("enabled")||!rule||!rule.enabled||!rule.country){yield set_icon(tab_opt(tab,{name:"ok"}),cb);if(rule&&!rule.country){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().perr("icon_no_country_err",{url,rule},{rate_limit:{count:1}})}return}if(rule.mitm)return void(yield set_icon(tab_opt(tab,{name:"mitm_icon"}),cb));yield set_icon(tab_opt(tab,{name:rule.country.toLowerCase()}),cb)}));E.refresh=o=>E.trigger("refresh",o);function on_refresh(o){if(!E.get("inited"))return;E.sp.spawn({name:"refresh",cancel:true},_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*on_r_(){try{const tab=o&&o.tab?o.tab:o&&o.tabId?yield _bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_9___default().get_tab(o.tabId):yield _bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_9___default().active();if(!tab)return;return yield refresh(tab,o&&o.retry)}catch(e){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().perr("be_icon_refresh_err",{},{err:e})}})))}const __WEBPACK_DEFAULT_EXPORT__=E},6210:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var underscore__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(7439);var underscore__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(underscore__WEBPACK_IMPORTED_MODULE_0__);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(6969);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1__);var _util_etask_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(6386);var _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_util_etask_js__WEBPACK_IMPORTED_MODULE_2__);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(3727);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3__);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(7345);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4__);var _util_util_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(1291);var _util_util_js__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(_util_util_js__WEBPACK_IMPORTED_MODULE_5__);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(9824);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(_util_zerr_js__WEBPACK_IMPORTED_MODULE_6__);var _util_date_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(932);var _util_date_js__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(_util_date_js__WEBPACK_IMPORTED_MODULE_7__);var _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(9651);var _util_storage_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(8915);var _util_storage_js__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(_util_storage_js__WEBPACK_IMPORTED_MODULE_9__);var _bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(737);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(5250);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_11___default=__webpack_require__.n(_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_11__);var _svc_hola_pub_svc_ipc_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(764);var _svc_hola_pub_svc_ipc_js__WEBPACK_IMPORTED_MODULE_12___default=__webpack_require__.n(_svc_hola_pub_svc_ipc_js__WEBPACK_IMPORTED_MODULE_12__);var _util_url_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(5305);var _util_url_js__WEBPACK_IMPORTED_MODULE_13___default=__webpack_require__.n(_util_url_js__WEBPACK_IMPORTED_MODULE_13__);var conf__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(9641);
// LICENSE_CODE ZON
_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_11___default().assert_bg("be_info");const chrome=self.chrome;const E=new(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1___default().task_model.extend({model_name:"info",_defaults:function(){this.on("destroy",(()=>E.uninit()))}}));let unblocking_rate={};const on_location=underscore__WEBPACK_IMPORTED_MODULE_0___default().debounce((()=>{const location=E.get("location");E.set("country",location?location.country:null);_util_storage_js__WEBPACK_IMPORTED_MODULE_9___default().set("src_country",E.get("country"))}));E.init=()=>{if(E.get("inited"))return;_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().set_perr_cb(perr_res_cb);E.set("inited",true);E.set("vpn_work_yes",_util_storage_js__WEBPACK_IMPORTED_MODULE_9___default().get_int("vpn_work_yes"));E.set("vpn_last_rating",_util_storage_js__WEBPACK_IMPORTED_MODULE_9___default().get_int("vpn_last_rating"));E.set("rate_on_store",_util_storage_js__WEBPACK_IMPORTED_MODULE_9___default().get_int("rate_on_store"));E.set("location",_util_storage_js__WEBPACK_IMPORTED_MODULE_9___default().get_json("location"));E.set("has_opened_popup",_util_storage_js__WEBPACK_IMPORTED_MODULE_9___default().get_int("has_opened_popup"));E.sp=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_11___default().new_etask("be_info");E.on("recover",E.fetch_info);E.on_init("change:location",on_location);E.listen_to(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default(),"change:ext.active change:uuid change:ext.suspended",E.fetch_info);E.listen_to(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default(),"change:user_id",E.set_user_id);E.set("settings",_util_storage_js__WEBPACK_IMPORTED_MODULE_9___default().get_json("settings")||{});unblocking_rate={};E.trigger("inited")};E.uninit=()=>{if(!E.get("inited"))return;_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().set_perr_cb();E.sp.return();unblocking_rate={};E.off("change:location",on_location);E.off("recover",E.fetch_info);E.stopListening();E.clear()};const perr_res_cb=res=>{if(res&&res.ip&&res.country&&!(_bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_8__.Z.is_active()&&_bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_8__.Z.get_agent_fallback("perr"))){set_location(res)}};const set_location=opt=>{if(!opt)return;let{ip,country}=opt;const location=E.get("location");if(location&&location.ip==ip&&location.country==country)return;E.set("location",{ip,country});_util_storage_js__WEBPACK_IMPORTED_MODULE_9___default().set_json("location",{ip,country})};const set_settings=settings=>{settings=settings||{};_util_storage_js__WEBPACK_IMPORTED_MODULE_9___default().set_json("settings",settings);E.set("settings",settings)};E.get_unblocking_rate_url=(limit,src_country)=>{src_country=(src_country||"").toLowerCase();const url=conf__WEBPACK_IMPORTED_MODULE_14__.url_ccgi+"/unblocking_rate";return _util_url_js__WEBPACK_IMPORTED_MODULE_13___default().qs_add(url,{src_country,limit})};E.get_unblocking_rate=(limit,src_country)=>{src_country=(src_country||E.get("country")||"").toLowerCase();if(!src_country)return;const now=Date.now();for(let k in unblocking_rate){if(now-unblocking_rate[k].ts>15*_util_date_js__WEBPACK_IMPORTED_MODULE_7___default().ms.MIN)delete unblocking_rate[k]}return _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({cancel:true},(function*get_unblocking_rate(){let key=src_country+"_"+limit;if(unblocking_rate[key]&&(unblocking_rate[key].et||unblocking_rate[key].info)){return unblocking_rate[key].et?yield this.wait_ext(unblocking_rate[key].et):unblocking_rate[key].info}unblocking_rate[key]={et:this};this.on("finally",(()=>unblocking_rate[key].et=undefined));let res,err;for(let i=0;i<=1;i++){try{res=yield _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_8__.Z.ccgi_ajax({url:conf__WEBPACK_IMPORTED_MODULE_14__.url_ccgi+"/unblocking_rate",data:_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().qs_ajax({src_country,limit})});if(res)break}catch(e){err=e}}if(!res&&!err)err="empty_response";if(!err){unblocking_rate[key]={info:res,ts:Date.now()};return res}_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().perr("be_unblocking_rate_err",{key},{err})}))};E.fetch_info=()=>E.trigger("fetch_info");E.on("fetch_info",(()=>{if(!E.set_busy({desc:"Configuring..."}))return E.schedule_clr(["fetch_info"]);return E.sp.spawn(_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({name:"fetch_info",cancel:true},(function*(){try{_util_zerr_js__WEBPACK_IMPORTED_MODULE_6___default().notice("be_info: fetch_info");set_location(yield _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_8__.Z.get_location());E.clr_busy()}catch(e){E.set_err();_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().perr("be_info_fetch_info_err",{},{err:e,rate_limit:{count:3}})}})))}));E.set_user_id=()=>{E.trigger("set_user_id")};E.on("set_user_id",(()=>{var user_id=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().get("user_id"),is_premium=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().get("is_premium");if(user_id===undefined)return;return _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()("set_user_id",(function*set_user_id_(){try{yield _bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_10__["default"].update_info();const sync_data=!_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_10__["default"].get("info")?{missing_svc:true}:yield _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default().all({token:get_user_sync_token()});const sync_token=sync_data.token;const missing_svc=sync_data.missing_svc;yield _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default().all({allow_fail:true},{client:user_id&&_bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_8__.Z.ccgi_ajax({qs:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().auth(),method:"POST",url:conf__WEBPACK_IMPORTED_MODULE_14__.url_ccgi+"/set_user_client.json",data:{user_id}}),svc:!missing_svc&&_svc_hola_pub_svc_ipc_js__WEBPACK_IMPORTED_MODULE_12___default().ajax({cmd:"user_token_update.json?token="+user_id+(is_premium?"&premium":"")+(sync_token?"&sync="+sync_token:"")})});if(user_id)E.trigger("user_id_set")}catch(e){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().perr("be_info_set_user_id_err",{},{err:e})}}))}));function fix_dont_show(data,root_url){var val=data[root_url];if(val&&val.period){data[root_url]={};data[root_url][val.type||"default"]=val;delete val.type}}const dont_show_count={};E.set_dont_show_again=opt=>{opt=_util_util_js__WEBPACK_IMPORTED_MODULE_5___default().clone(opt);const root_url=opt.root_url;if(!root_url)return;const type=opt.type||"default";if(opt.period=="session"){if(opt.src=="outside_click"){dont_show_count[root_url]=(dont_show_count[root_url]||0)+1;if(dont_show_count[root_url]<2)return}opt.period="1h"}if(opt.period=="default")opt.period=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().get_dont_show_def_period();var settings=E.get("settings")||{};var data=settings.dont_show=settings.dont_show||{};fix_dont_show(data,root_url);if(opt.unset){if(data[root_url])delete data[root_url][type]}else{data[root_url]=data[root_url]||{};data[root_url][type]={ts_user:_util_date_js__WEBPACK_IMPORTED_MODULE_7___default().to_sql(new Date),period:opt.period,src:opt.src}}set_settings(settings);E.trigger("change:settings");_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().perr("be_set_dont_show_again",opt)};function _is_dont_show(val,type){if(val&&!val.period)val=val[type];if(!val)return false;if(val.period=="never")return true;const dur=val.period=="default"?_util_date_js__WEBPACK_IMPORTED_MODULE_7___default().ms.WEEK:_util_date_js__WEBPACK_IMPORTED_MODULE_7___default().str_to_dur(val.period);if(dur)return new Date-_util_date_js__WEBPACK_IMPORTED_MODULE_7___default().from_sql(val.ts_user)<dur;return false}E.is_dont_show=(root_url,type)=>{type=type||"default";const settings=E.get("settings");const data=settings&&settings.dont_show;return!!data&&(_is_dont_show(data.all,type)||_is_dont_show(data[root_url],type))};E.get_dont_show_rules=type=>{const res=[];type=type||"default";const settings=E.get("settings");const data=settings&&settings.dont_show||{};Object.keys(data).forEach((url=>{if(_is_dont_show(data[url],type))res.push(url)}));return res};E.set_force_tpopup=(root_url,type)=>{var force=E.get("force_tpopup")||_util_storage_js__WEBPACK_IMPORTED_MODULE_9___default().get_json("force_tpopup")||{};force[root_url]={ts:_util_date_js__WEBPACK_IMPORTED_MODULE_7___default().to_sql(new Date),type};E.set("force_tpopup",force);_util_storage_js__WEBPACK_IMPORTED_MODULE_9___default().set_json("force_tpopup",force)};E.unset_force_tpopup=root_url=>{const force=E.get("force_tpopup")||_util_storage_js__WEBPACK_IMPORTED_MODULE_9___default().get_json("force_tpopup")||{};delete force[root_url];E.set("force_tpopup",force);_util_storage_js__WEBPACK_IMPORTED_MODULE_9___default().set_json("force_tpopup",force)};E.is_force_tpopup=root_url=>{const force=E.get("force_tpopup")||_util_storage_js__WEBPACK_IMPORTED_MODULE_9___default().get_json("force_tpopup")||{};if(!force||!force[root_url])return false;const _ts=force[root_url].ts;const type=force[root_url].type;if(!_ts)return false;const ts=_util_date_js__WEBPACK_IMPORTED_MODULE_7___default().from_sql(_ts);if(Date.now()-ts>30*_util_date_js__WEBPACK_IMPORTED_MODULE_7___default().ms.MIN)return false;return type||true};E.increment_vpn_work_yes=()=>{const counter=E.get("vpn_work_yes")+1;_util_storage_js__WEBPACK_IMPORTED_MODULE_9___default().set("vpn_work_yes",counter);E.set("vpn_work_yes",counter)};E.set_vpn_last_rating=rating=>{_util_storage_js__WEBPACK_IMPORTED_MODULE_9___default().set("vpn_last_rating",rating);E.set("vpn_last_rating",rating)};E.set_rate_on_store=ts=>{_util_storage_js__WEBPACK_IMPORTED_MODULE_9___default().set("rate_on_store",ts);E.set("rate_on_store",ts)};E.set_has_opened_popup=()=>{const ts=Date.now();_util_storage_js__WEBPACK_IMPORTED_MODULE_9___default().set("has_opened_popup",ts);E.set("has_opened_popup",ts)};E.reset_rate_us=()=>{E.set_vpn_last_rating(0);E.set_rate_on_store(0);_util_storage_js__WEBPACK_IMPORTED_MODULE_9___default().set("vpn_work_yes",0);E.set("vpn_work_yes",0)};var join_sessions_etask;function join_sessions(user){if(user.disable_account_changes)return;return _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()("join_sessions",(function*join_sessions_(){this.finally((()=>join_sessions_etask=undefined));join_sessions_etask=this;yield _bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_10__["default"].update_info();let sync_token;try{if(!(sync_token=_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_10__["default"].get("sync_token")))return;return yield _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_8__.Z.hola_api_call("users/auth/token/join",{qs:_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().qs_ajax({token:sync_token,uuid:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().get("uuid")}),method:"POST"})}catch(e){}}))}function get_user_sync_token(){return _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()("get_user_sync_token",(function*get_user_sync_token_(){yield join_sessions_etask;try{const data=yield _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_8__.Z.hola_api_call("users/auth/token/generate",{qs:_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().qs_ajax({uuid:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().get("uuid")})});return data.token}catch(e){return""}}))}E.get_user_data=query=>{var last_res;return _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()("get_user_data",(function*get_user_data_(){const res=yield _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_8__.Z.hola_api_call("users/get_user",query);last_res=res||{};if(last_res.user){join_sessions(last_res.user);return last_res}yield _bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_10__["default"].update_info();let sync_token;try{if(!(sync_token=_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_10__["default"].get("sync_token")))return last_res;yield _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_8__.Z.hola_api_call("users/auth/token/login",{qs:_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().qs_ajax({token:sync_token,uuid:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().get("uuid")}),method:"POST"})}catch(e){return last_res}const data=yield _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_8__.Z.hola_api_call("users/get_user",query);return data||last_res}))};E.is_verified=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*is_verified_(){let res=yield _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_8__.Z.hola_api_call("users/is_verified");return res&&res.verified}));E.resend_verification_email=()=>_bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_8__.Z.hola_api_call("users/send_email_verification",{method:"POST"});E.set_login_redirect=value=>chrome.cookies.set({value,url:_bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_8__.Z.hola_url(),name:"bext_login_origin",expirationDate:(Date.now()+5*_util_date_js__WEBPACK_IMPORTED_MODULE_7___default().ms.MIN)/1e3});E.set_email_verify_url=value=>chrome.cookies.set({value,url:_bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_8__.Z.hola_url(),name:"email_verify_next_url",expirationDate:(Date.now()+_util_date_js__WEBPACK_IMPORTED_MODULE_7___default().ms.HOUR)/1e3});const __WEBPACK_DEFAULT_EXPORT__=E},7148:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(6969);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_0__);var _util_etask_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(6386);var _util_etask_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_util_etask_js__WEBPACK_IMPORTED_MODULE_1__);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(9824);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_util_zerr_js__WEBPACK_IMPORTED_MODULE_2__);var _util_util_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(1291);var _util_util_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_util_util_js__WEBPACK_IMPORTED_MODULE_3__);var _util_storage_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(8915);var _util_storage_js__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_util_storage_js__WEBPACK_IMPORTED_MODULE_4__);var _util_escape_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(4336);var _util_escape_js__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(_util_escape_js__WEBPACK_IMPORTED_MODULE_5__);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(3727);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_6__);var _bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(4130);var _bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_7__);var _bext_vpn_bg_mitm_lib_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(2426);var _bext_vpn_bg_mitm_lib_js__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(_bext_vpn_bg_mitm_lib_js__WEBPACK_IMPORTED_MODULE_8__);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(7345);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_9__);var _bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(9265);var _bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(5371);var _bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_11___default=__webpack_require__.n(_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_11__);var _bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(6210);var _util_browser_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(6069);var _util_browser_js__WEBPACK_IMPORTED_MODULE_13___default=__webpack_require__.n(_util_browser_js__WEBPACK_IMPORTED_MODULE_13__);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(5250);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_14___default=__webpack_require__.n(_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_14__);var _bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(8552);var _svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(843);var _svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_16___default=__webpack_require__.n(_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_16__);
// LICENSE_CODE ZON
_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_14___default().assert_bg("be_mitm");const assign=Object.assign;const chrome=self.chrome;const E=new(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_0___default().task_model.extend({model_name:"mitm",_defaults:function(){this.on("destroy",(()=>E.uninit()))}}));let perr=(name,info,opt)=>{opt=opt||{};let timeline=_bext_vpn_bg_mitm_lib_js__WEBPACK_IMPORTED_MODULE_8___default().get_timeline();if(timeline)opt.filehead=timeline+"\n\n"+(opt.filehead||"");_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_9___default().perr(name,assign({},info),opt)};E.set_unblock=(root_url,tab_id)=>{_bext_vpn_bg_mitm_lib_js__WEBPACK_IMPORTED_MODULE_8___default().trace(tab_id,root_url,"user choice unblock");handler.enable_rule(root_url);_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_6___default().trigger("mitm_change",root_url)};E.set_ignore=(root_url,tab_id)=>{const rule=handler.get_rule(root_url);if(rule&&rule.enabled_ts)return;_bext_vpn_bg_mitm_lib_js__WEBPACK_IMPORTED_MODULE_8___default().trace(tab_id,root_url,"user choice ignore");handler.ignore_rule(root_url);let tab_url=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_14___default().root2url(root_url);if(_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_11___default().get_enabled_rule(tab_url))E.be_vpn.stop_vpn(tab_url,tab_id);_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_6___default().trigger("mitm_change",root_url)};E.remove_rule=root_url=>{if(!handler)return;delete handler.rules[root_url];_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_6___default().trigger("mitm_change",root_url)};const cb_wrapper=_util_zerr_js__WEBPACK_IMPORTED_MODULE_2___default().catch_unhandled_exception;const is_unblock_allowed=(tab_id,tab_url)=>{if(_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_11___default().get_enabled_rule(tab_url))return false;if(!_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_15__["default"].is_vpn_allowed(tab_url,true,_util_browser_js__WEBPACK_IMPORTED_MODULE_13___default().isInNet))return false;if(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_6___default().get("is_premium"))return true;const tab_unblocker=_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_11___default().tab_unblockers[tab_id];if(tab_unblocker)return!tab_unblocker.force_premium;return!_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_10__["default"].get_force_premium_rule(_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_16___default().get_root_url(tab_url),{tab_url})};E.get_confirm_tab_url=(root_url,tab_id)=>"mitm.html?"+_util_escape_js__WEBPACK_IMPORTED_MODULE_5___default().qs({root_url,tab_id});E.open_confirm_tab=(root_url,tab_id)=>_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_15__["default"].open_be_tab({force_active:true,url:E.get_confirm_tab_url(root_url,tab_id)});const handle_mitm_block=(reason,root_url,tab_id,tab_url)=>_util_etask_js__WEBPACK_IMPORTED_MODULE_1___default()((function*(){_bext_vpn_bg_mitm_lib_js__WEBPACK_IMPORTED_MODULE_8___default().trace(tab_id,tab_url,"handle_mitm_block");if(!is_unblock_allowed(tab_id,tab_url)){return void perr("handle_mitm_block_not_allowed",{root_url,tab_url,reason})}const unblock=handler.need_unblock(root_url);if(!unblock){return void perr("handle_mitm_block_no_need",{root_url,tab_url,reason})}if(unblock.mode==_bext_vpn_bg_mitm_lib_js__WEBPACK_IMPORTED_MODULE_8___default().modes.MANUAL){perr("handle_mitm_block_show_popup",{root_url,tab_url,reason});_bext_vpn_bg_mitm_lib_js__WEBPACK_IMPORTED_MODULE_8___default().trace(tab_id,tab_url,"trigger mitm popup");_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_6___default().trigger("mitm_change",root_url);if(_bext_vpn_bg_mitm_lib_js__WEBPACK_IMPORTED_MODULE_8___default().is_inside_popup_allowed(root_url)&&tab_id)_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_7___default().reload(tab_id);else E.open_confirm_tab(root_url,tab_id);return}if(unblock.mode==_bext_vpn_bg_mitm_lib_js__WEBPACK_IMPORTED_MODULE_8___default().modes.AUTO){perr("handle_mitm_block_auto",{root_url,tab_url,reason});_bext_vpn_bg_mitm_lib_js__WEBPACK_IMPORTED_MODULE_8___default().trace(tab_id,tab_url,"trigger mitm auto rule + popup");_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_6___default().trigger("mitm_change",root_url);yield E.be_vpn.unblock_action({url:tab_url,tab_id,mitm:true,country:"us"});_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_7___default().reload(tab_id);return}handler.enable_rule(root_url);_bext_vpn_bg_mitm_lib_js__WEBPACK_IMPORTED_MODULE_8___default().trace(tab_id,tab_url,"ignore due to dry mode");perr("handle_mitm_block_dry",{root_url,tab_url,reason})}));const SSL_ERRORS=["CERT_ERROR_IN_SSL_RENEGOTIATION","SSL_HANDSHAKE_NOT_COMPLETED","SSL_SERVER_CERT_CHANGED","CERT_COMMON_NAME_INVALID","CERT_AUTHORITY_INVALID","CERT_CONTAINS_ERRORS","CERT_INVALID"];const GEN_ERRORS=["CONNECTION_REFUSED"];const err_listener=cb_wrapper((o=>{o=o||{};const tab_id=o.tabId||o.id;const err=o.error&&o.error.split("::ERR_")[1];if(o.frameId||!tab_id||tab_id==-1||_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_6___default().is_disabled()||!err||!(SSL_ERRORS.includes(err)||GEN_ERRORS.includes(err))){return}const status_code=o.statusCode||o.http_status_code||0;const tab_url=o.url||_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_7___default().get_url(tab_id);const root_url=_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_16___default().get_root_url(tab_url);const name="mitm_"+(GEN_ERRORS.includes(err)?"gen":"cert")+"_err";_bext_vpn_bg_mitm_lib_js__WEBPACK_IMPORTED_MODULE_8___default().trace(tab_id,tab_url,"hook error init");const reason=GEN_ERRORS.includes(err)?_bext_vpn_bg_mitm_lib_js__WEBPACK_IMPORTED_MODULE_8___default().reasons.CONN_ERROR:_bext_vpn_bg_mitm_lib_js__WEBPACK_IMPORTED_MODULE_8___default().reasons.INVALID_CERT;if(!root_url||!is_unblock_allowed(tab_id,tab_url))return void _bext_vpn_bg_mitm_lib_js__WEBPACK_IMPORTED_MODULE_8___default().trace(tab_id,tab_url,"unblock not allowed");if(!handler.is_verification_allowed(root_url,reason))return void _bext_vpn_bg_mitm_lib_js__WEBPACK_IMPORTED_MODULE_8___default().trace(tab_id,tab_url,"mitm not allowed");perr("verify_"+name,{root_url,tab_url,reason});return _util_etask_js__WEBPACK_IMPORTED_MODULE_1___default()((function*init_mitm_check_err_(){_bext_vpn_bg_mitm_lib_js__WEBPACK_IMPORTED_MODULE_8___default().trace(tab_id,tab_url,"get_agents country us");const country="us";const agents=yield _bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_11___default().get_rule_agents({country});_bext_vpn_bg_mitm_lib_js__WEBPACK_IMPORTED_MODULE_8___default().trace(tab_id,tab_url,"call check_mitm_blocking code "+status_code+" with "+agents.length+" us agents");_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_11___default().add_int_ajax_url(tab_url);const rule=yield handler.verify_mitm(root_url,tab_url,agents,country,reason);_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_11___default().rm_int_ajax_url(tab_url);if(rule&&rule.mitm_detected_ts){perr("verified_"+name,{root_url,tab_url,reason});yield handle_mitm_block(reason,root_url,tab_id,tab_url)}else perr("false_positive_"+name,{root_url,tab_url,reason})}))}));E.is_popup_needed=root_url=>{if(!handler||_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_12__["default"].is_dont_show(root_url))return;const unblock=handler.need_unblock(root_url);return unblock&&[_bext_vpn_bg_mitm_lib_js__WEBPACK_IMPORTED_MODULE_8___default().modes.AUTO,_bext_vpn_bg_mitm_lib_js__WEBPACK_IMPORTED_MODULE_8___default().modes.MANUAL].includes(unblock.mode)};E.get_rules=()=>handler&&handler.get_exposed_rules();E.get_dialog=root_url=>{if(E.is_popup_needed(root_url))return{country:"us"}};E.trace=_bext_vpn_bg_mitm_lib_js__WEBPACK_IMPORTED_MODULE_8___default().trace;let hooks_inited;const init_hooks=()=>{if(hooks_inited||_util_util_js__WEBPACK_IMPORTED_MODULE_3___default().is_mocha())return;try{chrome.webNavigation.onErrorOccurred.addListener(err_listener)}catch(e){_util_zerr_js__WEBPACK_IMPORTED_MODULE_2___default()("add mitm hook err: %s",e);perr("be_add_mitm_hooks_err",{},{err:e,rate_limit:{count:1}})}hooks_inited=true};const uninit_hooks=()=>{if(!hooks_inited)return;try{chrome.webNavigation.onErrorOccurred.removeListener(err_listener)}catch(e){_util_zerr_js__WEBPACK_IMPORTED_MODULE_2___default()("rm mitm hook err: %s",e);perr("be_rm_mitm_hooks_err",{},{err:e,rate_limit:{count:1}})}hooks_inited=false};let on_conf_update=()=>{if(_bext_vpn_bg_mitm_lib_js__WEBPACK_IMPORTED_MODULE_8___default().is_enabled())init_hooks();else uninit_hooks()};let debug={cleanup_rules:()=>handler.cleanup_rules(),dump_rules:()=>console.table(Object.values(handler.rules)),test_xhr:(url,country)=>_util_etask_js__WEBPACK_IMPORTED_MODULE_1___default()((function*(){url=url||_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_7___default().get("active.url");_bext_vpn_bg_mitm_lib_js__WEBPACK_IMPORTED_MODULE_8___default().trace("debug test_xhr call. url: "+url);country=country||"us";const agents=yield _bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_11___default().get_rule_agents({country});_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_11___default().add_int_ajax_url(url);const root_url=_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_16___default().get_root_url(url);const rule=yield handler.verify_mitm(root_url,url,agents,country);_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_11___default().rm_int_ajax_url(url);_bext_vpn_bg_mitm_lib_js__WEBPACK_IMPORTED_MODULE_8___default().trace("debug test_xhr result: "+(rule?"mitm detected":"no mitm"))}))};let handler;E.init=be_vpn=>{E.be_vpn=be_vpn;E.sp=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_14___default().new_etask("be_mitm");_bext_vpn_bg_mitm_lib_js__WEBPACK_IMPORTED_MODULE_8___default().init({conf_get:_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_9___default().CG,be_util:_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_9___default(),be_info:_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_12__["default"],perr,now:_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_15__["default"].now,zerr:_util_zerr_js__WEBPACK_IMPORTED_MODULE_2___default(),be_ext:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_6___default(),get_uuid_md5:_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_15__["default"].get_uuid_md5,ajax_via_proxy:_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_11___default().ajax_via_proxy,storage:_util_storage_js__WEBPACK_IMPORTED_MODULE_4___default()});handler=new(_bext_vpn_bg_mitm_lib_js__WEBPACK_IMPORTED_MODULE_8___default().Handler);E.listen_to(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_6___default(),"change:bext_config",on_conf_update);on_conf_update();if(typeof self!=="undefined")self.mitm=debug};E.uninit=()=>{E.sp.return();E.stopListening()};const __WEBPACK_DEFAULT_EXPORT__=E},2426:(module,exports,__webpack_require__)=>{var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;var module;
// LICENSE_CODE ZON
"use strict";(function(){const is_node=typeof module=="object"&&module.exports&&module.children;if(!is_node);else;!(__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(6386),__webpack_require__(5305),__webpack_require__(1291),__webpack_require__(932),__webpack_require__(6262),__webpack_require__(843)],__WEBPACK_AMD_DEFINE_RESULT__=function(etask,zurl,zutil,date,version_util,svc_vpn_util){const E={debug:{}};const assign=Object.assign;let SEC=1e3,MIN=60*SEC;let api;const def_api={conf_get:()=>{},be_info:null,be_util:null,be_ext:null,perr:(id,info,opt)=>{},now:()=>Date.now(),zerr:{notice:()=>{}}};E.reasons={UNKNOWN:"unknown",INVALID_CERT:"invalid_cert",CONN_ERROR:"conn_error",REDIRECT:"redirect",TIMEOUT:"timeout"};E.modes={DRY:"dry",MANUAL:"manual",AUTO:"auto"};const CG=(s,def)=>api.conf_get(s,def);let get_client_params=root_url=>{let now=api.now();let ext_ver=api.be_util.version();return{now,ext_ver,root_url,conf_ver:CG("version"),uuid:api.be_ext.get("uuid"),uuid_md5:api.get_uuid_md5(),browser:api.be_util.browser(),install_ver:api.be_util.install_version()||ext_ver,install_ts:api.be_util.install_ts()||now,signed_in:+!!api.be_ext.get("user_id"),is_premium:+!!api.be_ext.get("is_premium"),src_country:(api.be_info.get("country")||"").toUpperCase(),ip:(api.be_info.get("location")||{}).ip,conn:api.be_util.get_connection_type()||"eth",dev:api.be_util.get_device_type()}};const query_conf=root_url=>{let res={};let client_params=get_client_params(root_url);let conf=CG("mitm2.rules")||[];for(let c of conf){if(!c.conf||!svc_vpn_util.match_filter(client_params,c.filter))continue;let{reasons}=res;assign(res,c.conf);if(c.conf.reasons)res.reasons=assign({},reasons,c.conf.reasons)}return res};const CGM=(root_url,path,def)=>zutil.get(query_conf(root_url),path,def);E.is_inside_popup_allowed=root_url=>CGM(root_url,"inside_popup");E.is_enabled=()=>{if(CG("debug.mitm2"))return true;return svc_vpn_util.check_min_ver(api.be_util.version(),CG("mitm2.min_ver"))};let _timeline;E.get_timeline=()=>{if(!_timeline||!CG("mitm2.trace.add_to_perr"))return;return _timeline.log.map((l=>date.to_sql(l.ts)+": "+l.msg)).join("\n")};E.trace=function(tab_id,tab_url,str){let msg;if(arguments.length==1)msg=tab_id;else msg=`tab_id: ${tab_id}, tab_url: ${tab_url}: ${str}`;let tconf=CG("mitm2.trace",{});if(tconf.print_to_logs)api.zerr.notice(msg);if(!tconf.add_to_perr)return;if(!_timeline)_timeline={log:[]};_timeline.log.push({ts:api.now(),msg});let max_size=tconf.max_size||500;if(max_size<_timeline.log.length)_timeline.log=_timeline.log.slice(max_size>>1)};let xhr_test=(url,opt)=>etask((function*xhr_test_(){let timeout=3*SEC;let ajax_opt=assign({force:opt.agent?"proxy":"direct",always:true,hdrs_abort:true,ignore_redir:true,force_headers:true,fix_307:true,prot:opt.agent&&"proxy",src:"bg_ajax",hdrs:{"Cache-Control":"no-cache,"+"no-store,must-revalidate,max-age=-1"},timeout},opt);E.trace("ajax to "+url);let resp,ts=api.now();try{resp=yield api.ajax_via_proxy({url,type:"GET"},ajax_opt)}catch(e){if(/timeout/.test(e))resp={orig_res:{error:"timeout"}}}let ret=resp&&resp.orig_res||{error:"ajax failed"};let status_code=ret.statusCode!=undefined?ret.statusCode:ret.code;delete ret.body;E.trace("resp "+(ret.error||status_code)+" after "+(api.now()-ts)+"ms");return status_code==200||status_code==301}));const get_reason_mode=(root_url,reason)=>{if(CG("debug.mitm2_auto"))return E.modes.AUTO;if(CG("debug.mitm2_manual"))return E.modes.MANUAL;const reason_conf=CGM(root_url,["reasons",reason]);if(!reason_conf||!reason_conf.enable)return;return reason_conf.mode||E.modes.DRY};class Handler{constructor(){this.rules={};const stored_rules=api.storage&&api.storage.get_json("mitm2_rules");if(stored_rules){for(let root_url in stored_rules)this.init_rule(root_url,stored_rules[root_url])}this.running_verifications={}}store(){if(!api.storage)return;api.storage.set_json("mitm2_rules",this.rules)}cleanup_rules(){api.storage.set_json("mitm2_rules",null);this.rules={};E.trace("cleanup rules")}init_rule(root_url,rule){rule=rule||{};let now=api.now();return this.rules[root_url]={root_url:root_url||rule.root_url,ver:rule.ver||api.be_util.version(),ts:rule.ts||now,reason:rule.reason||E.reasons.UNKNOWN,mode:rule.mode||E.modes.DRY,ignored_ts:rule.ignored_ts||null,enabled_ts:rule.enabled_ts||null,mitm_detected_ts:rule.mitm_detected_ts||null}}get_rule(root_url){let rule=this.rules[root_url];if(!rule||rule.ts<CG("mitm2.rule_min_ts"))return;const reason_mode=get_reason_mode(root_url,rule.reason);if(!reason_mode)return;if(reason_mode!=E.modes.DRY&&(!rule.mode||rule.mode==E.modes.DRY))return;return rule}get_exposed_rules(){let min_ts=CG("mitm2.rule_min_ts")||0;return Object.values(this.rules).filter((rule=>min_ts<rule.ts&&rule.mode&&rule.mode!=E.modes.DRY))}enable_rule(root_url){let rule=this.get_rule(root_url);if(!rule)return;rule.ignored_ts=null;rule.enabled_ts=api.now();this.store()}ignore_rule(root_url){let rule=this.get_rule(root_url);if(!rule)return;rule.ignored_ts=api.now();rule.enabled_ts=null;this.store()}need_unblock(root_url){if(!E.is_enabled())return;let rule=this.get_rule(root_url);if(!rule||!rule.mitm_detected_ts||rule.ignored_ts||rule.enabled_ts){return}const mode=get_reason_mode(root_url,rule.reason);return mode?{mode}:null}is_verification_allowed(root_url,reason){if(!E.is_enabled())return;if(this.running_verifications[root_url])return;let conf=CGM(root_url,"");if((conf.exclude_sites||[]).includes(root_url))return;const reason_mode=get_reason_mode(root_url,reason);if(!reason_mode)return;let rule=this.get_rule(root_url);if(rule&&rule.last_verification_ts)return;return true}verify_mitm(root_url,tab_url,agents,country,reason){let _this=this;return etask((function*(){if(_this.running_verifications[root_url])return this.wait_ext(_this.running_verifications[root_url]);let rule=_this.get_rule(root_url);if(!rule)rule=_this.init_rule(root_url);_this.running_verifications[root_url]=this;this.finally((()=>{_this.running_verifications[root_url]=null}));rule.last_verification_ts=api.now();rule.mode=get_reason_mode(root_url,reason);_this.store();for(let agent of agents){if(yield xhr_test(tab_url,{agent,country})){rule.reason=reason||E.reasons.UNKNOWN;rule.mitm_detected_ts=api.now();_this.store();return rule}}}))}}E.Handler=Handler;E.init=_api=>{api=assign({},def_api,_api)};E.t={};return E}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))})()},1002:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(6969);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_0__);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(9824);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_util_zerr_js__WEBPACK_IMPORTED_MODULE_1__);var _bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(737);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(7345);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3__);var _util_storage_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(8915);var _util_storage_js__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_util_storage_js__WEBPACK_IMPORTED_MODULE_4__);var _util_date_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(932);var _util_date_js__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(_util_date_js__WEBPACK_IMPORTED_MODULE_5__);
// LICENSE_CODE ZON
let be_bg_main=self.be_bg_main;const E=new(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_0___default().task_model.extend({model_name:"mode",_defaults:function(){this.on("destroy",(()=>E.uninit()))}}));function update_pending(new_mode,change){var last_mode=_util_storage_js__WEBPACK_IMPORTED_MODULE_4___default().get("last_mode"),pending;if(new_mode=="ext"&&last_mode)pending=last_mode;if(pending==E.get("pending"))return;change.pending=pending;_util_zerr_js__WEBPACK_IMPORTED_MODULE_1___default().info("pending mode set to "+pending)}let disconnections=[],ignore_svc;function maybe_ignore_svc(){if(_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_2__["default"].get("proxyjs_connected")||E.get("mode")!="exe")return;disconnections.push(_util_date_js__WEBPACK_IMPORTED_MODULE_5___default()());disconnections=disconnections.slice(-2);if(disconnections.length==2&&Date.now()-disconnections[0]<_util_date_js__WEBPACK_IMPORTED_MODULE_5___default().ms.SEC*10){_util_zerr_js__WEBPACK_IMPORTED_MODULE_1___default().info("Too frequent disconnections - ignoring svc");ignore_svc=true}}function is_svc_connected(){return _bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_2__["default"].get("cid_js")&&_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_2__["default"].get("session_key_cid_js")&&_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_2__["default"].get("proxyjs_connected")}function update_mode(){var new_mode=is_svc_connected()&&!ignore_svc?"exe":"ext";var change={},mode_changed;if(new_mode!=E.get("mode"))mode_changed=true;maybe_ignore_svc();update_pending(new_mode,change);Object.assign(change,{mode:new_mode,is_svc:new_mode!="ext",is_ext:new_mode=="ext","svc.detected":!!_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_2__["default"].get("version"),"svc.hola_svc_detected":!!_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_2__["default"].get("is_hola_svc"),"svc.version":_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_2__["default"].get("version"),"svc.appid":_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_2__["default"].get("appid"),"svc.campaign":_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_2__["default"].get("campaign"),"svc.uuid":_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_2__["default"].get("uuid"),"svc.cid_js":_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_2__["default"].get("cid_js"),"svc.session_key_cid_js":_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_2__["default"].get("session_key_cid_js"),"svc.info":_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_2__["default"].get("info"),"svc.callback_raw":_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_2__["default"].get("callback_raw"),"svc.callback_ts":_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_2__["default"].get("callback_ts")});if(mode_changed)change.ts=Date.now();E.safe_set(change);be_bg_main.safe_set(change);if(!mode_changed)return;if(new_mode!="ext")_util_storage_js__WEBPACK_IMPORTED_MODULE_4___default().set("last_mode",new_mode);_util_zerr_js__WEBPACK_IMPORTED_MODULE_1___default().info("mode set to "+new_mode);_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().perr("mode_change",{new_mode,proxyjs_connected:_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_2__["default"].get("proxyjs_connected"),cid_js:_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_2__["default"].get("cid_js"),session_key_cid_js:_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_2__["default"].get("session_key_cid_js")});E.set("mode_change_count",(E.get("mode_change_count")||0)+1)}E.init=()=>{be_bg_main=self.be_bg_main;E.listenTo(_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_2__["default"],"all",update_mode);update_mode()};E.uninit=()=>{E.stopListening();E.clear()};const __WEBPACK_DEFAULT_EXPORT__=E},7957:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(6969);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_0__);var _util_etask_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(6386);var _util_etask_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_util_etask_js__WEBPACK_IMPORTED_MODULE_1__);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(3727);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_2__);var _bext_vpn_bg_pac_engine_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(1225);var _bext_vpn_bg_pac_engine_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_bext_vpn_bg_pac_engine_js__WEBPACK_IMPORTED_MODULE_3__);var _util_url_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(5305);var _util_url_js__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_util_url_js__WEBPACK_IMPORTED_MODULE_4__);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(7345);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_5__);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(5250);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_6__);var underscore__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(7439);var underscore__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(underscore__WEBPACK_IMPORTED_MODULE_7__);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(9824);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(_util_zerr_js__WEBPACK_IMPORTED_MODULE_8__);var _util_date_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(932);var _util_date_js__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(_util_date_js__WEBPACK_IMPORTED_MODULE_9__);var _util_util_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(1291);var _util_util_js__WEBPACK_IMPORTED_MODULE_10___default=__webpack_require__.n(_util_util_js__WEBPACK_IMPORTED_MODULE_10__);var _svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(843);var _svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_11___default=__webpack_require__.n(_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_11__);var _bext_vpn_bg_dev_mode_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(1679);var conf__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(9641);
// LICENSE_CODE ZON
const v3=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_5___default().is_v3;const ff_webext=conf__WEBPACK_IMPORTED_MODULE_13__.firefox_web_ext;let chrome,is_etask_perf_on,bext_config={};const E=new(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_0___default().task_model.extend({model_name:"pac",_defaults:function(){this.stats={total:0,slow:{}};this.on("destroy",(()=>E.uninit()))}}));function update_config(){bext_config=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_2___default().get("bext_config")||{};is_etask_perf_on=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_2___default().get("gen.is_etask_perf_on");if(is_etask_perf_on&&!_util_etask_js__WEBPACK_IMPORTED_MODULE_1___default().perf())_util_etask_js__WEBPACK_IMPORTED_MODULE_1___default().perf(true);if(!is_etask_perf_on&&_util_etask_js__WEBPACK_IMPORTED_MODULE_1___default().perf())_util_etask_js__WEBPACK_IMPORTED_MODULE_1___default().perf(false)}function on_debug_pac(){let on=_bext_vpn_bg_dev_mode_js__WEBPACK_IMPORTED_MODULE_12__["default"].get("debug_pac");_util_zerr_js__WEBPACK_IMPORTED_MODULE_8___default().notice("virtual pac %s",on?"on":"off");if(on)_bext_vpn_bg_pac_engine_js__WEBPACK_IMPORTED_MODULE_3___default().init({key:E.pac_key});else _bext_vpn_bg_pac_engine_js__WEBPACK_IMPORTED_MODULE_3___default().t.reset()}E.init=()=>{if(E.inited)return;chrome=self.chrome;E.sp=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_6___default().new_etask("be_pac");E.listen_to(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_2___default(),"change:bext_config",update_config);E.listen_to(_bext_vpn_bg_dev_mode_js__WEBPACK_IMPORTED_MODULE_12__["default"],"change:debug_pac",on_debug_pac);monitor_init();update_config();E.inited=true};var monitor_init=period=>{var first_reported,prev_slow,start=Date.now();if(E.timer)E.timer=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_6___default().clear_timeout(E.timer);var reset=(cb,keep_stats)=>{if(!keep_stats){if(is_etask_perf_on)_util_etask_js__WEBPACK_IMPORTED_MODULE_1___default().perf_stat={};E.stats={total:0,slow:{}}}first_reported=true;start=Date.now();if(cb)E.timer=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_6___default().set_timeout(cb,_util_date_js__WEBPACK_IMPORTED_MODULE_9___default().ms.HOUR,{sp:E.sp})};E.timer=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_6___default().set_timeout((function pac_slow(){var ts=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_2___default().get("install_ts")||_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_2___default().get("update_ts");if(!first_reported&&ts!=self.hola.t.l_start)return reset(pac_slow,true);var send;for(var src in E.stats.slow){if(E.stats.slow[src]["100"]||E.stats.slow[src]["1000"]){send=true;break}}if(!prev_slow&&send){var info=Object.assign({period:Date.now()-start},E.stats);if(is_etask_perf_on)info.etask_perf_stat=_util_etask_js__WEBPACK_IMPORTED_MODULE_1___default().perf_stat;_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_5___default().perr("be_tab_unblocker_slow",_util_zerr_js__WEBPACK_IMPORTED_MODULE_8___default().json(info))}prev_slow=send;reset(pac_slow)}),period||5*_util_date_js__WEBPACK_IMPORTED_MODULE_9___default().ms.MIN,{sp:E.sp})};E.uninit=()=>{E.inited=false;E.timer=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_6___default().clear_timeout(E.timer);E.sp.return();E.stopListening()};function get_pac_scope(){if(chrome&&chrome.extension&&chrome.extension.inIncognitoContext)return"incognito_session_only";return"regular_only"}function err_cb(err){let{details,error}=err||{};if(error=="net::ERR_PROXY_CONNECTION_FAILED"&&!details)return;if(error=="net::ERR_PAC_SCRIPT_FAILED"){let m;if(m=(""+details).match(/Uncaught Error: init_ts ([0-9]+)/)){E.pac_engine_init_ts=+m[1];return _util_zerr_js__WEBPACK_IMPORTED_MODULE_8___default().notice("pac_engine init_ts %s",E.pac_engine_init_ts)}if(m=(""+details).match(/Uncaught Error: pac_auto_reload init ts mismatch/)){_util_zerr_js__WEBPACK_IMPORTED_MODULE_8___default()("pac_engine auto_reloaded detected on init");_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_2___default().trigger("pac_reload");reset_pac_file();_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_11___default().push_event("pac_reload",{init_ts:E.pac_engine_init_ts,new_ts:+m[1]});return}if(m=(""+details).match(/Uncaught Error: pac_auto_reload init_ts ([0-9]+)/)){if(E.pac_engine_init_ts==m[1])return;_util_zerr_js__WEBPACK_IMPORTED_MODULE_8___default()("pac_engine auto_reloaded detected init_ts %s -> %s",new Date(E.pac_engine_init_ts),new Date(+m[1]));_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_2___default().trigger("pac_reload");_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_11___default().push_event("pac_reload",{init_ts:E.pac_engine_init_ts,new_ts:+m[1]});_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_5___default().perr("pac_engine_auto_reload",{error,details,init_ts:E.pac_engine_init_ts,new_ts:m[1]},{err,rate_limit:{count:3}});E.pac_engine_init_ts=+m[1];if(_bext_vpn_bg_dev_mode_js__WEBPACK_IMPORTED_MODULE_12__["default"].get("debug_pac"))_bext_vpn_bg_pac_engine_js__WEBPACK_IMPORTED_MODULE_3___default().t.reset();return}if(/Uncaught Error: pac_get_log /.test(details)||/Uncaught Error: pac_dump /.test(details)){_util_zerr_js__WEBPACK_IMPORTED_MODULE_8___default()("proxy error %s %o %s",error,err,(""+details).replace(/\\n/g,"\n"));return}}_util_zerr_js__WEBPACK_IMPORTED_MODULE_8___default()("proxy error %s %o %s",error,err,(""+details).replace(/\\n/g,"\n"));_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_5___default().perr("proxy_error",{error,details},{rate_limit:{count:3}})}E.ajax_get_pac_init_ts=()=>{let url="http://__hola__.pac_get_init_ts.local.hola/?rnd="+Math.random();fetch(url,{method:"POST"}).catch((()=>{}))};let set_pac=script=>{E.has_pac=!!script;const scope=get_pac_scope();if(_util_util_js__WEBPACK_IMPORTED_MODULE_10___default().is_mocha())return;return _util_etask_js__WEBPACK_IMPORTED_MODULE_1___default()((function*set_pac_(){try{chrome.proxy.onProxyError.removeListener(err_cb);E.pac_engine_init_ts=0;if(script){chrome.proxy.onProxyError.addListener(err_cb);yield _util_etask_js__WEBPACK_IMPORTED_MODULE_1___default().cb_apply(chrome.proxy.settings,".set",[{scope,value:{mode:"pac_script",pacScript:{data:script}}}]);E.ajax_get_pac_init_ts()}else{yield _util_etask_js__WEBPACK_IMPORTED_MODULE_1___default().cb_apply(chrome.proxy.settings,".clear",[{scope}])}}catch(e){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_5___default().perr("set_pac_err",{},{err:e,rate_limit:{count:1}})}}))};function check_need_ext_settings(){return _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_2___default().get("ajax_via_proxy_inited")||_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_2___default().get("has_active_rules")&&!_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_2___default().is_disabled()}const gen_pac_script_str=options=>{let res="var pac_engine = ("+_bext_vpn_bg_pac_engine_js__WEBPACK_IMPORTED_MODULE_3___default().module_fn+")();\n"+"pac_engine.init("+JSON.stringify(options)+");\n"+"function FindProxyForURL(url, host){\n"+"    return pac_engine.FindProxyForURL(url, host); }\n";if(v3)res+=`pac_engine.set_v3_rules(${JSON.stringify(E.v3_rules)})\n`;return res};const reset_pac_file=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_1___default()((function*(){E.has_pac=false;return yield E.update_pac_file_state()}));E.set_v3_rules=rules=>{E.v3_rules=rules;_bext_vpn_bg_pac_engine_js__WEBPACK_IMPORTED_MODULE_3___default().set_v3_rules(rules);E.update_pac_file_state(true)};E.find_proxy=url=>_bext_vpn_bg_pac_engine_js__WEBPACK_IMPORTED_MODULE_3___default().FindProxyForURL(url,_util_url_js__WEBPACK_IMPORTED_MODULE_4___default().get_host(url));E.update_pac_file_state=force=>{if(ff_webext)return;var need_pac=check_need_ext_settings();if(!force&&!!E.has_pac==!!need_pac)return;_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_2___default().trigger("pac_init");if(!need_pac){if(_bext_vpn_bg_dev_mode_js__WEBPACK_IMPORTED_MODULE_12__["default"].get("debug_pac"))_bext_vpn_bg_pac_engine_js__WEBPACK_IMPORTED_MODULE_3___default().t.reset();return set_pac(null)}var arr=new Uint8Array(32),key="";self.crypto.getRandomValues(arr);underscore__WEBPACK_IMPORTED_MODULE_7___default().each(arr,(a=>{key+=a.toString(16)}));E.pac_key=key;var options={key:E.pac_key};if(!bext_config.disable_pac_engine_auto_reload_init)options.set_ts=Date.now();var et=set_pac(gen_pac_script_str(options));if(_bext_vpn_bg_dev_mode_js__WEBPACK_IMPORTED_MODULE_12__["default"].get("debug_pac"))_bext_vpn_bg_pac_engine_js__WEBPACK_IMPORTED_MODULE_3___default().init(options);return et};function hex_encode(s){let h="";for(let i=0;i<s.length;i++)h+=s.charCodeAt(i).toString(16);return h}const get_rule_url=rule=>{let prefix=hex_encode(JSON.stringify(rule));return"http://__hola__.set."+prefix+".local.hola/"};const set_pac_rule=v3?(rule,opt)=>_util_etask_js__WEBPACK_IMPORTED_MODULE_1___default()({cancel:true},(function*_set_pac_rule(){let controller=new self.AbortController;this.finally((()=>controller.abort()));opt=opt||{};let dur,url=get_rule_url(rule);E.stats.total++;const t0=Date.now();try{if(_bext_vpn_bg_dev_mode_js__WEBPACK_IMPORTED_MODULE_12__["default"].get("debug_pac")){try{_bext_vpn_bg_pac_engine_js__WEBPACK_IMPORTED_MODULE_3___default().FindProxyForURL(url,_util_url_js__WEBPACK_IMPORTED_MODULE_4___default().get_host(url))}catch(err){}}fetch(url,{method:"POST",signal:controller.signal}).catch((()=>this.continue())).then((()=>this.continue()));yield this.wait(20*_util_date_js__WEBPACK_IMPORTED_MODULE_9___default().ms.SEC)}catch(err){}if((dur=Date.now()-t0)>10){let s,src="async_"+(opt.src||"idle");if(!(s=E.stats.slow[src]))s=E.stats.slow[src]={10:0,100:0,1e3:0,max:0};s[dur>1e3?"1000":dur>100?"100":"10"]++;s.max=Math.max(dur,s.max)}})):(rule,opt)=>_util_etask_js__WEBPACK_IMPORTED_MODULE_1___default()({cancel:true},(function*_set_pac_rule(){this.finally((()=>{if(!xhr)return;xhr.abort();xhr.onload=xhr.onabort=xhr.onerror=null}));opt=opt||{};let dur,xhr=new XMLHttpRequest;let url=get_rule_url(rule);xhr.open("POST",url,opt.async||_util_util_js__WEBPACK_IMPORTED_MODULE_10___default().is_mocha());E.stats.total++;const t0=Date.now();if(opt.async)xhr.onload=xhr.onabort=xhr.onerror=()=>this.continue();try{if(_bext_vpn_bg_dev_mode_js__WEBPACK_IMPORTED_MODULE_12__["default"].get("debug_pac")){try{_bext_vpn_bg_pac_engine_js__WEBPACK_IMPORTED_MODULE_3___default().FindProxyForURL(url,_util_url_js__WEBPACK_IMPORTED_MODULE_4___default().get_host(url))}catch(err){}}xhr.send(null);if(opt.async)yield this.wait(20*_util_date_js__WEBPACK_IMPORTED_MODULE_9___default().ms.SEC)}catch(err){}if((dur=Date.now()-t0)>10){let s,src=(opt.async?"async_":"")+(opt.src||"idle");if(!(s=E.stats.slow[src]))s=E.stats.slow[src]={10:0,100:0,1e3:0,max:0};s[dur>1e3?"1000":dur>100?"100":"10"]++;s.max=Math.max(dur,s.max);if(!opt.async&&dur>100){_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_11___default().push_event("pac_slow",{url:rule.set,set_url:url,dur})}}}));E.unset_proxy_for_host=(host,opt)=>_util_etask_js__WEBPACK_IMPORTED_MODULE_1___default()({cancel:true},(function*unset_proxy_for_host(){if(!E.pac_key)return;let rule={unset:host,key:E.pac_key};if(!_util_util_js__WEBPACK_IMPORTED_MODULE_10___default().is_mocha()&&E.pac_engine_init_ts)rule.init_ts=E.pac_engine_init_ts;yield set_pac_rule(rule,opt)}));E.set_proxy_for_host=(host,proxy_str,deadline_ts,opt)=>_util_etask_js__WEBPACK_IMPORTED_MODULE_1___default()({cancel:true},(function*set_proxy_for_host(){if(!E.pac_key)return;var n=proxy_str.split(" ");if(n.length<2||!{PROXY:1,SOCKS:1,SOCKS5:1,HTTPS:1}[n[0]])proxy_str="DIRECT";let rule={proxy:proxy_str,set:host,key:E.pac_key,d_ts:deadline_ts};if(_util_util_js__WEBPACK_IMPORTED_MODULE_10___default().is_mocha())delete rule.d_ts;if(!_util_util_js__WEBPACK_IMPORTED_MODULE_10___default().is_mocha()&&E.pac_engine_init_ts)rule.init_ts=E.pac_engine_init_ts;yield set_pac_rule(rule,opt)}));const __WEBPACK_DEFAULT_EXPORT__=E},1225:(module,exports)=>{var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;var module;
// LICENSE_CODE ZON
"use strict";(function(){var is_node=typeof module=="object"&&module.exports&&module.children;if(!is_node);else;!(__WEBPACK_AMD_DEFINE_ARRAY__=[],__WEBPACK_AMD_DEFINE_RESULT__=function module_fn(){var E={module_fn},g_pac_engine={},g_log=[],local_redir;var regex_url2host=/^(?:https?|wss?):\/\/([^\/]+)/;var regex_local_cmd_host=/^__hola__\.set\.(.*)\.local\.hola$/;var v3_rules;function reset(){local_redir={rules:{},counter:0}}function log(s){var text=(new Date).toISOString()+" "+s;if(typeof alert!="undefined")alert(text);g_log.push(text);if(g_log.length>256)g_log.splice(0,g_log.length/2)}function pac_dump(){var str="";str+="init_ts: "+g_pac_engine.init_ts+"\n";str+="g_pac_engine:\n";try{str+=JSON.stringify(g_pac_engine)}catch(e){str+=e}str+="\nlocal_redir:\n";str+="  counter: "+local_redir.counter+"\n";str+="  rules:\n";for(var host in local_redir.rules){var rule=local_redir.rules[host];var ttl=rule.deadline_ts-Date.now();if(ttl>0)str+="    "+host+": "+rule.proxy+" (ttl "+(ttl/1e3|0)+"s)\n"}return str}function hex_decode(h){var s="";for(var i=0;i<h.length;i+=2)s+=String.fromCharCode(parseInt(h.substr(i,2),16));return s}function add_local_rule(host,proxy,deadline_ts){var cur_ts=Date.now(),entry=local_redir.rules[host];if(!entry||entry.proxy!=proxy)entry=local_redir.rules[host]={proxy};entry.deadline_ts=deadline_ts||cur_ts+6e4;local_redir.counter++;if(local_redir.counter>1e3){for(var i in local_redir.rules){var local=local_redir.rules[i];if(local.deadline_ts<cur_ts)delete local_redir.rules[i]}local_redir.counter=0}}function url2host(url){var n=url.match(regex_url2host);return n?n[1]:url}function get_local_rule(url){var host=url2host(url),rule=local_redir.rules[host];if(!rule)return;if(rule.deadline_ts<Date.now())return void delete local_redir.rules[host];return rule.proxy}function init_hola_domains_re(){var domains="hola.org|holacdn.com|zspeed-cdn.com|"+"h-vpn.org|holavpn.com|holavpnworld.com|"+"holavpnextension.com|holavpninstaller.com|holabrowser.com|"+"holafreevpn.com|new-tab-page|hola-new-tab-page|"+"holavpnrussia.com|hola-vpn.com|holax.io|holavpn.net|"+"holavpnandroid.com|hola-vpn.com|holavpnrussia.com|"+"hola-diagnostics|hola-settings".replace(/\./g,"\\.");return new RegExp("^(.*\\.)?("+domains+")$")}var hola_domain_re=init_hola_domains_re();function is_ip(host){var m=/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/.exec(host);if(!m)return false;for(var i=1;i<=4;i++){if(+m[i]>255)return false}return true}function convert_addr(ipchars){var bytes=ipchars.split(".");var result=(bytes[0]&255)<<24|(bytes[1]&255)<<16|(bytes[2]&255)<<8|bytes[3]&255;return result>>>0}function is_in_net(ipaddr,pattern,maskstr){var test=/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/.exec(ipaddr);if(!test||test[1]>255||test[2]>255||test[3]>255||test[4]>255)return false;var host=convert_addr(ipaddr);var pat=convert_addr(pattern);var mask=convert_addr(maskstr);return(host&mask)==(pat&mask)}function is_private_network(hostname){if(!hostname.includes("."))return true;if(!is_ip(hostname))return false;return is_in_net(hostname,"10.0.0.0","255.0.0.0")||is_in_net(hostname,"172.16.0.0","255.240.0.0")||is_in_net(hostname,"192.168.0.0","255.255.0.0")||is_in_net(hostname,"127.0.0.0","255.0.0.0")}function get_global_rule(host){if(!v3_rules)return null;if(is_private_network(host)||host.match(hola_domain_re))return"DIRECT";return v3_rules.hosts_map[host]||v3_rules.hosts_map.default}function local_hola_handler(hex_payload){var msg;try{msg=JSON.parse(hex_decode(hex_payload))}catch(e){}if(!msg||msg.key!=g_pac_engine.key)return"DIRECT";if(msg.unset)delete local_redir.rules[msg.unset];else add_local_rule(msg.set,msg.proxy,msg.d_ts);if(msg.init_ts&&g_pac_engine.init_ts!=msg.init_ts)throw new Error("pac_auto_reload init_ts "+g_pac_engine.init_ts);return"PROXY 127.0.0.1:0"}E.init=function(options){options=options||{};g_pac_engine={init_ts:Date.now(),key:options.key};reset();if(options.set_ts&&options.set_ts+3e3<g_pac_engine.init_ts)throw new Error("pac_auto_reload init ts mismatch")};E.set_v3_rules=function(rules){v3_rules=rules};function handle_debug(host){switch(host){case"__hola__.pac_get_init_ts.local.hola":throw new Error("init_ts "+g_pac_engine.init_ts);case"__hola__.pac_dump.local.hola":throw new Error("pac_dump "+pac_dump());case"__hola__.pac_get_log.local.hola":g_log=[];throw new Error("pac_get_log ["+g_log.join("\n")+"]")}}E.FindProxyForURL=function(url,host){if(host[0]=="_"){var m=host.match(regex_local_cmd_host);if(m)return local_hola_handler(m[1]);handle_debug(host)}return get_local_rule(url)||get_global_rule(host)||"DIRECT"};E.t={local_redir:function(){return local_redir},reset};return E}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))})()},9265:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var conf__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(9641);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(6969);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1__);var _util_etask_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(6386);var _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_util_etask_js__WEBPACK_IMPORTED_MODULE_2__);var _util_date_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(932);var _util_date_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_util_date_js__WEBPACK_IMPORTED_MODULE_3__);var _util_escape_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(4336);var _util_escape_js__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_util_escape_js__WEBPACK_IMPORTED_MODULE_4__);var _util_url_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(5305);var _util_url_js__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(_util_url_js__WEBPACK_IMPORTED_MODULE_5__);var _svc_account_pub_membership_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(6467);var _svc_account_pub_membership_js__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(_svc_account_pub_membership_js__WEBPACK_IMPORTED_MODULE_6__);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(3727);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_7__);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(7345);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_8__);var _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(9651);var _util_util_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(1291);var _util_util_js__WEBPACK_IMPORTED_MODULE_10___default=__webpack_require__.n(_util_util_js__WEBPACK_IMPORTED_MODULE_10__);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(5250);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_11___default=__webpack_require__.n(_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_11__);var _bext_vpn_util_no_log_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(2181);var _util_version_util_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(6262);var _util_version_util_js__WEBPACK_IMPORTED_MODULE_13___default=__webpack_require__.n(_util_version_util_js__WEBPACK_IMPORTED_MODULE_13__);var _bext_vpn_bg_force_lib_js__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(7310);var _bext_vpn_bg_force_lib_js__WEBPACK_IMPORTED_MODULE_14___default=__webpack_require__.n(_bext_vpn_bg_force_lib_js__WEBPACK_IMPORTED_MODULE_14__);var _bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(6210);var _bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(8552);var _bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(4130);var _bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_17___default=__webpack_require__.n(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_17__);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(9824);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_18___default=__webpack_require__.n(_util_zerr_js__WEBPACK_IMPORTED_MODULE_18__);var _util_storage_js__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(8915);var _util_storage_js__WEBPACK_IMPORTED_MODULE_19___default=__webpack_require__.n(_util_storage_js__WEBPACK_IMPORTED_MODULE_19__);
// LICENSE_CODE ZON
_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_11___default().assert_bg("be_premium");const chrome=self.chrome,assign=Object.assign;const E=new(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1___default().task_model.extend({model_name:"premium",_defaults:function(){this.on("destroy",(()=>E.uninit()))}}));let membership_timeout,daily_refresh_timer;const test_users=["deploy@hola.org","qa.hola@gmail.com","qa.hola2@gmail.com","yulia@hola.org","holaplus.payment@gmail.com","holavpntests@gmail.com","deploy.vpnext@gmail.com","nikita+2@hola.org","nikita+vpn@hola.org"];E.is_active=()=>_svc_account_pub_membership_js__WEBPACK_IMPORTED_MODULE_6___default().is_active(E.get("membership"));E.is_ultra=()=>_svc_account_pub_membership_js__WEBPACK_IMPORTED_MODULE_6___default().is_ultra(E.get("membership"));E.is_paid=()=>_svc_account_pub_membership_js__WEBPACK_IMPORTED_MODULE_6___default().is_paid(E.get("membership"));E.logout_user=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*logout_user(){E.be_rule.disable_premium();yield _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_9__.Z.hola_api_call("users/logout/inline",{method:"POST",text:true});set_user(null);E.set("membership",null);_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_7___default().set("is_premium",false);_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_7___default().set("is_ultra",false)}));const set_user=user=>{let email;if(user&&user.user)email=_util_util_js__WEBPACK_IMPORTED_MODULE_10___default().get(user.user.emails,"0.value");E.set("is_test_user",+test_users.includes(email));_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_7___default().set("user_id",_util_util_js__WEBPACK_IMPORTED_MODULE_10___default().get(user,"user._id",""));_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_7___default().set("hola_uid",_util_util_js__WEBPACK_IMPORTED_MODULE_10___default().get(user,"user.hola_uid"));_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_7___default().set("pap_a_aid",_util_util_js__WEBPACK_IMPORTED_MODULE_10___default().get(user,"user.pap.a_aid"));E.set("user",user&&user.user);if(!user)E.be_rule.disable_trial_on_logout()};const update_uuid_info=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*_update_uuid_info(){try{let url=conf__WEBPACK_IMPORTED_MODULE_0__.url_ccgi+"/get_uuid_info";let qs=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_7___default().auth();_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_7___default().set("uuid_info",yield _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_9__.Z.ccgi_ajax({url,qs}))}catch(e){_util_zerr_js__WEBPACK_IMPORTED_MODULE_18___default().warn("update_uuid_info failed %s",_util_zerr_js__WEBPACK_IMPORTED_MODULE_18___default().e2s(e))}}));var last_refreshed=0;E.refresh_user=opt=>{opt=assign({},opt);let user_id=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_7___default().get("user_id");var now;_util_zerr_js__WEBPACK_IMPORTED_MODULE_18___default().notice("be_premium: refresh_user %O",opt);if((now=Date.now())-last_refreshed<300){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_8___default().perr("refresh_user_multiple",{user_id},{rate_limit:{count:2},err:new Error,with_log:true})}last_refreshed=now;if(refresh_user_et)refresh_user_et.return();return _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({name:"refresh_user",cancel:true},(function*(){try{const _user=yield _bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_15__["default"].get_user_data({data:{uuid:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_7___default().get("uuid"),source:"be_premium"}});let _membership;if(user_id!=_util_util_js__WEBPACK_IMPORTED_MODULE_10___default().get(_user,"user._id")||opt.force_premium){_membership=yield _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_9__.Z.hola_api_call("users/payment/get_membership?ver="+_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_8___default().version())}else _membership=yield E.get("membership");yield update_uuid_info();const old_is_active=E.is_active();E.set("membership",_membership);let is_active=E.is_active();_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_7___default().set("is_premium",is_active);_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_7___default().set("is_ultra",E.is_ultra());let pro_grace_period_ts=_membership&&_membership.pro_grace_period_ts;_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_7___default().set("is_pro_grace_period",pro_grace_period_ts&&now<pro_grace_period_ts);set_user(_user);_bext_vpn_util_no_log_js__WEBPACK_IMPORTED_MODULE_12__["default"].set_plus(is_active);if(!is_active&&old_is_active)E.be_rule.disable_premium();else if(is_active&&!old_is_active)E.be_rule.disable_stubs();return _membership}catch(e){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_8___default().perr("refresh_user_fail",{},{err:e});_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_11___default().clear_timeout(membership_timeout);membership_timeout=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_11___default().set_timeout((()=>E.sp.spawn(E.refresh_user(opt))),Math.random()*_util_date_js__WEBPACK_IMPORTED_MODULE_3___default().ms.HOUR)}finally{if(!E.get("updated"))E.set("updated",true);E.trigger("user_updated")}}))};let refresh_user_et;E.schedule_refresh_user=opt=>{if(refresh_user_et)refresh_user_et.return();_util_zerr_js__WEBPACK_IMPORTED_MODULE_18___default().notice("be_premium: schedule_refresh_user %O",opt);E.sp.spawn(_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*schedule_refresh_user_(){refresh_user_et=this;this.finally((()=>{refresh_user_et=null}));yield _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default().sleep(1e3);yield E.refresh_user(opt)})))};function is_blacklist(root_url,tab_url){if(!root_url)return false;if(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_7___default().get("is_premium"))return false;const blacklist=(E.be_rule.get("rules")||{}).blacklist||{};return blacklist[root_url]||tab_url&&blacklist[_util_url_js__WEBPACK_IMPORTED_MODULE_5___default().parse(tab_url).hostname]}E.get_force_premium_rule=(root_url,opt)=>{opt=opt||{};if(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_8___default().full_browser_mode())return false;let rule;if(is_blacklist(root_url,opt.tab_url)){rule={id:root_url,domain:new RegExp(root_url),blacklist:true};return rule}opt=opt||{};rule=_bext_vpn_bg_force_lib_js__WEBPACK_IMPORTED_MODULE_14___default().find_rule(root_url,_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_7___default().get("bext_config"),"force_premium",_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_15__["default"].get("country"));if(!rule)return false;const install_ver=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_7___default().get("install_version");if(!opt.ignore_install_version&&rule.install_ver_min&&install_ver&&_util_version_util_js__WEBPACK_IMPORTED_MODULE_13___default().cmp(install_ver,rule.install_ver_min)<0){return false}if(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_8___default().get_site_conf(root_url,"trial"))return false;return rule};E.get_force_premium_rules=(root_urls,opt)=>root_urls.map((root_url=>E.get_force_premium_rule(root_url,opt)));const info_inited_cb=()=>{if(_util_util_js__WEBPACK_IMPORTED_MODULE_10___default().is_mocha()&&last_refreshed)return;E.sp.spawn(E.refresh_user())};let login_popup_id,login_tab_id,login_win_id;E.open_login_popup=({method,signup,root_url})=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*(){try{let next=chrome.runtime.getURL("")+"js/login_done.html";let qs=method=="email"?_util_escape_js__WEBPACK_IMPORTED_MODULE_4___default().qs({next,hide_social:1,signup:signup?1:undefined,uuid:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_7___default().get("uuid"),root_url,ver:_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_8___default().version()}):_util_escape_js__WEBPACK_IMPORTED_MODULE_4___default().qs({next});let url=method=="email"?_bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_9__.Z.hola_url()+`/bext_login?${qs}`:_bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_9__.Z.hola_url()+`/users/auth/${method}/popup?${qs}`;_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_15__["default"].set_login_redirect(new URL(next).hostname);yield close_login_popup();login_tab_id=_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_17___default().get("active.id");let cur_win=yield _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default().cb_apply(chrome.windows,".getLastFocused",[]);login_win_id=cur_win&&cur_win.id;let win=yield _bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_16__["default"].create_window({width:500,height:500,url});login_popup_id=win.id}catch(e){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_8___default().perr("be_open_login_popup_err",{method,signup,root_url},{err:e})}}));const close_login_popup=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*(){if(!login_popup_id)return;yield _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default().cb_apply(chrome.windows,".remove",[login_popup_id]);login_popup_id=null}));E.login_popup_done=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*(){yield close_login_popup();if(login_win_id){yield _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default().cb_apply(chrome.windows.update,[login_win_id,{focused:true}]);login_win_id=null}if(login_tab_id){yield _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default().cb_apply(chrome.tabs.update,[login_tab_id,{active:true}]);login_tab_id=null}yield E.refresh_user({reason:"login_popup_done"})}));const on_pap_a_aid=()=>{const aff_id=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_7___default().get("pap_a_aid");if(!aff_id)return;const prev_aff_id=_util_storage_js__WEBPACK_IMPORTED_MODULE_19___default().get("pap_a_aid");_util_storage_js__WEBPACK_IMPORTED_MODULE_19___default().set("pap_a_aid",aff_id);if(aff_id!=prev_aff_id)_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_8___default().perr("be_aff_id_changed",{aff_id,prev_aff_id})};E.init=be_rule=>{if(E.inited)return;E.inited=true;E.be_rule=be_rule;E.sp=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_11___default().new_etask("be_premium");if(_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_15__["default"].get("inited"))info_inited_cb();else _bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_15__["default"].on("inited",info_inited_cb);daily_refresh_timer=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_11___default().set_interval(E.refresh_user.bind(E,{force_premium:true}),_util_date_js__WEBPACK_IMPORTED_MODULE_3___default().ms.DAY,{sp:E.sp,name:"refresh_user"});E.listen_to(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_7___default(),"change:pap_a_aid",on_pap_a_aid)};E.uninit=opt=>{opt=opt||{};E.inited=false;_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_15__["default"].off("inited",info_inited_cb);E.sp.return();_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_11___default().clear_timeout(membership_timeout);_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_11___default().clear_interval(daily_refresh_timer);last_refreshed=0;close_login_popup();if(!opt.keep_user)E.clear();E.stopListening()};const __WEBPACK_DEFAULT_EXPORT__=E},8076:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var underscore__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(7439);var underscore__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(underscore__WEBPACK_IMPORTED_MODULE_0__);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(6969);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1__);var _util_etask_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(6386);var _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_util_etask_js__WEBPACK_IMPORTED_MODULE_2__);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(3727);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3__);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(7345);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4__);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(9824);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(_util_zerr_js__WEBPACK_IMPORTED_MODULE_5__);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(5250);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_6__);var _bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(5371);var _bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_7__);var _util_url_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(5305);var _util_url_js__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(_util_url_js__WEBPACK_IMPORTED_MODULE_8__);var _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(9651);var _util_array_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(6545);var _util_array_js__WEBPACK_IMPORTED_MODULE_10___default=__webpack_require__.n(_util_array_js__WEBPACK_IMPORTED_MODULE_10__);var _svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(843);var _svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_11___default=__webpack_require__.n(_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_11__);var _svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(2227);var _svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_12___default=__webpack_require__.n(_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_12__);var _bext_vpn_bg_mode_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(1002);var _bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(4130);var _bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_14___default=__webpack_require__.n(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_14__);var _util_date_js__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(932);var _util_date_js__WEBPACK_IMPORTED_MODULE_15___default=__webpack_require__.n(_util_date_js__WEBPACK_IMPORTED_MODULE_15__);var _util_util_js__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(1291);var _util_util_js__WEBPACK_IMPORTED_MODULE_16___default=__webpack_require__.n(_util_util_js__WEBPACK_IMPORTED_MODULE_16__);var _bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(6210);var _bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(7666);var _util_storage_js__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(8915);var _util_storage_js__WEBPACK_IMPORTED_MODULE_19___default=__webpack_require__.n(_util_storage_js__WEBPACK_IMPORTED_MODULE_19__);var conf__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(9641);var _bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__(9265);
// LICENSE_CODE ZON
_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_6___default().assert_bg("be_rule");const SEC=_util_date_js__WEBPACK_IMPORTED_MODULE_15___default().ms.SEC,chrome=self.chrome,assign=Object.assign;let be_bg_main,tab_state={},bext_config={};const E=new(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1___default().task_model.extend({model_name:"rule",rules:undefined,_defaults:function(){this.on("destroy",(()=>E.uninit()))}}));let stamp;const v3=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().is_v3;const CG=(path,def)=>_util_util_js__WEBPACK_IMPORTED_MODULE_16___default().get(bext_config,path,def);_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_7___default().be_rule=E;E.tasks=[];E.task_cancel_all=()=>_util_util_js__WEBPACK_IMPORTED_MODULE_16___default().forEach(E.tasks,(task=>task.return()));E.task_insert=task=>E.tasks.push(task);E.task_remove=task=>_util_array_js__WEBPACK_IMPORTED_MODULE_10___default().rm_elm(E.tasks,task);E.uninit=()=>{if(!E.get("inited"))return;E.sp.return();E.off("recover",on_recover);E.off("fetch_rules",fetch_rules);E.off("set_rule",set_rule);E.stopListening();E.clear();E.task_cancel_all();E.rules=undefined};const on_max_redirects=(from,to,urls)=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({cancel:true},(function*_on_max_redirects(){if(CG("disable_max_redirects"))return;let urules,rules=_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_12___default().get_rules();if(!rules||!(urules=rules.unblocker_rules))return;let update;for(let name in urules){let r=urules[name];if(!r.enabled||r.name!=from&&r.name!=to)continue;r.enabled=false;E.set_rule({name:r.name,country:r.country,enabled:r.enabled});update=true}if(!update)return;_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().perr("max_redirect_rule_disable",{from,to,urls},{rate_limit:{count:1}});yield E.update_rules(rules)}));E.init=()=>{if(E.get("inited"))return;be_bg_main=self.be_bg_main;E.set("inited",true);E.set("tabs_stub_rules",{});E.set("enable_ts",_util_storage_js__WEBPACK_IMPORTED_MODULE_19___default().get("enable_ts"));E.sp=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_6___default().new_etask("be_rule");E.on("recover",on_recover);E.on("fetch_rules",fetch_rules);E.on("set_rule",set_rule);E.listen_to(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default(),"change:ext.active change:ext.suspended change:session_key",underscore__WEBPACK_IMPORTED_MODULE_0___default().debounce((()=>{set_rules()})));E.listenTo(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_14___default(),"completed error_occured",(info=>{if(!_util_util_js__WEBPACK_IMPORTED_MODULE_16___default().get(info,"tabId"))return;var fix_task=fix_tasks[info.tabId];if(!fix_task)return;if(!fix_task.fix_waiting)return;fix_task.continue()}));E.listenTo(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_14___default(),"created",(o=>{var tab=o.tab;var stub_rule=E.get_stub_rule(tab.openerTabId);if(tab.openerTabId&&!_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_6___default().is_new_tab(tab.url)&&stub_rule)E.set_stub_rule(tab.id,stub_rule)}));E.listenTo(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_14___default(),"max_redirect_sequence",on_max_redirects);_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_12___default().on("local_rules_set",(()=>E.update_rules(undefined,{resolve:true})));const set_rules=resolve=>{E.update_rules(bext_config.proxy_rules||null,{resolve});stamp=bext_config.stamp};E.listen_to(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default(),"change:bext_config",(()=>{bext_config=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().get("bext_config")||{};if(bext_config.proxy_rules&&(!stamp||stamp!=bext_config.stamp))set_rules(!stamp)}));E.listen_to(_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_17__["default"],"change:country",(()=>{if(_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_17__["default"].get("country"))set_rules()}));if(_util_util_js__WEBPACK_IMPORTED_MODULE_16___default().is_mocha())E.update_rules(undefined,{resolve:true})};function on_recover(){E.trigger("fetch_rules")}E.get_rules=(url,ignore)=>_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_6___default().get_rules(E.rules,url,ignore);E.get_rule_ratings=args=>_bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_9__.Z.ccgi_ajax({data:_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().qs_ajax(args),url:conf__WEBPACK_IMPORTED_MODULE_20__.url_ccgi+"/rule_ratings"});E.get_groups_from_ratings=ratings=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({name:"get_groups_from_ratings",cancel:true},(function*(){let groups=[];ratings.forEach((cr=>{cr.rules.forEach((r=>{if(r.rating<=0)return;groups.push(underscore__WEBPACK_IMPORTED_MODULE_0___default().pick(r,"name","type","country"))}))}));if(!groups.length)return;groups=yield _svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_12___default().get_groups(groups);if(!_util_util_js__WEBPACK_IMPORTED_MODULE_16___default().get(groups,"unblocker_rules"))return groups;_util_util_js__WEBPACK_IMPORTED_MODULE_16___default().forEach(groups.unblocker_rules,(r=>delete r.enabled));return groups}));E.update_rules=(rules,opt)=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*update_rules(){if(rules)_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_12___default().set_rules(rules);if(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().is_disabled()||!rules&&rules!==undefined)E.rules=undefined;else{E.rules=_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_12___default().get_rules();E.set("rules",E.rules)}yield _bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_7___default().update_rule_urls(E.rules,opt);E.set("stamp",_util_util_js__WEBPACK_IMPORTED_MODULE_16___default().get(E.rules,"stamp",0))}));function fetch_rules(){if(!E.get("inited"))return;E.task_cancel_all();if(!E.set_busy({desc:"Changing country..."}))return E.schedule_clr(["fetch_rules"]);var auth=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().auth();if(!auth.uuid||!auth.session_key)return E.clr_busy();E.sp.spawn(_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({cancel:true},(function*fetch_rules_(){this.finally((()=>{if(E.get("status")=="busy")E.clr_busy()}));try{yield E.update_rules()}catch(e){E.set_err();_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().perr("be_script_fetch_rules_err",{},{err:e})}})))}E.set_rule=(opt,update)=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*_set_rule(){if(!opt)return;if(opt.stub)return void E.set_stub_rule(opt.tab_id,opt);if(opt.tab_id)E.set_stub_rule(opt.tab_id,null);if(opt.enabled)opt.src_country=(_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_17__["default"].get("country")||"").toLowerCase();if(_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_18__["default"].get_trial_active(opt.name))opt.src="trial";_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_12___default().set_rule(opt);E.trigger("rule_set",opt);if(update){yield E.update_rules(undefined,{resolve:opt.enabled,rule:opt,reload:!opt.no_reload})}}));function set_tab_state(tab_id,state){if(!tab_id||tab_id==-1)return;var s=tab_state[tab_id]=tab_state[tab_id]||{};if(s.state==state)return;var prev=s.state||"idle";s.state=state;E.trigger("set_tab_state",{tab_id,prev,curr:s.state})}const get_tab_id=tab_id=>tab_id===undefined?_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_14___default().get("active.id"):tab_id;E.get_tab_state=tab_id=>(tab_state[get_tab_id(tab_id)]||{}).state||"idle";const set_enable_ts=ts=>{E.set("enable_ts",ts);_util_storage_js__WEBPACK_IMPORTED_MODULE_19___default().set("enable_ts",ts)};const set_rule_tasks={};function set_rule(opt){_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_6___default().assert(E.get("inited"),new Error("set_rule failed, be_rule not inited"));opt=assign({},opt);const{tab_id}=opt;E.task_cancel_all();if(fix_tasks[tab_id])fix_tasks[tab_id].return();if(set_rule_tasks[tab_id])set_rule_tasks[tab_id].return();if(!E.set_busy({desc:opt.enabled?"Finding peers...":"Stopping peer routing..."})){return E.schedule(["set_rule",opt])}E.sp.spawn(_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({cancel:true},(function*_set_rule(){set_rule_tasks[tab_id]=this;set_tab_state(opt.tab_id,opt.enabled?"enable_rule":"disable_rule");this.finally((()=>{delete set_rule_tasks[tab_id];E.clr_busy();set_tab_state(tab_id,"idle")}));const hola_uid=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().get("hola_uid");try{if(_util_util_js__WEBPACK_IMPORTED_MODULE_16___default().is_mocha())E.t.set_rule_sp=this;set_tab_state(tab_id,"update_rules");E.update_progress({desc:"Changing country..."});if(!opt.stub&&opt.enabled){_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_12___default().reverify_country_agents(opt.country);if(_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_6___default().is_debug_peer(opt))_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_12___default().reauth_country_agents(opt.country,0);let to=_util_util_js__WEBPACK_IMPORTED_MODULE_16___default().get(bext_config,"set_rule_timeout",10*SEC);if(to)this.alarm(to,{throw:new Error("timeout")})}yield E.set_rule(opt,true);if(!opt.stub){let r=_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_11___default().find_rule(E.rules&&E.rules.unblocker_rules,opt);let is_enabled=r&&r.enabled;if(!!is_enabled!=!!opt.enabled)_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().perr("be_set_rule_mismatch",{opt,r,hola_uid})}set_tab_state(tab_id,"rule_set");const info={name:opt.name,type:opt.type,country:opt.country,enabled:opt.enabled,hola_uid};if(!E.get("enable_ts")){const ts=Date.now();set_enable_ts(ts);info.first_enable=ts;info.aff_id=be_bg_main.get("aff_id")}_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().perr("be_set_rule_ok",info)}catch(e){set_tab_state(tab_id,"set_rule_err");_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().perr("be_script_set_rule_err",{hola_uid},{err:e})}})))}E.is_enabled=rule=>{if(!rule)return true;if(!E.rules||!E.rules.unblocker_rules)return false;var r=_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_11___default().find_rule(E.rules.unblocker_rules,rule);return r&&r.enabled};E._change_proxy=opt=>{if(!E.get("inited")||opt.rule.changing_proxy||!E.is_enabled(opt.rule))return;opt.rule.changing_proxy=true;set_tab_state(opt.tab_id,"change_proxy");return _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({cancel:true},(function*change_proxy(){this.finally((()=>{opt.rule.changing_proxy=false;E.task_remove(this)}));E.task_insert(this);E.update_progress({desc:"Trying another peer..."});const exclude=opt.exclude||_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_12___default().get_active_agents(opt.rule);let res=yield _svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_12___default().replace_agents(opt.rule,exclude);if(v3)yield _bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_7___default().update_rule_urls(E.rules);return res}))};function get_report(opt){let tab_id=get_tab_id(opt.tab_id),rule=opt.rule||{};let req_errors,user=_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_21__["default"].get("user");if(opt.send_logs&&be_bg_main)req_errors=be_bg_main.get_dumped_errors(tab_id);let page_load,trace;if((trace=_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_14___default().get_trace(tab_id))&&trace.length)page_load=trace[trace.length-1].duration;let tu=_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_7___default().get_tab_unblocker(tab_id)||{};let url=opt.url||_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_14___default().get("active.url");return assign({src_country:opt.src_country||(_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_17__["default"].get("country")||"").toLowerCase(),hola_uid:user&&user.hola_uid,url,root_url:opt.root_url||get_root_url(tab_id),premium:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().get("is_premium"),proxy_country:rule.country&&rule.country.toLowerCase(),tab_id,callback_raw:_bext_vpn_bg_mode_js__WEBPACK_IMPORTED_MODULE_13__.Z.get("svc.callback_raw"),callback_ts:_bext_vpn_bg_mode_js__WEBPACK_IMPORTED_MODULE_13__.Z.get("svc.callback_ts"),mode_change_count:_bext_vpn_bg_mode_js__WEBPACK_IMPORTED_MODULE_13__.Z.get("mode_change_count"),multiple_mode_changes:_bext_vpn_bg_mode_js__WEBPACK_IMPORTED_MODULE_13__.Z.get("mode_change_count")>2,real_url:_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_14___default().get("active.url"),status:_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_14___default().get("active.status"),agent:_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_12___default().get_active_agents(opt.rule),agents:tu.agents,mitm_active:rule.is_mitm,req_errors,src:opt.src,page_load},underscore__WEBPACK_IMPORTED_MODULE_0___default().pick(rule,"name","type"))}E.send_fix_it_report=opt=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*send_fix_it_report_(){if(!E.get("inited"))return;let log,info=get_report(opt);if(opt.send_logs&&be_bg_main){let root_url=get_root_url(info.tab_id);if(CG("debug_logs.domains",[]).includes(root_url)||Math.random()*100<CG("debug_logs.all_domains_perc",0)){log=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().get_log()}}_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().perr("be_ui_vpn_click_no_fix_it_multi",info,{err:true});const res=yield _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().perr("be_ui_vpn_click_no_fix_it",info,{err:true,filehead:log,rate_limit:{count:10}});if(be_bg_main&&_util_util_js__WEBPACK_IMPORTED_MODULE_16___default().get(res,"bug_id"))be_bg_main.set_bug_id(res.bug_id)}));E.send_vpn_work_report=function(opt){var tab_id=get_tab_id(),rule=opt.rule||{};var user=_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_21__["default"].get("user");_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().perr("be_vpn_ok",assign({src_country:(_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_17__["default"].get("country")||"").toLowerCase(),url:_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_14___default().get("active.url"),root_url:get_root_url(tab_id),proxy_country:rule.country&&rule.country.toLowerCase(),hola_uid:user&&user.hola_uid,mitm_active:rule.is_mitm,src:opt.src},underscore__WEBPACK_IMPORTED_MODULE_0___default().pick(rule,"name","type")))};var fix_tasks={};E.fix_vpn=opt=>{if(!E.get("inited"))return;opt=opt||{};let ts=Date.now(),tab_id=opt.tab_id;if(fix_tasks[tab_id])fix_tasks[tab_id].return();set_tab_state(tab_id,"fix_vpn");return fix_tasks[tab_id]=_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({cancel:true,async:true},(function*fix_vpn_(){this.finally((()=>{delete fix_tasks[tab_id];set_tab_state(tab_id,"idle")}));try{let agent;let tu=_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_7___default().get_tab_unblocker(tab_id);if(tu&&(agent=tu.last_agent)){yield _bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_7___default()._set_req_err("fix_vpn",agent,{url:opt.url,tab_id,status:-1,peer:!agent.pool,country:opt.rule.country,rule:opt.rule})}_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_7___default().reauth_rule_agents(opt.rule);yield E.change_proxy_wait({rule:opt.rule,desc:"not_working",root_url:opt.root_url,user_not_working:true,tab_id});_util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default().notice("tab:%d reloading tab on fix_vpn",tab_id);_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_14___default().reload(tab_id);if(_util_util_js__WEBPACK_IMPORTED_MODULE_16___default().is_mocha()||Date.now()-ts>=10*SEC)return;while(true){const trace=_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_14___default().get_trace(tab_id);const last_trace=trace&&trace.length&&trace[trace.length-1];const status=_util_util_js__WEBPACK_IMPORTED_MODULE_16___default().get(last_trace,"status");if(status){let page_load=_util_util_js__WEBPACK_IMPORTED_MODULE_16___default().get(last_trace,"duration");return page_load<20*SEC&&!["4","5"].includes(status[0])}this.fix_waiting=true;yield this.wait(20*SEC);this.fix_waiting=false}}catch(e){set_tab_state(tab_id,"fix_vpn_err");this.fix_waiting=false;_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().perr("be_fix_vpn_err",opt,{err:e})}}))};function get_root_url(tab_id){var url;return tab_id>=0&&(url=_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_14___default().get_url(tab_id))&&_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_11___default().get_root_url(url)}E.change_proxy=(details,reason,route_opt,agent)=>{if(!E.get("inited"))return;let tu=_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_7___default().get_tab_unblocker(details.tabId);if(!tu)return{error:"no_tub_unblocker"};let exclude=agent||_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_12___default().get_chosen_agent(route_opt,tu.rule);let root_url=get_root_url(details.tabId);if(!exclude){let route=_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_11___default().gen_route_str(route_opt,{no_algo:true});_util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default().debug("tab:%d no agents for %s route, root_url: %s",details.tabId,route,root_url);_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().perr("debug_null_agents",{agents:_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_12___default().get_active_agents(tu.rule),details},{err:true})}exclude=_util_util_js__WEBPACK_IMPORTED_MODULE_16___default().omit(exclude,"rtt");const host=exclude&&exclude.host;_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().perr("change_proxy_on_err",{reason,bad_agent:host});_util_zerr_js__WEBPACK_IMPORTED_MODULE_5___default().debug("tab:%d change agent on %s, bad agents: [%s], root_url: %s",details.tabId,reason,host,root_url);return E._change_proxy({rule:tu.rule,exclude:exclude?[exclude]:[],root_url:root_url||"",agent_not_working:true})};E.disable_premium=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({cancel:true},(function*disable_premium(){E.set_rule({name:"all_browser",country:"us",del:true,enabled:false});let urules,rules=_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_12___default().get_rules();if(!rules||!(urules=rules.unblocker_rules))return;for(let name in urules){let site_conf,r=urules[name];if(!r.enabled||r.src=="trial"||!_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_21__["default"].get_force_premium_rule(r.name)&&!((site_conf=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().get_site_conf(r.name))&&site_conf.require_plus)&&!_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_6___default().is_google(r.name)){continue}r.enabled=false;E.set_rule({name:r.name,country:r.country,enabled:r.enabled})}yield E.update_rules(rules)}));E.disable_trial_on_logout=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({cancel:true},(function*disable_trial_on_logout(){let urules,rules=_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_12___default().get_rules();if(!rules||!(urules=rules.unblocker_rules))return;for(let name in urules){let r=urules[name];if(!r.enabled||r.src!="trial"||!_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_18__["default"].need_signin(r.name))continue;r.enabled=false;E.set_rule({name:r.name,country:r.country,enabled:r.enabled})}yield E.update_rules(rules)}));E.disable_stubs=()=>E.set("tabs_stub_rules",{});E.disable_trial=domains=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({cancel:true},(function*disable_trial(){let update,rules=_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_12___default().get_rules();if(!rules)return;domains.forEach((domain=>{let rule=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_6___default().get_rules(rules,"http://"+domain+"/",true);if(!(rule=rule&&rule[0])||!rule.enabled||rule.src!="trial")return;let unblockers=_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_7___default().tab_unblockers||{};for(let tabid in unblockers){let uri,u=unblockers[tabid];if(!u.rule||u.rule.name!=rule.name||!(tabid=+tabid))continue;if(uri=_util_url_js__WEBPACK_IMPORTED_MODULE_8___default().parse(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_14___default().get_url(tabid))){chrome.tabs.update(tabid,{url:uri.protocol+"//"+uri.hostname})}}rule.enabled=false;E.set_rule({name:domain,country:rule.country,enabled:rule.enabled,src:"trial"});update=true}));if(update)yield E.update_rules(rules)}));E.change_proxy_wait=opt=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({cancel:true},(function*change_proxy_wait_(){this.finally((()=>set_tab_state(opt.tab_id,"idle")));if(E.get("status")!="busy")return yield E._change_proxy(opt);E.once("change:status",(()=>this.continue(E._change_proxy(opt))));return yield this.wait()}));E.set_stub_rule=(tab_id,rule)=>{let tabs_stub_rules=assign({},E.get("tabs_stub_rules"));if(_util_util_js__WEBPACK_IMPORTED_MODULE_16___default().get(rule,"enabled"))tabs_stub_rules[tab_id]=rule;else delete tabs_stub_rules[tab_id];E.set("tabs_stub_rules",tabs_stub_rules)};E.get_stub_rule=tab_id=>(E.get("tabs_stub_rules")||{})[tab_id];if(_util_util_js__WEBPACK_IMPORTED_MODULE_16___default().is_mocha())E.t={on_max_redirects};const __WEBPACK_DEFAULT_EXPORT__=E},2955:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(7345);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_0__);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(9824);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_util_zerr_js__WEBPACK_IMPORTED_MODULE_1__);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(3727);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_2__);var _svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(843);var _svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_3__);var conf__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(9641);
// LICENSE_CODE ZON
const assign=Object.assign;const E={};function start_monitor_worker(){var worker=new Worker(new URL(__webpack_require__.p+__webpack_require__.u(881),__webpack_require__.b),{type:undefined});worker.onmessage=e=>{let data=e.data||{};switch(data.type){case"ping":var opt={val:data.val,url:conf__WEBPACK_IMPORTED_MODULE_4__.url_perr,perr:_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_0___default().perr_opt("be_main_thread_stuck",{},{level:_util_zerr_js__WEBPACK_IMPORTED_MODULE_1___default().L.ERR,rate_limit:{count:1}})};var config=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_2___default().get("bext_config");if(config&&config.monitor_worker)assign(opt,config.monitor_worker);worker.postMessage({type:"pong",opt});break;case"push_event":_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_3___default().push_event(data.name,{duration:data.duration,ts:data.ts});break;default:break}}}E.start_monitor_worker=start_monitor_worker;const __WEBPACK_DEFAULT_EXPORT__=E},737:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(6969);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_0__);var _util_etask_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(6386);var _util_etask_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_util_etask_js__WEBPACK_IMPORTED_MODULE_1__);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(7345);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_2__);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(3727);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3__);var _util_util_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(1291);var _util_util_js__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_util_util_js__WEBPACK_IMPORTED_MODULE_4__);var underscore__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(7439);var underscore__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(underscore__WEBPACK_IMPORTED_MODULE_5__);var _util_date_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(932);var _util_date_js__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(_util_date_js__WEBPACK_IMPORTED_MODULE_6__);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(9824);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(_util_zerr_js__WEBPACK_IMPORTED_MODULE_7__);var _svc_hola_pub_svc_monitor_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(9946);var _svc_hola_pub_svc_monitor_js__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(_svc_hola_pub_svc_monitor_js__WEBPACK_IMPORTED_MODULE_8__);var _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(9651);var conf__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(9641);
// LICENSE_CODE ZON
const chrome=self.chrome;const E=new(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_0___default().task_model.extend({model_name:"svc",_defaults:function(){this.on("destroy",(()=>E.uninit()))}}));function firefox_origin_fix(details){let fix={name:"Origin",value:"resource://ff_ext-at-hola-dot-org"};return{requestHeaders:[fix].concat(details.requestHeaders)}}E.init=be_vpn=>{if(E.inited)return;E.inited=true;if(conf__WEBPACK_IMPORTED_MODULE_10__.firefox_web_ext){chrome.webRequest.onBeforeSendHeaders.addListener(firefox_origin_fix,{urls:["*://127.0.0.1/*","*://localhost.h-local.org/*"]},["blocking","requestHeaders"])}E.svc_mon.init();E.listenTo(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default(),"change:is_premium",(()=>E.update_info()));if(!(E.be_vpn=be_vpn))return};E.uninit=()=>{E.inited=false;if(conf__WEBPACK_IMPORTED_MODULE_10__.firefox_web_ext){chrome.webRequest.onBeforeSendHeaders.removeListener(firefox_origin_fix)}E.stopListening();E.svc_mon.uninit();E.clear()};E.svc_mon=(EE=>{EE.init=()=>{if(EE.inited)return;_svc_hola_pub_svc_monitor_js__WEBPACK_IMPORTED_MODULE_8___default().init({components:["vpn","client"],detecting_start_interval:1,detecting_start_retries:10,detecting_interval:600,monitoring_interval:60,log:str=>_util_zerr_js__WEBPACK_IMPORTED_MODULE_7___default().notice("svc_monitor: "+str),perr:(id,info)=>_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_2___default().perr(id,info),watch:data=>E.update_info((()=>transform_callback_data(data)))});EE.inited=true};EE.reset=()=>_svc_hola_pub_svc_monitor_js__WEBPACK_IMPORTED_MODULE_8___default().refresh_info();EE.watch_vpn_status=()=>{if(EE.vs_sp)return;return EE.vs_sp=_util_etask_js__WEBPACK_IMPORTED_MODULE_1___default()({name:"watch_vpn_status",cancel:true},(function*watch_vpn_status_loop_(){let status=yield EE.query_api("vpn_status",undefined,{timeout:30*_util_date_js__WEBPACK_IMPORTED_MODULE_6___default().ms.SEC});status=_util_util_js__WEBPACK_IMPORTED_MODULE_4___default().get(status,"ret");yield parse_vpn_status(status||{});const idle=!status||status.idle;if(idle&&!_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().get("is_premium"))return;_svc_hola_pub_svc_monitor_js__WEBPACK_IMPORTED_MODULE_8___default().reconf({monitoring_interval:idle?60:1})}))};EE.stop_watch_vpn_status=()=>{if(!EE.vs_sp)return;EE.vs_sp=void EE.vs_sp.return();_svc_hola_pub_svc_monitor_js__WEBPACK_IMPORTED_MODULE_8___default().reconf({monitoring_interval:60})};EE.query_api=(cmd,params)=>_svc_hola_pub_svc_monitor_js__WEBPACK_IMPORTED_MODULE_8___default().exec(cmd,params);EE.uninit=()=>{if(!EE.inited)return;_svc_hola_pub_svc_monitor_js__WEBPACK_IMPORTED_MODULE_8___default().uninit();EE.inited=false};return EE})({});const transform_callback_data=data=>{if(!data)throw"no data";let ret={status:{}};ret.raw=data;if(data.connected_js)ret.proxyjs_connected=true;if(data.full_vpn)ret.status.full_vpn=data.full_vpn;return Object.assign(ret,{cid_js:data.cid_js||"",appid:data.appid||"",campaign:data.campaign||"",uuid:data.uuid||"",version:data.ver||"0.0.0",os_ver:data.os_ver,is_hola_svc:data.exe=="hola_svc.exe"||data.exe=="hola_svc",session_key_js:data.session_key_js,user_token:data.user_token,sync_token:data.sync_token||"",svc:1})};E.update_info=provider=>_util_etask_js__WEBPACK_IMPORTED_MODULE_1___default()("update_info",(function*update_info_(){try{const info=provider?provider():yield E.callback();if(underscore__WEBPACK_IMPORTED_MODULE_5___default().isEqual(info,E.get("info")))return info;let change={};change.info=info;change.cid_js=info.cid_js;change.proxyjs_connected=info.proxyjs_connected;change.version=info.version;change.is_hola_svc=info.is_hola_svc;change.session_key_cid_js=info.session_key_js;change.user_token=info.user_token;change.sync_token=info.sync_token||"";change.callback_raw=info.raw;change.callback_ts=_util_date_js__WEBPACK_IMPORTED_MODULE_6___default()();change.appid=info.appid;change.campaign=info.campaign;change.uuid=info.uuid;E.safe_set(change);return info}catch(e){E.safe_set({info:null,cid_js:"",session_key_cid_js:0,sync_token:"",callback_raw:null,callback_ts:null,version:null,appid:"",campaign:"",uuid:""})}}));E.callback=function(opt){opt=opt||{};self.disable_svc_polling=self.disable_svc_polling||0;return _util_etask_js__WEBPACK_IMPORTED_MODULE_1___default()("callback",[function try_catch$(){if(self.disable_svc_polling||_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().is_disabled())return this.return(_util_etask_js__WEBPACK_IMPORTED_MODULE_1___default().err("not running"));return E.svc_mon.query_api("callback",opt.full_vpn&&{vpn:1})},function(ret){let data=ret&&ret.ret;if(this.error||!data){console.log("Use self.disable_svc_polling = 1 to stop polling");return this.return(_util_etask_js__WEBPACK_IMPORTED_MODULE_1___default().err("not running"))}if(opt.raw)return this.return(data);data=transform_callback_data(data);return this.return(data)}])};const ensure_vpn_info=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_1___default()({name:"ensure_vpn_info"},[function try_catch$(){return _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_9__.Z.hola_api_call("users/ensure_vpn_info")},function(info){if(this.error||!info){return void _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_2___default().perr("ensure_vpn_info_fail",{},{err:this.error})}var vpn_info=_util_util_js__WEBPACK_IMPORTED_MODULE_4___default().pick(info,"login","password");E.set("vpn_info",vpn_info);return vpn_info}]);const parse_vpn_status=status=>_util_etask_js__WEBPACK_IMPORTED_MODULE_1___default()((function*_parse_vpn_status(){let connecting=!!status.connecting_to;let connected=!!status.connected_to;let country=status.connecting_to||status.connected_to||"";let active=(connecting||status.disconnecting)&&!connected;if(E.get("status")!="ready"&&connected)yield update_location();set_status(active?"busy":"ready",country.toLowerCase())}));const set_status=(status,country)=>{if(country!==undefined){if(country=="uk")country="gb";E.set("vpn_country",country)}E.set("status",status||"ready");E.trigger("update_vpn_status")};E.vpn_connect=opt=>_util_etask_js__WEBPACK_IMPORTED_MODULE_1___default()((function*vpn_connect_(){try{opt=opt||{};const country=(opt.country||"").toLowerCase();const vpn_info=E.get("vpn_info")||(yield ensure_vpn_info());if(!vpn_info)return void set_status("ready","");set_status("busy",country,"vpn_connect");let res=yield E.svc_mon.query_api("vpn_connect",{host:country+".vpn.hola.org",username:vpn_info.login,password:vpn_info.password,country});E.svc_mon.reset();return res}catch(e){set_status("ready","");_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_2___default().perr("vpn_connect",{},{err:e})}}));E.vpn_disconnect=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_1___default()((function*vpn_disconnect_(){this.finally((()=>set_status()));try{set_status("busy","");let res=yield E.svc_mon.query_api("vpn_disconnect");E.svc_mon.reset();return res}catch(e){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_2___default().perr("vpn_disconnect",{},{err:e})}}));E.vpn_change_agent=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_1___default()((function*vpn_change_agent_(){this.finally((()=>set_status()));try{set_status("busy");let res=yield E.svc_mon.query_api("vpn_change_agent");E.svc_mon.reset();return res}catch(e){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_2___default().perr("vpn_change_agent",{},{err:e})}}));if(false){}let ul_sp;function update_location(){if(ul_sp)return ul_sp;return ul_sp=_util_etask_js__WEBPACK_IMPORTED_MODULE_1___default()({name:"update_location"},(function*call_myip_(){let res;for(let i=0;i<5;i++){try{res=yield _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_9__.Z.hola_api_call("myip.json",{timeout:5*_util_date_js__WEBPACK_IMPORTED_MODULE_6___default().ms.SEC});break}catch(e){yield _util_etask_js__WEBPACK_IMPORTED_MODULE_1___default().sleep(_util_date_js__WEBPACK_IMPORTED_MODULE_6___default().ms.SEC)}}ul_sp=undefined;return res}))}const __WEBPACK_DEFAULT_EXPORT__=E},228:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(6969);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_0__);var _bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(4130);var _bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_1__);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(5250);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_2__);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(3727);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3__);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(7345);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4__);var _svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(2227);var _svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_5__);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(9824);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(_util_zerr_js__WEBPACK_IMPORTED_MODULE_6__);var _util_url_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(5305);var _util_url_js__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(_util_url_js__WEBPACK_IMPORTED_MODULE_7__);var _util_util_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(1291);var _util_util_js__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(_util_util_js__WEBPACK_IMPORTED_MODULE_8__);
// LICENSE_CODE ZON
const chrome=self.chrome;_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_2___default().assert_bg("be_tab_perr");const E=new(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_0___default().model.extend({_defaults:function(){this.on("destroy",(()=>E.uninit()))}}));const cb_wrapper=_util_zerr_js__WEBPACK_IMPORTED_MODULE_6___default().catch_unhandled_exception;const google_host=hostname=>{var host_split=hostname.split(".").reverse();return host_split[1]=="google"||host_split[2]=="google"};const enabled_google_rule=()=>_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_5___default().has_rule((r=>google_host(r.name)));const google_captcha_send_perr=_url=>{if(!E.inited)return;let url=_util_url_js__WEBPACK_IMPORTED_MODULE_7___default().parse(_url),id;if(!google_host(url.hostname))return;if(/\/sorry\//.test(url.pathname))id="google_cap_sorry";else if(/\/websearch\/answer\/86640$/.test(url.pathname))id="google_cap_support";else if(/\/recaptcha$/.test(url.pathname))id="google_cap_support2";else return;if(enabled_google_rule())id+="_enabled_google_rule";if(be_vpn.be_mode.get("svc.detected"))id+="_svc";_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().perr(id,{url:_url},{err:true,rate_limit:{count:1,disable_drop_count:true}})};const on_tab_created=cb_wrapper((o=>{const tab=o.tab;if(!tab.url)return;google_captcha_send_perr(tab.url)}));const on_tab_updated=cb_wrapper((o=>{const info=(o||{}).info;if(!_util_util_js__WEBPACK_IMPORTED_MODULE_8___default().get(info,"url"))return;google_captcha_send_perr(info.url)}));const on_tab_replaced=cb_wrapper((o=>{const added=o.added;chrome.tabs.get(added,(tab=>{if(!_util_util_js__WEBPACK_IMPORTED_MODULE_8___default().get(tab,"url"))return;google_captcha_send_perr(tab.url)}))}));const update_state=()=>{const is_active=!_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().is_disabled();if(is_active==E.is_active)return;E.is_active=is_active;E.stopListening(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_1___default());if(!E.is_active)return;E.listenTo(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_1___default(),"created",on_tab_created);E.listenTo(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_1___default(),"updated",on_tab_updated);E.listenTo(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_1___default(),"replaced",on_tab_replaced)};E.uninit=()=>{if(!E.inited)return;E.inited=0;E.stopListening();be_vpn=null};let be_vpn;E.init=_be_vpn=>{if(E.inited)return;be_vpn=_be_vpn;E.inited=1;E.listen_to(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default(),"change:ext.active change:ext.suspended",update_state)};const __WEBPACK_DEFAULT_EXPORT__=E},5371:(module,exports,__webpack_require__)=>{"use strict";var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;// LICENSE_CODE ZON
!(__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(7439),__webpack_require__(6969),__webpack_require__(6386),__webpack_require__(7345),__webpack_require__(4130),__webpack_require__(3727),__webpack_require__(1211),__webpack_require__(843),__webpack_require__(4336),__webpack_require__(5305),__webpack_require__(932),__webpack_require__(9824),__webpack_require__(6069),__webpack_require__(5250),__webpack_require__(1291),__webpack_require__(7957),__webpack_require__(6545),__webpack_require__(2044),__webpack_require__(5516),__webpack_require__(2227),__webpack_require__(8915),__webpack_require__(918),__webpack_require__(6210),__webpack_require__(737),__webpack_require__(9265),__webpack_require__(7666),__webpack_require__(6262),__webpack_require__(5317),__webpack_require__(9201),__webpack_require__(8552),__webpack_require__(1225),__webpack_require__(1679),__webpack_require__(9641),__webpack_require__(3958)],__WEBPACK_AMD_DEFINE_RESULT__=function(_,be_backbone,etask,be_util,be_tabs,be_ext,B,svc_vpn_util,zescape,zurl,date,zerr,browser,be_vpn_util,zutil,be_pac,array,attrib,string,unblocker_lib,storage,ajax,be_info,be_svc,be_premium,be_trial,version_util,rate_limit,match,bg_util,pac_engine,be_dev_mode,conf,pcountries){if(ajax.default)ajax=ajax.default;be_trial=be_trial.default;be_dev_mode=be_dev_mode.default;be_info=be_info.default;be_pac=be_pac.default;be_svc=be_svc.default;be_premium=be_premium.default;bg_util=bg_util.default;be_vpn_util.assert_bg("be_tab_unblocker");function get_bg_main(){return self.be_bg_main}const assign=Object.assign;let chrome=self.chrome;let proxy_debug,debug_hooks;let requests_handler;let host_tracker;const E=new(be_backbone.model.extend({model_name:"tab_unblocker",tab_unblockers:{},requests:{},agent_requests:{},internal_reqs:{},routing_reqs:{},loading_sites:{},_defaults:function(){this.on("destroy",(()=>E.uninit()))}}));const CG=(path,def)=>zutil.get(bext_config,path,def);const cb_wrapper=zerr.catch_unhandled_exception;function ff_cb_wrapper(){const args=array.slice(arguments,1);return zerr.catch_unhandled_exception.apply(zerr,args)}let bext_config={};const is_chrome=be_util.browser_guess.browser=="chrome";const is_firefox=be_util.browser_guess.browser=="firefox";const force_strategy=storage.get("be_force_strategy");const load_errors={},tab_loads={};const bw_perr_acc=new bg_util.Bw_perr_acc;const err_logs_len=20;const req_types={media:{chrome:{min_ver:58},opera:{min_ver:45}}};const ff_webext=conf.firefox_web_ext;let request_errors={},proxy_req_slow={agents:{}},pages={};let request_errors_known={};const main_frame_errors=zutil.bool_lookup(["ERR_DNS_FAILED","ERR_AUTH_REQUIRED","net::ERR_TUNNEL_CONNECTION_FAILED","net::ERR_PROXY_CONNECTION_FAILED"]);const is_main_frame=d=>d&&!d.frameId&&d.type=="main_frame";let hola_req_id=0;function make_internal_request(url,hdrs,opt){let req_url;req_url=opt.no_redirect?url:"http://internal.hola/"+ ++hola_req_id;E.internal_reqs[req_url]={url,hdrs,opt};return req_url}function hola_XMLHttpRequest(url,method,hdrs,opt){const xhr=new XMLHttpRequest;const req_url=make_internal_request(url,hdrs,opt);xhr.hola_url=req_url;xhr.open(method,req_url);return xhr}function hdrs_arr_to_obj(hdrs){const _hdrs={};hdrs.forEach((e=>_hdrs[e.name]=e.value));return _hdrs}function loading_sites_set(tab_id,url){if(CG("disable_loading_tabs_tracker"))return;if(!url){if(E.loading_sites[tab_id]){be_vpn_util.clear_timeout(E.loading_sites[tab_id].to);delete E.loading_sites[tab_id];be_tabs.update_active_tab_url()}return}if(E.loading_sites[tab_id]){be_vpn_util.clear_timeout(E.loading_sites[tab_id].to);E.loading_sites[tab_id].url=url}else{E.loading_sites[tab_id]={url};be_tabs.update_active_tab_url()}E.loading_sites[tab_id].to=be_vpn_util.set_timeout((()=>delete E.loading_sites[tab_id]),6e4,{sp:E.sp,name:"del_loading_sites"})}function routing_reqs_set(details,req){let url=req.url;if(!E.routing_reqs[url])E.routing_reqs[url]={req};E.routing_reqs[url].to=be_vpn_util.set_timeout((()=>delete E.routing_reqs[url]),1e4,{sp:E.sp,name:"del_routing_reqs"})}function send_direct_ajax(req){if(req.direct_req)return;req.hdrs=hdrs_arr_to_obj(req.hdrs);req.hdrs["Cache-Control"]="no-cache";try{const xhr=req.direct_req=hola_XMLHttpRequest(req.url,req.method,req.hdrs,{force:"direct",ignore_redir:true,no_routing:true});xhr.onreadystatechange=cb_wrapper((()=>{let cmd;if(xhr.readyState===xhr.DONE){let ir=E.internal_reqs[req.url]||{};if(!req.direct_resp&&ir.res)req.direct_resp={code:ir.res.code,error:ir.res.error};cmd=req.strategy(req.direct_resp,req.proxy_resp)||{};delete E.internal_reqs[req.url];delete E.internal_reqs[xhr.hola_url]}if(xhr.readyState!=xhr.HEADERS_RECEIVED)return;req.direct_resp={code:xhr.status,len:xhr.getResponseHeader("Content-Length"),te:xhr.getResponseHeader("Transfer-Encoding"),lmod:xhr.getResponseHeader("Last-Modified"),etag:xhr.getResponseHeader("Etag"),type:xhr.getResponseHeader("Content-Type")};function direct_req_abort(){if(req.direct_req.abort)return req.direct_req.abort()}req.direct_timeout=be_vpn_util.clear_timeout(req.direct_timeout);cmd=req.strategy(req.direct_resp,req.proxy_resp)||{};if(cmd.proxy.serve&&!cmd.direct.serve)return void direct_req_abort();const cc=xhr.getResponseHeader("Cache-Control");if(cc&&(/no-store/.test(cc)||/(no-cache|must-revalidate|max-age)/.test(cc)&&!req.direct_resp.lmod&&!req.direct_resp.etag)){direct_req_abort()}}));xhr.send()}catch(e){}}function hdrs_add(hdrs,name,value){hdrs.push({name,value});return true}function get_site_verify_conf(req,rule){if(!req||!req.proxy_resp||!rule)return false;if(req.method!="GET")return false;return be_util.get_site_verify_conf(rule.name,req.url,rule.country)}const is_trial=root_url=>!!be_trial.get_trial_active(root_url);function is_force_proxy(opt){opt=opt||{};const r=opt.rule,tu=opt.tab_unblocker||{};if(!r||!r.name||!be_ext.get("is_premium")&&(!E.rules||(E.rules.blacklist||{})[r.name]||tu.force_premium)){return}return is_trial(r.name)||be_premium.is_active()&&(r.mode=="protect"||tu.force_premium||be_ext.get("is_premium"))}const is_direct_on_tab_laod_err=tab_id=>!CG("disable_direct_on_err")&&E.get_tab_load_err(tab_id);function get_forced_strategy(details,rule,strict,opt){let force;if(force=strict||opt.force)return force;if(opt.no_rule||is_direct_on_tab_laod_err(details.tabId)||!be_ext.get("is_premium")&&rule.name&&be_vpn_util.is_google(rule.name)){return"direct"}}function on_hooks_err(id,err){be_util.perr(id,{},{err,rate_limit:{count:1}});zerr("on_hooks_err %s %s",err,err&&err.stack);if(zutil.is_mocha())process.exit(1)}function is_redir_status(status,tmp_only){return{302:1,303:1,307:1}[status]||!tmp_only&&+status==301}function is_auth_done_url(url){return/^https?:\/\/hola\.org\/users\/auth\/\w+\/done/.test(url)}const get_headers_conf=(conf,name,url,type)=>{let c;if(!url&&(c=conf&&conf[name]&&conf[name].find((r=>r.type&&r.type.includes(type))))||(c=be_util.find_conf_rule_by_url(conf,name,url))&&(!c.type||c.type&&c.type.includes(type))){return c}};class Base_handler{constructor(){this.listener_opt={urls:["<all_urls>"]};this.listener_extra_opt=["blocking","requestBody"];this.tab_unblocker_end_cb=cb_wrapper(this._unsafe_tab_unblocker_end_cb.bind(this));this.on_before_send_headers=this.wrap("on_before_send_headers",(d=>{this.tab_unblocker_cb(d=assign({},d,{handler:this._on_before_send_headers.bind(this),cbname:"on_before_send_headers",ret:{}}));return d.ret}),true);this.on_headers_received=this.wrap("on_headers_received",(d=>{this.tab_unblocker_cb(d=assign({},d,{handler:this._on_headers_received.bind(this),cbname:"on_headers_received",ret:{}}));return d.ret}),true);this.on_completed=this.wrap("on_completed",(d=>{this.tab_unblocker_end_cb(d=assign({},d,{cbname:"on_completed",ret:{}}));delete this.cached_reqid[d.requestId];return d.ret}),true);this.on_error_occurred=this.wrap("on_error_occurred",(d=>{if(!d)return;this.tab_unblocker_end_cb(assign(d,{cbname:"on_error_occurred",ret:{}}));return d.ret}));this.on_headers_received_page=cb_wrapper((d=>{if(!d||!is_main_frame(d))return;loading_sites_set(d.tabId,null);let status=d.statusCode||bg_util.http_status_to_node(d.statusCode,d.statusLine).statusCode;if(!status)return;status=d.statusCode=""+status;be_tabs.page_trace(d,"on_headers_received");on_main_frame_headers(d);if(is_auth_done_url(d.url))be_premium.schedule_refresh_user({reason:"auth_done_url"});const res=bg_util.nodify_res(d);const tu=E.get_tab_unblocker(d.tabId);const req=E.requests[d.requestId],agent=req&&req.agent;if(is_redir_status(status)){be_tabs.track_redirect({id:d.tabId,info:d,url:d.originUrl||d.url});const location=res.headers.location;const redir=tu&&agent&&(be_util.find_conf_rule_by_url(tu.site_conf,"redirect",location)||be_util.find_conf_rule_by_url(bext_config,"redirect",location));d=assign({error:"redirect"},d);if(redir&&redir.action=="change_agent"&&tu.rule&&track_autoreload(tu,agent,d)){tu.resolve_cap=req.cancel=true;ext_on_err(tu.rule,agent,d,req.route_opt)}return req&&req.cancel?{cancel:true}:undefined}if(!{4:1,5:1}[status[0]])return;if(tu&&agent&&req&&is_hola_agent_auth(res))req.origin_url=d.url;be_tabs.trigger("error_occured",{id:d.tabId,info:{type:d.type,http_status_code:status}});d=assign({error:"cf"},d);if(!CG("disable_cf_fix")&&tu&&agent&&d.statusCode==403&&res.headers.server=="cloudflare"&&!res.headers["cf-chl-bypass"]&&tu.rule&&track_autoreload(tu,agent,d)){req.cancel=true;ext_on_err(tu.rule,agent,d,req.route_opt);return{cancel:true}}}));this.on_completed_debug_page=this.wrap("on_completed_debug_page",(d=>{let rule_info;if(!d||d.fromCache||!d.ip||!is_main_frame(d)||E.requests[d.requestId]||E.get_tab_unblocker(d.tabId)||(rule_info=get_rule_info_from_url(d.url))&&rule_info.tabs[d.tabId]){return}let agents=unblocker_lib.find_agents({ip:d.ip});if(agents.length){be_util.perr("proxy_req_unexpected",{details:d,agent:agents[0].info()},{rate_limit:{count:1}})}}));this.on_before_send_headers_debug=ff_cb_wrapper("on_before_send_headers_debug",(d=>{d=assign({},d,{ret:{}});const req=E.requests[d.requestId],agent=req&&req.agent;const store=E.tab_unblockers[d.tabId]||this;const last_agent=store.last_agent||{};if(!agent||agent.ip==last_agent.ip&&agent.port==last_agent.port)return d.ret;zerr.notice("tab:%d proxy agent selected %O %s",d.tabId,agent,req.url.slice(0,100));let rule;if(rule=req.opt.rule){zerr.notice("tab:%d rule %O",d.tabId,zutil.pick(rule,"id","name","country","description"))}store.last_agent=agent;return d.ret}));this.on_headers_received_debug=ff_cb_wrapper("on_headers_received_debug",(d=>{d=assign({},d,{ret:{}});let req,res,tu,host;if((req=E.requests[d.requestId])&&req.agent&&(tu=E.get_tab_unblocker(d.tabId))&&(res=bg_util.nodify_res(d))){if(is_hola_agent_auth(res)&&(host=req.agent.host)){host=host.split(".")[0];let rl,debug_auth=tu.debug_auth=tu.debug_auth||{};if(!(rl=debug_auth[host]))rl=debug_auth[host]={total:0};rl.total++}let cc,rule=req.opt.rule;if(CG("debug.cache_control_report")&&!tu._cache_reported&&(cc=res.headers["cache-control"])&&+cc.replace("max-age=","")>0){be_util.perr("be_debug_cache_control",{details:d,rule:be_vpn_util.get_rule_min_fmt(rule)});tu._cache_reported=true}let verify;if(is_redir_status(d.statusCode)&&(verify=get_site_verify_conf(req,rule))&&verify.ret&&verify.ret.status==d.statusCode){be_util.perr("bw_req_err_"+verify.id,{error:d.statusCode,url:req.url,ip:d.ip,method:req.method,rule:be_vpn_util.get_rule_min_fmt(rule),agent:req.agent},{rate_limit:{count:1,ms:date.ms.MIN}})}}return d.ret}));this.on_completed_debug=ff_cb_wrapper("on_completed_debug",(d=>{let req;if(!d||!(req=E.requests[d.requestId]))return;const rule=be_vpn_util.get_rule_min_fmt(req.opt.rule);const limit={count:1,ms:date.ms.MIN};const info={url:req.url,ip:d.ip,method:req.method,agent:req.agent,rule};let verify;if((verify=get_site_verify_conf(req,rule))&&verify.ret&&verify.ret.status==req.proxy_resp.code){be_util.perr("bw_req_err_"+verify.id,assign({error:req.proxy_resp.code},info),{rate_limit:limit})}const tab_unblocker=E.get_tab_unblocker(d.tabId);const is_proxy_req=tab_unblocker&&rule&&req.proxy_req&&req.serving=="proxy"&&req.agent;let min_ver;if(is_proxy_req&&d.ip&&(min_ver=bext_config.ip_check_min_ver)&&version_util.cmp(be_util.version(),min_ver)>=0&&req.agent.ip!=d.ip&&!d.fromCache){let mismatch_perr_id="req_agent_ip_mismatch";if(unblocker_lib.find_agents({ip:d.ip}).length)mismatch_perr_id+="_agent";be_util.perr(mismatch_perr_id,info,{rate_limit:{count:1}});svc_vpn_util.push_event("pac_miss",{req_ip:d.ip,agent_ip:req.agent.ip,url:req.url})}let dur=Date.now()-req.start_ts;if(is_proxy_req&&!bext_config.disable_monitor_slow&&dur>10*date.ms.SEC){let s;if(!(s=proxy_req_slow[rule.name])){s=proxy_req_slow[rule.name]={10:0,20:0,60:0,max:0};monitor_proxy_req_slow()}let agent=req.agent.host||req.agent.ip;proxy_req_slow.agents[agent]=(proxy_req_slow.agents[agent]||0)+1;s[dur>60*date.ms.SEC?"60":dur>20*date.ms.SEC?"20":"10"]++;s.max=Math.max(dur,s.max);zerr.debug("tab:%d slow request detected - %d ms, agent %s, "+"url %s",d.tabId,dur,agent,req.url.slice(0,200))}if(!d.error||!tab_unblocker)return;let rl_path="debug_errors."+d.error+"."+!!req.agent,rl;if(!(rl=zutil.get(tab_unblocker,rl_path)))zutil.set(tab_unblocker,rl_path,rl={total:0});rl.total++;if(!rate_limit(rl,limit.ms,limit.count))return;zerr.debug("tab:%d request failed with error %s after %d ms, "+"total cnt %d, rule %s, type %s, method %s, agent %s, url %s",d.tabId,d.error,dur,rl.total,rule&&rule.name,d.type,req.method,req.agent&&req.agent.host,req.url.slice(0,200))}));this.on_headers_received_media=ff_cb_wrapper("on_headers_received_media",(d=>{let media_failure;if(!(media_failure=get_failure_config("media")))return;let req,tab;if(d.tabId<0||!(tab=E.tab_unblockers[d.tabId])||!(req=E.requests[d.requestId])){return}tab.media_chunks=tab.media_chunks||0;const media_agents=tab.media_agents=tab.media_agents||{};const agent=req.agent&&req.agent.host;const rule=zutil.get(req,"opt.rule");if(d.statusCode==200){tab.media_chunks++;if(agent)media_agents[agent]=(media_agents[agent]||0)+1;if(tab.media_req_cancel&&!tab.media_fix_perr){tab.media_fix_perr=true;be_util.perr("media_failure_fixed",{url:d.url,agent,headers:d.requestHeaders,rule:be_vpn_util.get_rule_min_fmt(rule)},{rate_limit:{count:1}})}return}if(!/^(4|5)/.test(d.statusCode)||d.statusCode==407||!agent||!rule){return}tab.media_failures=(tab.media_failures||0)+1;const res=bg_util.nodify_res(d);zerr.notice("tab:%d media failure detected: %d, %s%s %s",d.tabId,d.statusCode,agent,res.headers["x-tcp-info"]?" from:"+res.headers["x-tcp-info"]:"",d.url.slice(0,200));this.dump_media_stats(d.tabId,"error");return fix_media_req_err(zutil.get(req,"opt.rule"),req.agent,d,tab,req.route_opt,media_failure)}));this.on_completed_media=ff_cb_wrapper("on_completed_media",(d=>{let media_failure,req,tab,rule,agent;if(d.tabId<0||!(tab=E.tab_unblockers[d.tabId])||!(req=E.requests[d.requestId])||req.serving!="proxy"||!(rule=zutil.get(req,"opt.rule"))||!(agent=req.agent)||!(media_failure=get_failure_config("media"))||!/^(4|5)/.test(d.statusCode)||d.statusCode==407){return}if(d.ip&&agent.ip!=d.ip){return zerr.debug("tab:%d ignore set_err on agent ip mismatch"+" - expected %s, got %s",d.tabId,agent.ip,d.ip)}let root_url=rule.name;if(!be_util.get_site_verify_conf(root_url,d.url,rule.country)||media_failure.disable_set_err){return}let limit=assign({ms:5*date.ms.MIN,count:10},media_failure.set_err_rate_limit);let set_err_rl=tab.set_err_rl=tab.set_err_rl||{};let rl=set_err_rl[agent.host]=set_err_rl[agent.host]||{};if(!rate_limit(rl,limit.ms,limit.count)){return zerr.debug("tab:%d set_err limit exeeded: %s",d.tabId,agent.host)}let err_opt={tab_id:d.tabId,url:d.url,status:d.statusCode,peer:!agent.pool,country:rule.country,rule};E._set_req_err("media_failure",agent,err_opt)}))}wrap(name,cb,ff){const cb_wrap=_cb=>ff?ff_cb_wrapper(name,_cb):cb_wrapper(_cb);return cb_wrap(cb)}static get_handler(){if(zutil.get(self,"browser.proxy.onRequest"))return new Ff_handler;return new Chrome_handler}init(){if(this.inited)return;this.inited=true;this.cached_reqid={};this.update_hooks();this.init_media_stats();return true}uninit(){if(!this.inited)return;this.inited=false;this.uninit_media_stats();this.update_hooks();this.cached_reqid={};return true}update_hooks(mode){let add_global=()=>{if(!this.global_hooks)this.global_hooks=this.add_hooks("main_frame")};let rm_global=()=>{if(this.global_hooks)this.global_hooks=this.remove_hooks(this.global_hooks)};let add_local=()=>{for(let tabid in E.tab_unblockers){let tab=E.tab_unblockers[tabid];if(!tab.hooks)tab.hooks=this.add_hooks(tabid)}};let rm_local=()=>{for(let tabid in E.tab_unblockers){let tab=E.tab_unblockers[tabid];if(tab.hooks)tab.hooks=this.remove_hooks(tab.hooks)}};let add_debug=()=>{if(!this.debug_hooks)this.debug_hooks=this.add_debug_hooks()};let rm_debug=()=>{if(this.debug_hooks)this.debug_hooks=this.remove_hooks(this.debug_hooks)};if(mode=="all_browser"||mode=="debug_peer")return rm_local();if(!this.inited){rm_global();rm_debug();rm_local()}else{add_global();add_debug();add_local()}}add_debug_hooks(){if(!bext_config.debug_hooks)return;let hooks=new Request_hooks(this);try{hooks.add("onCompleted",this.on_completed_debug_page,{urls:["<all_urls>"],types:["main_frame"]})}catch(e){on_hooks_err("be_add_debug_hooks_err",e)}return hooks}add_hooks(tabid,hooks_wrapper){let hooks=new Request_hooks(this,hooks_wrapper);try{if(tabid=="main_frame"){hooks.add("onHeadersReceived",this.on_headers_received_page,{urls:["<all_urls>"],types:["main_frame"]},["responseHeaders"]);return hooks}tabid=+tabid;let filter=tabid>=0?assign({tabId:tabid},this.listener_opt):this.listener_opt;if(debug_hooks){hooks.add("onCompleted",this.on_completed_debug,filter);hooks.add("onErrorOccurred",this.on_completed_debug,filter)}hooks.add("onBeforeSendHeaders",this.on_before_send_headers,filter,["blocking","requestHeaders"]);hooks.add("onHeadersReceived",this.on_headers_received,filter,["blocking","responseHeaders"]);let failure_opt;if(failure_opt=this.get_failure_opt(tabid,"media",filter)){hooks.add("onCompleted",this.on_completed_media,failure_opt);hooks.add("onHeadersReceived",this.on_headers_received_media,failure_opt,["responseHeaders","blocking"]);hooks.add_interval(this.dump_media_stats.bind(this,tabid,"interval"),10*date.ms.MIN,{sp:E.sp,name:"dump_media_stats"})}hooks.add("onCompleted",this.on_completed,filter);hooks.add("onErrorOccurred",this.on_error_occurred,filter);if(!debug_hooks)return hooks;hooks.add("onBeforeSendHeaders",this.on_before_send_headers_debug,filter,["blocking","requestHeaders"]);hooks.add("onHeadersReceived",this.on_headers_received_debug,filter,["blocking","responseHeaders"])}catch(e){on_hooks_err("be_add_hooks_err",e)}return hooks}get_failure_opt(tabid,name,opt){let failure;if(!(failure=get_failure_config(name)))return;let types,ext=failure.extensions||[];if(types=failure.types){const g=be_util.browser_guess;types=types.filter((t=>{let min;return!(min=zutil.get(req_types[t],g.browser+".min_ver"))||g.version>=min}))}let urls=[],root_url;if(root_url=tabid>=0&&be_tabs.get_url(tabid))root_url=svc_vpn_util.get_root_url(root_url);let rules=failure.rules||[];if(root_url)rules=rules.filter((r=>r.domain==root_url));rules.forEach((r=>{if(r.urls)urls=urls.concat(r.urls);if(r.extensions)ext=ext.concat(r.extensions)}));ext=array.unique(ext);ext.forEach((e=>urls.push("*://*/*."+e,"*://*/*."+e+"?*")));urls=array.unique(urls);if(urls.length)return assign({},opt,{urls,types})}init_media_stats(){if(this.on_video_progress)return;E.on("video_progress",this.on_video_progress=msg=>{const tab=E.get_tab_unblocker(msg.tab_id);if(tab&&msg.progress)tab.video_progress=(tab.video_progress||0)+msg.progress});E.listenTo(be_ext,"change:ui_open",this.on_ui_open=function(c,ui){if(ui&&ui.tab_id)this.dump_media_stats(ui.tab_id,"ui_open")}.bind(this))}uninit_media_stats(){if(this.on_video_progress)E.off("video_progress",this.on_video_progress);this.on_video_progress=null;if(this.on_ui_open)E.stopListening(be_ext,"change:ui_open",this.on_ui_open);this.on_ui_open=null}dump_media_stats(tab_id,reason){const tab=E.get_tab_unblocker(tab_id);if(!tab||!tab.media_agents)return;zerr.debug("tab:%d media stats on %s: %d sec played, %d chunks "+"received, agents %O",tab_id,reason,tab.video_progress||0,tab.media_chunks||0,tab.media_agents||{});tab.media_chunks=0;tab.media_agents={};tab.video_progress=0}remove_hooks(hooks){try{hooks.clear()}catch(e){on_hooks_err("be_rm_hooks_err",e)}}_gen_proxy_req(){}_on_first_request(details,opt){const url=details.url,rule=opt.rule||{};let req=E.requests[details.requestId];let country=opt.country||rule.country||"";const tab_id=details.tabId;if(!req){req=E.requests[details.requestId]={id:details.requestId,url,method:details.method,type:details.type,opt,route_opt:{direct:1},start_ts:Date.now(),tab_id,ret:details.ret};let strict=!E.internal_reqs[details.url]&&force_strategy;const force=get_forced_strategy(details,rule,strict,opt);const proxy_country=country.toUpperCase();const uopt={force,top_url:rule.name?zurl.add_proto(rule.name)+"/":opt.int_req&&opt.int_req.hdrs?opt.int_req.hdrs.Referer:null,root_url:rule.name,type:is_main_frame(details)?"main_frame":details.type,method:details.method,country:proxy_country,proxy_country,src_country:be_info.get("country"),premium:force!="direct"&&!!is_force_proxy(opt),is_trial:is_trial(rule.name),full_vpn:!bext_config.default_strategy,strict};let root_url;if(be_vpn_util.is_all_browser(rule)&&(root_url=tab_id>=0&&be_tabs.get_url(tab_id))){uopt.real_root_url=svc_vpn_util.get_root_url(root_url)}req.strategy=unblocker_lib.handle_request(url,uopt);const t=E.get_tab_unblocker(tab_id);if(t){if(proxy_debug){if(t.track.strategy!=req.strategy.desc||Date.now()-t.track.last>30*date.ms.SEC){if(t.track.counter){zerr.info("STRATEGY: %s tab:%d - %d urls - %O",t.track.strategy,tab_id,t.track.counter,Object.keys(t.track.domains))}zerr.info("STRATEGY: %s tab:%d %s",req.strategy.desc,tab_id,req.url.slice(0,256));t.track.counter=0;t.track.strategy=req.strategy.desc;t.track.domains={};t.track.last=Date.now()}t.track.counter++;t.track.domains[zurl.get_host(req.url)]=true}t.req_total_n=(t.req_total_n||0)+1;t.req_stats.total_n=(t.req_stats.total_n||0)+1}}req.proxy_req=false;if(req.cancel){unblocker_lib.on_before(req.url,req.id,{err:"cancel"});return void(details.ret.cancel=true)}const cmd=req.cmd=req.strategy(req.direct_resp,req.proxy_resp);if(!cmd){return void unblocker_lib.on_before(req.url,req.id,tab_id,{err:"no_cmd"})}E.set("activity",Date.now());country=zutil.get(cmd,"proxy.country",country);if(req.serving){if(req.serving=="proxy"){if(cmd.proxy){return void this._gen_proxy_req(req,details,cmd,{country})}}}else if(cmd.proxy){if(cmd.direct&&cmd.direct.serve)req.serving="direct";else if(cmd.proxy.serve){req.serving="proxy";this._gen_proxy_req(req,details,cmd,{country})}else if(cmd.proxy.start)this._gen_proxy_req(req,details,cmd,{country});else if(cmd.direct.start)req.direct_req=true;else if(cmd.proxy.abort)return void(details.ret.cancel=true);if(cmd.direct&&cmd.direct.abort&&req.direct_req)req.direct_req.abort()}else if(cmd.direct){if(cmd.direct.serve)req.serving="direct";else if(cmd.direct.start)req.direct_req=true;else if(cmd.direct.abort)details.ret.cancel=true}else if(cmd.block)details.ret.cancel=true;unblocker_lib.on_before(req.url,req.id,req.tab_id,{strategy:req.strategy&&req.strategy.desc,agent:req.proxy_req&&req.proxy_req.host})}_on_before_send_headers(details){const url=details.url,req=E.requests[details.requestId];const req_hdrs=details.requestHeaders;let hdrs,modified=0;if(!req||!req.strategy)return;if(be_dev_mode.get("debug_pac")){let proto=zurl.get_proto(url),host=zurl.get_host(url);let _url=proto=="http"?url:proto+"://"+host+"/";let ret=pac_engine.FindProxyForURL(_url,host);let exp=req.proxy_str||"DIRECT";if(ret==exp){zerr.notice("virtual_pac FindProxyForURL OK %s exp %s url %s",ret,exp,url)}else{zerr("virtual_pac FindProxyForURL MISS %s exp %s url %s",ret,exp,url)}}const int_req=req.opt.int_req;if(hdrs=int_req&&int_req.hdrs){for(let h in hdrs)modified|=hdrs_add(req_hdrs,h,hdrs[h])}let c,tu=E.get_tab_unblocker(details.tabId);if(tu&&(c=get_headers_conf(tu.site_conf,"headers_conf",url,details.type)||get_headers_conf(bext_config,"headers_conf2",url,details.type)||get_headers_conf(bext_config,"headers_conf2","",details.type))&&c.name&&c.value!==undefined){modified|=hdrs_add(req_hdrs,c.name,c.value)}let redir,agent=req&&req.agent;if(tu&&tu.rule&&agent&&req.origin_url&&(redir=be_util.find_conf_rule_by_url(tu.site_conf,"redirect",details.url)||be_util.find_conf_rule_by_url(bext_config,"redirect",details.url))&&redir.action=="change_agent"){const d=assign({error:"redirect",originUrl:req.origin_url},details);if(track_autoreload(tu,agent,d)){tu.resolve_cap=req.cancel=true;ext_on_err(tu.rule,agent,d,req.route_opt)}if(req.cancel)return{cancel:true}}const cmd=req.strategy(req.direct_resp,req.proxy_resp)||{};if(req.serving);else if(cmd.proxy){if(cmd.direct&&cmd.direct.start&&!req.direct_req){req.hdrs=req_hdrs;send_direct_ajax(req)}if(cmd.proxy.start&&cmd.proxy.hdrs_only&&url.startsWith("http:")&&!url.includes(":443/")){modified|=hdrs_add(req_hdrs,"X-Hola-Headers-Only","1")}}if(modified)details.ret.requestHeaders=req_hdrs}tab_unblocker_cb(details){let url;if(!(url=details.url))return;let tab_unblocker=E.get_tab_unblocker(details.tabId);const is_main=is_main_frame(details);if(!ff_webext&&!be_pac.has_pac)return;if(is_main&&details.tabId!=-1&&(details.cbname=="on_before_request"||details.cbname=="on_before_send_headers")){loading_sites_set(details.tabId,url)}else loading_sites_set(details.tabId,null);let rule_info,req,handler=details.handler;if(req=E.requests[details.requestId])return handler(details,req.opt);if(req=E.routing_reqs[url]){delete E.routing_reqs[url];req.to=be_vpn_util.clear_timeout(req.to);req=req.req;req.id=details.requestId;E.requests[details.requestId]=req;return handler(details,req.opt)}if(req=E.internal_reqs[url]){if(zurl.get_host(url)=="internal.hola"){req.reqid=details.requestId;E.internal_reqs[req.url]=req;delete E.internal_reqs[url];req.is_redirected=true;return void(details.ret.redirectUrl=req.url)}if(req.opt&&req.opt.no_redirect)req.reqid=details.requestId;if(req.reqid==details.requestId)return handler(details,assign({},req.opt,{int_req:req}))}if(details.cbname!="on_before_request"&&details.cbname!="on_proxy_request"){return}if(is_main){rule_info=get_rule_info_from_url(url);if(!tab_unblocker){if(rule_info&&details.tabId!=-1){if(!(tab_unblocker=tab_unblocker_add(details.tabId,rule_info,url))){return}}}else if(!rule_info||rule_info.root_url!=tab_unblocker.root_url){tab_unblocker_del(details.tabId,undefined,"rule_missing");if(!rule_info||!(tab_unblocker=tab_unblocker_add(details.tabId,rule_info,url))){return}}let site,redir,force_redir;if(tab_unblocker&&rule_info&&rule_info.rule.src=="trial"&&(site=tab_unblocker.site_conf)&&(redir=zutil.get(site,"trial.trial_redirect"))&&(force_redir=zutil.get(site,"trial.trial_force_redirect"))){const now=Date.now();if(tab_unblocker.prev_url==redir&&url!=force_redir&&now-tab_unblocker.prev_url_ts<=5*date.ms.SEC){tab_unblocker.prev_url=tab_unblocker.prev_url_ts=null;unblocker_lib.on_before(url,details.requestId,details.tabId,{force_redir});return void(details.ret.redirectUrl=force_redir)}tab_unblocker.prev_url=url;tab_unblocker.prev_url_ts=now}}if(!is_vpn_allowed(url,is_main,details))return;let rule=tab_unblocker&&tab_unblocker.rule;if(!tab_unblocker&&details.tabId==-1&&details.frameId==-1){let tab_id=be_tabs.get("active.id");tab_unblocker=E.get_tab_unblocker(tab_id);if(rule_info||(rule_info=get_rule_info_from_url(url)))rule=rule_info.rule;else if(tab_unblocker)rule=tab_unblocker.rule}if(!rule)return;if(!be_ext.get("is_premium")&&((tab_unblocker||{}).force_premium||!be_util.full_browser_mode()&&rule_info&&be_vpn_util.is_all_browser(rule_info.rule))){unblocker_lib.on_before(url,details.requestId,details.tabId,{err:(tab_unblocker||{}).force_premium?"force_premium":"all_browser"});return}if(!be_ext.get("agent_key")&&!storage.get("agent_key")){unblocker_lib.on_before(url,details.requestId,details.tabId,{err:"agent_key"});be_util.perr("be_no_agent_key2",{details,rule:be_vpn_util.get_rule_min_fmt(rule)},{err:true,rate_limit:{count:2}});return}let r;if((r=rule)&&get_bg_main().set_rule_use)get_bg_main().set_rule_use(r);return this._on_first_request(details,{rule,no_rule:!rule,tab_unblocker})}_on_headers_received(details){let req;const res=bg_util.nodify_res(details),req_id=details.requestId;if(!(req=E.requests[req_id]))return;unblocker_lib.on_completed(req_id,details.tabId,{status:details.statusLine,hdrs:res.headers});const tu=E.get_tab_unblocker(details.tabId);const hola_warn=res.headers["x-hola-warning"];const proxy_auth_required=is_hola_agent_auth(res);const int_req=req.opt.int_req,url=req.url;if(int_req&&req.opt.ignore_redir&&!int_req.res&&!proxy_auth_required){int_req.res=res;req.cancel=true}if(hola_warn&&tu&&!tu.rule.changing_proxy)E.be_rule.change_proxy(details,hola_warn,req.route_opt);const resp=get_strategy_resp(res);if(req.proxy_req){if(proxy_auth_required){if(/Auth Failed suspicious/.test(res.reasonPhrase)){get_bg_main().suspend_client(/permanent/.test(res.reasonPhrase))}else if(req.opt.rule&&!bext_config.disable_407_reauth)E.reauth_rule_agents(req.opt.rule,3*date.ms.MIN);return void be_util.perr("req_header_proxy_auth",{url,proxy_req:req.proxy_req},{err:true,rate_limit:{count:5}})}req.proxy_resp=resp;if(!req.direct_resp)req.direct_resp={slow:true}}else if(req.direct_req)req.direct_resp=resp;const cmd=req.strategy(req.direct_resp,req.proxy_resp)||{};if(cmd.proxy){if(cmd.proxy.serve){if(req.direct_req)req.direct_req.abort();let location=res.headers.location;if(is_redir_status(res.statusCode)&&location&&/^https?:\/\//.test(location)){if(!zurl.is_valid_url(location)){be_util.perr("req_invalid_redirect",{url,redirect:location,status:res.statusCode},{rate_limit:{count:3}})}if(!is_firefox&&!bext_config.disable_redir_fix&&tu){const country=zutil.get(cmd,"proxy.country",tu.country);location+=location.endsWith("/")?"":"/";if(url!=location){this._gen_proxy_req(req,details,cmd,{country,location})}}}return void(req.serving="proxy")}if(cmd.direct&&cmd.direct.serve){req.serving="direct";if(!req.proxy_req||is_redir_status(res.statusCode,true))return;routing_reqs_set(details,req);return void(details.ret.redirectUrl=url)}if(cmd.proxy.start&&!int_req){req.direct_req=false;routing_reqs_set(details,req);return void(details.ret.redirectUrl=url)}}else if(cmd.direct){if(cmd.direct.serve)return void(req.serving="direct");routing_reqs_set(details,req);return void(details.ret.redirectUrl=url)}if(req.proxy_resp){if(req.direct_req&&!req.direct_resp){req.direct_timeout=be_vpn_util.set_timeout((()=>req.direct_req.abort()),5e3,{sp:E.sp,name:"direct_timeout"})}return void(req.serving="proxy")}}_unsafe_tab_unblocker_end_cb(details){const reqid=details.requestId;const req=E.requests[reqid];const error=get_req_error(req,details);if(req){delete E.requests[reqid];const agent_req=E.agent_requests[req.url];if(agent_req&&agent_req.id==req.id)delete E.agent_requests[req.url];let resp;if(error)resp={code:0,error};else{if(details.responseHeaders)resp=get_strategy_resp(bg_util.nodify_res(details))}if(resp&&!req.serving){if(req.proxy_req)req.proxy_resp=resp;else if(req.direct_req)req.direct_resp=resp}req.strategy(req.direct_resp,req.proxy_resp);const int_req=E.internal_reqs[req.url];if(int_req){if(error){int_req.error=error;if(!int_req.res)int_req.res={code:0,error}}else if(!int_req.res)int_req.res=bg_util.nodify_res(details)}}let tabid=details.tabId,tab_unblocker=E.get_tab_unblocker(tabid);const is_main=is_main_frame(details);if(tab_unblocker){tab_unblocker.last_req_ts=Date.now();if(req){if(req.proxy_resp&&is_main&&req.proxy_resp.code==200&&!req.proxy_resp.error){inc_not_working("req_main_n",tab_unblocker)}if(req.proxy_req&&!error){tab_unblocker.req_stats.succ_n=(tab_unblocker.req_stats.succ_n||0)+1}if(tab_unblocker.tab_reload_ts&&tab_unblocker.rule&&is_main&&error&&error!="net::ERR_ABORTED"){be_util.perr("tab_reload_failed",{dur:Date.now()-tab_unblocker.tab_reload_ts,rule:tab_unblocker.rule.name,info:"end_cb",country:tab_unblocker.country,error},{rate_limit:{count:5}});tab_unblocker.tab_reload_ts=undefined}}}let verify;if(req&&(verify=get_site_verify_conf(req,req.opt.rule))&&req.proxy_resp.code==200&&!req.proxy_resp.error){bw_perr_acc.push(verify,req);inc_not_working("bw_media_n",tab_unblocker)}const is_proxy_req=tab_unblocker&&req&&req.opt.rule&&svc_vpn_util.gen_route_str(req.route_opt)!="direct";if(!is_proxy_req||!error){if(is_proxy_req&&tab_unblocker&&is_main)set_tab_load_err(tabid,null);return}const info={url:req.url,type:details.type,method:req.method,error,agent:req.agent,rule:be_vpn_util.get_rule_min_fmt(req.opt.rule)};tab_unblocker.err_logs.push({ts:Date.now(),method:req.method,error,agent:zutil.get(req.agent,"host"),url:req.url.slice(0,100)});if(tab_unblocker.err_logs.length>err_logs_len)tab_unblocker.err_logs.shift();tab_unblocker.req_err_total_n=(tab_unblocker.req_err_total_n||0)+1;tab_unblocker.req_stats.err_n=(tab_unblocker.req_stats.err_n||0)+1;if(!is_err_handled(error,is_main)){if(request_errors_known[error])return;let reported;if(!(reported=load_errors[tabid]))reported=load_errors[tabid]={};if(reported[error])return;reported[error]=true;return void be_util.perr("req_err_unhandled",info,{err:error,rate_limit:{count:5}})}fix_req_err(tab_unblocker,req.agent,details.error?details:assign({},details,{error}),req.route_opt)}add_web_worker_hooks(){if(this.web_worker_hooks)return;let hook_wrapper=(d,cb)=>{if(d.tabId!=-1||!d.initiator)return;let rule=E.get_enabled_rule(d.initiator);if(!rule)return;for(let tab_id in E.tab_unblockers){let tab_rule=E.tab_unblockers[tab_id].rule;if(!tab_rule||tab_rule.id!=rule.id)continue;if(CG("debug.web_worker_requests_detector")){alert(`Detected web worker request. Rule: ${rule.name}, `+`url: ${d.url}, initiator: ${d.initiator}`)}return cb(assign({},d,{tabId:tab_id}))}};this.web_worker_hooks=this.add_hooks(-1,hook_wrapper)}rm_web_worker_hooks(){if(!this.web_worker_hooks)return;this.web_worker_hooks.clear();this.web_worker_hooks=null}update_web_worker_hooks(){let need_hook=CG("debug.web_worker_requests_detector");for(let id in E.tab_unblockers){let tab=E.tab_unblockers[id];if(tab.rule&&be_util.get_site_conf(tab.rule.name,"web_worker_proxy")){need_hook=true;break}}if(need_hook)this.add_web_worker_hooks();else this.rm_web_worker_hooks()}}const is_err_handled=(err,is_main)=>!CG("main_frame_errors_only")&&!is_main&&request_errors[err]||is_main&&(request_errors[err]||main_frame_errors[err]);const get_req_error=(req,details)=>{if(details.error||!is_main_frame(details))return details.error;if(!req||!req.url||!req.url.startsWith("http:"))return;const s=details.statusLine||"";if(details.statusCode==502&&s.includes("DNS Failed"))return"ERR_DNS_FAILED";if(details.statusCode==407&&s.includes("Proxy Authentication"))return"ERR_AUTH_REQUIRED"};class Ff_handler extends Base_handler{constructor(){super();this.on_proxy_request=this.wrap("on_proxy_request",(d=>{this.tab_unblocker_cb(d=assign({},d,{handler:this._on_first_request.bind(this),cbname:"on_proxy_request",ret:{}}));this._clean_req_to_ret();this.req_to_ret[d.requestId]={ret:d.ret,ts:Date.now()};return d.hola_proxy||{type:"direct"}}),true);this.on_before_request=this.wrap("on_before_request",(d=>{const data=this.req_to_ret[d.requestId];delete this.req_to_ret[d.requestId];return zutil.get(data,"ret",{})}),true)}_clean_req_to_ret(){const clean={},now=Date.now();for(let id in this.req_to_ret){const data=this.req_to_ret[id];if(now-data.ts<5*date.ms.MIN)clean[id]=data}this.req_to_ret=clean}_gen_proxy_req(req,details,cmd,opt){opt=opt||{};const prot=opt.prot||"https";req.route_opt={prot,country:opt.country};if(cmd.proxy.pool)req.route_opt.pool=cmd.proxy.pool;const proxy=get_proxy_agent(req,cmd.proxy);if(!proxy){req.proxy_resp={code:0,error:"failed set proxy"};return}req.proxy_req=proxy;let host,is_http;if(E.be_bg_ajax&&E.be_bg_ajax.need_agent_domain_fallback())host=E.be_bg_ajax.get_agent_fallback_host(host);else if(E.be_bg_ajax&&req.route_opt.prot=="https"&&(E.be_bg_ajax.is_agent_fallback()||(is_http=E.be_bg_ajax.is_http_fallback()))){req.route_opt.prot="proxy";if(!is_http)host=proxy.ip}details.hola_proxy={type:req.route_opt.prot,host:host||proxy.host||proxy.ip,port:proxy.port}}init(){if(!super.init())return;this.req_to_ret={};this.base_hooks=new Request_hooks;try{this.base_hooks.add("onRequest",this.on_proxy_request,this.listener_opt);this.base_hooks.add("onBeforeRequest",this.on_before_request,this.listener_opt,this.listener_extra_opt)}catch(e){on_hooks_err("be_add_hooks_err",e)}}uninit(){if(!super.uninit())return;try{this.base_hooks.clear()}catch(e){on_hooks_err("be_rm_hooks_err",e)}}}class Chrome_handler extends Base_handler{constructor(){super();let on_before_request=d=>{d=d||{};this.tab_unblocker_cb(assign(d,{cbname:"on_before_request",handler:this._on_first_request.bind(this),ret:{}}));return d.ret};this.on_before_request=this.wrap("on_before_request",on_before_request,true);this.on_before_request_tab=this.wrap("on_before_request_tab",(d=>{if(!is_main_frame(d))return on_before_request(d)}),true)}_gen_proxy_req(req,details,cmd,opt){opt=opt||{};if(req.redirected){req.redirected=false;return void(req.proxy_req=true)}const req_opt=req.opt||{};const prot=(req_opt.prot||"https").toUpperCase();req.route_opt={prot,country:opt.country};if(cmd.proxy.pool)req.route_opt.pool=cmd.proxy.pool;const src=cmd.src||req_opt.rule&&"geo_rule";const _url=opt.location||details.url;let proxy;if(!req_opt.agent&&!is_vpn_allowed(_url,is_main_frame(details),details)||!(proxy=get_proxy_agent(req,cmd.proxy))||_url.includes("client_cgi/fetch_info")){E._set_proxy_for_url(_url,"DIRECT",{tab_id:details.tabId,src});req.proxy_resp={code:0,error:"failed set proxy"};return}req.proxy_req=proxy;let host=proxy.host||proxy.ip;if(!req_opt.is_proxy_set){let is_http;if(E.be_bg_ajax&&E.be_bg_ajax.need_agent_domain_fallback())host=E.be_bg_ajax.get_agent_fallback_host(host);else if(E.be_bg_ajax&&req.route_opt.prot=="HTTPS"&&(E.be_bg_ajax.is_agent_fallback()||(is_http=E.be_bg_ajax.is_http_fallback()))){req.route_opt.prot="PROXY";if(!is_http)host=proxy.ip}req.proxy_str=req.route_opt.prot+" "+host+":"+proxy.port;E._set_proxy_for_url(_url,req.proxy_str,{src,tab_id:details.tabId});if((!bext_config.disable_redir_fix&&is_main_frame(details)||req_opt.fix_307)&&/^http:/.test(details.url)){E._set_proxy_for_url(details.url.replace("http:","https:"),req.proxy_str,{src,tab_id:details.tabId})}}details.hola_proxy={type:zutil.get(req,"route_opt.prot"),host,port:proxy.port}}add_hooks(tabid,hook_wrapper){let hooks=super.add_hooks(tabid,hook_wrapper);try{let extra_opt=this.listener_extra_opt.slice();if(is_extra_headers_supported())extra_opt.push("extraHeaders");if(tabid=="main_frame"){hooks.add("onBeforeRequest",this.on_before_request,assign({types:["main_frame"]},this.listener_opt),extra_opt);return hooks}tabid=+tabid;let filter=tabid>=0?{tabId:tabid}:{};hooks.add("onBeforeRequest",this.on_before_request_tab,assign(filter,this.listener_opt),extra_opt);return hooks}catch(e){on_hooks_err("be_add_hooks_err",e)}}}class Request_hooks{constructor(ctx,hook_wrapper){this._hooks=[];this.intervals=[];this._ctx=ctx;this._hook_wrapper=hook_wrapper}_get_handler(cb_name){return cb_name=="onRequest"?self.browser.proxy.onRequest:chrome.webRequest[cb_name]}_t_find_cb(cb_name){return this._hooks.filter((([name])=>cb_name==name)).map((h=>h[1]))}add(cb_name,cb,filter,opt){if(this._ctx)cb=cb.bind(this._ctx);let _cb=this._hook_wrapper?d=>this._hook_wrapper(d,cb):cb;this._hooks.push([cb_name,_cb]);if(opt===undefined)this._get_handler(cb_name).addListener(_cb,filter);else this._get_handler(cb_name).addListener(_cb,filter,opt)}add_interval(cb,t,opt){this.intervals.push(be_vpn_util.set_interval(cb,t,opt))}clear(){for(let[cb_name,cb]of this._hooks){let handler=this._get_handler(cb_name);handler.removeListener(cb)}for(let interval of this.intervals)be_vpn_util.clear_interval(interval)}}const regex_url2host=/^(?:https?|wss?):\/\/([^/]+)/;const url2host=url=>{let n=url.match(regex_url2host);return n?n[1]:url};class Host_tracker{constructor(){this.host_trackers=new Map;this.clear=this.clear.bind(this);be_ext.on("pac_init",this.clear);be_ext.on("pac_reload",this.clear)}handle_set_proxy_for_host(host,proxy_str,opt){let _this=this;return etask((function*_handle_set_proxy_for_host(){let ht=_this.host_trackers.get(host);if(!ht){if(proxy_str=="DIRECT")return;let listener=_this._get_host_tracker_listener(host);ht={listener,last_proxy_str:proxy_str,last_opt:opt,last_proxy_str_per_tab:{}};_this.host_trackers.set(host,ht);const tab_unblocker=E.get_tab_unblocker(opt.tab_id);const rule=tab_unblocker&&tab_unblocker.rule;if(rule)add_proxied_host(rule.name,host,opt.tab_id);try{chrome.webRequest.onBeforeSendHeaders.addListener(listener,{urls:[`*://${host}/*`]},["blocking"])}catch(e){on_hooks_err("be_add_ht_listener_err",e);_this.host_trackers.delete(host)}}ht.last_proxy_str=proxy_str;if(opt&&opt.tab_id)ht.last_proxy_str_per_tab[opt.tab_id]=proxy_str;ht.last_opt=opt;yield _this._update_pac_proxy(ht,host,proxy_str)}))}_get_host_tracker_listener(host){return details=>{let tab_unblocker=E.get_tab_unblocker(details.tabId);let rule=tab_unblocker&&tab_unblocker.rule;if(!tab_unblocker&&details.tabId==-1&&details.frameId==-1){let tab_id=be_tabs.get("active.id");tab_unblocker=E.get_tab_unblocker(tab_id);let rule_info=get_rule_info_from_url(details.url);if(rule_info)rule=rule_info.rule;else if(tab_unblocker)rule=tab_unblocker.rule}let ht=this.host_trackers.get(host);let expected_proxy;if(rule&&rule.enabled&&!is_direct_on_tab_laod_err(details.tabId)||E.internal_reqs[details.url]){expected_proxy=ht.last_proxy_str_per_tab[details.tabId]||ht.last_proxy_str}if(ht.deadline_ts&&ht.deadline_ts<Date.now())ht.pac_proxy_str=null;this._update_pac_proxy(ht,host,expected_proxy)}}rm_host_tracker_listener(host){let ht=this.host_trackers.get(host);try{if(ht.timeout)ht.timeout=void clearTimeout(ht.timeout);chrome.webRequest.onBeforeSendHeaders.removeListener(ht.listener)}catch(e){on_hooks_err("be_rm_ht_listener_err",e)}this.host_trackers.delete(host)}_update_pac_proxy(ht,host,proxy_str){if(ht.pac_proxy_str==proxy_str){if(!ht.deadline_ts||Date.now()+5*date.ms.SEC<ht.deadline_ts)return}let _this=this;return etask((function*_update_pac_proxy(){ht.pac_proxy_str=proxy_str;ht.deadline_ts=null;if(!proxy_str)return yield be_pac.unset_proxy_for_host(host,ht.last_opt);if(ht.timeout)clearTimeout(ht.timeout);let timeout_ms=bext_config.pac_rule_lifetime_ms||60*date.ms.SEC;ht.deadline_ts=Date.now()+timeout_ms;ht.timeout=setTimeout((()=>_this.rm_host_tracker_listener(host)),timeout_ms);yield be_pac.set_proxy_for_host(host,proxy_str,ht.deadline_ts,ht.last_opt)}))}clear(){for(let[host,ht]of this.host_trackers)ht.pac_proxy_str=null}uninit(){be_ext.off("pac_init",this.clear);be_ext.off("pac_reload",this.clear);for(let[host,ht]of this.host_trackers)this.rm_host_tracker_listener(host)}}E._set_proxy_for_url=(url,proxy_str,opt)=>etask((function*_set_proxy_for_url(){if(!url)return;let host=url2host(url);if(!host_tracker)host_tracker=new Host_tracker;yield host_tracker.handle_set_proxy_for_host(host,proxy_str,opt)}));E.get_tab_load_err=tab_id=>(E.get("tab_load_err")||{})[tab_id];function get_strategy_resp(res){let resp;if(res.headers["x-hola-response"]){resp={hdrs_only:true,code:res.headers["x-hola-status-code"],len:res.headers["x-hola-content-length"],te:res.headers["x-hola-transfer-encoding"],lmod:res.headers["x-hola-last-modified"],etag:res.headers["x-hola-etag"],type:res.headers["x-hola-content-type"],error:res.headers["x-hola-error"]}}else{resp={code:res.statusCode,len:res.headers["content-length"],te:res.headers["transfer-encoding"],lmod:res.headers["last-modified"],etag:res.headers.etag,type:res.headers["content-type"],error:res.headers["x-hola-error"]}}resp.policy=res.headers["x-hola-policy"];return resp}function is_vpn_allowed(_url,is_main,details){let protocol,hostname,url=zurl.parse(_url);if(!(protocol=url.protocol)||!(hostname=url.hostname)){if(protocol!="file:")be_util.perr("url_parsing_failed",{url});return false}if(_url.match(/^(chrome|opera|firefox|edge|about)(-extension)?:/))return false;if(hostname.startsWith("__hola__."))return false;if(is_all_browser_rule_active()||is_debug_peer_rule_active()){return!bg_util.is_private_network(hostname,browser.isInNet)&&!unblocker_lib.is_agent(hostname)&&!/zagent\d+\.hola\.org/.test(hostname)&&(is_debug_peer_rule_active()||!zurl.is_hola_domain(hostname))}if(unblocker_lib.is_agent(hostname))return false;return bg_util.is_vpn_allowed(_url,is_main,browser.isInNet)}function get_proxy_agent(req,proxy){const opt=req.opt||{},rule=opt.rule;const route_opt=req.route_opt;if(!rule&&!opt.agent){be_util.perr("be_debug_no_rule",{route_opt,url:req.url},{err:true,rate_limit:{count:1}});return}const route=svc_vpn_util.gen_route_str(route_opt,{no_algo:true});let agent=opt.agent||unblocker_lib.get_chosen_agent(route_opt,rule);if(!agent){zerr.debug("tab:%d no agents for %s route, rule: %s",req.tab_id,route,zutil.get(rule,"name","unknown"));be_util.perr("be_debug_no_agents",{route_opt,agents:unblocker_lib.get_active_agents(rule),rule:be_vpn_util.get_rule_min_fmt(rule)},{err:true,rate_limit:{count:2}});return}req.agent=agent;let tab;if((tab=opt.tab_unblocker)&&tab.agents){if(agent.is_fallback&&(!tab.agents[agent.host]||Date.now()-tab.agents[agent.host]>5*date.ms.MIN)){be_util.perr("be_fallback_agent",{route_opt,agent,rule:be_vpn_util.get_rule_min_fmt(rule)},{err:true,rate_limit:{count:2}})}tab.agents[agent.host]=Date.now()}let port,plist;const trial=rule&&is_trial(rule.name);if(rule&&(plist=agent.port_list)){if(be_vpn_util.is_debug_peer(rule))port=agent.port==plist.direct?25333:+agent.port+1e3;else if(agent.is_fallback&&agent.port==25500){let country=route_opt.country.toLowerCase();port=+agent.port+(pcountries.ports[country]||{}).port||0}else{let key=[];if(agent.port==plist.direct){if(trial)key.push("trial");if(proxy.peer)key.push("peer")}port=plist[key.join("_")]||agent.port}}port=port||agent.port;if(agent.vendor!="force_agent"&&route_opt.pool&&!agent.pool){be_util.perr("be_wrong_agent",{agent,route_opt,rule:be_vpn_util.get_rule_min_fmt(rule),trial},{rate_limit:{count:1}})}return{ip:agent.ip,port,host:agent.host}}function get_rule_info_from_url(url){let rule_info,r,res=null;if(E.url_to_rule_infos.all_browser)return E.url_to_rule_infos.all_browser;if(!url)return E.url_to_rule_infos.debug_peer||null;for(r in E.url_to_rule_infos){rule_info=E.url_to_rule_infos[r];if(rule_info.url_re&&rule_info.url_re.test(url)){res=rule_info;break}}if(!is_debug_peer_rule_active())return res;return is_debug_peer_proxy_traffic()&&res||is_debug_peer_def_traffic()&&!res?E.url_to_rule_infos.debug_peer:res}const is_all_browser_rule_active=()=>!!E.url_to_rule_infos.all_browser;const is_debug_peer_rule_active=()=>!!E.url_to_rule_infos.debug_peer;const is_debug_peer_def_traffic=()=>is_debug_peer_rule_active()&&E.url_to_rule_infos.debug_peer.rule.def_traffic;const is_debug_peer_proxy_traffic=()=>is_debug_peer_rule_active()&&E.url_to_rule_infos.debug_peer.rule.proxy_traffic;const get_debug_peer=e=>is_debug_peer_rule_active()&&E.url_to_rule_infos.debug_peer.rule[e];E.get_tab_unblocker=tabid=>{if(E.tab_unblockers.debug_peer&&+tabid&&(is_debug_peer_def_traffic()&&!E.tab_unblockers[tabid]||is_debug_peer_proxy_traffic()&&E.tab_unblockers[tabid])){return E.tab_unblockers.debug_peer}if(E.tab_unblockers.all_browser)return E.tab_unblockers.all_browser;return tabid&&E.tab_unblockers[tabid]};const set_tab_load_err=(tab_id,err)=>{let tab_load_err=assign({},E.get("tab_load_err"));const is_all_browser=tab_id=="all_browser";if(err&&tab_load_err[tab_id]||!err&&!tab_load_err[tab_id]&&!is_all_browser){return}if(err)tab_load_err[tab_id]={err};else{be_util.perr("tab_load_direct_on_err",is_all_browser?tab_load_err:tab_load_err[tab_id],{rate_limit:{count:1}});if(is_all_browser)tab_load_err={};else delete tab_load_err[tab_id]}E.set("tab_load_err",tab_load_err)};function tab_unblocker_del(tabid,refresh,reason){const tab_unblocker=E.tab_unblockers[tabid];zerr.notice("tab:%d tab_unblocker_del: %s",+tabid,zutil.get(tab_unblocker,"country","not_found"));if(!tab_unblocker)return;if(tab_unblocker.not_working)E.send_not_working(tab_unblocker,"unblocker_del");if(tab_unblocker.tab_reload_ts&&tab_unblocker.rule){be_util.perr("tab_reload_unblock_stop",{dur:Date.now()-tab_unblocker.tab_reload_ts,reason,rule:tab_unblocker.rule.name,country:tab_unblocker.country},{rate_limit:{count:5}});tab_unblocker.tab_reload_ts=undefined}const is_all_browser=tabid=="all_browser"||tabid=="debug_peer";set_tab_load_err(tabid,null);if(requests_handler&&tab_unblocker.hooks)requests_handler.remove_hooks(tab_unblocker.hooks);const rule_info=E.url_to_rule_infos[tab_unblocker.root_url];delete E.tab_unblockers[tabid];delete pages[tabid];unblocker_lib.del_ctx(tabid);if(is_all_browser)requests_handler.update_hooks();if(!rule_info){be_util.perr("be_rule_info_missing",{tabid,tab_unblocker,rule_infos:E.url_to_rule_infos})}else delete rule_info.tabs[tabid];requests_handler.update_web_worker_hooks();if(refresh&&is_all_browser)tabid=be_tabs.get("active.id");if(!refresh||be_tabs.get("active.id")!=tabid)return;try{chrome.tabs.get(bg_util.tabid2api(tabid),(tab=>{if(tab&&!be_vpn_util.is_browser_internal_url(tab.url))be_tabs.update(tab.id,{url:tab.url})}))}catch(e){on_hooks_err("be_tab_unblocker_del_err",e)}}E.tab_reload=(tabid,tab_url)=>etask((function*tab_reload(){yield be_tabs.update(tabid,{url:tab_url});try{chrome.tabs.get(tabid,(tab=>{if(!tab||tab.status!="complete")return;be_tabs.reload(tabid)}))}catch(e){on_hooks_err("be_tab_reload_err",e)}}));const get_force_premium_rule=tab_url=>be_premium.get_force_premium_rule(svc_vpn_util.get_root_url(tab_url),{tab_url});const monitor_proxy_req_slow=()=>{if(monitor_proxy_req_slow.et)return;monitor_proxy_req_slow.et=etask({cancel:true,async:true},(function*_monitor_req_slow_proxy(){this.finally((()=>{monitor_proxy_req_slow.et=undefined;proxy_req_slow={agents:{}}}));yield etask.sleep(date.ms.HOUR);for(let root in proxy_req_slow){if(proxy_req_slow[root]["20"]||proxy_req_slow[root]["60"])return void be_util.perr("proxy_req_slow",proxy_req_slow)}}))};const monitor_page_load=()=>{if(monitor_page_load.et)return;monitor_page_load.et=etask({cancel:true,async:true},(function*_monitor_page_load(){this.finally((()=>monitor_page_load.et=undefined));for(;;){if(!Object.keys(pages).length)return;let now=Date.now(),slow={};for(let id in pages){if(now-pages[id].start_ts<10*date.ms.SEC)continue;slow[id]=[]}if(Object.keys(slow).length){for(let reqid in E.requests){const req=E.requests[reqid];if(!req||!slow[req.tab_id]||!req.agent||now-req.start_ts<6*date.ms.SEC){continue}slow[req.tab_id].push(req)}for(let id in slow){let tu;if(slow[id].length<3||!(tu=E.get_tab_unblocker(id)))continue;const req=slow[id][0];const d={url:req.url,type:req.type,tabId:+id,error:"slow"};if(track_autoreload(tu,req.agent,d)){delete pages[id];be_util.perr("page_load_slow",d,{rate_limit:{count:5}});yield ext_on_err(tu.rule,req.agent,d,req.route_opt,true)}}}yield etask.sleep(date.ms.SEC)}}))};const tab_unblocker_add=cb_wrapper(((tabid,rule_info,tab_url,opt)=>{if(!rule_info||rule_info.tabs[tabid])return;opt=opt||{};const is_all_browser=be_vpn_util.is_all_browser(rule_info.rule)||be_vpn_util.is_debug_peer(rule_info.rule);const id=is_all_browser?rule_info.rule.name:tabid;let tab_unblocker=E.tab_unblockers[id];const root_url=svc_vpn_util.get_root_url(tab_url);if(tab_unblocker&&tab_unblocker.rule)return;tab_unblocker={country:rule_info.rule.country,rule:rule_info.rule,root_url:rule_info.root_url,log:tab_unblocker?tab_unblocker.log:[],force_premium:get_force_premium_rule(tab_url),err_logs:[],agents:{},track:{counter:0,domains:{}},site_conf:be_util.get_site_conf(root_url||rule_info.rule.name)||{},req_stats:{}};E.tab_unblockers[id]=tab_unblocker;zerr.notice("tab:%d tab_unblocker_add: %s %s",tabid,rule_info.rule.name,tab_unblocker.country);if(requests_handler){if(is_all_browser)requests_handler.update_hooks(id);tab_unblocker.hooks=requests_handler.add_hooks(id)}rule_info.tabs[tabid]=true;unblocker_lib.add_ctx(tabid,tab_unblocker.rule,{src:tab_url});requests_handler.update_web_worker_hooks();if(opt.reload&&(be_tabs.get("active.id")==tabid||is_all_browser)){if(opt.fix_url)tab_url=bg_util.get_root_link(rule_info.rule,tab_url)||tab_url;if(be_trial.get_trial_active(root_url)){let site_conf=be_util.get_site_conf(root_url);tab_url=zutil.get(site_conf,"trial.trial_redirect",tab_url)}let sug_url=bg_util.get_site_storage(root_url,"suggestion_redirect_url");if(sug_url){bg_util.set_site_storage(root_url,"suggestion_redirect_url",null);tab_url=sug_url}if(is_all_browser){tab_url=be_tabs.get("active.url");tabid=be_tabs.get("active.id")}if(tab_url&&!be_vpn_util.is_browser_internal_url(tab_url)){zerr.notice("tab:%d reloading tab",tabid);tab_unblocker.tab_reload_ts=Date.now();be_util.perr("tab_reload_start",{rule:rule_info.rule.name,country:tab_unblocker.country},{rate_limit:{count:5}});return E.tab_reload(tabid,tab_url)}}E.set("activity",Date.now());return tab_unblocker}));const on_tab_created=cb_wrapper((o=>{const tab=o.tab;if(!tab.url)return;const rule_info=get_rule_info_from_url(tab.url);tab_unblocker_add(tab.id,rule_info,be_tabs.get_loading_tab_url(tab.id)||tab.url)}));const on_tab_updated=cb_wrapper((o=>{o=o||{};let id=o.id,info=o.info;if(!info)return;let tab_unblocker=E.tab_unblockers[id];if(info.url){const rule_info=get_rule_info_from_url(info.url);if(!tab_unblocker||!rule_info||tab_unblocker.root_url!=rule_info.root_url){if(tab_unblocker)tab_unblocker_del(id,undefined,"rule_replaced");tab_unblocker=tab_unblocker_add(id,rule_info,be_tabs.get_loading_tab_url(id)||info.url)}}if(!tab_unblocker||!info.status)return;switch(info.status){case"complete":delete pages[id];if(tab_unblocker.resolve_cap&&tab_unblocker.site_conf){be_util.perr("be_resolve_cap",{root_url:tab_unblocker.root_url});tab_unblocker.resolve_cap=undefined}break;case"loading":if(!CG("disable_slow_load_monitor")){pages[id]={start_ts:Date.now()};monitor_page_load()}break}}));const on_tab_removed=cb_wrapper((o=>{if(o){send_proxied_hosts({tab_id:o.tab_id});tab_unblocker_del(o.id,undefined,"tab_removed")}}));const on_tab_replaced=cb_wrapper((o=>{if(!o)return;let added=o.added,removed=o.removed;tab_unblocker_del(removed,undefined,"tab_replaced");try{chrome.tabs.get(added,(tab=>{if(!tab||!tab.url)return;const rule_info=get_rule_info_from_url(tab.url);tab_unblocker_add(added,rule_info,be_tabs.get_loading_tab_url(added)||tab.url)}))}catch(e){on_hooks_err("be_on_tab_replaced_err",e)}}));function unset_rule_for_url(root_url,refresh){let rule_info=E.url_to_rule_infos[root_url];if(!rule_info)return;for(let tab in rule_info.tabs)tab_unblocker_del(tab,refresh,"rule_disabled");if(root_url=="all_browser"||root_url=="debug_peer")tab_unblocker_del(root_url,refresh,"rule_disabled");delete E.url_to_rule_infos[root_url]}function set_rule_for_url(root_url,rule,opt){let rule_info=E.url_to_rule_infos[root_url];if(rule_info)unset_rule_for_url(root_url,0);rule_info=E.url_to_rule_infos[root_url]={rule,root_url,tabs:{},url_re:new RegExp(root_url)};if(be_vpn_util.is_debug_peer(rule)){return void tab_unblocker_add("debug_peer",rule_info,"debug_peer",opt)}const is_all_browser=be_vpn_util.is_all_browser(rule);const url=is_all_browser?`*://*/*`:`*://*.${rule.name}/*`;try{chrome.tabs.query({url},cb_wrapper((tabs=>{if(!tabs)return;for(let tab of tabs){tab_unblocker_add(tab.id,rule_info,be_tabs.get_loading_tab_url(tab.id)||tab.url,opt)}})))}catch(e){on_hooks_err("be_set_rule_for_url_err",e)}}function update_rules(url_to_rule_infos,opt){opt=opt||{};let url,rule;for(url in E.url_to_rule_infos){rule=url_to_rule_infos[url];if(!rule)unset_rule_for_url(url,1);else if(rule.id!=E.url_to_rule_infos[url].rule.id)set_rule_for_url(url,rule,opt)}for(url in url_to_rule_infos){rule=url_to_rule_infos[url];if(!E.url_to_rule_infos[url])set_rule_for_url(url,rule,assign({},opt,{fix_url:1}))}}E.get_rule_route=rule=>{const country=rule.country,proxy_country=country.toUpperCase();return unblocker_lib.get_rule_strategy({},null,{root_url:rule.name,premium:is_force_proxy({rule}),country:proxy_country,proxy_country,src_country:be_info.get("country"),is_trial:is_trial(rule.name)})};E.update_rule_urls=(rules,opt)=>etask((function*update_rule_urls(){if(!E.inited)return;opt=opt||{};be_ext.set("has_active_rules",rules&&_.some(rules.unblocker_rules,(rule=>rule.enabled)));E.rules=rules;if(!be_ext.is_disabled())requests_handler.init();yield be_pac.update_pac_file_state();let url_to_rule_infos={};if(!rules)return update_rules(url_to_rule_infos);const r=_.omit(E.rules,"unblocker_globals");if((E.rules||{}).unblocker_globals)r.unblocker_globals=assign({},E.rules.unblocker_globals);unblocker_lib.unblocker_json_set(r,{by_rules:1,ext:1});let ag_rules=[],agents={};for(let r in rules.unblocker_rules){let rule=rules.unblocker_rules[r];if(!rule.enabled)continue;if(be_vpn_util.is_all_browser(rule)||be_vpn_util.is_debug_peer(rule)){url_to_rule_infos[rule.name]=rule}else{for(let i=0;i<rule.root_url.length;i++)url_to_rule_infos[rule.root_url[i]]=rule}if(!opt.resolve||opt.rule&&opt.rule.name!=rule.name)continue;const pool=E.get_rule_route(rule).pool;[{peer:false,pool},{peer:false}].forEach((b=>{b=assign({country:rule.country,link:rule.link,name:rule.name},b);let s=svc_vpn_util.gen_route_str(b);if(!agents[s]){ag_rules.push(b);agents[s]=true}}))}this.finally((()=>update_rules(url_to_rule_infos,opt)));if(ag_rules.length)yield unblocker_lib.resolve_agents(ag_rules)}));E.ajax_via_proxy=(url,_opt,state)=>etask((function*ajax_via_proxy(){if(be_ext.is_disabled()&&(!E.be_bg_ajax||!E.be_bg_ajax.is_active()))return;if(!E.ajax_via_proxy_inited)E.init_ajax_via_proxy();this.finally((()=>{delete E.internal_reqs[opt.url];if(xhr){xhr.abort();xhr.onerror=null;xhr.onreadystatechange=null;delete E.internal_reqs[xhr.hola_url]}if(!{bg_ajax:1,proxy_auth:1}[_opt.src])E.trigger("internal_reqs_update")}));_opt=_opt||{};state=state||{};let opt=typeof url=="object"?url:{type:"POST",url};let xhr,complete,xhr_resp;const get_result=()=>{let req=E.internal_reqs[opt.url]||{};complete=true;delete E.internal_reqs[xhr.hola_url];if(!req.res){if(xhr_resp)req.res=xhr_resp;else{const headers_s=xhr.getAllResponseHeaders();req.res=xhr_resp={statusCode:xhr.status,reasonPhrase:xhr.statusText,responseURL:xhr.responseURL,headers:attrib.to_obj_lower(attrib.from_str(headers_s,{allow_invalid:true}))}}}else if(!xhr_resp)xhr_resp=req.res;if(_opt.force_headers&&(!req.res.headers||!Object.keys(req.res.headers).length)){req.res.headers=xhr_resp?xhr_resp.headers:attrib.to_obj_lower(attrib.from_str(xhr.getAllResponseHeaders(),{allow_invalid:true}));if(req.res.statusCode==407&&xhr_resp)req.res.statusCode=xhr_resp.statusCode}return{data:xhr.responseText,xhr,agent:_opt.agent,status:xhr_resp.statusCode,orig_res:req.res,is_redirected:req.is_redirected}};let proxy;try{const rule=opt.rule,agent=_opt.agent;if((rule||_opt.force=="proxy")&&!_opt.country&&!agent){const r=rule||get_rule_info_from_url(opt.url);if(r){_opt.country=r.country;_opt.peer=_opt.peer||r.peer}else throw new Error("proxy rule not found for "+opt.url);_opt.force="proxy"}const req_opts={force:_opt.force,country:_opt.country,no_routing:true,peer:_opt.peer,no_rule:!_opt.country,fix_307:_opt.fix_307};if(_opt.ignore_redir!=false)req_opts.ignore_redir=true;if(_opt.prot)req_opts.prot=_opt.prot;if(agent)req_opts.agent=agent;if(_opt.force=="direct")proxy="DIRECT";const b=be_util.browser_guess;if(is_chrome&&b.version>=76&&(_opt.force=="direct"||_opt.force=="proxy"&&agent)){req_opts.no_redirect=true;if(_opt.force=="proxy"){proxy=(agent.host?"HTTPS "+agent.host:"PROXY "+agent.ip)+":"+agent.port}}if(proxy){req_opts.is_proxy_set=true;yield E._set_proxy_for_url(opt.url,proxy,{async:!bext_config.disable_ajax_via_proxy_async})}xhr=hola_XMLHttpRequest(opt.url,opt.type,_opt.hdrs,req_opts);if(_opt.with_credentials)xhr.withCredentials=true;if(_opt.src!="bg_ajax")E.trigger("internal_reqs_update");xhr.onreadystatechange=cb_wrapper((()=>{if(xhr.readyState!=xhr.HEADERS_RECEIVED)return;state.hdrs_received=true;const headers_s=xhr.getAllResponseHeaders();xhr_resp={statusCode:xhr.status,reasonPhrase:xhr.statusText,responseURL:xhr.responseURL,headers:attrib.to_obj_lower(attrib.from_str(headers_s,{allow_invalid:true}))};if(_opt.hdrs_abort)xhr.abort()}));xhr.onerror=ev=>{const req=E.internal_reqs[opt.url];if(req)req.et=this};xhr.onload=()=>this.continue();xhr.onabort=()=>this.continue();xhr.send(_opt.data);yield this.wait(_opt.timeout||30*date.ms.SEC);return get_result()}catch(e){if(_opt.always&&xhr&&!complete)return get_result();throw new Error((proxy?proxy+" ":"")+(e.statusText||e))}}));const on_tab_completed=cb_wrapper((o=>{if(o.frameId)return;let start_ts,load_perr;if(E.get_tab_load_err(o.tabId))set_tab_load_err(o.tabId,null);const tab=E.get_tab_unblocker(o.tabId);const _url=zurl.parse(o.url),_path=_url.path.toLowerCase();let root_url=svc_vpn_util.get_root_url(o.url),rule,path;if(tab&&tab.tab_reload_ts&&tab.rule){be_util.perr("tab_reload_success",{rule:tab.rule.name,dur:Date.now()-tab.tab_reload_ts,country:tab.country},{rate_limit:{count:5}});tab.tab_reload_ts=undefined}if(!o.url||!(start_ts=tab_loads[o.tabId])||!(load_perr=zutil.get(bext_config,"load_perr"))){return}if(!(rule=load_perr.find((r=>r.domain==root_url)))||(path=rule.paths.find((p=>_path.startsWith("/"+p))))===undefined){return}const info={id:rule.id,path:path||"root",ms:Date.now()-start_ts,loc:zutil.get(be_info.get("location"),"country","").toLowerCase()};if(tab&&(rule=tab.rule))assign(info,{country:rule.country,trial:rule.src=="trial"});else info.local=true;be_util.perr("tab_load_completed",info)}));const on_before_navigate=cb_wrapper((o=>{if(o.frameId)return;svc_vpn_util.push_event("navgiate",{tab_id:o.tabId,url:o.url});load_errors[o.tabId]={};tab_loads[o.tabId]=Date.now()}));const test_rules={};E.get_enabled_rule=url=>{const key="http://"+svc_vpn_util.get_root_url(url)+"/";if(zutil.is_mocha()&&test_rules[key])return test_rules[key];const rules=E.be_rule.get_rules(key);const r=rules&&rules[0];return r&&r.enabled?r:undefined};E.get_rule_agents=rule=>etask((function*get_rule_agents_(){yield unblocker_lib.get_agents(null,rule);return unblocker_lib.get_agents_by_route(rule.country)}));E.uninit=()=>{if(!E.inited)return;E.stopListening(be_ext,"change:ext.active change:ext.suspended "+"change:ajax_via_proxy_inited",update_state);E.stopListening(be_ext,"change:bext_config",update_config);be_ext.off("not_working",on_not_working);E.sp.return();E.update_rule_urls();be_ext.set("has_active_rules",0);E.rules=null;E.inited=0;E.is_enabled=false;if(monitor_proxy_req_slow.et)monitor_proxy_req_slow.et=void monitor_proxy_req_slow.et.return();if(monitor_page_load.et)monitor_page_load.et=void monitor_page_load.et.return();agent_auth_listener_del();requests_handler.uninit();if(host_tracker)host_tracker=host_tracker.uninit();E.uninit_ajax_via_proxy();be_pac.update_pac_file_state();E.requests={};for(let k in E.routing_reqs)E.routing_reqs[k].to=be_vpn_util.clear_timeout(E.routing_reqs[k].to);E.routing_reqs={};for(let k in E.loading_sites)be_vpn_util.clear_timeout(E.loading_sites[k].to);E.loading_sites={};E.stopListening();E.clear()};function on_before_request_int(d){if(d&&d.tabId==-1&&d.url&&requests_handler&&(E.internal_reqs[d.url]||d.url.startsWith("http://internal.hola/"))){return requests_handler.on_before_request(d)}}function on_completed_request_int(d){if(!d||d.tabId!=-1||!d.url||!E.requests||!E.requests[d.requestId]||d.type!="xmlhttprequest"){return}const reqid=d.requestId,req=E.requests[reqid];delete E.requests[reqid];if(!d.error)return;const resp={statusCode:0,error:d.error};if(!req.serving){if(req.proxy_req)req.proxy_resp=resp;else if(req.direct_req)req.direct_resp=resp}let ireq;if(!(ireq=E.internal_reqs[req.url]))return;ireq.error=d.error;if(!ireq.res)ireq.res=resp;if(ireq.et)ireq.et.continue()}function on_send_headers_int(d){if(!d||d.tabId!=-1)return;const req=E.requests[d.requestId],int_req=req&&req.opt.int_req;if(!req||!int_req||!int_req.hdrs)return;let modified;const hdrs=int_req.hdrs,req_hdrs=d.requestHeaders;for(let h in hdrs)modified|=hdrs_add(req_hdrs,h,hdrs[h]);if(modified)return{requestHeaders:req_hdrs}}const is_hola_agent_auth=res=>res.statusCode==407&&(res.headers["proxy-authenticate"]=='Basic realm="Hola Unblocker"'||zutil.is_mocha()&&res.headers["proxy-authenticate"]=="hola_unblocker");function on_headers_int(d){if(!d||d.tabId!=-1)return;const req=E.requests[d.requestId],int_req=req&&req.opt.int_req;if(!req||!d||!requests_handler||!int_req||!req.opt.ignore_redir)return;const res=bg_util.nodify_res(d);if(is_hola_agent_auth(res))return;int_req.res=res;req.cancel=true}E.send_not_working=(tab,reason)=>{let rate=be_ext.get("gen.dbg_log_rate");if(rate===undefined)rate=100;const with_log=reason&&!Math.floor(Math.random()*rate)/rate;be_util.perr("be_not_working_stats",assign({reason},tab.not_working),{err:true,with_log,rate_limit:{count:5,ms:date.ms.MIN}});delete tab.not_working};function monitor_not_working(tab_id){let e,period=2*date.ms.MIN,n=period,now=Date.now();for(let id in E.tab_unblockers){let diff,tab=E.tab_unblockers[id];if(!(e=tab.not_working)||(diff=now-e.ts)<period){if(diff&&id!=tab_id)n=Math.min(n,diff);continue}E.send_not_working(tab)}monitor_not_working.to=be_vpn_util.clear_timeout(monitor_not_working.to);if(n<period||tab_id){monitor_not_working.to=be_vpn_util.set_timeout(monitor_not_working,n,{sp:E.sp,name:"monitor_not_working"})}}function inc_not_working(id,tab){let e;if(!tab||!(e=tab.not_working))return;e.stats[id]=(e.stats[id]||0)+1}function on_not_working(e){let tab;if(!(tab=E.get_tab_unblocker(e.tab_id))){return void be_util.perr("be_not_working_tab_not_found",e,{err:true,rate_limit:{count:1}})}let rule=be_vpn_util.get_rule_min_fmt(tab.rule);zerr.notice("tab:%d not working trigger, src %s, current agent %s, %O",e.tab_id,e.src,tab.last_agent&&tab.last_agent.host,{rule,agents:tab.agents});e=assign({err_logs:tab.err_logs},e);unblocker_lib.trigger("not_working",e.tab_id,e);if(tab.not_working)E.send_not_working(tab,"not_working_"+e.src);tab.not_working={ts:Date.now(),info:e,stats:{},rule};monitor_not_working(e.tab_id);if(!["ui","watermark"].includes(e.src)||!debug_hooks)return;let errors={},total;for(let err in tab.debug_errors){if(total=zutil.get(tab.debug_errors,err+".true.total"))errors[err]=total}if(tab.debug_auth)errors.auth=tab.debug_auth;if(tab.media_failures)errors.media=tab.media_failures;if(tab.browse_failures)errors.browse=tab.browse_failures;get_bg_main().dump_errors(e.tab_id,errors)}const ext_on_err=(rule,agent,details,route_opt,retry)=>etask((function*ext_on_err_(){if(rule.changing_proxy)return;if(!E.get_tab_unblocker(details.tabId)){return zerr.notice("tab:%d ignore agent change for closed tab",details.tabId)}if(!retry&&bext_config.report_tab_load_on)be_tabs.page_trace(details,"autoreload");let curr,min_rule=be_vpn_util.get_rule_min_fmt(rule);if(agent&&(curr=unblocker_lib.get_chosen_agent(route_opt,rule))&&agent.host!=curr.host){zerr.notice("tab:%d ignore agent change: failed %s current %s",details.tabId,agent.host,curr.host)}else{const req=E.requests[details.requestId];if(zutil.get(req,"cmd.proxy.peer")){let err_opt={tab_id:details.tabId,url:details.url,status:details.statusCode,peer:true,country:rule.country,rule};yield E._set_req_err("ext_err",agent,err_opt)}const res=yield E.be_rule.change_proxy(details,details.error||(retry?"retry":"unknown"),route_opt);if(res&&res.error)return}if(!retry&&details.tabId>=0){zerr.notice("tab:%d reloading tab on error %s",details.tabId,details.error);if(details.error=="redirect"){be_tabs.update(details.tabId,{url:details.originUrl||details.url})}else be_tabs.reload(details.tabId)}be_ext.trigger("not_working",{tab_id:details.tabId,src:"agent",agent,rule:min_rule})}));const check_retry=(rule,agent,details,tab,route_opt)=>etask((function*_check_retry(){let retry_conf;if(!agent||!(retry_conf=CG("request_errors.retry")))return;let url=details.url;let retry=reason=>etask((function*(){if(!reason)return;zerr.notice("tab:%d allow retry for %s failed request, %s %s",details.tabId,reason,details.error||details.statusCode,url.slice(0,200));be_util.perr("req_err_retry_"+reason,{url,status:details.statusCode,error:details.error,agent,type:details.type,rule:be_vpn_util.get_rule_min_fmt(rule)},{rate_limit:{count:1}});yield ext_on_err(rule,agent,details,route_opt,true);return true}));let m;if(!retry_conf.disable_url_ip_check&&(m=url.match(/=(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})/))&&unblocker_lib.find_agents({ip:m[1]}).length){zerr.notice("tab:%d %s ignore retry for url %s, agent ip %s found",details.tabId,details.error,url.slice(0,200),m[1]);be_util.perr("req_err_ignore_retry",{url,status:details.statusCode,error:details.error,agent,type:details.type,rule:be_vpn_util.get_rule_min_fmt(rule)},{rate_limit:{count:1}});return}let ret=retry_conf.sporadic_perc&&tab.req_err_total_n/tab.req_total_n*100<retry_conf.sporadic_perc&&"sporadic";let mf=bext_config.media_failure;if(!mf||retry_conf.disable_media_failure)return yield retry(ret);let urls=tab.retry_urls=tab.retry_urls||{};if(urls[url]>=(retry_conf.max||5)){zerr.notice("tab:%d max retry %d for media request failed exceeded, "+"%s, %s",details.tabId,urls[url],details.error,url.slice(0,200));return}let check_ext=ext=>url.includes("."+ext);let verify=be_util.get_site_verify_conf(rule.name,url,rule.country);if(mf.extensions.some(check_ext)||verify&&verify.url){urls[url]=(urls[url]||0)+1;ret="media"}return yield retry(ret)}));E.reauth_rule_agents=(rule,period)=>{if(rule&&rule.enabled)unblocker_lib.reauth_country_agents(rule.country,period)};E.reverify_rule_agents=rule=>{if(rule&&rule.enabled)unblocker_lib.reverify_country_agents(rule.country)};const track_autoreload=(tab,agent,d)=>{let now=Date.now(),limit=bext_config.autoreload_limit||3;let per=bext_config.autoreload_ms||date.ms.MIN;if(tab.req_err_n==limit){if(now-tab.req_err_ts<per)return;tab.req_err_sent=tab.req_err_n=0}if(!tab.req_err_n)tab.req_err_ts=now;tab.req_err_n=(tab.req_err_n||0)+1;let info={url:d.url,type:d.type,error:d.error,agent,rule:be_vpn_util.get_rule_min_fmt(tab.rule)};if(tab.req_err_n==limit){be_util.perr("req_err_autoreload_max",info);if(is_main_frame(d)&&is_err_handled(d.error,true)){if(main_frame_errors[d.error])set_tab_load_err(d.tabId,d.error);be_util.perr("req_err_main_frame",info)}}be_util.perr("req_err",info);return true};const fix_req_err=(tab,agent,d,route_opt)=>etask((function*_fix_req_err(){let rule;if(!E.inited||!(rule=tab.rule))return;if(tab.site_conf&&tab.site_conf.skip_fix_req_err&&tab.site_conf.skip_fix_req_err.includes(d.error)){be_util.perr("skip_fix_req_err",{},{rate_limit:{count:1}});return}if(!is_main_frame(d)&&(yield check_retry(rule,agent,d,tab,route_opt))){return}E.reauth_rule_agents(rule);if(track_autoreload(tab,agent,d))yield ext_on_err(rule,agent,d,route_opt)}));E._set_req_err=(id,agent,opt)=>etask((function*_set_req_err_(){if(!opt.peer&&opt.rule&&agent.pool&&!E.get_rule_route(opt.rule).pool){return}let endpoint=opt.peer?"/set_err_peer":"/set_err";let domain=zurl.parse(opt.url).host;zerr.notice("tab:%d %s set_err: %s domain=%s",opt.tab_id,id,agent.host,domain);try{const ret=yield ajax.json({url:zescape.uri("https://"+agent.host+":"+agent.port+endpoint,{domain,err_code:opt.status,country:opt.country,uuid:be_ext.get("uuid")}),perr:_opt=>be_util.perr(_opt.id,_opt.info,opt)});be_vpn_util.assert(zutil.get(ret,"res"),new Error("empty res"));return ret.res}catch(e){zerr("tab:%d %s set_err failed: %s domain=%s err=%s",opt.tab_id,id,agent.host,domain,e);return{err:e}}}));const fix_media_req_err=(rule,agent,d,tab,route_opt,opt)=>{const root_url=rule.name,tab_url=d.initiator||d.url;let verify=be_util.get_site_verify_conf(root_url,d.url);if(!opt.disable_perr){be_util.perr("media_failure_detected",{url:d.url,code:d.statusCode,page_url:tab_url,root_url,agent,rule:verify,headers:d.requestHeaders},{rate_limit:{count:1}})}if(!verify)return;let limit=assign({ms:date.ms.MIN,count:5},opt.cancel_req_rate_limit);let cancel_req_rl=tab.cancel_req_rl=tab.cancel_req_rl||{};let rl=cancel_req_rl[agent.host]=cancel_req_rl[agent.host]||{};if(!rate_limit(rl,limit.ms,limit.count)){tab.media_req_cancel=false;check_retry(rule,agent,d,tab,route_opt);return zerr.debug("tab:%d cancel media req limit exceeded: %s",d.tabId,agent.host)}tab.media_req_cancel=true;return d.ret={cancel:true}};function get_credentials(){var _key=be_ext.get("agent_key"),key=_key||storage.get("agent_key");var err=_key?null:key?"be_agent_key_fallback":"be_no_agent_key";if(err)be_util.perr(err,{},{err:true,rate_limit:{count:2}});let opt={uuid:be_ext.get("uuid"),asnum:get_debug_peer("asnum"),cid:get_debug_peer("cid"),peer_country:get_debug_peer("peer_country")};return{username:be_vpn_util.get_user_name(opt),password:key||"cccccccccccc"}}const agent_auth_listener=ff_cb_wrapper("agent_auth_listener",(details=>{if(details.isProxy&&details.realm=="Hola Unblocker"){if(/Auth Failed suspicious/.test(details.statusLine)){get_bg_main().suspend_client(/permanent/.test(details.statusLine));return{cancel:true}}return{authCredentials:get_credentials()}}be_util.perr("auth_listener_not_proxy",_.pick(details,"url","realm","challenger"),{rate_limit:{count:2}});return{}}));function agent_auth_listener_del(){if(!agent_auth_listener.inited)return;try{chrome.webRequest.onAuthRequired.removeListener(agent_auth_listener)}catch(e){on_hooks_err("be_rm_hooks_err",e)}agent_auth_listener.inited=false}const is_extra_headers_supported=()=>!ff_webext&&is_chrome&&!be_util.browser_guess.android&&be_util.browser_guess.version>=79;function agent_auth_listener_add(){if(zutil.is_mocha()||!chrome.webRequest.onAuthRequired)return;agent_auth_listener_del();try{let extra=["blocking"];if(is_extra_headers_supported())extra.push("extraHeaders");chrome.webRequest.onAuthRequired.addListener(agent_auth_listener,{urls:["<all_urls>"]},extra)}catch(e){on_hooks_err("be_add_hooks_err",e)}agent_auth_listener.inited=true}E.init=function(){if(E.inited)return;chrome=self.chrome;if(!requests_handler)requests_handler=Base_handler.get_handler();E.sp=be_vpn_util.new_etask("be_tab_unblocker");E.url_to_rule_infos=E.url_to_rule_infos||{};agent_auth_listener_add();host_tracker=new Host_tracker;E.inited=1;E.listen_to(be_ext,"change:ext.active change:ext.suspended "+"change:ajax_via_proxy_inited",update_state);E.listen_to(be_ext,"change:bext_config",update_config);be_ext.on("not_working",on_not_working);if(zutil.is_mocha()){hola_req_id=0;E.t.requests_handler=requests_handler}update_config();if(self&&self.hola){self.hola.get_log=()=>be_util.get_log().join("\n");self.hola.dump_unittest=unblocker_lib.dump_unittest}};const init_bg_ajax_on_before_request=ff_cb_wrapper("on_before_bg_ajax",on_before_request_int);const init_bg_ajax_on_req_end=ff_cb_wrapper("on_req_end_bg_ajax",on_completed_request_int);const init_bg_ajax_on_send_headers=ff_cb_wrapper("on_send_headers_bg_ajax",on_send_headers_int);const init_bg_ajax_on_headers=ff_cb_wrapper("on_headers_bg_ajax",on_headers_int);let additional_ajax_via_proxy_urls=new Set;E.add_int_ajax_url=function(url){if(additional_ajax_via_proxy_urls.has(url))return;additional_ajax_via_proxy_urls.add(url);if(!E.ajax_via_proxy_inited)return;E.uninit_ajax_via_proxy(true);E.init_ajax_via_proxy(true)};E.rm_int_ajax_url=function(url){if(!additional_ajax_via_proxy_urls.has(url))return;additional_ajax_via_proxy_urls.delete(url);if(!E.ajax_via_proxy_inited)return;E.uninit_ajax_via_proxy(true);E.init_ajax_via_proxy(true)};E.init_ajax_via_proxy=function(silent){if(E.ajax_via_proxy_inited||zutil.is_mocha())return;E.ajax_via_proxy_inited=1;if(!silent)be_ext.set("ajax_via_proxy_inited",1);E.url_to_rule_infos=E.url_to_rule_infos||{};if(!requests_handler)requests_handler=Base_handler.get_handler();requests_handler.init();be_pac.init();const et=be_pac.update_pac_file_state();const urls=["http://internal.hola/*","http://*.trigger.hola.org/*"].concat(Array.from(additional_ajax_via_proxy_urls));const hola_domains=["hola.org","zspeed-cdn.com","h-vpn.org","holavpninstaller.com","holavpnextension.com","holafreevpn.com","hola-vpn.com","holavpnrussia.com"];for(const d of hola_domains){urls.push(`https://${d}/*`);urls.push(`https://perr.${d}/*`);urls.push(`https://client.${d}/*`)}try{chrome.webRequest.onBeforeRequest.addListener(init_bg_ajax_on_before_request,{urls},["requestBody","blocking"]);chrome.webRequest.onHeadersReceived.addListener(init_bg_ajax_on_headers,{urls},["blocking","responseHeaders"]);chrome.webRequest.onBeforeSendHeaders.addListener(init_bg_ajax_on_send_headers,{urls},["blocking","requestHeaders"]);chrome.webRequest.onCompleted.addListener(init_bg_ajax_on_req_end,{urls:urls.slice(1)});chrome.webRequest.onErrorOccurred.addListener(init_bg_ajax_on_req_end,{urls:urls.slice(1)})}catch(e){on_hooks_err("be_add_hooks_err",e)}return et};E.uninit_ajax_via_proxy=function(silent){if(!E.ajax_via_proxy_inited)return;E.ajax_via_proxy_inited=0;if(!silent)be_ext.set("ajax_via_proxy_inited",0);try{chrome.webRequest.onBeforeRequest.removeListener(init_bg_ajax_on_before_request);chrome.webRequest.onErrorOccurred.removeListener(init_bg_ajax_on_req_end);chrome.webRequest.onCompleted.removeListener(init_bg_ajax_on_req_end);chrome.webRequest.onHeadersReceived.removeListener(init_bg_ajax_on_headers);chrome.webRequest.onHeadersReceived.removeListener(init_bg_ajax_on_send_headers)}catch(e){on_hooks_err("be_rm_hooks_err",e)}};function update_state(){let is_enabled=!be_ext.is_disabled();if(!is_enabled)E.uninit_ajax_via_proxy();be_pac.update_pac_file_state();if(is_enabled==E.is_enabled)return;E.is_enabled=is_enabled;E.stopListening(be_tabs);if(requests_handler)requests_handler.uninit();if(monitor_proxy_req_slow.et)monitor_proxy_req_slow.et=void monitor_proxy_req_slow.et.return();if(monitor_page_load.et)monitor_page_load.et=void monitor_page_load.et.return();if(monitor_not_working.to){monitor_not_working.to=be_vpn_util.clear_timeout(monitor_not_working.to)}if(host_tracker)host_tracker=host_tracker.uninit();if(!E.is_enabled)return;if(requests_handler)requests_handler.init();E.listenTo(be_tabs,"created",on_tab_created);E.listenTo(be_tabs,"updated",on_tab_updated);E.listenTo(be_tabs,"removed",on_tab_removed);E.listenTo(be_tabs,"replaced",on_tab_replaced);E.listenTo(be_tabs,"completed",on_tab_completed);E.listenTo(be_tabs,"before_navigate",on_before_navigate)}function update_config(){const prev=bext_config;bext_config=be_ext.get("bext_config")||{};proxy_debug=zutil.get(bext_config,"debug.proxy_debug");debug_hooks=!zutil.is_mocha()&&!zutil.get(bext_config,"debug_logs.disable")||zutil.get(bext_config,"debug_logs.enable");request_errors=zutil.bool_lookup(zutil.get(bext_config,"request_errors.handle",[]));request_errors_known=zutil.bool_lookup(zutil.get(bext_config,"request_errors.ignore_known",["net::ERR_ABORTED","net::ERR_BLOCKED_BY_CLIENT","net::ERR_CACHE_MISS"]));if(requests_handler&&prev.debug_hooks!=bext_config.debug_hooks)requests_handler.update_hooks();if(CG("disable_slow_load_monitor2")&&monitor_page_load.et)monitor_page_load.et=void monitor_page_load.et.return();be_util.convert_url2regex(bext_config,"redirect");for(let tabid in E.tab_unblockers){let tu=E.tab_unblockers[tabid];if(tu.rule&&tu.rule.name)tu.site_conf=be_util.get_site_conf(tu.rule.name)}const ph_conf=zutil.get(bext_config,"collect_proxied_hosts",{});if(ph_conf.enabled!=proxied_hosts_conf.enabled){if(ph_conf.enabled)init_proxied_hosts(ph_conf);else uninit_proxied_hosts()}proxied_hosts_conf=ph_conf}function get_failure_config(type){const failure=be_util.CG(type+"_failure");if(failure&&!failure.disable&&(!failure.min_ver||version_util.cmp(be_util.version(),failure.min_ver)>=0)){return failure}}let proxied_hosts={},proxied_hosts_conf={},proxied_hosts_et;const init_proxied_hosts=ph_conf=>{proxied_hosts_conf=ph_conf;E.sp.spawn(proxied_hosts_et=etask({name:"proxied_hosts",cancel:true},(function*_proxied_hosts(){this.finally((()=>proxied_hosts_et=null));while(true){const{interval,threshold}=proxied_hosts_conf;yield etask.sleep(interval);const root_urls=Object.keys(proxied_hosts).filter((r=>Date.now()-proxied_hosts[r].first_ts>=threshold));if(root_urls.length)yield send_proxied_hosts({root_urls})}})))};const uninit_proxied_hosts=()=>{if(proxied_hosts_et)proxied_hosts_et.return();proxied_hosts_et=null;proxied_hosts={}};const send_proxied_hosts=etask.fn((function*(opt){const{tab_id,root_url,root_urls}=opt||{};if(!proxied_hosts_conf.enabled)return;const data={};for(const r in proxied_hosts){const o=proxied_hosts[r];if(o&&!o.sent&&(!root_url||root_url==r||!root_urls||root_urls.includes(r)||!tab_id||o.tab_id==tab_id)&&Object.keys(o.hosts).length){o.sent=Date.now();data[r]=o.hosts}}if(!Object.keys(data).length)return;yield E.be_bg_ajax.ccgi_ajax({url:conf.url_ccgi+"/proxied_hosts",method:"POST",data,timeout:10*date.ms.SEC})}));const add_proxied_host=(root_url,host,tab_id)=>{if(!proxied_hosts_conf.enabled)return;if(!zurl.is_valid_domain(root_url)||zurl.is_hola_domain(root_url)||!zurl.is_valid_domain(host)||zurl.is_hola_domain(host)){return}proxied_hosts[root_url]=proxied_hosts[root_url]||{first_ts:Date.now(),hosts:{},tab_id};if(proxied_hosts[root_url].sent)return;proxied_hosts[root_url].hosts[host]=proxied_hosts[root_url].hosts[host]||Date.now()};const on_main_frame_headers=d=>{let failure;if(!(failure=get_failure_config("browse")))return;if(d.tabId<0||!/^(4|5)/.test(d.statusCode)||d.statusCode==407)return;let tab_url=d.url||d.initiator,root_url;if(tab_url)root_url=svc_vpn_util.get_root_url(tab_url);let info={url:d.url,code:d.statusCode,page_url:tab_url,root_url,details:d};let is_hola_domain=zurl.is_hola_domain(root_url);let tab=E.get_tab_unblocker(d.tabId),req=E.requests[d.requestId];let no_unblock=!tab||!req&&!is_hola_domain;if(!CG("disable_google_caps_oops")&&be_vpn_util.is_google(root_url)&&tab_url.includes("/sorry/")){be_util.perr("google_caps_oops",{info:assign({no_unblock},info)},{rate_limit:{count:1}})}else if(!CG("disable_hola_err")&&is_hola_domain)be_util.perr("hola_browse_failure",{info},{rate_limit:{count:1}});if(no_unblock)return;let agent;if(tab&&req&&(agent=req.agent))tab.browse_failures=(tab.browse_failures||0)+1;zerr.notice("tab:%d browse failure detected: %d %s",d.tabId,d.statusCode,d.url.slice(0,200));if(failure.disable_perr)return;info.agent=agent&&agent.host;be_util.perr("browse_failure_detected",info,{rate_limit:{count:1}})};E.get_all_agents=function(){let agents=[];if(!E.rules)return agents;for(let r in E.rules.unblocker_rules){let rule=E.rules.unblocker_rules[r];for(let route of unblocker_lib.get_rule_routes(rule))agents=agents.concat(unblocker_lib.get_agents_by_route(route))}return agents};if(zutil.is_mocha()){E.t={Base_handler,is_force_proxy,on_not_working,tab_unblocker_del,get_forced_strategy,test_rules,on_before_navigate,on_tab_created,on_tab_updated,on_tab_removed,requests_handler,is_vpn_allowed,url2host,be_pac,fix_req_err,check_retry}}return E}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},4130:(module,exports,__webpack_require__)=>{"use strict";var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;// LICENSE_CODE ZON
!(__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(7439),__webpack_require__(6386),__webpack_require__(6969),__webpack_require__(1211),__webpack_require__(9824),__webpack_require__(843),__webpack_require__(932),__webpack_require__(5305),__webpack_require__(3727),__webpack_require__(7345),__webpack_require__(5250),__webpack_require__(1291)],__WEBPACK_AMD_DEFINE_RESULT__=function(_,etask,be_backbone,B,zerr,vpn_util,date,zurl,be_ext,be_util,be_vpn_util,zutil){be_vpn_util.assert_bg("be_tabs");const chrome=self.chrome;const E=new(be_backbone.model.extend({model_name:"tabs",_defaults:function(){this.on("destroy",(()=>{E.uninit()}))}}));const max_redirects=10;const tabs={};const v3=be_util.is_v3;function active_cb(){etask({name:"active_cb",cancel:true},(function*active_cb_(){try{let tab=yield E.get_tab(E.get("active.real.id"));if(tab===undefined)tab=tabs[E.get("active.real.id")];if(tab&&chrome){if(/^(chrome-)?devtools:\/\/devtools\//.test(tab.url||""))return}E.set({"active.id":tab?tab.id:undefined,"active.url":tab?E.get_loading_tab_url(tab.id)||tab.url:"","active.status":tab?tab.status:"","active.incognito":tab?tab.incognito:false})}catch(err){zerr("be_tabs_active_cb_err: "+err)}}))}function is_active(id){return id==E.get("active.real.id")}var tab_trace={};function page_trace(details,msg,clear){if(!details)return;var is_main=chrome?!details.frameId&&(!details.type||details.type=="main_frame"):details.is_main;if(!is_main&&msg!="autoreload")return;var tab_id=details.tabId;if(clear)page_trace_del(tab_id);var trace=tab_trace[tab_id]=tab_trace[tab_id]||[];var ts=details.timeStamp;var from_start=trace[0]?ts-trace[0].ts:0;var prev=trace.length?trace[trace.length-1]:null;if(prev)prev.duration=ts-prev.ts;var status=details.statusCode||prev&&prev.status||"0";trace.push({ts,real_ts:Date.now(),from_start,msg,status,error:details.error});zerr.debug("tab:%d navigation %s %s",tab_id,msg,details.url.slice(0,200))}function page_trace_del(tab_id){delete tab_trace[tab_id]}E.page_trace=page_trace;E.get_trace=tab_id=>{var trace=tab_trace[tab_id];if(!trace||!trace.length)return trace;trace[trace.length-1].duration=Date.now()-trace[trace.length-1].real_ts;return trace};function on_created(tab){tabs[tab.id]=tab;set_url(tab.id,tab.url);E.trigger("created",{tab})}function on_updated(id,info,tab){if(!info.url&&!info.status)return;tabs[tab.id]=tab;set_url(id,info.url);if(is_active(id))E.sp.spawn(active_cb());E.trigger("updated",{id,info,tab})}E.update_active_tab_url=()=>E.sp&&E.sp.spawn(active_cb());function on_activated(info){E.set("active.real.id",info.tabId)}function on_removed(id,info){del_tab(id);track_redirect_del(id);page_trace_del(id);E.trigger("removed",{id,info})}function on_replaced(added,removed){del_tab(removed);track_redirect_del(removed);page_trace_del(removed);if(is_active(removed))E.set("active.real.id",added);E.trigger("replaced",{added,removed})}var chrome_error_list=["ACCESS_DENIED","BLOCKED_BY_ADMINISTRATOR","CONNECTION_REFUSED","CONNECTION_FAILED","NAME_NOT_RESOLVED","ADDRESS_UNREACHABLE","CERT_ERROR_IN_SSL_RENEGOTIATION","NAME_RESOLUTION_FAILED","NETWORK_ACCESS_DENIED","SSL_HANDSHAKE_NOT_COMPLETED","SSL_SERVER_CERT_CHANGED","CERT_COMMON_NAME_INVALID","CERT_AUTHORITY_INVALID","CERT_CONTAINS_ERRORS","CERT_INVALID","INVALID_RESPONSE","EMPTY_RESPONSE","INSECURE_RESPONSE","DNS_MALFORMED_RESPONSE","DNS_SERVER_FAILED","DNS_SEARCH_EMPTY","TIMED_OUT","CONNECTION_CLOSED","ABORTED","CONNECTION_RESET","CERT_SYMANTEC_LEGACY"];function on_error_occured(info){if(info.frameId!=0)return;var err=info.error||"";err=err.split("::ERR_")[1];if(chrome&&(!err||!chrome_error_list.includes(err)))return;info.http_status_code=0;E.trigger("error_occured",{id:info.tabId,info})}const WINDOW_ID_NONE=chrome?-1:null;function on_focused(id){if(id===WINDOW_ID_NONE)return;E.set("active.window.id",id);E.trigger("on_focused");chrome.tabs.query({active:true,windowId:id},(_tabs=>{if(_tabs&&_tabs.length)E.set("active.real.id",_tabs[0].id)}))}const nav_tabs={};function on_before_navigate(info){if(!info.frameId)nav_tabs[info.tabId]=info.url;var trace,clear=true;if(!info.frameId&&(trace=tab_trace[info.tabId])){var i,now=Date.now();for(i=trace.length-1;i>=0&&trace[i].msg!="autoreload";i--);if(i>=0&&now-trace[i].real_ts<2*date.ms.SEC)clear=false}page_trace(info,"before_navigate",clear);if(!info.frameId&&is_active(info.tabId))active_cb();E.trigger("before_navigate",info)}function on_completed(info){page_trace(info,"completed");if(is_active(info.tabId))active_cb();E.trigger("completed",info)}function on_committed(details){page_trace(details,"committed");E.trigger("committed",{id:details.tabId,info:details});if(!details.frameId&&details.tabId&&details.url){var qualifiers=details.transitionQualifiers;if(qualifiers&&qualifiers.includes("client_redirect")){track_redirect({id:details.tabId,url:details.url,info:details})}else if(!qualifiers.includes("server_redirect"))delete tabs_redirect[details.tabId];last_committed[details.tabId]=get_root_url(details.url)}if(false){}}function get_root_url(url){url=zurl.parse(url);if(!url.hostname||!url.protocol)return;url=url.protocol+"//"+url.hostname+"/";return vpn_util.get_root_url(url)}var tabs_redirect={},last_committed={};function track_redirect(tab){let url;if(!E.inited||!chrome||!tab||tab.id===undefined||!(url=tab.url||E.get_url(tab.id))){return}let list=tabs_redirect[tab.id]=tabs_redirect[tab.id]||{redirects:[]};let last_url=last_committed[tab.id],from_url=get_root_url(url);let to_url,headers;if(headers=tab.info&&tab.info.responseHeaders){let h;if(h=headers.find((e=>e.name.toLowerCase()=="location")))to_url=h.value;to_url=to_url&&get_root_url(to_url)}if(!to_url&&tab.info&&tab.info.transitionQualifiers){to_url=get_root_url(url);from_url=last_url}const redirects=list.redirects;if(!from_url||!to_url||from_url==to_url||redirects.length&&redirects[redirects.length-1].from==from_url){return}redirects.push({to:to_url,from:from_url,url,ts:Date.now()});if(redirects.length==max_redirects){if(!list.is_max&&E.get_redirect_list(tab.id,max_redirects,true).length==max_redirects){let urls=list.redirects.map((e=>e.url));be_util.perr("be_max_redirect_sequence",{urls},{err:true,rate_limit:{count:1}});E.trigger("max_redirect_sequence",from_url,to_url,urls);list.is_max=true}redirects.shift()}if(list.to)be_vpn_util.clear_timeout(list.to);list.to=be_vpn_util.set_timeout((()=>list.redirects=[]),2*date.ms.MIN)}function get_redirect_sequence(tab_id,url,ts_limit,limit){var list;if(!(list=tabs_redirect[tab_id]))return[];list=ts_limit?list.redirects.filter((e=>e.ts>ts_limit)):list.redirects;if(!list.length||list.some((e=>e.from=="hola.org")))return[];var ts,parent_url,i,root_urls=[];for(i=0,parent_url=list.find((e=>e.to==url));parent_url&&i<max_redirects;i++){if(ts&&ts<=parent_url.ts)break;root_urls.unshift(parent_url.from);if(!ts)ts=parent_url.ts;list.splice(0,list.indexOf(parent_url)+1);parent_url=list.find((e=>e.to==parent_url.from))}return root_urls.splice(0,limit||4)}function track_redirect_del(tab_id){if(tab_id===undefined)return;if(last_committed[tab_id])delete last_committed[tab_id];if(tabs_redirect[tab_id]){if(tabs_redirect[tab_id].to)be_vpn_util.clear_timeout(tabs_redirect[tab_id].to);delete tabs_redirect[tab_id]}}E.track_redirect=track_redirect;E.get_redirect_list=(tab_id,limit)=>{var time_limit=Date.now()-120*date.ms.SEC;var active_url=E.get("active.url");active_url=active_url&&get_root_url(active_url);return get_redirect_sequence(tab_id,active_url,time_limit,limit)};E.get_loading_tab_url=tab_id=>{if(be_util.CG("disable_loading_tabs_tracker"))return;let site_req=E.be_tab_unblocker.loading_sites[tab_id];if(site_req)return site_req.url};const init_listeners=()=>{chrome.tabs.onCreated.addListener(on_created);chrome.tabs.onUpdated.addListener(on_updated);chrome.tabs.onActivated.addListener(on_activated);chrome.tabs.onRemoved.addListener(on_removed);chrome.tabs.onReplaced.addListener(on_replaced);chrome.windows.onFocusChanged.addListener(on_focused);set_navigation_listeners()};E.init=be_tab_unblocker=>{if(E.inited)return;E.be_tab_unblocker=be_tab_unblocker;E.sp=be_vpn_util.new_etask("be_tabs");E.listen_to(be_ext,"change:ext.active change:ext.suspended",update_state);E.urls={};chrome.tabs.query({},(_tabs=>{if(!_tabs)return;for(var i=0;i<_tabs.length;i++){tabs[_tabs[i].id]=_tabs[i];set_url(_tabs[i].id,_tabs[i].url)}}));chrome.windows.getLastFocused({},(win=>{if(win)on_focused(win.id)}));if(!v3)init_listeners();E.on_init("change:active.real.id",active_cb);E.inited=true};E.uninit=()=>{if(!E.inited)return;E.sp.return();chrome.tabs.onCreated.removeListener(on_created);chrome.tabs.onUpdated.removeListener(on_updated);chrome.tabs.onActivated.removeListener(on_activated);chrome.tabs.onRemoved.removeListener(on_removed);chrome.tabs.onReplaced.removeListener(on_replaced);chrome.windows.onFocusChanged.removeListener(on_focused);E.off("change:active.real.id",active_cb);del_navigation_listeners();E.stopListening();E.inited=false;E.urls=undefined;E.clear()};function set_navigation_listeners(){if(E.nav_listening)return;E.nav_listening=true;if(zutil.get(chrome,"webNavigation.onBeforeNavigate"))chrome.webNavigation.onBeforeNavigate.addListener(on_before_navigate);if(zutil.get(chrome,"webNavigation.onCompleted"))chrome.webNavigation.onCompleted.addListener(on_completed);if(zutil.get(chrome,"webNavigation.onErrorOccurred"))chrome.webNavigation.onErrorOccurred.addListener(on_error_occured);if(zutil.get(chrome,"webNavigation.onCommitted"))chrome.webNavigation.onCommitted.addListener(on_committed)}function del_navigation_listeners(){if(!E.nav_listening)return;E.nav_listening=false;if(zutil.get(chrome,"webNavigation.onBeforeNavigate")){chrome.webNavigation.onBeforeNavigate.removeListener(on_before_navigate)}if(zutil.get(chrome,"webNavigation.onCompleted"))chrome.webNavigation.onCompleted.removeListener(on_completed);if(zutil.get(chrome,"webNavigation.onErrorOccurred"))chrome.webNavigation.onErrorOccurred.removeListener(on_error_occured);if(zutil.get(chrome,"webNavigation.onCommitted"))chrome.webNavigation.onCommitted.removeListener(on_committed)}E.get_tab=tab_id=>{if(!tab_id)return null;return etask.cb_apply(chrome.tabs,".get",[tab_id])};E.get_nav_tab_url=id=>nav_tabs[id];E.get_nav_tabs=()=>nav_tabs;function del_tab(id){delete tabs[id];delete nav_tabs[id];if(!E.urls[id])return;delete E.urls[id];E.trigger("url_updated",id)}function set_url(id,url){if(!url||url==E.urls[id])return;E.urls[id]=url;E.trigger("url_updated",id,url)}function update_state(){let is_active=!be_ext.is_disabled();if(E.is_active==is_active)return;E.is_active=is_active;del_navigation_listeners();if(!E.is_active)return;set_navigation_listeners()}E.get_url=tab_id=>E.get_loading_tab_url(tab_id)||E.urls&&E.urls[tab_id];E.active=()=>E.get_tab(E.get("active.id"));E.update=(tab_id,opt)=>etask((function*update(){try{if(!+tab_id)throw new Error("invalid tab_id");yield etask.cb_apply(chrome.tabs.update,[+tab_id,opt])}catch(e){be_util.perr("be_tab_update_err",{tab_id,opt},{err:e,rate_limit:{count:1}})}}));E.reload=tab_id=>etask((function*reload(){try{if(!+tab_id)throw new Error("invalid tab_id");yield etask.cb_apply(chrome.tabs.reload,[+tab_id,{bypassCache:true}])}catch(e){be_util.perr("be_tab_reload_err",{tab_id},{err:e,rate_limit:{count:1}})}}));var tabs_suggestions={};E.set_force_suggestion=(tab_id,val)=>{tabs_suggestions[tab_id]=val};E.is_force_suggestion=tab_id=>tabs_suggestions[tab_id];E.t={get_redirect_sequence,tabs_redirect};if(v3)init_listeners();return E}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))},4968:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var underscore__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(7439);var underscore__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(underscore__WEBPACK_IMPORTED_MODULE_0__);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(6969);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1__);var _util_etask_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(6386);var _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_util_etask_js__WEBPACK_IMPORTED_MODULE_2__);var _util_storage_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(8915);var _util_storage_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_util_storage_js__WEBPACK_IMPORTED_MODULE_3__);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(7345);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4__);var _bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(4130);var _bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_5__);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(3727);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_6__);var _bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(1211);var _bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_7__);var _svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(843);var _svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_8__);var _bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(5371);var _bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_9__);var _bext_vpn_bg_mitm_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(7148);var _bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(6210);var _bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(8076);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(9824);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_13___default=__webpack_require__.n(_util_zerr_js__WEBPACK_IMPORTED_MODULE_13__);var _bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(9265);var _util_util_js__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(1291);var _util_util_js__WEBPACK_IMPORTED_MODULE_15___default=__webpack_require__.n(_util_util_js__WEBPACK_IMPORTED_MODULE_15__);var _util_escape_js__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(4336);var _util_escape_js__WEBPACK_IMPORTED_MODULE_16___default=__webpack_require__.n(_util_escape_js__WEBPACK_IMPORTED_MODULE_16__);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(5250);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_17___default=__webpack_require__.n(_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_17__);var _util_version_util_js__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(6262);var _util_version_util_js__WEBPACK_IMPORTED_MODULE_18___default=__webpack_require__.n(_util_version_util_js__WEBPACK_IMPORTED_MODULE_18__);var _bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(7666);var _bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(8552);var _bext_vpn_bg_tpopup_script_js__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__(9568);var _util_user_agent_js__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__(901);var _util_user_agent_js__WEBPACK_IMPORTED_MODULE_21___default=__webpack_require__.n(_util_user_agent_js__WEBPACK_IMPORTED_MODULE_21__);
// LICENSE_CODE ZON
_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_17___default().assert_bg("be_tpopup");const{chrome}=self,{assign}=Object;const CG=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().CG;const v3=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().is_v3;const E=new(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1___default().model.extend({model_name:"tpopup",_defaults:function(){this.on("destroy",(()=>this.uninit()))}}));const popup_showing=()=>{if(v3)return _bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_7___default().msg.is_connected(-1);let views=chrome.extension.getViews({type:"popup"});return views&&views.length>0};const min_suggest_rate=.3;let forced_urls={},connected_tpopups={},loading_tpopups={};let tpopup_windows={};E.is_connected=(tab_id,tpopup_type)=>{if(!_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_7___default().tabs.is_connected(tab_id))return false;return tpopup_type?connected_tpopups[tab_id]==tpopup_type:connected_tpopups[tab_id]};const is_never_show_popup=(root_url,url)=>_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_17___default().is_skip_url(url)||_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_17___default().is_google(root_url)&&!_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().check_min_ver(CG("tpopup.allow_google_min_ver"))||_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_17___default().is_youtube(root_url)&&!_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().check_min_ver(CG("tpopup.allow_youtube_min_ver"));const is_never_show_popup_by_rating=root_url=>_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_17___default().is_google(root_url)&&!_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().check_min_ver(CG("tpopup.allow_rule_rating_google_min_ver"))||_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_17___default().is_youtube(root_url)&&!_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().check_min_ver(CG("tpopup.allow_rule_rating_youtube_min_ver"));const is_old_mac=()=>{try{const ua=navigator.userAgent;const hola_br_i=ua.indexOf("Hola/");const is_macos=_util_user_agent_js__WEBPACK_IMPORTED_MODULE_21___default().guess().os=="macos";let hola_br_ver="";if(hola_br_i>-1&&is_macos){hola_br_ver=ua.substring(hola_br_i+5);if(!!hola_br_ver&&_util_version_util_js__WEBPACK_IMPORTED_MODULE_18___default().cmp(hola_br_ver,"1.198.611")<0){return true}}}catch(e){return false}return false};const get_rule=url=>{const rules=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_17___default().get_rules(_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_12__.Z.get("rules"),url);return underscore__WEBPACK_IMPORTED_MODULE_0___default().first(rules)};const is_protect=url=>{if(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().full_browser_mode())return false;let rule=get_rule(url)||{};return rule.enabled&&_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_17___default().is_all_browser(rule)||rule.mode=="protect"};const is_tpopup_disabled=()=>{let popup_conf=(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_6___default().get("bext_config")||{}).popup||{};return popup_conf.disable||_util_version_util_js__WEBPACK_IMPORTED_MODULE_18___default().cmp(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().version(),popup_conf.disable_max_ver)<0};E.do_tpopup=(tab,root_url,tpopup_opt)=>loading_tpopups[tab&&tab.id]||_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*do_tpopup(){let url=tab&&tab.url,tab_id=tab&&tab.id;root_url=root_url||url&&_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_8___default().get_root_url(url);if(!url||!root_url||_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_6___default().is_disabled()||is_tpopup_disabled())return;loading_tpopups[tab_id]=this;this.finally((()=>{delete loading_tpopups[tab_id];if(false){}}));this.catch((err=>{_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().perr("be_tpopup_err",{},{err,with_log:true});delete connected_tpopups[tab_id]}));if(!v3)_bext_vpn_bg_mitm_js__WEBPACK_IMPORTED_MODULE_10__.Z.trace(tab_id,url,"do_tpopup start");tpopup_opt=tpopup_opt||(yield get_tpopup_opt({tab_id,url,root_url}));if(!tpopup_opt)return;yield render_tpopup(assign({tab_id,root_url,url},tpopup_opt))}));const check_unblockig_rate=root_url=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*(){let unblocking_rate=yield _bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_11__["default"].get_unblocking_rate(200);if(!unblocking_rate)return false;let rate;for(let i=0,r;!rate&&(r=unblocking_rate[i]);i++){if(r.root_url==root_url&&r.unblocking_rate>min_suggest_rate)rate=r;else if(root_url=="bbc.com"&&r.root_url=="bbc.co.uk"&&r.unblocking_rate>min_suggest_rate){rate=r}}return!!rate}));E.need_rating_popup=()=>{let c=CG("rating_popup",{});let unblock_action_n=_util_storage_js__WEBPACK_IMPORTED_MODULE_3___default().get_int("unblock_action_n");return unblock_action_n>1&&_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().check_min_ver(c.min_ver)&&!_util_storage_js__WEBPACK_IMPORTED_MODULE_3___default().get_int("rating_popup_close_ts")&&!_util_storage_js__WEBPACK_IMPORTED_MODULE_3___default().get_int("rate_popup_rating")};const get_tpopup_opt=({tab_id,url,root_url})=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*(){let premium_rule=_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_14__["default"].get_force_premium_rule(root_url,{tab_url:url});if(is_old_mac()&&(url||"").indexOf("chrome://")==0){return{tpopup_type:"browser_update"}}if(E.need_rating_popup())return{tpopup_type:"rate"};if(_util_util_js__WEBPACK_IMPORTED_MODULE_15___default().get(premium_rule,"blacklist")){_util_zerr_js__WEBPACK_IMPORTED_MODULE_13___default().notice("tab:%d no tpopup - blacklist %s",tab_id,root_url);return}if(is_protect(url)){_util_zerr_js__WEBPACK_IMPORTED_MODULE_13___default().notice("tab:%d hide tpopup when protect browser/pc is enabled",tab_id);return}if(is_never_show_popup(root_url,url)){return _util_zerr_js__WEBPACK_IMPORTED_MODULE_13___default().notice("tab:%d tpopup not allowed on %s",tab_id,root_url)}if(!_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_11__["default"].is_dont_show(root_url,"suggestion")&&!is_rule_enabled(url)&&need_smart_suggestions(tab_id,url)){_util_zerr_js__WEBPACK_IMPORTED_MODULE_13___default().notice("tab:%d need smart suggestion popup",tab_id);return{wider_tpopup:true,tpopup_type:"smart_suggestion"}}if(!_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_14__["default"].is_active()&&premium_rule&&!_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_11__["default"].is_dont_show(root_url)){_util_zerr_js__WEBPACK_IMPORTED_MODULE_13___default().notice("tab:%d force premium - tpopup should be shown",tab_id);return{}}let proxy_country=is_rule_enabled(url)?get_rule(url).country:null;if(need_watermark_popup(tab_id,url,proxy_country)){_util_zerr_js__WEBPACK_IMPORTED_MODULE_13___default().notice("tab:%d need watermark popup",tab_id);return{tpopup_type:"watermark"}}if(_bext_vpn_bg_mitm_js__WEBPACK_IMPORTED_MODULE_10__.Z.is_popup_needed(root_url)&&_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_19__["default"].need_trial(root_url)){_util_zerr_js__WEBPACK_IMPORTED_MODULE_13___default().notice("tab:%d need mitm_trial watermark popup",tab_id);return{tpopup_type:"watermark",fallback_tab_url:_bext_vpn_bg_mitm_js__WEBPACK_IMPORTED_MODULE_10__.Z.get_confirm_tab_url(root_url,tab_id)}}if(_bext_vpn_bg_mitm_js__WEBPACK_IMPORTED_MODULE_10__.Z.is_popup_needed(root_url)){_bext_vpn_bg_mitm_js__WEBPACK_IMPORTED_MODULE_10__.Z.trace(tab_id,url,"do_tpopup mitm popup should be shown");_util_zerr_js__WEBPACK_IMPORTED_MODULE_13___default().notice("tab:%d mitm popup should be shown",tab_id);return{tpopup_type:"watermark",fallback_tab_url:_bext_vpn_bg_mitm_js__WEBPACK_IMPORTED_MODULE_10__.Z.get_confirm_tab_url(root_url,tab_id)}}if(need_force_suggestion(tab_id,url)){_util_zerr_js__WEBPACK_IMPORTED_MODULE_13___default().notice("tab:%d need forced suggestion popup",tab_id);_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_5___default().set_force_suggestion(tab_id,null);_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_12__.Z.set_stub_rule(tab_id,null);return{tpopup_type:"suggestion"}}if(need_stub_rule_popup(tab_id,url)){let tpopup_country=(_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_12__.Z.get_stub_rule(tab_id)||{}).country||"";_util_zerr_js__WEBPACK_IMPORTED_MODULE_13___default().notice("tab:%d need last rule popup",tab_id);_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_5___default().set_force_suggestion(tab_id,null);_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_12__.Z.set_stub_rule(tab_id,null);return{tpopup_type:"suggestion",tpopup_country:tpopup_country.toUpperCase()}}let forced;if(forced=_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_11__["default"].is_force_tpopup(root_url)){_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_11__["default"].unset_force_tpopup(root_url);_util_zerr_js__WEBPACK_IMPORTED_MODULE_13___default().notice("tab:%d popup was forced",tab_id);if(typeof forced=="string")return{tpopup_type:forced};forced_urls[root_url]=forced;return{}}if(_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_11__["default"].is_dont_show(root_url))return _util_zerr_js__WEBPACK_IMPORTED_MODULE_13___default().notice("tab:%d tab is don't show",tab_id);let smode=get_suggestion_mode(root_url);if(["always","never"].includes(smode)||smode=="by_popular"&&_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_11__["default"].is_dont_show(root_url,"suggestion")){_util_zerr_js__WEBPACK_IMPORTED_MODULE_13___default().notice("tab:%d skip tpopup, site has suggestion conf",tab_id);return}if(forced=forced_urls[root_url]){_util_zerr_js__WEBPACK_IMPORTED_MODULE_13___default().notice("tab:%d popup was forced2",tab_id);return typeof forced=="string"?{tpopup_type:forced}:{}}if(premium_rule||is_rule_enabled(url))return;if(is_never_show_popup_by_rating(root_url)){_util_zerr_js__WEBPACK_IMPORTED_MODULE_13___default().notice("tab:%d skip tpopup, %s tpopup by rating is not allowed",tab_id,root_url);return}_util_zerr_js__WEBPACK_IMPORTED_MODULE_13___default().notice("tab:%d checking if site has high unblocking rate",tab_id);if(!(yield check_unblockig_rate(root_url))){_util_zerr_js__WEBPACK_IMPORTED_MODULE_13___default().notice("tab:%d skip tpopup, unblocking rate is too low",tab_id);return}if(get_suggestion_mode(root_url)=="by_popular"&&!_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_11__["default"].is_dont_show(root_url,"suggestion")){_util_zerr_js__WEBPACK_IMPORTED_MODULE_13___default().notice("tab:%d need watermark popup (by_popular)",tab_id);return{tpopup_type:"watermark"}}return{}}));const render_tpopup=({tab_id,tpopup_type,root_url,tpopup_country,url,fallback_tab_url,wider_tpopup})=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*(){if(popup_showing()&&!tpopup_type)return _util_zerr_js__WEBPACK_IMPORTED_MODULE_13___default().notice("tab:%d extension popup is opened",tab_id);let tab=yield _bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_5___default().get_tab(tab_id);if(!tab)return _util_zerr_js__WEBPACK_IMPORTED_MODULE_13___default()("tab:%d tpopup tab disappeared",tab_id);if(tab.url!=url){_util_zerr_js__WEBPACK_IMPORTED_MODULE_13___default()("tab:%d tpopup tab changed url %s -> %s",tab_id,url,tab.url);return}if(E.is_connected(tab_id,tpopup_type))return;let win_id=tpopup_windows[tab_id];if(win_id&&(yield _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default().cb_apply(chrome.windows,".get",[win_id])))return;_util_zerr_js__WEBPACK_IMPORTED_MODULE_13___default().notice("tab:%d applying tpopup to tab",tab_id);let opt={tab_id,connection_id:tab_id+":tpopup:"+underscore__WEBPACK_IMPORTED_MODULE_0___default().random(Number.MAX_SAFE_INTEGER),root_url,url,ext_url:chrome.runtime.getURL("")+"js"};if(tpopup_type){opt.type=tpopup_type;if(wider_tpopup){opt.style={top:"20px",right:"20px",width:"604px",height:"172px"}}else opt.style={top:"0",right:"0",width:"0",height:"0"}}else{opt.style=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().check_min_ver(CG("new_design_min_ver"))?{top:"5px",right:"20px",width:"366px",height:"320px"}:{top:"5px",right:"20px",width:"274px",height:"377px"}}if(tpopup_country)opt.country=tpopup_country;try{if(CG("debug.fail_trial_tpopup")&&_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_20__["default"].get_site_storage(root_url,"force_trial")||CG("debug.fail_all_tpopup")){throw new Error("test fail_tpopup")}yield inject_iframe(tab_id,opt);connected_tpopups[tab_id]=tpopup_type||true}catch(e){if(e.message.match(/(tab was closed)|(no tab)/i))return;if(fallback_tab_url){_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_20__["default"].open_be_tab({url:fallback_tab_url,force_active:true});return}_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().perr("be_tpopup_inject_err",{tab_url:tab.url,tab_id,tpopup_type,tab},{err:e,with_log:true});if(_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_20__["default"].get_site_storage(root_url,"force_trial")&&_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().check_min_ver(CG("tpopup_window_min_ver"))){opt.mode="window";let win=yield create_window(opt);if(win)tpopup_windows[tab_id]=win.id}}}));const inject_iframe=(tab_id,opt)=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*(){let site_conf=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().get_site_conf(opt.root_url)||{};opt=Object.assign({},opt,{tpopup_parent:site_conf.tpopup_parent||CG("tpopup_parent")});let tabapi=_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_20__["default"].tabid2api(tab_id);let code=`(${_bext_vpn_bg_tpopup_script_js__WEBPACK_IMPORTED_MODULE_22__.Z.toString()})(${JSON.stringify(opt)})`;_util_zerr_js__WEBPACK_IMPORTED_MODULE_13___default().notice("tab:%d inject tpopup iframe",tab_id);let res;if(v3){res=yield chrome.scripting.executeScript({target:{tabId:+tabapi},func:_bext_vpn_bg_tpopup_script_js__WEBPACK_IMPORTED_MODULE_22__.Z,args:[opt]})}else{res=yield _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default().cb_apply(chrome.tabs,".executeScript",[tabapi,{code,matchAboutBlank:true}])}let err=chrome.runtime.lastError||res&&res[0]&&res[0].err;if(err)throw new Error(err);else _util_zerr_js__WEBPACK_IMPORTED_MODULE_13___default().notice("tab:%d tpopup iframe injected",tab_id)}));const create_window=opt=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*(){let url=opt.ext_url+"/popup.html?"+_util_escape_js__WEBPACK_IMPORTED_MODULE_16___default().qs(opt);_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().perr("be_tpopup_create_window",{opt});return yield _bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_20__["default"].create_window({width:600,height:500,url})}));const is_trial_expired=(url,root_url)=>{let rule_country=(get_rule(url)||{}).country;return _bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_19__["default"].is_trial_expired(root_url)&&!_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_14__["default"].is_active()&&!!rule_country};const need_trial_ended=(url,root_url,proxy_country)=>proxy_country&&is_trial_expired(url,root_url)&&!_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_20__["default"].get_site_storage(root_url,"trial.dont_show_ended");const get_suggestion_mode=root_url=>{const site_conf=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().get_site_conf(root_url);const c=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().get_suggestion_conf(site_conf,_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_11__["default"].get("country"));return c&&(c.mode||"by_popular")};const is_rule_enabled=url=>(get_rule(url)||{}).enabled;const need_geo_suggestion=(tab_id,url,root_url)=>{if(!_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_14__["default"].is_active()&&_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_20__["default"].get_site_storage(root_url,"force_trial")){return true}return get_suggestion_mode(root_url)=="always"&&!is_rule_enabled(url)&&!_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_19__["default"].get_trial_active(root_url)&&!is_trial_expired(url,root_url)&&!_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_11__["default"].is_dont_show(root_url,"suggestion")};const need_geo_watermark=(tab_id,url,root_url)=>{const allow_hide=_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_14__["default"].is_active()||_util_util_js__WEBPACK_IMPORTED_MODULE_15___default().get(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_6___default().get("bext_config"),"geo_popup.watermark.allow_hide");return is_rule_enabled(url)&&(!allow_hide||!_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_11__["default"].is_dont_show(root_url,"watermark"))};const need_smart_suggestions=(tab_id,url)=>{const root_url=_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_8___default().get_root_url(url);return _bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_20__["default"].is_vpn_allowed(url,true)&&!_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_17___default().is_google(root_url)&&!_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_20__["default"].get_site_storage(root_url,"force_trial")&&!_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_11__["default"].is_dont_show(root_url,"suggestion")&&!!_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_19__["default"].get_smart_suggestions(root_url)};const need_force_suggestion=(tab_id,url)=>{const root_url=_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_8___default().get_root_url(url);let post_install=E.get("post_install_redirect");post_install=post_install&&_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_8___default().get_root_url(post_install);return _bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_20__["default"].is_vpn_allowed(url,true)&&!_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_17___default().is_google(root_url)&&(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_5___default().is_force_suggestion(tab_id)||root_url==post_install)&&!_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_11__["default"].is_dont_show(root_url,"suggestion")};const need_proxy_error_dialog=tab_id=>_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().proxy_error_ui_enabled("dialog")&&!!_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_9___default().get_tab_load_err(tab_id);const need_watermark_popup=(tab_id,url,proxy_country)=>{if(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_6___default().is_disabled())return false;let root_url=_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_8___default().get_root_url(url);return need_geo_watermark(tab_id,url,root_url)||need_trial_ended(url,root_url,proxy_country)||need_geo_suggestion(tab_id,url,root_url)||need_proxy_error_dialog(tab_id)};const need_stub_rule_popup=(tab_id,url)=>{if(!_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_20__["default"].is_vpn_allowed(url,true)||_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_17___default().is_skip_url(url))return false;const rule=_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_12__.Z.get_stub_rule(tab_id);const root_url=_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_8___default().get_root_url(url);return rule&&!_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_11__["default"].is_dont_show(root_url,"suggestion")};const tpopup_on_create=o=>E.do_tpopup(o.tab);const tpopup_on_updated=o=>E.do_tpopup(o.tab);const tpopup_on_replaced=o=>chrome.tabs.get(o.added,(tab=>E.do_tpopup(tab)));const tpopup_on_removed=o=>o&&E.close_tab_tpopup(o.id);let sent={};const send_trial_perr=(opt,page,re)=>{if(sent[page])return;if(!opt.skip_check&&!re.test(opt.url))return;sent[page]=true;be_util.perr("be_trial_page",{url:opt.url,root_url:opt.root_url,page})};const debug_stats=opt=>{try{const root_url=opt.root_url;if(root_url!="netflix.com")return;if(!be_trial.get_trial_active(root_url)){send_trial_perr({skip_check:true},"visit_no_trial",/.*/);return}send_trial_perr({skip_check:true},"visit_trial",/.*/);send_trial_perr(opt,"browse",/\/browse/i);send_trial_perr(opt,"watch",/\/watch/i);send_trial_perr(opt,"search",/\/search/i);send_trial_perr(opt,"login",/\/login/i)}catch(e){zerr("debug_stats error %o",e)}};const tpopup_msg=(c_id,name,opt)=>{let tab_id=+c_id.split(":")[0];chrome.tabs.sendMessage(tab_id,assign({id:"tpopup."+name,_type:"tpopup",_connection_id:c_id},opt))};E.show=c_id=>{tpopup_msg(c_id,"show")};E.hide=c_id=>{tpopup_msg(c_id,"hide")};E.close=c_id=>{tpopup_msg(c_id,"close")};E.pause_videos=c_id=>{tpopup_msg(c_id,"pause_videos")};E.resume_videos=c_id=>{tpopup_msg(c_id,"resume_videos")};E.hide_arrow_anim=c_id=>{tpopup_msg(c_id,"hide_arrow_anim")};E.show_arrow_anim=(c_id,opt)=>{tpopup_msg(c_id,"show_arrow_anim",opt)};let resize_et={};E.resize=(c_id,opt)=>{if(resize_et[c_id])resize_et[c_id].return();return _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*resize_(){this.finally((()=>delete resize_et[c_id]));resize_et[c_id]=this;tpopup_msg(c_id,"resize",opt);return yield this.wait()}))};E.close_tab_tpopup=tab_id=>{let connections=_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_7___default().tabs.get_tab_connections(tab_id);if(connections)connections.forEach((c_id=>E.close(c_id)));if(connected_tpopups[tab_id])connected_tpopups[tab_id]=false};const on_resize_end=e=>{if(resize_et[e.connection_id])resize_et[e.connection_id].continue()};const enabled_cb=()=>{if(!_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_6___default().is_disabled())return;Object.keys(connected_tpopups).forEach((tab_id=>E.close_tab_tpopup(tab_id)))};const on_trial_end=trial=>{Object.keys(connected_tpopups).forEach((tab_id=>{if(!_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_19__["default"].match_url(trial,_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_5___default().get_url(tab_id)))return;const connections=_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_7___default().tabs.get_tab_connections(tab_id);if(connections)connections.forEach((c_id=>E.pause_videos(c_id)))}))};const on_iframe_disappeared=data=>{if(!_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_19__["default"].is_trial_expired(data.root_url))return;_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_4___default().perr("be_tpopup_trial_end_disappeared",data,{with_log:true})};E.uninit=()=>{if(!E.inited)return;E.inited=0;E.off("resize_end",on_resize_end);E.off("iframe_disappeared",on_iframe_disappeared);E.stopListening()};E.init=()=>{if(E.inited)return;E.inited=1;E.listenTo(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_5___default(),"created",tpopup_on_create);E.listenTo(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_5___default(),"updated",tpopup_on_updated);E.listenTo(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_5___default(),"replaced",tpopup_on_replaced);E.listenTo(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_5___default(),"removed",tpopup_on_removed);E.listenTo(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_6___default(),"change:ext.active change:ext.suspended",enabled_cb);E.listenTo(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_6___default(),"trial_end",on_trial_end);E.on("resize_end",on_resize_end);E.on("iframe_disappeared",on_iframe_disappeared)};E.t={need_watermark_popup,need_force_suggestion,get_tpopup_opt};const __WEBPACK_DEFAULT_EXPORT__=E},9568:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});
// LICENSE_CODE ZON
const __WEBPACK_DEFAULT_EXPORT__=tpopup_opt=>{const b=window.chrome||typeof browser!="undefined"&&browser;const assign=Object.assign;let port,inited=false;let frame,fade,arrow_anim;let{url,type,root_url,connection_id,ext_url,tab_id,country,style,tpopup_parent}=tpopup_opt;let expected_style={};const max_zindex=2147483647;const v3=b.runtime.getManifest().manifest_version==3;const auto_px={width:1,height:1,top:1,left:1,right:1,bottom:1,"max-width":1,"max-height":1,"min-width":1,"min-height":1};const is_number=n=>!isNaN(parseFloat(n))&&isFinite(n);const set_css=(el,css_styles)=>{Object.entries(css_styles).forEach((prop=>{let name=prop[0],value=prop[1];if(value&&is_number(value)&&auto_px[name])value+="px";el.style.setProperty(name,value,"important");if(el==frame)expected_style[name]=value}));return el};const rm_element=el=>el&&el.parentNode&&el.parentNode.removeChild(el);const append_element=el=>frame&&frame.parentNode&&frame.parentNode.appendChild(el);const rm_fade=()=>{rm_element(fade);fade=undefined};const set_fade=show=>{if(!show){if(!fade)return;if(fade.animate){fade.animate([{opacity:"1"},{opacity:"0"}],{duration:300,easing:"ease-in"}).addEventListener("finish",rm_fade)}else rm_fade();return}if(fade)return;fade=set_css(document.createElement("div"),{position:"fixed",border:"none",top:"0",left:"0",width:"100%",height:"100%","background-color":"rgba(0, 0, 0, 0.25)",visibility:"visibile","z-index":max_zindex-1,"backdrop-filter":"blur(2px)"});append_element(fade);if(fade.animate){fade.animate([{opacity:"0"},{opacity:"1"}],{duration:300,easing:"ease-in"})}};const animate=(el,css,time,cb)=>{if(!el.animate){set_css(el,css);if(cb)cb();return}let first=el.getBoundingClientRect();set_css(el,assign({"transform-origin":"top left"},css));let last=el.getBoundingClientRect();let scale_x=first.width/last.width;let scale_y=first.height/last.height;let dx=first.left-last.left;let dy=first.top-last.top;if(!dx&&!dy&&scale_x==1&&scale_y==1)return void cb&&cb();let translate="translate("+dx+"px, "+dy+"px)";let scale="scale("+scale_x+", "+scale_y+")";el.animate([{transform:translate+" "+scale},{transform:"translate(0, 0) scale(1, 1)"}],{duration:time||200,easing:"ease-in"}).addEventListener("finish",(()=>{if(cb)cb()}))};const resize_iframe=opt=>{if(!frame)return;let css={width:opt.width,height:opt.height,margin:opt.margin||""};if(opt.top!==undefined)css.top=opt.top;if(opt.left!==undefined)css.left=opt.left;if(opt.right!==undefined)css.right=opt.right;if(opt.bottom!==undefined)css.bottom=opt.bottom;if(opt.animate)animate(frame,css,opt.animation_time);else set_css(frame,opt);if(opt.fade!==undefined)set_fade(opt.fade)};const show_arrow_anim=opt=>{rm_element(arrow_anim);arrow_anim=set_css(document.createElement("iframe"),assign({position:"fixed",border:"none",overflow:"hidden",visibility:"visibile","z-index":max_zindex,"pointer-events":"none"},opt.css));arrow_anim.setAttribute("src",opt.url);append_element(arrow_anim)};const hide_arrow_anim=()=>{rm_element(arrow_anim);arrow_anim=undefined};const rm_iframe=()=>{try{if(!frame)return;rm_fade();rm_element(frame);frame=undefined;hide_arrow_anim()}catch(e){console.error("rm_iframe error: "+e)}};const get_iframe_parent=()=>{const el=document.fullscreenElement;const parent=tpopup_parent||"documentElement";if(!el||type!="watermark")return document[parent];if(el.tagName=="IFRAME")return el.contentDocument?el.contentDocument.body:document[parent];if(el.shadowRoot)return el.shadowRoot;if(el.tagName=="VIDEO"||el.tagName=="IMG")return document[parent];return el};const must_exit_fullscreen=()=>{let el=document.fullscreenElement;return el&&(el.tagName=="IFRAME"&&!el.contentDocument||frame&&frame.parentElement!=el)};const exit_fullscreen=()=>document.exitFullscreen();const is_playing=video=>{if(video.tagName=="VIDEO")return!video.paused&&!video.ended};const is_paused=video=>{if(video.tagName=="VIDEO")return video.paused&&!video.ended};const play_video=video=>{if(video.tagName=="VIDEO")return void video.play()};const pause_video=video=>{if(video.tagName=="VIDEO")return void video.pause()};const add_iframe=()=>{if(frame)return;if(document.getElementById("_hola_popup_iframe__"))return void console.error("frame already exists");if(!document.body)return void console.error("document not ready");let styles=assign({position:"fixed","max-width":"100%","max-height":"100%","background-color":"transparent","z-index":max_zindex,overflow:"hidden",visibility:"hidden",border:"none",display:"block"},style);frame=document.createElement("iframe");set_css(frame,styles);get_iframe_parent().appendChild(frame);frame.setAttribute("src",ext_url+"/popup.html?tab_id="+tab_id+"&connection_id="+connection_id);frame.setAttribute("id","_hola_popup_iframe__")};const trigger=(name,data)=>b.runtime.sendMessage({type:"be_msg_req",_type:"tpopup",_tab_id:tab_id,context:{rmt:true},msg:{msg:"call_api",obj:"tpopup",func:"trigger",args:[name,assign({tab_id,connection_id},data)]}});const ext_send_msg=msg=>b.runtime.sendMessage({type:"be_msg_req",_type:"tpopup",_tab_id:tab_id,context:{rmt:true},msg:{msg:"call_api",obj:"tpopup",func:"send_tpopup_msg",args:[tab_id,msg]}});const perr=(id,info,perr_opt)=>b.runtime.sendMessage({type:"be_msg_req",_type:"tpopup",_tab_id:tab_id,context:{rmt:true},msg:{msg:"call_api",obj:"tpopup",func:"perr",args:[tab_id,id,assign({root_url,url},info),perr_opt]}});const on_ext_msg=msg=>{if(msg._connection_id!=connection_id)return;switch(msg.id){case"tpopup.init":ext_send_msg({id:"cs_tpopup.init",_type:"tpopup",_connection_id:connection_id,data:{tab_id,connection_id,url,root_url,country,type,fullscreen:!!document.fullscreenElement}});break;case"tpopup.show":set_css(frame,{visibility:"visible"});break;case"tpopup.hide":set_css(frame,{visibility:"hidden"});break;case"tpopup.resize":if(msg.fade&&must_exit_fullscreen())exit_fullscreen();resize_iframe({width:msg.width,height:msg.height,top:msg.top,left:msg.left,right:msg.right,bottom:msg.bottom,fade:msg.fade,animate:msg.animate,animation_time:msg.animation_time,margin:msg.margin});trigger("resize_end");break;case"tpopup.show_arrow_anim":show_arrow_anim({url:ext_url+"/animation_arrow.html?direction="+msg.direction+"&logo_pos="+msg.logo_pos+"&width="+msg.size.width+"&height="+msg.size.height,css:msg.css});break;case"tpopup.hide_arrow_anim":hide_arrow_anim();break;case"tpopup.pause_videos":pause_videos();break;case"tpopup.resume_videos":resume_videos();break;case"tpopup.close":uninit();break}};let paused_videos=[];const pause_videos=()=>{const paused=[];let videos=Array.from(document.querySelectorAll("video"));let iframes=Array.from(document.querySelectorAll("iframe"));iframes.forEach((i=>{if(!i.contentDocument)return;videos=videos.concat(Array.from(i.contentDocument.querySelectorAll("video")))}));videos.forEach((v=>{try{if(!is_playing(v))return;pause_video(v);paused.push(v)}catch(e){perr("geo_trial_ended_pause_video_err",{err:e.message});console.error("pause video error: "+e)}}));if(paused.length)perr("geo_trial_ended_pause_video",{count:paused.length});paused_videos=paused_videos.concat(paused)};const resume_videos=()=>{const resumed=[];paused_videos.forEach((v=>{try{if(!is_paused(v))return;play_video(v);resumed.push(v)}catch(e){perr("geo_trial_ended_resume_video_err",{err:e.message});console.error("play video error: "+e)}}));if(resumed.length)perr("geo_trial_ended_resume_video",{count:resumed.length});paused_videos=[]};const move_frame=parent=>{parent.appendChild(frame);set_css(frame,{visibility:"hidden"})};const on_fullscreen=()=>{const parent=get_iframe_parent();if(frame&&frame.parentElement!==parent)move_frame(parent)};const on_body_mousedown=()=>trigger("body_click");const on_mouseenter=()=>trigger("mouseenter");const on_mouseleave=()=>trigger("mouseleave");let overlapping_int;const start_overlapping_detector=()=>{overlapping_int=setInterval((()=>{if(!frame)return;let el=frame;while(el=el.nextElementSibling){if(+window.getComputedStyle(el).zIndex!=max_zindex)continue;move_frame(frame.parentElement);stop_overlapping_detector();return}}),1e3)};const stop_overlapping_detector=()=>clearInterval(overlapping_int);const is_disappeared=()=>{if(!frame)return false;let expected_hidden=expected_style.visibility=="hidden"||expected_style.display=="none"||Number.parseInt(expected_style.width)==0||Number.parseInt(expected_style.height)==0;if(expected_hidden||window.innerHeight<100||window.innerWidth<100)return false;if(!frame.isConnected)return true;let cstyle=window.getComputedStyle(frame);let rect=frame.getBoundingClientRect();return cstyle.visibility=="hidden"||cstyle.display=="none"||rect.width==0||rect.height==0||rect.x+rect.width<0||rect.y+rect.height<0||rect.x>window.innerWidth||rect.y>window.innerHeight};const cleanup_style=s=>{let temp_el=document.createElement("div");document.body.appendChild(temp_el);let def_style=window.getComputedStyle(temp_el);s=assign({},s);for(let key in s){if(s[key]==""||s[key]==def_style[key])delete s[key]}temp_el.remove();return s};const start_iframe_monitor=()=>{monitor_int=setInterval((()=>{if(!is_disappeared())return;let fs_el=document.fullscreenElement;let info={root_url,removed:!frame.isConnected,style:frame.getAttribute("style"),expected_style,computed_style:cleanup_style(window.getComputedStyle(frame)),rect:frame.getBoundingClientRect(),windown_width:window.innerWidth,window_height:window.innerHeight,fullscreenEl:fs_el&&fs_el.tagName};perr("tpopup_iframe_disappeared",info);trigger("iframe_disappeared",info);stop_iframe_monitor()}),5e3)};let monitor_int;const stop_iframe_monitor=()=>clearInterval(monitor_int);const connect_to_bg=()=>{try{port=b.runtime.connect({name:connection_id})}catch(e){uninit();return}port.onDisconnect.addListener((()=>{port=null;if(v3)setTimeout((()=>connect_to_bg()),100);else uninit()}))};const init=()=>{try{if(inited)return;if(url!=location.href&&!(location.href=="chrome://new-tab-page/"&&url=="chrome://newtab/")){console.error("expected url: "+url+" actual: "+location.href);return}if(!(document instanceof window.HTMLDocument))throw new Error("wrong document type");inited=true;add_iframe();if(!frame)return;if(document.body)document.body.addEventListener("mousedown",on_body_mousedown);frame.addEventListener("mouseenter",on_mouseenter);frame.addEventListener("mouseleave",on_mouseleave);document.addEventListener("fullscreenchange",on_fullscreen);document.addEventListener("webkitfullscreenchange",on_fullscreen);document.addEventListener("mozfullscreenchange",on_fullscreen);start_overlapping_detector();start_iframe_monitor();connect_to_bg();b.runtime.onMessage.addListener(on_ext_msg);window.addEventListener("unload",uninit)}catch(e){return{err:e.message}}return{err:null}};const uninit=()=>{if(!inited)return;paused_videos=[];if(frame){frame.removeEventListener("mouseenter",on_mouseenter);frame.removeEventListener("mouseleave",on_mouseleave)}if(document.body)document.body.removeEventListener("mousedown",on_body_mousedown);rm_iframe();document.removeEventListener("fullscreenchange",on_fullscreen);document.removeEventListener("webkitfullscreenchange",on_fullscreen);document.removeEventListener("mozfullscreenchange",on_fullscreen);stop_overlapping_detector();stop_iframe_monitor();b.runtime.onMessage.removeListener(on_ext_msg);if(port){port.onDisconnect.removeListener(uninit);port.disconnect();port=null}inited=false};return init()}},7666:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var conf__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(9641);var underscore__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(7439);var underscore__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(underscore__WEBPACK_IMPORTED_MODULE_1__);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(6969);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_2__);var _util_etask_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(6386);var _util_etask_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_util_etask_js__WEBPACK_IMPORTED_MODULE_3__);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(9824);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_util_zerr_js__WEBPACK_IMPORTED_MODULE_4__);var _util_date_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(932);var _util_date_js__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(_util_date_js__WEBPACK_IMPORTED_MODULE_5__);var _util_storage_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(8915);var _util_storage_js__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(_util_storage_js__WEBPACK_IMPORTED_MODULE_6__);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(3727);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_7__);var _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(9651);var _bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(4130);var _bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_9__);var _svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(843);var _svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default=__webpack_require__.n(_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_10__);var _svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(8033);var _svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11___default=__webpack_require__.n(_svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11__);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(7345);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default=__webpack_require__.n(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_12__);var _bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(9265);var _bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(6210);var _util_util_js__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(1291);var _util_util_js__WEBPACK_IMPORTED_MODULE_15___default=__webpack_require__.n(_util_util_js__WEBPACK_IMPORTED_MODULE_15__);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(5250);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_16___default=__webpack_require__.n(_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_16__);var _bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(8552);var _bext_vpn_bg_mode_js__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(1002);
// LICENSE_CODE ZON
_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_16___default().assert_bg("be_trial");const assign=Object.assign;const{SEC}=_util_date_js__WEBPACK_IMPORTED_MODULE_5___default().ms;let is_user_updated;const E=new(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_2___default().task_model.extend({model_name:"trial",_defaults:function(){this.on("destroy",(()=>E.uninit()))}}));let perr=(name,info,opt)=>{opt=opt||{};let trial_info=E.get_trial_perr_info();if(trial_info.timeline)opt.filehead=trial_info.timeline+"\n\n"+(opt.filehead||"");_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default().perr(name,assign({cycle_stats:trial_info.cycle_stats,state:trial_info.state},info),opt)};let fetch_trials=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_3___default()((function*fetch_trials_states_(){try{const auth=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_7___default().auth();if(!auth||!auth.uuid||!auth.session_key){log_timeline("missing_session");perr("be_empty_user_session");return}let qs=assign(_svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11___default().get_client_params(),auth,{min_conf_ver:_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default().CG("reset_trial.min_conf_ver")});return yield _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_8__.Z.ccgi_ajax({url:conf__WEBPACK_IMPORTED_MODULE_0__.url_ccgi+"/trial_get3",qs,retry:2,timeout:7*SEC})}catch(e){_util_zerr_js__WEBPACK_IMPORTED_MODULE_4___default().warn("get_trial failed %s",_util_zerr_js__WEBPACK_IMPORTED_MODULE_4___default().e2s(e))}}));let refresh_trials=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_3___default()((function*(){if(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_7___default().get("is_premium"))return;log_timeline("refresh trials");let states=yield fetch_trials();_first_start_ts=_svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11___default().find_first_start_ts(states,_first_start_ts);user_trials=new(_svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11___default().User_trials)(states,_svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11___default().get_client_params());monitor_active_trial()}));let update_active_tab_trial_ui=()=>{let url=_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_9___default().get("active.url");if(!url)return;let root_url=_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default().get_root_url(url);if(!root_url)return;let client_params=_svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11___default().get_client_params(root_url);let trial;if(trial=user_trials.check_ui_conf_change(client_params)){log_timeline(`trial ui change detected: ${root_url}`);_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_7___default().trigger("trial_change",trial.get_obj())}};E.get_watch_time_ms=()=>{if(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default().check_min_install_ver(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default().CG("ext_trial_watch_time_min_ver"))){return _util_storage_js__WEBPACK_IMPORTED_MODULE_6___default().get_int("trial_watch_time_ms")}};const get_active_sites=()=>{let sites={};let urls=Object.values(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_9___default().urls);for(let url of urls){let rules=E.be_rule.get_rules(url);if(!rules.length)continue;let root_url=_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default().get_root_url(url);if(root_url)sites[root_url]=1}return Object.keys(sites)};let cycle_stats;const get_site_stats_obj=(trial,site)=>{const cycle_n=trial.state.cycle_n||0;if(!cycle_stats||cycle_stats.cycle_n!=cycle_n)cycle_stats={cycle_n,sites:{}};if(!cycle_stats.sites[site]){cycle_stats.sites[site]={watching_ms:0,waiting_ms:0,idle_ms:0,interruptions_n:0}}return cycle_stats.sites[site]};const record_site_usage=(trial,site,duration)=>{if(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default().CG("trial_disable_per_site_activity_tracker"))return;let site_stats=get_site_stats_obj(trial,site);if(trial.is_running()){site_stats.watching_ms+=duration;if(site!="total")activation_tracker.count_watch(site,duration)}else{if(trial.is_wait_ended()||trial.can_start_new_cycle())site_stats.idle_ms+=duration;else site_stats.waiting_ms+=duration}};const record_site_interruption=(trial,site)=>{if(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default().CG("trial_disable_per_site_activity_tracker"))return;get_site_stats_obj(trial,site).interruptions_n++};let _trial_monitor;let monitor_active_trial=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_3___default()((function*(){if(_trial_monitor)return;cycle_stats={};log_timeline(`monitor_active_trial start`);E.sp.spawn(_trial_monitor=this);this.finally((()=>{log_timeline(`monitor_active_trial finish`);_trial_monitor=null}));const interval_ms=SEC;let watch_time_ms=E.get_watch_time_ms();let trial_usage=0,ended={},wait_ended={},cleared={},it=0;return yield _util_etask_js__WEBPACK_IMPORTED_MODULE_3___default().interval(interval_ms,(()=>{if(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_7___default().get("is_premium"))return;let active_sites=get_active_sites();if(active_sites.length)active_sites=active_sites.concat("total");update_active_tab_trial_ui();let is_active;for(let tkey in user_trials.trials){let trial=user_trials.trials[tkey];for(let site of active_sites)record_site_usage(trial,site,interval_ms);let trial_obj=trial.get_obj();if(trial.is_running()){if(watch_time_ms!==undefined){_util_storage_js__WEBPACK_IMPORTED_MODULE_6___default().set_json("trial_watch_time_ms",watch_time_ms+=interval_ms)}is_active=true;ended[tkey]=cleared[tkey]=undefined;continue}if(trial.is_wait_ended()){if(!wait_ended[tkey]){log_timeline(`trial_wait_end ${tkey}`);if(!trial_obj.conf.autostart_after_wait)perr("be_trial_cycle_wait_ready",{trial_obj});_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_7___default().trigger("trial_wait_end",trial_obj);wait_ended[tkey]=true}}else wait_ended[tkey]=undefined;if(!ended[tkey]){_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_7___default().trigger("trial_end",trial_obj);let remaining_time=E.get_remaining_cycle_time(trial.state.root_url);log_timeline(`trial_end ${tkey} `+`remaining time ${remaining_time}ms (monitor)`);if(it>0){if(remaining_time>0)perr("be_trial_cycle_wait",{trial_obj});else perr("be_trial_cycle_end",{trial_obj})}perr("be_trial_end",{type:"site",entity:trial.state.root_url});for(let site of active_sites)record_site_interruption(trial,site);ended[tkey]=true}}if(!is_active){if(trial_usage>0)perr("be_trial_usage",{sec:trial_usage});trial_usage=0}if(E.get_trial_active())trial_usage++;it++}))}));let _set_trial_et;E.set_trial=root_url=>_util_etask_js__WEBPACK_IMPORTED_MODULE_3___default()((function*set_trial_(){log_timeline(`set_trial ${root_url}`);this.finally((()=>{_set_trial_et=null}));if(_set_trial_et)yield this.wait_ext(_set_trial_et);let alredy_started=E.get_trial_active(root_url);if(alredy_started)return alredy_started;try{_set_trial_et=this;const auth=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_7___default().auth();if(!auth||!auth.uuid||!auth.session_key){log_timeline("missing_session");perr("be_empty_user_session",{type:"trial_start",root_url});return}const qs=assign(_svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11___default().get_client_params(),auth,{domain:root_url});perr("be_trial_start",{type:"site",entity:root_url});let prev_trial=E.get_trial_active(root_url,true);let res=yield _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_8__.Z.ccgi_ajax({url:conf__WEBPACK_IMPORTED_MODULE_0__.url_ccgi+"/trial_set3",qs,retry:2,timeout:4*SEC});if(!res||!res.key){log_timeline(`set_trial: ${root_url}. empty response`);perr("be_trial_start_no_trial",{type:"site",entity:root_url});return}_first_start_ts=_svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11___default().find_first_start_ts(res.states,_first_start_ts);_skipped_signin_ts=null;user_trials=new(_svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11___default().User_trials)(res.states,_svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11___default().get_client_params());let trial=user_trials.trials[res.key];if(!trial)throw new Error("missing conf during trial start");if(trial.state.interval_n==0){perr("be_trial_cycle_start",{domain:root_url});if(!prev_trial||!prev_trial.start_ts)perr("be_trial_cycle_start_first",{domain:root_url})}perr("be_trial_start_got_trial",{type:"site",entity:root_url,state:trial.state});monitor_active_trial();log_timeline(`set_trial: ${root_url}. start trial`);_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_7___default().trigger("trial_start",trial.get_obj());return trial.get_obj()}catch(e){_util_zerr_js__WEBPACK_IMPORTED_MODULE_4___default().warn("trial_start failed %s",_util_zerr_js__WEBPACK_IMPORTED_MODULE_4___default().e2s(e));log_timeline(`set_trial failed: ${root_url}. ${_util_zerr_js__WEBPACK_IMPORTED_MODULE_4___default().e2s(e)}`);perr("be_trial_start_error",{type:"site",entity:root_url},{err:e});throw new Error(_util_util_js__WEBPACK_IMPORTED_MODULE_15___default().get(e,"hola_info.data.err","unknown"))}}));let trial_reset=(root_url,full_reset)=>_util_etask_js__WEBPACK_IMPORTED_MODULE_3___default()((function*trial_reset_(){log_timeline(`reset_trial ${root_url}`);let user_id=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_7___default().get("user_id");let qs=assign(_svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11___default().get_client_params(),{user_id},_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_7___default().auth());if(full_reset)qs.full_reset=1;else qs.domain=root_url;try{yield _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_8__.Z.ccgi_ajax({url:conf__WEBPACK_IMPORTED_MODULE_0__.url_ccgi+"/trial_reset3",qs});_skipped_signin_ts=null;yield refresh_trials();_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_7___default().trigger("trial_change")}catch(e){_util_zerr_js__WEBPACK_IMPORTED_MODULE_4___default().warn("trial_reset failed %s",_util_zerr_js__WEBPACK_IMPORTED_MODULE_4___default().e2s(e));log_timeline(`trial_reset failed ${root_url} ${_util_zerr_js__WEBPACK_IMPORTED_MODULE_4___default().e2s(e)}`);throw new Error(_util_util_js__WEBPACK_IMPORTED_MODULE_15___default().get(e,"hola_info.data.err","unknown"))}}));E.is_watermark_small=root_url=>user_trials.is_watermark_small(_svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11___default().get_client_params(root_url));E.is_watermark_popcorn=root_url=>user_trials.is_watermark_popcorn(_svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11___default().get_client_params(root_url));E.is_trial_expired=root_url=>user_trials.is_expired(_svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11___default().get_client_params(root_url));E.get_trial_active=(root_url,ignore_ts)=>user_trials.get_trial_active(_svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11___default().get_client_params(root_url),ignore_ts,!_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default().CG("trial_disable_stub_instances_v2"));E.get_trials_info=cur_root_url=>user_trials.get_trials_info(cur_root_url);E.get_next_trial_ts=(root_url,subtract_wait)=>user_trials.get_next_interval_ts(_svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11___default().get_client_params(root_url),subtract_wait);E.get_last_trial_end_ts=root_url=>user_trials.get_last_interval_end_ts(_svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11___default().get_client_params(root_url));E.get_trial_wait=root_url=>user_trials.get_trial_wait(_svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11___default().get_client_params(root_url));E.reset_trial=(root_url,full_reset)=>_util_etask_js__WEBPACK_IMPORTED_MODULE_3___default()((function*(){yield trial_reset(root_url,full_reset);_first_start_ts=null}));E.need_trial=root_url=>user_trials.need_trial(_svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11___default().get_client_params(root_url));E.get_smart_suggestions=root_url=>{if(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default().CG("disable_smart_suggestions"))return;return user_trials.get_smart_suggestions(_svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11___default().get_client_params(root_url))};E.is_unlimited_trial=root_url=>{if(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default().CG("debug.force_plus_mode"))return true;return user_trials.is_unlimited_trial(_svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11___default().get_client_params(root_url))};E.need_ext_pin_tip=root_url=>{if(_util_storage_js__WEBPACK_IMPORTED_MODULE_6___default().get("ext_pin_tip_shown"))return;return user_trials.need_ext_pin_tip(_svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11___default().get_client_params(root_url))};E.shown_ext_pin_tip=root_url=>{_util_storage_js__WEBPACK_IMPORTED_MODULE_6___default().set("ext_pin_tip_shown",_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_17__["default"].now())};E.need_signin=root_url=>user_trials.need_signin(_svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11___default().get_client_params(root_url));E.move_trial_time=(root_url,time,count)=>_util_etask_js__WEBPACK_IMPORTED_MODULE_3___default()((function*(){let user_id=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_7___default().get("user_id");if(!E.get_trial_active(root_url,true))return;log_timeline(`move trial time ${root_url} for ${time}ms count: ${count}`+"(debug)");try{perr("be_trial_move_trial_time",{type:"site",root_url,time,count});let client_params=_svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11___default().get_client_params(root_url);const qs=assign({},client_params,_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_7___default().auth(),{domain:root_url,time,user_id,count});let old_t=user_trials.get_trial(client_params,true);const res=yield _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_8__.Z.ccgi_ajax({method:"POST",url:conf__WEBPACK_IMPORTED_MODULE_0__.url_ccgi+"/move_trial_time3",qs});if(old_t){if(+time)old_t.move_time(+time);else if(+count)old_t.move_count(+count)}user_trials=new(_svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11___default().User_trials)(res.states,_svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11___default().get_client_params());let new_t=user_trials.get_trial(_svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11___default().get_client_params(root_url),true);if(old_t&&new_t)assign(new_t.state,old_t.state,new_t.state);_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_7___default().trigger("trial_change",new_t&&new_t.get_obj())}catch(e){_util_zerr_js__WEBPACK_IMPORTED_MODULE_4___default().warn("move_trial_time failed %s",_util_zerr_js__WEBPACK_IMPORTED_MODULE_4___default().e2s(e));log_timeline(`move_trial_time failed ${_util_zerr_js__WEBPACK_IMPORTED_MODULE_4___default().e2s(e)}`);throw new Error(_util_util_js__WEBPACK_IMPORTED_MODULE_15___default().get(e,"hola_info.data.err","unknown"))}}));E.match_url=(trial_obj,url)=>{if(!trial_obj.conf)return;let root_url=_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default().get_root_url(url);let t=user_trials.get_trial(_svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11___default().get_client_params(root_url),true);return t&&t.get_conf().key==trial_obj.conf.key};E.get_trial_period=root_url=>user_trials.get_interval_dur(_svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11___default().get_client_params(root_url));E.get_total_cycle_time=(root_url,for_wait_screen)=>user_trials.get_total_cycle_time(_svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11___default().get_client_params(root_url),for_wait_screen);E.get_used_cycle_time=(root_url,subtract_current)=>user_trials.get_used_cycle_time(_svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11___default().get_client_params(root_url),subtract_current);E.get_used_trial_time=(root_url,subtract_current)=>user_trials.get_used_trial_time(_svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11___default().get_client_params(root_url),subtract_current);E.is_wait_ended=root_url=>user_trials.is_wait_ended(_svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11___default().get_client_params(root_url));let _set_close_watermark_et;let set_close_watermark=root_url=>_util_etask_js__WEBPACK_IMPORTED_MODULE_3___default()((function*set_close_watermark_(){log_timeline(`set_close_watermark ${root_url}`);this.finally((()=>{_set_close_watermark_et=null}));if(_set_close_watermark_et)yield this.wait_ext(_set_close_watermark_et);try{_set_close_watermark_et=this;const auth=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_7___default().auth();if(!auth||!auth.uuid||!auth.session_key){log_timeline("missing_session");perr("be_empty_user_session",{type:"set_close_watermark",root_url});return}const qs=assign(_svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11___default().get_client_params(),auth,{domain:root_url});perr("be_trial_close_watermark",{type:"site",entity:root_url});let res=yield _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_8__.Z.ccgi_ajax({url:conf__WEBPACK_IMPORTED_MODULE_0__.url_ccgi+"/trial_set_close_watermark",qs});if(!res||!res.key){log_timeline(`set_close_watermark: ${root_url}. empty response`);perr("be_trial_close_watermark_no_trial",{type:"site",entity:root_url});return}user_trials=new(_svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11___default().User_trials)(res.states,_svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11___default().get_client_params());let trial=user_trials.trials[res.key];if(!trial)throw new Error("missing conf during close watermark");log_timeline(`set_close_watermark: ${root_url}. success`);monitor_active_trial();return trial.get_obj()}catch(e){_util_zerr_js__WEBPACK_IMPORTED_MODULE_4___default().warn("set_close_watermark failed %s",_util_zerr_js__WEBPACK_IMPORTED_MODULE_4___default().e2s(e));log_timeline(`set_close_watermark failed: ${root_url} ${_util_zerr_js__WEBPACK_IMPORTED_MODULE_4___default().e2s(e)}`);perr("be_trial_close_watermark_error",{type:"site",entity:root_url},{err:e});throw new Error(_util_util_js__WEBPACK_IMPORTED_MODULE_15___default().get(e,"hola_info.data.err","unknown"))}}));let _start_wait;let start_wait=root_url=>_util_etask_js__WEBPACK_IMPORTED_MODULE_3___default()((function*start_wait_(){log_timeline(`start wait ${root_url}`);this.finally((()=>{_start_wait=null}));if(_start_wait)yield this.wait_ext(_start_wait);try{_start_wait=this;const auth=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_7___default().auth();if(!auth||!auth.uuid||!auth.session_key){log_timeline("missing_session");perr("be_empty_user_session",{type:"trial_start_wait",root_url});return}const qs=assign(_svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11___default().get_client_params(),auth,{domain:root_url});perr("be_trial_close_watermark",{type:"site",entity:root_url});let res=yield _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_8__.Z.ccgi_ajax({url:conf__WEBPACK_IMPORTED_MODULE_0__.url_ccgi+"/trial_start_wait",qs,retry:2,timeout:7*SEC});if(!res||!res.key){log_timeline(`start_wait: ${root_url}. empty response`);perr("be_trial_start_wait_no_trial",{type:"site",entity:root_url});return}user_trials=new(_svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11___default().User_trials)(res.states,_svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11___default().get_client_params());let trial=user_trials.trials[res.key];if(!trial)throw new Error("missing conf during trial_start");log_timeline(`start_wait: ${root_url}. success`);monitor_active_trial();return trial.get_obj()}catch(e){_util_zerr_js__WEBPACK_IMPORTED_MODULE_4___default().warn("start_wait failed %s",_util_zerr_js__WEBPACK_IMPORTED_MODULE_4___default().e2s(e));log_timeline(`start_wait failed: ${root_url} ${_util_zerr_js__WEBPACK_IMPORTED_MODULE_4___default().e2s(e)}`);perr("be_trial_start_wait_error",{type:"site",entity:root_url},{err:e});throw new Error(_util_util_js__WEBPACK_IMPORTED_MODULE_15___default().get(e,"hola_info.data.err","unknown"))}}));E.close_bonus_tooltip=root_url=>{let client_params=_svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11___default().get_client_params(root_url);user_trials.close_bonus_tooltip(client_params);_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_7___default().trigger("trial_change")};E.hide_watermark=root_url=>{let client_params=_svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11___default().get_client_params(root_url);if(!user_trials.can_hide_watermark(client_params))return;set_close_watermark(root_url);user_trials.close_watermark(client_params);_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_7___default().trigger("trial_change");return true};E.is_watermark_hidden=root_url=>user_trials.is_watermark_hidden(_svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11___default().get_client_params(root_url));E.can_hide_watermark=root_url=>user_trials.can_hide_watermark(_svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11___default().get_client_params(root_url));E.skip_signin=root_url=>{let trial=user_trials.get_trial(_svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11___default().get_client_params(root_url));if(trial)trial.skip_signin();else _skipped_signin_ts=_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_17__["default"].now();_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_7___default().trigger("trial_change")};E.can_skip_signin=root_url=>user_trials.can_skip_signin(_svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11___default().get_client_params(root_url));E.get_remaining_cycle_time=root_url=>Math.max(E.get_total_cycle_time(root_url)-E.get_used_cycle_time(root_url),0);E.get_trial_perr_info=()=>({timeline:get_timeline(),state:get_trial_state(),cycle_stats});E.start_wait=root_url=>{let trial=user_trials.get_trial(_svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11___default().get_client_params(root_url));if(!trial)return;if(trial.is_wait_ended()){log_timeline("attempt to start ended wait");_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_7___default().trigger("trial_wait_end",trial.get_obj());return}if(!trial.start_wait(root_url)){log_timeline("no need to start wait");_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_7___default().trigger("trial_wait_end",trial.get_obj());return}start_wait();monitor_active_trial();let trial_obj=trial.get_obj();_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_7___default().trigger("trial_wait_start",trial_obj);if(!trial.get_conf().autostart_after_wait)perr("be_trial_cycle_wait_waiting",{trial_obj})};E.stop_wait=root_url=>{let trial=user_trials.get_trial(_svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11___default().get_client_params(root_url));if(!trial)return;log_timeline("stop wait");trial.stop_wait();_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_7___default().trigger("trial_wait_stop",trial.get_obj())};let _fetch_server_ts=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_3___default()((function*__fetch_server_ts(){log_timeline("fetch new /server_ts");try{yield _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_8__.Z.ccgi_ajax({url:conf__WEBPACK_IMPORTED_MODULE_0__.url_ccgi+"/server_ts"})}catch(e){_util_zerr_js__WEBPACK_IMPORTED_MODULE_4___default().warn("fetch_server_ts failed %s",_util_zerr_js__WEBPACK_IMPORTED_MODULE_4___default().e2s(e))}}));let fetch_server_ts=underscore__WEBPACK_IMPORTED_MODULE_1___default().throttle(_fetch_server_ts,SEC,{trailing:false});let reset_trial_conf;let update_reset_trial=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_3___default()((function*(){let prev=reset_trial_conf;reset_trial_conf=_util_util_js__WEBPACK_IMPORTED_MODULE_15___default().get(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_7___default().get("bext_config"),"reset_trial");if(prev&&reset_trial_conf&&prev.min_conf_ver!=reset_trial_conf.min_conf_ver){log_timeline("reset trial due to conf version change");yield refresh_trials();_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_7___default().trigger("trial_change")}}));let ab_test;E.update_ab_test=()=>{let ref="";let cfg=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default().CG("ab_test");E.set("trial_ref_prefix","");let debug_enabled=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default().CG("debug.ab_test_enable");ab_test=_util_storage_js__WEBPACK_IMPORTED_MODULE_6___default().get_json("ab_test");if(!cfg||!debug_enabled&&(!_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default().check_min_ver(cfg.min_ver)||!_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default().check_min_install_ts(cfg.min_install_ts)||!_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default().check_min_install_ver(cfg.min_install_ver)||!_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default().check_min_tfi(cfg.min_tfi))){if(ab_test){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default().del_hola_org_cookie("ext_ab_test");_util_storage_js__WEBPACK_IMPORTED_MODULE_6___default().clr("ab_test")}E.set("trial_ref_prefix",ref);ab_test=null;return}if(!ab_test||ab_test.ver!=cfg.ver||debug_enabled){const rand=debug_enabled?+_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default().CG("debug.ab_test_rand")||0:Math.random();const value=((cfg.value||[]).find((v=>v[0]<=rand&&rand<v[1]))||[])[2];ab_test={rand,name:cfg.name,ver:cfg.ver,value};_util_storage_js__WEBPACK_IMPORTED_MODULE_6___default().set_json("ab_test",ab_test);perr("be_ab_test_selected");_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default().set_hola_org_cookie("ext_ab_test",JSON.stringify(ab_test))}if(cfg.ref_prefix)ref+=ab_test.name+"_"+ab_test.value+"_";E.set("trial_ref_prefix",ref)};E.get_ab_test_str=()=>ab_test&&JSON.stringify(ab_test);let user_trials=new(_svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11___default().User_trials);let activation_tracker=new(_svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11___default().Activation_tracker);let on_conf_update=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_3___default()((function*(){E.update_ab_test();yield update_reset_trial()}));let _timeline;let init_timeline=()=>{_timeline={log:[]}};let get_timeline=()=>{if(!_timeline||_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default().CG("trial_timeline.disable"))return;return _timeline.log.map((l=>_util_date_js__WEBPACK_IMPORTED_MODULE_5___default().to_sql(l.ts)+": "+l.msg)).join("\n")};let get_trial_state=()=>{if(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default().CG("trial_timeline.disable_perr_state"))return;return E.get_trials_info()};let log_timeline=msg=>{_util_zerr_js__WEBPACK_IMPORTED_MODULE_4___default().notice(msg);if(!_timeline)return;let cfg=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default().CG("trial_timeline",{});if(cfg.disable)return;_timeline.log.push({ts:_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_17__["default"].now(),msg});let max_size=cfg.max_size||500;if(max_size<_timeline.log.length)_timeline.log=_timeline.log.slice(max_size>>1)};let _first_start_ts;let get_first_start_ts=()=>{let min_ts=_first_start_ts;let ts=user_trials.get_first_start_ts(min_ts);if(ts&&(!min_ts||ts<min_ts))min_ts=ts;return min_ts};let _skipped_signin_ts;E.get_param_from_state=param=>{if(param=="first_start_ts")return get_first_start_ts();if(param=="skipped_signin_ts"&&_skipped_signin_ts)return _skipped_signin_ts;let states=user_trials.get_states();for(let key in states){if(states[key][param])return states[key][param]}};E.get_grace_time=trial=>trial.conf.grace_time;E.can_start_trial_silently=root_url=>{if(E.need_signin(root_url)||E.get_trial_wait(root_url))return false;let next_ts=E.get_next_trial_ts(root_url);return!next_ts||next_ts>_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_17__["default"].now()};E.start_trial=root_url=>_util_etask_js__WEBPACK_IMPORTED_MODULE_3___default()((function*(){let trial=E.get_trial_active(root_url)||(yield E.set_trial(root_url));_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_17__["default"].set_site_storage(root_url,"trial",{dont_show_ended:false});return trial}));E.init=(be_rule,be_tpopup,be_tab_unblocker)=>{user_trials=new(_svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11___default().User_trials);activation_tracker=new(_svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11___default().Activation_tracker);init_timeline();E.be_rule=be_rule;E.sp=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_16___default().new_etask("be_trial");_svc_vpn_pub_trial_lib_js__WEBPACK_IMPORTED_MODULE_11___default().init({conf_get:_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default().CG,perr,be_util:_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default(),now:_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_17__["default"].now,get_uuid_md5:_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_17__["default"].get_uuid_md5,be_ext:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_7___default(),be_mode:_bext_vpn_bg_mode_js__WEBPACK_IMPORTED_MODULE_18__.Z,is_user_updated:()=>is_user_updated,must_verify_email:()=>_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_16___default().must_verify_email(_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_13__["default"].get("user")),get_ab_test:()=>ab_test,get_param_from_state:E.get_param_from_state,be_info:_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_14__["default"]});E.listenTo(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_7___default(),"change:session_key",refresh_trials);E.listenTo(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_7___default(),"change:user_id",(()=>{monitor_active_trial()}));E.listen_to(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_7___default(),"change:bext_config",on_conf_update);update_reset_trial();E.update_ab_test();E.listenTo(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_9___default(),"change:active.id on_focused",(()=>{let url=_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_9___default().get_url(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_9___default().get("active.id"));let root_url=_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default().get_root_url(url);if(root_url&&!E.get_trial_active(root_url,true))return;update_active_tab_trial_ui();if(_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_17__["default"].need_date_sync())fetch_server_ts()}));E.listenTo(be_tpopup,"mouseenter body_click",(()=>{if(!E.get_trial_active(null,true))return;if(_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_17__["default"].need_date_sync())fetch_server_ts()}));E.listenTo(_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_13__["default"],"user_updated",(()=>is_user_updated=true));E.listenTo(be_tab_unblocker,"change:activity",underscore__WEBPACK_IMPORTED_MODULE_1___default().debounce((function(){let sites=activation_tracker.flush();if(!sites||_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default().CG("activation_tracker_disable"))return;_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default().perr("be_activation",{sites})}),_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default().CG("activation_tracker_debounce_ms")||60*SEC))};E.uninit=()=>{E.sp.return();E.stopListening()};if(false){}const __WEBPACK_DEFAULT_EXPORT__=E},9370:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var underscore__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(7439);var underscore__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(underscore__WEBPACK_IMPORTED_MODULE_0__);var conf__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(9641);var zon_config__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(4118);var _util_util_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(1291);var _util_util_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_util_util_js__WEBPACK_IMPORTED_MODULE_3__);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(9824);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_util_zerr_js__WEBPACK_IMPORTED_MODULE_4__);var _util_date_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(932);var _util_date_js__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(_util_date_js__WEBPACK_IMPORTED_MODULE_5__);var _util_storage_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(8915);var _util_storage_js__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(_util_storage_js__WEBPACK_IMPORTED_MODULE_6__);var _util_etask_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(6386);var _util_etask_js__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(_util_etask_js__WEBPACK_IMPORTED_MODULE_7__);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(6969);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_8__);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(5250);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_9__);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(7345);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default=__webpack_require__.n(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10__);var _bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(8552);var _bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(4130);var _bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_12___default=__webpack_require__.n(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_12__);var _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(9651);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(3727);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14___default=__webpack_require__.n(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14__);var _bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(8076);var _bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(9265);var _bext_vpn_bg_mitm_js__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(7148);var _bext_vpn_bg_dev_mode_js__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(1679);var _bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(7666);var _bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(3886);var _bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__(5371);var _bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_21___default=__webpack_require__.n(_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_21__);var _bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__(6210);var _bext_vpn_bg_tpopup_js__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__(4968);var _bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_24__=__webpack_require__(737);var _bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_25__=__webpack_require__(1211);var _bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_25___default=__webpack_require__.n(_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_25__);
// LICENSE_CODE ZON
_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_9___default().assert_bg("bg_ui_api");const chrome=self.chrome;const{CG}=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default();const webrtc_policy=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default().browser()=="firefox"?"proxy_only":"disable_non_proxied_udp";const E=new(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_8___default().task_model.extend({model_name:"bg_ui_api",_defaults:function(){this.on("destroy",(()=>E.uninit()))}}));E.init=be_bg_main=>{if(E.inited)return;E.set_enabled=be_bg_main.set_enabled;E.ga_send=be_bg_main.ga_send;E.set_agree_ts=be_bg_main.set_agree_ts;E.debug_set_install_ts=be_bg_main.debug_set_install_ts;E.debug_set_install_ver=be_bg_main.debug_set_install_ver;E.bg_main_recover=()=>void be_bg_main.trigger("recover");_util_storage_js__WEBPACK_IMPORTED_MODULE_6___default().set("ui_popup_render_count",0);const attributes={ext_active:{model:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14___default(),key:"ext.active"},ext_suspended:{model:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14___default(),key:"ext.suspended"},ext_conflict:{model:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14___default(),key:"ext.conflict"},no_permission:{model:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14___default(),key:"no_permission"},is_premium:{model:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14___default()},is_ultra:{model:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14___default()},bext_config:{model:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14___default()},vpn_countries:{model:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14___default()},uuid:{model:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14___default()},user_id:{model:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14___default()},uuid_info:{model:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14___default()},install_ts:{model:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14___default()},install_version:{model:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14___default()},active_tab_url:{model:_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_12___default(),key:"active.url"},active_tab_id:{model:_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_12___default(),key:"active.id"},rules:{model:_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_15__.Z},rule_status:{model:_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_15__.Z,key:"status"},rule_status_opt:{model:_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_15__.Z,key:"status_opt"},user:{model:_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_16__["default"]},membership:{model:_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_16__["default"]},vpn_last_rating:{model:_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_22__["default"]},rate_on_store:{model:_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_22__["default"]},country:{model:_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_22__["default"]},location:{model:_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_22__["default"]},vpn_work_yes:{model:_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_22__["default"]},rate_us_count:{model:E},info_status:{model:_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_22__["default"],key:"status"},dev_mode:{model:_bext_vpn_bg_dev_mode_js__WEBPACK_IMPORTED_MODULE_18__["default"]},vpn_country:{model:_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_24__["default"]},svc_info:{model:_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_24__["default"],key:"info"},svc_version:{model:_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_24__["default"],key:"version"},svc_status:{model:_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_24__["default"],key:"status"},trial_ref_prefix:{model:_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_19__["default"]},vpn_status:{model:_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_20__.Z,key:"status"},bg_main_status:{model:be_bg_main,key:"status"},bg_main_inited:{model:be_bg_main,key:"inited"},enabled:{model:be_bg_main},agree_ts:{model:be_bg_main},hola_conn_hostname:{model:_bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_13__.Z}};Object.keys(attributes).forEach((attr=>{const model=attributes[attr].model;const model_key=attributes[attr].key||attr;E.listen_to(model,"change:"+model_key,(()=>E.set(attr,model.get(model_key))))}));const events=[{model:_bext_vpn_bg_tpopup_js__WEBPACK_IMPORTED_MODULE_23__.Z,event:"body_click"},{model:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14___default(),event:"trial_end"},{model:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14___default(),event:"trial_start"},{model:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14___default(),event:"trial_wait_start"},{model:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14___default(),event:"trial_wait_stop"},{model:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14___default(),event:"trial_wait_end"},{model:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14___default(),event:"trial_change"},{model:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14___default(),event:"mitm_change"},{model:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14___default(),event:"local_time_change"},{model:_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_20__.Z,event:"force_trial"},{model:_bext_vpn_bg_tpopup_js__WEBPACK_IMPORTED_MODULE_23__.Z,event:"mouseleave"},{model:_bext_vpn_bg_tpopup_js__WEBPACK_IMPORTED_MODULE_23__.Z,event:"mouseenter"},{model:_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_12___default(),event:"url_updated",name:"tab_url_updated"},{model:_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_12___default(),event:"change:active.url",name:"active_url_changed"},{model:_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_12___default(),event:"change:active.id",name:"tab_id_changed"},{model:_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_22__["default"],event:"change:country",name:"country_changed"},{model:_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_22__["default"],event:"change:location",name:"location_changed"},{model:be_bg_main,event:"change:enabled",name:"enabled_changed"},{model:be_bg_main,event:"change:inited",name:"bg_main_inited"},{model:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14___default(),event:"change:is_premium change:is_ultra",name:"user_changed"},{model:_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_16__["default"],event:"change:user",name:"user_changed"},{model:_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_16__["default"],event:"change:membership",name:"membership_changed"},{model:_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_15__.Z,event:"change:rules change:tabs_stub_rules",name:"rule_changed"},{model:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14___default(),event:"change:ext.active",name:"ext_active_changed"},{model:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14___default(),event:"change:ext.suspended",name:"ext_suspended_changed"},{model:_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_22__["default"],event:"change:status",name:"status_changed"},{model:_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_22__["default"],event:"change:settings",name:"settings_changed"},{model:_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_15__.Z,event:"change:status set_tab_state",name:"status_changed"},{model:_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_21___default(),event:"change:tab_load_err",name:"tab_load_err"},{model:_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_24__["default"],event:"change:status",name:"status_changed"},{model:_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_20__.Z,event:"change:status",name:"vpn_status_changed"},{model:_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_15__.Z,event:"set_tab_state"},{model:_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_24__["default"],event:"change:info",name:"svc_info_changed"},{model:_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_24__["default"],event:"change:version",name:"svc_version_changed"},{model:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14___default(),event:"change:ext.conflict",name:"ext_conflict_changed"},{model:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14___default(),event:"change:no_permission",name:"no_permission_changed"},{model:be_bg_main,event:"change:agree_ts",name:"agree_ts_changed"},{model:_bext_vpn_bg_dev_mode_js__WEBPACK_IMPORTED_MODULE_18__["default"],event:"change:dev_mode",name:"dev_mode_changed"},{model:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14___default(),event:"change:bext_config",name:"bext_config_changed"}];events.forEach((v=>{E.listenTo(v.model,v.event,((...args)=>{if(v.event.startsWith("change:"))args=[];E.trigger(v.name||v.event,...args)}))}));E.on("popup_open",on_popup_open);_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_25___default().backbone.server.start(E,"bg_ui_api");E.listenTo(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14___default(),"change:is_premium",on_premium_change);E.inited=true};E.uninit=()=>{if(!E.inited)return;E.inited=false;_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_25___default().backbone.server.stop("bg_ui_api");E.stopListening();E.off("popup_open",on_popup_open)};const store_urls={chrome:"https://chrome.google.com/webstore/detail/"+"hola-free-vpn-proxy-unblo/gkojfkhlekighikafcpjkiklfbnlmeio",opera:"https://addons.opera.com/en/extensions/details/"+"hola-better-internet/",firefox:"https://addons.mozilla.org/en-US/firefox/addon/"+"hola-free-vpn-proxy-unblocker/",edge:"https://microsoftedge.microsoft.com/addons/detail/"+"eibinhpjpbkmjeohlclnebmkhdfehpbf"};const review_urls={chrome:store_urls.chrome+"/reviews",opera:store_urls.opera,firefox:store_urls.firefox+"reviews/",edge:store_urls.edge};const get_rate_us_url=()=>{let urls=CG("rate_us.urls");let src_country=(_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_22__["default"].get("country")||"").toUpperCase();if(!urls||!urls.length)urls=[{url:"store",rand:1}];urls=urls.sort(((a,b)=>a.rand-b.rand));let random=Math.random();let browser=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default().browser();for(let item of urls){if(item.countries&&!item.countries.includes(src_country)||item.browsers&&!item.browsers.includes(browser)){continue}if(random>item.rand){random-=item.rand;continue}return item.url=="store"?review_urls[browser]:item.url}};E.open_rate_us=()=>{let url=get_rate_us_url();if(!url)return;_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default().perr("be_open_rate_us",{url});_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_22__["default"].set_rate_on_store(Date.now());E.open_new_tab({url,force_active:true})};E.open_web_store=()=>E.open_new_tab({url:store_urls[_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default().browser()],force_active:true});E.set_rate_us_count=count=>E.set("rate_us_count",count);E.reset_rate_us=_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_22__["default"].reset_rate_us;const on_popup_open=rule=>{_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_21___default().reauth_rule_agents(rule);_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_21___default().reverify_rule_agents(rule);if(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default().CG("debug.force_plus_mode"))_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default().perr("be_debug_plus_popup_open")};const dev_info=()=>{const ext_type=(()=>{const types=underscore__WEBPACK_IMPORTED_MODULE_0___default().invert(conf__WEBPACK_IMPORTED_MODULE_1__.ids);return id=>types[id]})();try{var a=[],manifest;if(chrome&&!(manifest=chrome.runtime.getManifest()).update_url&&!_util_util_js__WEBPACK_IMPORTED_MODULE_3___default().get(manifest,"applications.gecko.update_url")){a.push("no update")}if(chrome&&!conf__WEBPACK_IMPORTED_MODULE_1__.browser.firefox&&!ext_type(chrome.runtime.id))a.push("unknown id");if(zon_config__WEBPACK_IMPORTED_MODULE_2__._RELEASE_LEVEL!=2){if(zon_config__WEBPACK_IMPORTED_MODULE_2__._RELEASE_LEVEL==1)a.push("rel1");if(zon_config__WEBPACK_IMPORTED_MODULE_2__.BUILDTYPE_DEBUG)a.push("debug")}if(conf__WEBPACK_IMPORTED_MODULE_1__.arch)a.push(conf__WEBPACK_IMPORTED_MODULE_1__.arch);return a.join(",")}catch(e){_util_zerr_js__WEBPACK_IMPORTED_MODULE_4___default()("dev_info %s",_util_zerr_js__WEBPACK_IMPORTED_MODULE_4___default().e2s(e))}return""};E.get_product_info=()=>{const build=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default().build_info(),dev=dev_info();const res=[];const add=(name,value)=>{if(value)res.push({name,value})};add("Ext version",build.ext_version||_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default().version());add("WWW version",build.server_version);add("Service",build.svc_version);if(build.svc_mode){let mode=build.svc_mode+" active";if(build.svc_mode_pending)mode+=", "+build.svc_mode_pending+" pending";add("Mode",mode)}add("Product",build.product_type);add("Browser",build.browser);add("Platform",build.platform);add("CID",_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_24__["default"].get("cid_js"));add("UUID",_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14___default().get("uuid"));add("Dev info",dev);return res};E.get_popup_rating_cache=root_url=>{let cache=_util_storage_js__WEBPACK_IMPORTED_MODULE_6___default().get_json("popup_rating_cache");return cache&&root_url==cache.root_url&&cache.rule_ratings||null};E.set_popup_rating_cache=(root_url,rule_ratings)=>_util_storage_js__WEBPACK_IMPORTED_MODULE_6___default().set_json("popup_rating_cache",{rule_ratings,root_url});E.need_upgrade_msg=()=>{if(Date.now()-_util_storage_js__WEBPACK_IMPORTED_MODULE_6___default().get_int("upgrade_msg_ts")<_util_date_js__WEBPACK_IMPORTED_MODULE_5___default().ms.DAY)return false;let browser=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default().browser();let min_ver_all=CG("upgrade_msg.min_ver.all");let min_ver_browser=CG(`upgrade_msg.min_ver.${browser}`);return!!min_ver_all&&!_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default().check_min_ver(min_ver_all)||!!min_ver_browser&&!_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default().check_min_ver(min_ver_browser)};E.click_upgrade=upgrade=>{_util_storage_js__WEBPACK_IMPORTED_MODULE_6___default().set("upgrade_msg_ts",Date.now());if(upgrade)E.open_web_store()};E.init_monitor_active=()=>{let data=_util_storage_js__WEBPACK_IMPORTED_MODULE_6___default().get_json("monitor_active")||{};data.ui_open_ts=Date.now();_util_storage_js__WEBPACK_IMPORTED_MODULE_6___default().set_json("monitor_active",data)};E.uninit_monitor_active=()=>{let data=_util_storage_js__WEBPACK_IMPORTED_MODULE_6___default().get_json("monitor_active")||{};data.ui_close_ts=Date.now();_util_storage_js__WEBPACK_IMPORTED_MODULE_6___default().set_json("monitor_active",data)};E.set_dbg_conf=(path,value)=>{_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_11__["default"].set_dbg_conf(path,value);_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_20__.Z.set_bext_config()};const is_hide_ip_supported=()=>_util_util_js__WEBPACK_IMPORTED_MODULE_3___default().get(chrome,"privacy.network.webRTCIPHandlingPolicy");E.is_hide_ip_active=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_7___default()((function*is_hide_ip_active(){if(!is_hide_ip_supported())return false;let r=yield _util_etask_js__WEBPACK_IMPORTED_MODULE_7___default().cb_apply(chrome.privacy.network.webRTCIPHandlingPolicy,".get",[{}]);return r.value==webrtc_policy}));E.set_hide_ip=value=>_util_etask_js__WEBPACK_IMPORTED_MODULE_7___default()((function*set_hide_ip(){if(!is_hide_ip_supported())return false;yield _util_etask_js__WEBPACK_IMPORTED_MODULE_7___default().cb_apply(chrome.privacy.network.webRTCIPHandlingPolicy,".set",[{value:value?webrtc_policy:"default",scope:chrome.extension.inIncognitoContext?"incognito_session_only":"regular"}]);E.trigger("hide_ip_changed");return value}));const on_premium_change=()=>{if(!_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14___default().get("is_premium")&&E.is_hide_ip_active())E.set_hide_ip(false)};E.focus_on_tab=tab_id=>_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_12___default().update(tab_id,{active:true});E.get_dbg_conf=path=>_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_11__["default"].get_dbg_conf(path);E.get_storage_locale=()=>_util_storage_js__WEBPACK_IMPORTED_MODULE_6___default().get("locale");E.set_storage_locale=locale=>_util_storage_js__WEBPACK_IMPORTED_MODULE_6___default().set("locale",locale);E.trigger_not_working=opt=>void _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_14___default().trigger("not_working",opt);E.fetch_rules=()=>void _bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_15__.Z.trigger("fetch_rules");E.trigger_force_trial=opt=>void _bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_20__.Z.trigger("force_trial",opt);E.bg_vpn_recover=()=>void _bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_20__.Z.trigger("recover");E.open_new_tab=_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_11__["default"].open_new_tab;E.open_be_tab=_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_11__["default"].open_be_tab;E.update_tab=_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_11__["default"].update_tab;E.perr=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default().perr;E.get_log=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_10___default().get_log;E.get_tab_load_err=_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_21___default().get_tab_load_err;E.get_enabled_rule=_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_20__.Z.get_enabled_rule;E.get_disabled_rule=_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_20__.Z.get_disabled_rule;E.send_vpn_work_report=_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_15__.Z.send_vpn_work_report;E.send_fix_it_report=_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_15__.Z.send_fix_it_report;E.set_dont_show_again=_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_22__["default"].set_dont_show_again;E.get_dont_show_rules=_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_22__["default"].get_dont_show_rules;E.is_dont_show=_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_22__["default"].is_dont_show;E.get_rule_ratings=_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_15__.Z.get_rule_ratings;E.fix_vpn=_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_15__.Z.fix_vpn;E.set_rule=_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_15__.Z.set_rule;E.rule_task_cancel_all=_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_15__.Z.task_cancel_all;E.force_bext_config_update=_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_20__.Z.force_bext_config_update;E.stop_vpn=_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_20__.Z.stop_vpn;E.pause_videos=_bext_vpn_bg_tpopup_js__WEBPACK_IMPORTED_MODULE_23__.Z.pause_videos;E.resume_videos=_bext_vpn_bg_tpopup_js__WEBPACK_IMPORTED_MODULE_23__.Z.resume_videos;E.hide_arrow_anim=_bext_vpn_bg_tpopup_js__WEBPACK_IMPORTED_MODULE_23__.Z.hide_arrow_anim;E.show_arrow_anim=_bext_vpn_bg_tpopup_js__WEBPACK_IMPORTED_MODULE_23__.Z.show_arrow_anim;E.close_tab_tpopup=_bext_vpn_bg_tpopup_js__WEBPACK_IMPORTED_MODULE_23__.Z.close_tab_tpopup;E.get_trial_active=_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_19__["default"].get_trial_active;E.set_trial=_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_19__["default"].set_trial;E.get_trial_perr_info=_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_19__["default"].get_trial_perr_info;E.move_trial_time=_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_19__["default"].move_trial_time;E.trial_hide_watermark=_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_19__["default"].hide_watermark;E.close_bonus_tooltip=_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_19__["default"].close_bonus_tooltip;E.is_watermark_hidden=_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_19__["default"].is_watermark_hidden;E.is_watermark_small=_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_19__["default"].is_watermark_small;E.is_watermark_popcorn=_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_19__["default"].is_watermark_popcorn;E.can_hide_watermark=_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_19__["default"].can_hide_watermark;E.get_next_trial_ts=_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_19__["default"].get_next_trial_ts;E.get_last_trial_end_ts=_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_19__["default"].get_last_trial_end_ts;E.can_skip_signin=_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_19__["default"].can_skip_signin;E.get_smart_suggestions=_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_19__["default"].get_smart_suggestions;E.is_unlimited_trial=_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_19__["default"].is_unlimited_trial;E.skip_signin=_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_19__["default"].skip_signin;E.get_trials_info=_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_19__["default"].get_trials_info;E.is_trial_expired=_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_19__["default"].is_trial_expired;E.get_trial_wait=_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_19__["default"].get_trial_wait;E.get_trial_period=_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_19__["default"].get_trial_period;E.get_total_cycle_time=_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_19__["default"].get_total_cycle_time;E.get_used_cycle_time=_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_19__["default"].get_used_cycle_time;E.get_used_trial_time=_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_19__["default"].get_used_trial_time;E.get_remaining_cycle_time=_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_19__["default"].get_remaining_cycle_time;E.is_trial_wait_ended=_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_19__["default"].is_wait_ended;E.need_trial=_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_19__["default"].need_trial;E.trial_need_signin=_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_19__["default"].need_signin;E.reset_trial=_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_19__["default"].reset_trial;E.trial_match_url=_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_19__["default"].match_url;E.trial_start_wait=_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_19__["default"].start_wait;E.trial_stop_wait=_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_19__["default"].stop_wait;E.need_ext_pin_tip=_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_19__["default"].need_ext_pin_tip;E.shown_ext_pin_tip=_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_19__["default"].shown_ext_pin_tip;E.can_start_trial_silently=root_url=>_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_19__["default"].can_start_trial_silently(root_url);E.start_trial=root_url=>_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_19__["default"].start_trial(root_url);E.get_server_ts=_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_11__["default"].now;E.refresh_user=_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_16__["default"].refresh_user;E.refresh_anonymous=_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_16__["default"].refresh_anonymous;E.logout=_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_16__["default"].logout_user;E.resend_verification_email=_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_22__["default"].resend_verification_email;E.open_login_popup=_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_16__["default"].open_login_popup;E.is_verified=_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_22__["default"].is_verified;E.set_vpn_last_rating=_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_22__["default"].set_vpn_last_rating;E.get_redirect_list=_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_12___default().get_redirect_list;E.reload_tab_by_id=_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_12___default().reload;E.get_mitm_rules=_bext_vpn_bg_mitm_js__WEBPACK_IMPORTED_MODULE_17__.Z.get_rules;E.mitm_remove_rule=_bext_vpn_bg_mitm_js__WEBPACK_IMPORTED_MODULE_17__.Z.remove_rule;E.mitm_set_ignore=_bext_vpn_bg_mitm_js__WEBPACK_IMPORTED_MODULE_17__.Z.set_ignore;E.mitm_set_unblock=_bext_vpn_bg_mitm_js__WEBPACK_IMPORTED_MODULE_17__.Z.set_unblock;E.get_mitm_dialog=_bext_vpn_bg_mitm_js__WEBPACK_IMPORTED_MODULE_17__.Z.get_dialog;E.set_login_redirect=_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_22__["default"].set_login_redirect;E.set_email_verify_url=_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_22__["default"].set_email_verify_url;E.get_unblocking_rate_url=_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_22__["default"].get_unblocking_rate_url;E.get_unblocking_rate=_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_22__["default"].get_unblocking_rate;E.set_dev_mode=_bext_vpn_bg_dev_mode_js__WEBPACK_IMPORTED_MODULE_18__["default"].enable;E.update_svc_info=_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_24__["default"].update_info;E.is_paid=_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_16__["default"].is_paid;E.set_enabled_for_browser=_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_20__.Z.set_enabled_for_browser;E.tpopup_is_connected=_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_20__.Z.tpopup_is_connected;E.hola_api_call=_bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_13__.Z.hola_api_call;E.perr_ajax=_bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_13__.Z.perr_ajax;E.show_tpopup=_bext_vpn_bg_tpopup_js__WEBPACK_IMPORTED_MODULE_23__.Z.show;E.close_tpopup=_bext_vpn_bg_tpopup_js__WEBPACK_IMPORTED_MODULE_23__.Z.close;E.resize_tpopup=_bext_vpn_bg_tpopup_js__WEBPACK_IMPORTED_MODULE_23__.Z.resize;E.set_force_suggestion=_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_12___default().set_force_suggestion;E.do_tpopup=_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_20__.Z.do_tpopup;E.vpn_change_agent=_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_24__["default"].vpn_change_agent;E.unblock_action=_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_20__.Z.unblock_action;E.get_force_premium_rules=_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_16__["default"].get_force_premium_rules;E.increment_vpn_work_yes=_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_22__["default"].increment_vpn_work_yes;E.get_tab_state=_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_15__.Z.get_tab_state;E.get_force_premium_rule=_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_16__["default"].get_force_premium_rule;E.is_incognito_allowed=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_7___default().cb_apply(chrome.extension,".isAllowedIncognitoAccess",[]);E.push_event=_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_20__.Z.push_event;E.get_site_storage=_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_11__["default"].get_site_storage;E.set_site_storage=_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_11__["default"].set_site_storage;E.get_tab_url=tab_id=>_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_12___default().get_url(tab_id);E.get_selected_url=opt=>_bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_13__.Z.get_selected_url(opt);E.get_debug_peer_info=_bext_vpn_bg_dev_mode_js__WEBPACK_IMPORTED_MODULE_18__["default"].get_debug_peer_info;E.change_peer=_bext_vpn_bg_dev_mode_js__WEBPACK_IMPORTED_MODULE_18__["default"].change_peer;E.set_has_opened_popup=_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_22__["default"].set_has_opened_popup;E.update_full_browser_vpn_mode=_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_20__.Z.update_full_browser_vpn_mode;E.close_rating_popup=()=>_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_20__.Z.close_rating_popup();E.dev_get=name=>_bext_vpn_bg_dev_mode_js__WEBPACK_IMPORTED_MODULE_18__["default"].get(name);E.dev_set=(name,value)=>_bext_vpn_bg_dev_mode_js__WEBPACK_IMPORTED_MODULE_18__["default"].set(name,value);E.dev_force_tpopup=type=>_bext_vpn_bg_dev_mode_js__WEBPACK_IMPORTED_MODULE_18__["default"].force_tpopup(type);E.get_src_country_excluded=_bext_vpn_bg_vpn_js__WEBPACK_IMPORTED_MODULE_20__.Z.get_src_country_excluded;if(false){}E.t={get_rate_us_url,review_urls};const __WEBPACK_DEFAULT_EXPORT__=E},8552:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var underscore__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(7439);var underscore__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(underscore__WEBPACK_IMPORTED_MODULE_0__);var md5__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(2033);var md5__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(md5__WEBPACK_IMPORTED_MODULE_1__);var _util_util_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(1291);var _util_util_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_util_util_js__WEBPACK_IMPORTED_MODULE_2__);var _util_url_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(5305);var _util_url_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_util_url_js__WEBPACK_IMPORTED_MODULE_3__);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(9824);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_util_zerr_js__WEBPACK_IMPORTED_MODULE_4__);var _util_storage_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(8915);var _util_storage_js__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(_util_storage_js__WEBPACK_IMPORTED_MODULE_5__);var _util_date_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(932);var _util_date_js__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(_util_date_js__WEBPACK_IMPORTED_MODULE_6__);var _util_etask_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(6386);var _util_etask_js__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(_util_etask_js__WEBPACK_IMPORTED_MODULE_7__);var _svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(843);var _svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_8__);var _svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(2227);var _svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_9__);var _bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(1211);var _bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_10___default=__webpack_require__.n(_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_10__);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(7345);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_11___default=__webpack_require__.n(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_11__);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(5250);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_12___default=__webpack_require__.n(_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_12__);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(3727);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_13___default=__webpack_require__.n(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_13__);var conf__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(9641);
// LICENSE_CODE ZON
const E={};const chrome=self.chrome,assign=Object.assign;const{www_host}=conf__WEBPACK_IMPORTED_MODULE_14__;E.is_private_network=(hostname,is_in_net)=>{if(_util_url_js__WEBPACK_IMPORTED_MODULE_3___default().get_top_level_domain(hostname)=="localhost")return true;if(is_in_net&&_util_url_js__WEBPACK_IMPORTED_MODULE_3___default().is_ip(hostname)){if(is_in_net(hostname,"10.0.0.0","255.0.0.0")||is_in_net(hostname,"172.16.0.0","255.240.0.0")||is_in_net(hostname,"192.168.0.0","255.255.0.0")||is_in_net(hostname,"127.0.0.0","255.0.0.0")){return true}}return false};E.is_vpn_allowed=(_url,is_main,is_in_net,rule)=>{let protocol,hostname,url=_util_url_js__WEBPACK_IMPORTED_MODULE_3___default().parse(_url),port=url.port;if(!(protocol=url.protocol)||!(hostname=url.hostname))return false;if(_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_12___default().is_all_browser(rule))return true;if(!hostname.includes("."))return false;const protocols={"http:":1,"https:":1,"wss:":1,"ws:":1};if(!protocols[protocol])return false;if(port&&!{"http:80":1,"https:443":1,"ws:80":1,"wss:443":1}[protocol+port]){return false}if(E.is_private_network(hostname,is_in_net)||_util_url_js__WEBPACK_IMPORTED_MODULE_3___default().is_ip(hostname)&&(is_main||!is_in_net)){return false}return _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_11___default().CG("allow_hola_domain_vpn",true)||!_util_url_js__WEBPACK_IMPORTED_MODULE_3___default().is_hola_domain(hostname)};E.get_root_link=(rule,href)=>href&&_util_url_js__WEBPACK_IMPORTED_MODULE_3___default().add_proto(_util_url_js__WEBPACK_IMPORTED_MODULE_3___default().get_host(href))||rule.link;const add_rule_ratings=opt=>{const proxy_country=opt.proxy_country,rules=opt.rules;const rule_ratings=opt.rule_ratings||[];const groups=opt.groups;const country_ratings=underscore__WEBPACK_IMPORTED_MODULE_0___default().find(rule_ratings,(cr=>cr.proxy_country==proxy_country));if(country_ratings){_util_util_js__WEBPACK_IMPORTED_MODULE_2___default().forEach(country_ratings.rules,(r=>{if(r.rating<=0)return;let r_rule=_util_util_js__WEBPACK_IMPORTED_MODULE_2___default().clone(_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_8___default().find_rule(rules,r)||_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_8___default().find_rule(groups&&groups.unblocker_rules,r));if(!r_rule){r_rule=_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_9___default().gen_rule({name:r.name,type:r.type,country:r.country,supported:true})}let rule=_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_8___default().find_rule(rules,r_rule);if(!rule){if(!r_rule.root_url)return;rule=_util_util_js__WEBPACK_IMPORTED_MODULE_2___default().clone(r_rule);rules.push(rule)}rule.ratings=r}))}rules.forEach((r=>{if(!r.ratings)r.ratings={rating:0,vote_up:0,vote_down:0}}));rules.sort(((r1,r2)=>r1.ratings.rating-r2.ratings.rating>0?-1:1));return rules};E.get_all_rules=opt=>{const proxy_country=opt.proxy_country.toLowerCase();const rule_ratings=opt.rule_ratings;const all_rules=opt.rules,url=opt.url,root_url=opt.root_url;let rules=_util_util_js__WEBPACK_IMPORTED_MODULE_2___default().clone(_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_12___default().get_rules(all_rules,url)||[]);rules=underscore__WEBPACK_IMPORTED_MODULE_0___default().filter(rules,(r=>r.country==proxy_country));rules=add_rule_ratings({proxy_country,rules,root_url,url,rule_ratings,groups:opt.groups});if(!underscore__WEBPACK_IMPORTED_MODULE_0___default().find(rules,(r=>r.type=="url"&&r.name==root_url&&r.md5!="premium"))){rules.push(_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_9___default().gen_rule({name:root_url,mitm:opt.mitm,country:proxy_country,supported:true,ratings:{rating:0,vote_up:0,vote_down:0}}))}return rules};const open_tab=opt=>{const create_tab=url=>chrome.tabs.create({url,active:!!opt.force_active});const url=opt.url;if(opt.force_new)return create_tab(url);chrome.tabs.query(assign({lastFocusedWindow:true},opt.tab_match),(tabs=>{if(!tabs||!tabs.length)return create_tab(url);if(opt.exclude_re&&opt.exclude_re.exec(tabs[0].url)){chrome.tabs.create({url,active:opt.force_active||false});return chrome.tabs.reload(tabs[0].id)}chrome.tabs.update(tabs[0].id,{url,active:true},(tab=>{if(!tab)create_tab(url)}))}))};E.update_tab=(tab_id,url)=>chrome.tabs.update(tab_id,{url,active:true});E.open_new_tab=opt=>{const _opt=_util_util_js__WEBPACK_IMPORTED_MODULE_2___default().clone(opt);_opt.force_new=1;return open_tab(_opt)};E.open_hola_tab=opt=>{const _opt=_util_util_js__WEBPACK_IMPORTED_MODULE_2___default().clone(opt);const www_host_esc=www_host.replace(/\./g,"\\.");_opt.tab_match=chrome?{url:"*://"+www_host+"/*"}:{url_re:"^https?:\\/\\/"+www_host_esc+"\\/"};_opt.exclude_re=new RegExp(www_host_esc+"/access/([^/]*)/using/vpn-"+"([^?/]*)$","gi");if(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_11___default().browser()=="chrome"){_opt.tab_match.url=[_opt.tab_match.url,"*://chrome.google.com/*/"+chrome.runtime.id+"*"]}return open_tab(_opt)};E.open_be_tab=opt=>{opt=_util_util_js__WEBPACK_IMPORTED_MODULE_2___default().clone(opt);const url=chrome.runtime.getURL("").slice(0,-1);opt.tab_match={url:url+"/*"};if(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_11___default().browser()!="firefox")opt.url="js/"+opt.url;return open_tab(opt)};E.Rules_set=class Rules_set{constructor(host,invert){this._data={};this._invert=!!invert;if(!host)return;this.add(host);let id,sets_map=_util_storage_js__WEBPACK_IMPORTED_MODULE_5___default().get_json("be_rules_sets")||{};if(!(id=sets_map[host]))return;Object.entries(sets_map).forEach((e=>{if(e[1]==id)this.add(e[0])}))}add(host){if(!host)return;this._data[host]=1}to_array(){let data=this._data;return Object.keys(data).filter((k=>data[k]))}save(){let sets_map=_util_storage_js__WEBPACK_IMPORTED_MODULE_5___default().get_json("be_rules_sets")||{};let id=+_util_date_js__WEBPACK_IMPORTED_MODULE_6___default()();Object.keys(this._data).forEach((host=>{if(!!this._data[host]^this._invert)sets_map[host]=id;else delete sets_map[host]}));_util_storage_js__WEBPACK_IMPORTED_MODULE_5___default().set_json("be_rules_sets",sets_map)}};E.tabid2api=tabid=>{if(chrome&&typeof tabid=="string")tabid=+tabid;return tabid};E.upgrade_ext=function upgrade_ext(){_util_zerr_js__WEBPACK_IMPORTED_MODULE_4___default().notice("upgrade_ext");if(!_util_util_js__WEBPACK_IMPORTED_MODULE_2___default().get(chrome,"runtime.requestUpdateCheck"))return;chrome.runtime.requestUpdateCheck((status=>_util_zerr_js__WEBPACK_IMPORTED_MODULE_4___default().notice("update check: "+status)))};const storage_get_fn=area=>items=>_util_etask_js__WEBPACK_IMPORTED_MODULE_7___default()((function*_storage_get_fn(){try{const data=yield _util_etask_js__WEBPACK_IMPORTED_MODULE_7___default().cb_apply(chrome.storage[area],".get",[items]);if(_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_10___default().runtime.last_error)storage_err("storage_"+area+"_get",items,_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_10___default().runtime.last_error);return data||{}}catch(e){storage_err("storage_"+area+"_get_catch",items,e)}}));const storage_set_fn=area=>items=>_util_etask_js__WEBPACK_IMPORTED_MODULE_7___default()((function*_storage_set_fn(){try{yield _util_etask_js__WEBPACK_IMPORTED_MODULE_7___default().cb_apply(chrome.storage[area],".set",[items]);if(_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_10___default().runtime.last_error)storage_err("storage_"+area+"_set",items,_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_10___default().runtime.last_error);return items}catch(e){storage_err("storage_"+area+"_set_catch",items,e)}}));const storage_remove_fn=area=>items=>_util_etask_js__WEBPACK_IMPORTED_MODULE_7___default()((function*_storage_remove_fn(){yield _util_etask_js__WEBPACK_IMPORTED_MODULE_7___default().cb_apply(chrome.storage[area],".remove",[items]);if(_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_10___default().runtime.last_error)storage_err("storage_"+area+"_remove",items,_bext_pub_browser_js__WEBPACK_IMPORTED_MODULE_10___default().runtime.last_error)}));let perr_sent;const storage_err=(name,items,err)=>{const s=_util_util_js__WEBPACK_IMPORTED_MODULE_2___default().get(err,"message");const msg=name+" "+_util_zerr_js__WEBPACK_IMPORTED_MODULE_4___default().json(items)+" failed "+s+" "+(err&&err.stack);if(!perr_sent){perr_sent=true;const id=s=="The browser is shutting down."?"storage_browser_shutdown":"storage_lib_err";_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_11___default().perr(id,{name,items,err_str:err instanceof Error?_util_zerr_js__WEBPACK_IMPORTED_MODULE_4___default().e2s(err):_util_zerr_js__WEBPACK_IMPORTED_MODULE_4___default().json(err)},{err})}_util_zerr_js__WEBPACK_IMPORTED_MODULE_4___default()(msg);throw new Error(msg)};let _uuid_md5;E.get_uuid_md5=()=>{let uuid=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_13___default().get("uuid");if(!uuid)return;if(!_uuid_md5||_uuid_md5.uuid!=uuid)_uuid_md5={uuid,md5:md5__WEBPACK_IMPORTED_MODULE_1___default()(uuid)};return _uuid_md5.md5};E.storage_local_get=storage_get_fn("local");E.storage_local_set=storage_set_fn("local");E.storage_local_remove=storage_remove_fn("local");E.get_site_storage=(root_url,path,def)=>{const key=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_11___default().get_site_key(root_url)||root_url;const data=_util_storage_js__WEBPACK_IMPORTED_MODULE_5___default().get_json("site_storage")||{};return _util_util_js__WEBPACK_IMPORTED_MODULE_2___default().get(data[key],path,def)};E.set_site_storage=(root_url,path,val)=>{const key=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_11___default().get_site_key(root_url)||root_url;const data=_util_storage_js__WEBPACK_IMPORTED_MODULE_5___default().get_json("site_storage")||{};data[key]=data[key]||{};_util_util_js__WEBPACK_IMPORTED_MODULE_2___default().set(data[key],path,val);_util_storage_js__WEBPACK_IMPORTED_MODULE_5___default().set_json("site_storage",data)};E.set_dbg_conf=(path,value)=>{const _conf=_util_storage_js__WEBPACK_IMPORTED_MODULE_5___default().get_json("hola_conf")||{};_util_util_js__WEBPACK_IMPORTED_MODULE_2___default().set(_conf,path,value);_util_storage_js__WEBPACK_IMPORTED_MODULE_5___default().set_json("hola_conf",_conf)};E.get_dbg_conf=path=>_util_util_js__WEBPACK_IMPORTED_MODULE_2___default().get(_util_storage_js__WEBPACK_IMPORTED_MODULE_5___default().get_json("hola_conf"),path);const status_regex=/^HTTP\/(\d\.\d) (0|\d{3})( (.*))?$/;E.http_status_to_node=(code,line)=>{let n=(line||"").match(status_regex);if(!n){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_11___default().perr("bad_status_line",{code,line},{rate_limit:{count:2}});n=[null,"1.1",code," ",""]}return{httpVersion:n[1],statusCode:+n[2]||0,reasonPhrase:n[4]||"",headers:{}}};E.nodify_res=details=>{let ret=E.http_status_to_node(details.statusCode,details.statusLine);if(!details.responseHeaders)return ret;try{details.responseHeaders.forEach((hdr=>{ret.headers[hdr.name.toLowerCase()]=hdr.value}))}catch(e){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_11___default().perr("response_headers_error",{statusLine:details.statusLine,url:details.url,method:details.method,statusCode:details.statusCode},{rate_limit:{count:2}})}return ret};E.Bw_perr_acc=class Bw_perr_acc{constructor(){this.data={}}_send(bw_rule,acc){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_11___default().perr("req_bw",{len:acc.len,ms:acc.ms,bw:acc.len*1e3/acc.ms,id:acc.id,country:acc.rule&&acc.rule.country,agent:acc.agent});delete this.data[acc.id]}push(bw_rule,req){const agent=_util_util_js__WEBPACK_IMPORTED_MODULE_2___default().get(req,"agent.host");const id=bw_rule.id+(bw_rule.sid?"_"+bw_rule.sid:"");let acc=this.data[id];if(acc&&acc.rule!=req.opt.rule)this._send(bw_rule,acc);acc=this.data[id]=this.data[id]||{len:0,ms:0,rule:req.opt.rule,agent,id};acc.len+=+req.proxy_resp.len||0;acc.ms+=Date.now()-req.start_ts;if(acc.len>(bw_rule.sample_size||10*1024*1024)||acc.agent!=agent||bw_rule.sid){this._send(bw_rule,acc)}}};E.create_window=({url,width,height})=>_util_etask_js__WEBPACK_IMPORTED_MODULE_7___default()((function*(){let cur_win=yield _util_etask_js__WEBPACK_IMPORTED_MODULE_7___default().cb_apply(chrome.windows,".getCurrent",[]);if(!cur_win)return;if(cur_win.state=="fullscreen"&&_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_11___default().os_mac()){yield _util_etask_js__WEBPACK_IMPORTED_MODULE_7___default().cb_apply(chrome.windows,".update",[cur_win.id,{state:"normal"}]);yield _util_etask_js__WEBPACK_IMPORTED_MODULE_7___default().sleep(1e3);cur_win=yield _util_etask_js__WEBPACK_IMPORTED_MODULE_7___default().cb_apply(chrome.windows,".getCurrent",[])}let opt={url,top:Math.round((cur_win.height-height)/2+cur_win.top),left:Math.round((cur_win.width-height)/2+cur_win.left),width,height,type:"popup",state:"normal"};if(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_11___default().browser()!="firefox")opt.focused=true;return yield _util_etask_js__WEBPACK_IMPORTED_MODULE_7___default().cb_apply(chrome.windows,".create",[opt])}));let _date;E.now=()=>{if(!_date||!_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_11___default().check_min_ver(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_11___default().CG("use_server_ts_min_ver")))return Date.now();return Math.round(performance.now())+_date.perf_diff};E.update_ts=server_ts=>{if(!E.need_date_sync(server_ts))return;let local_ts=Math.round(performance.now());let perf_diff=server_ts-local_ts;let prev_perf_diff=_date&&_date.perf_diff;_date={server_ts,local_ts,perf_diff,date_diff:server_ts-Date.now()};if(!prev_perf_diff||50<Math.abs(_date.perf_diff-prev_perf_diff))_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_13___default().trigger("local_time_change",server_ts)};E.check_conf_ver=conf_ver=>{if(conf_ver==_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_11___default().CG("version"))return;if(!_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_11___default().CG("disable_conf_ver_update"))_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_13___default().trigger("conf_ver_change",conf_ver)};E.need_date_sync=server_ts=>{if(!_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_11___default().check_min_ver(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_11___default().CG("use_server_ts_min_ver")))return;if(!_date)return true;if(server_ts)return 1e3<Math.abs(server_ts-E.now());let date_diff=E.now()-Date.now();return 1e3<Math.abs(_date.date_diff-date_diff)};const __WEBPACK_DEFAULT_EXPORT__=E},3886:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var underscore__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(7439);var underscore__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(underscore__WEBPACK_IMPORTED_MODULE_0__);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(6969);var _bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1__);var _util_etask_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(6386);var _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_util_etask_js__WEBPACK_IMPORTED_MODULE_2__);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(3727);var _bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3__);var _util_util_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(1291);var _util_util_js__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_util_util_js__WEBPACK_IMPORTED_MODULE_4__);var _util_array_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(6545);var _util_array_js__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(_util_array_js__WEBPACK_IMPORTED_MODULE_5__);var _util_rand_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(4135);var _util_rand_js__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(_util_rand_js__WEBPACK_IMPORTED_MODULE_6__);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(7345);var _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7__);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(9824);var _util_zerr_js__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(_util_zerr_js__WEBPACK_IMPORTED_MODULE_8__);var _bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(8076);var _bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(6210);var _bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(4130);var _bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_11___default=__webpack_require__.n(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_11__);var _svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(843);var _svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default=__webpack_require__.n(_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_12__);var _bext_vpn_bg_tpopup_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(4968);var _util_url_js__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(5305);var _util_url_js__WEBPACK_IMPORTED_MODULE_14___default=__webpack_require__.n(_util_url_js__WEBPACK_IMPORTED_MODULE_14__);var _bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(5371);var _bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_15___default=__webpack_require__.n(_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_15__);var _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(9651);var _util_storage_js__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(8915);var _util_storage_js__WEBPACK_IMPORTED_MODULE_17___default=__webpack_require__.n(_util_storage_js__WEBPACK_IMPORTED_MODULE_17__);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(5250);var _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_18___default=__webpack_require__.n(_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_18__);var _bext_vpn_util_no_log_js__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(2181);var _util_date_js__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(932);var _util_date_js__WEBPACK_IMPORTED_MODULE_20___default=__webpack_require__.n(_util_date_js__WEBPACK_IMPORTED_MODULE_20__);var _bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__(737);var _bext_vpn_bg_pac_js__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__(7957);var _bext_vpn_bg_mode_js__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__(1002);var _bext_vpn_bg_tab_perr_js__WEBPACK_IMPORTED_MODULE_24__=__webpack_require__(228);var _bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_25__=__webpack_require__(9265);var _svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_26__=__webpack_require__(2227);var _svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_26___default=__webpack_require__.n(_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_26__);var _bext_vpn_bg_force_lib_js__WEBPACK_IMPORTED_MODULE_27__=__webpack_require__(7310);var _bext_vpn_bg_force_lib_js__WEBPACK_IMPORTED_MODULE_27___default=__webpack_require__.n(_bext_vpn_bg_force_lib_js__WEBPACK_IMPORTED_MODULE_27__);var _protocol_pub_countries_js__WEBPACK_IMPORTED_MODULE_28__=__webpack_require__(3958);var _protocol_pub_countries_js__WEBPACK_IMPORTED_MODULE_28___default=__webpack_require__.n(_protocol_pub_countries_js__WEBPACK_IMPORTED_MODULE_28__);var _bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_29__=__webpack_require__(7666);var _bext_vpn_bg_mitm_js__WEBPACK_IMPORTED_MODULE_30__=__webpack_require__(7148);var _bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_31__=__webpack_require__(8552);var _bext_vpn_bg_dev_mode_js__WEBPACK_IMPORTED_MODULE_32__=__webpack_require__(1679);var conf__WEBPACK_IMPORTED_MODULE_33__=__webpack_require__(9641);
// LICENSE_CODE ZON
_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_18___default().assert_bg("be_vpn");function get_bg_main(){return self.be_bg_main}let chrome=self.chrome,assign=Object.assign;const v3=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default().is_v3;const E=new(_bext_pub_backbone_js__WEBPACK_IMPORTED_MODULE_1___default().model.extend({tabs:{},active_tab_id:0,unblocked_urls:{},history:{},_defaults:function(){this.on("destroy",(()=>E.uninit()))}}));var active_tab_timer_ms=_util_date_js__WEBPACK_IMPORTED_MODULE_20___default().ms.HOUR;E.be_tab_unblocker=_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_15___default();let{SEC}=_util_date_js__WEBPACK_IMPORTED_MODULE_20___default().ms;function is_stub_unblock(domain){return domain&&(!_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_25__["default"].is_active()&&_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_18___default().is_google(domain)||_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_18___default().is_skip_url(_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_18___default().root2url(domain)))}function on_lib_event(o){switch(o.id){case"set_agent_key":_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().set("agent_key",o.data);break;case"before_rule_set":if(!is_stub_unblock(o.data)&&o.data!="all_browser")clean_cookies(o.data);if(_util_util_js__WEBPACK_IMPORTED_MODULE_4___default().get(chrome,"webRequest.handlerBehaviorChanged"))chrome.webRequest.handlerBehaviorChanged();break}}function get_root_urls(root_url){var site,root_urls=[root_url];if(!(site=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default().get_site_conf(root_url))||!site.root_url)return root_urls;for(var i=0;i<site.root_url.length;i++){if(root_url!=site.root_url[i])root_urls.push(site.root_url[i])}return root_urls}function clean_cookies(domain){if(!_util_util_js__WEBPACK_IMPORTED_MODULE_4___default().get(chrome,"cookies.getAll")||!_util_util_js__WEBPACK_IMPORTED_MODULE_4___default().get(chrome,"cookies.remove")){return}var site;if((site=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default().get_site_conf(domain))&&site.keep_cookies)return;E.sp.spawn(_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*clean_cookies_domain_(){const domains=get_root_urls(domain);let cookies=yield _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default().all(domains.map((v=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default().cb_apply(chrome.cookies.getAll,[{domain:v}]))));cookies=_util_array_js__WEBPACK_IMPORTED_MODULE_5___default().flatten_shallow(cookies||[]);cookies.forEach((cookie=>{if(!cookie)return;chrome.cookies.remove({name:cookie.name,url:(cookie.secure?"https":"http")+"://"+cookie.domain+cookie.path})}))})));E.sp.spawn(_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*clean_cookies_all_(){let cookies=yield _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default().all([_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default().cb_apply(chrome.cookies.getAll,[{name:"DS"}]),_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default().cb_apply(chrome.cookies.getAll,[{name:"DE2"}])]);cookies=_util_array_js__WEBPACK_IMPORTED_MODULE_5___default().flatten_shallow(cookies);const filtered=underscore__WEBPACK_IMPORTED_MODULE_0___default().filter(cookies,(cookie=>cookie&&/^\.g[a-z]{1}\.com$/.test(cookie.domain)));filtered.forEach((cookie=>{chrome.cookies.remove({url:"http://yep"+cookie.domain,name:cookie.name})}));if(filtered.length){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default().perr("be_clean_cookies2",{rule:domain,cookies:filtered.map((c=>underscore__WEBPACK_IMPORTED_MODULE_0___default().pick(c,"domain","name","path")))},{rate_limit:{count:1}})}})))}const on_premium_change=()=>{const tasks=_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_26___default().set_user_plus(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().get("is_premium"));if(_util_util_js__WEBPACK_IMPORTED_MODULE_4___default().get(tasks,"length")&&E.active_tab_id)_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_11___default().reload(E.active_tab_id)};function CG(id,def){return _util_util_js__WEBPACK_IMPORTED_MODULE_4___default().get(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().get("bext_config"),id,def)}function uninit_unblocker_lib(){_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_26___default().uninit();_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_26___default().off("lib_event",on_lib_event);init_unblocker_lib.inited=false;E.stopListening(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default(),"change:is_premium",on_premium_change)}const init_unblocker_lib=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*_init_unblocker_lib(){if(init_unblocker_lib.inited)return;init_unblocker_lib.inited=true;_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_26___default().on("lib_event",on_lib_event);yield _svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_26___default().init({be_dev_mode:_bext_vpn_bg_dev_mode_js__WEBPACK_IMPORTED_MODULE_32__["default"],perr:(opt,err)=>err?_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default().perr(opt.id,opt.info,assign({err},opt)):_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default().perr(opt.id,opt.info,opt),ajax:_bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_16__.Z.ajax,ajax_via_proxy:_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_15___default().ajax_via_proxy,storage:{get:id=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*get(){let ret;try{ret=yield _bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_31__["default"].storage_local_get(id)}catch(e){}return ret&&ret[id]})),set:(id,val)=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*set(){try{yield _bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_31__["default"].storage_local_set({[id]:val})}catch(e){}}))},conf_get:(id,def)=>{var v=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().get(id);return/^gen\./.test(id)?v!==undefined?v:def:CG(id,def)},get_auth:()=>_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().auth({is_premium:+!!_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().get("is_premium")}),get_prod_info:()=>_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default().qs_ajax({uuid:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().get("uuid")}),get_user_info:()=>({hola_uid:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().get("hola_uid"),country:(_util_util_js__WEBPACK_IMPORTED_MODULE_4___default().get(_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_10__["default"].get("location"),"country")||"").toLowerCase()}),suspend_client:permanent=>get_bg_main().suspend_client(permanent),get_verify_url:(agent,force_ip)=>{let res;if(_bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_16__.Z.need_agent_domain_fallback()){res="https://"+_bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_16__.Z.get_agent_fallback_host(agent.host)}else if(force_ip||_bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_16__.Z.is_agent_fallback())res="http://"+agent.ip;else res="https://"+agent.host;return res+":"+agent.port+"/verify_proxy"},get_rule_routes:rule=>{let routes=[],s=_util_util_js__WEBPACK_IMPORTED_MODULE_4___default().pick(rule,"country");let route=_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_15___default().get_rule_route(rule);routes.push(s);if(route.pool||rule.pool)routes.push(assign({pool:route.pool||rule.pool},s));return routes},get_fallback_agent:country=>{let a;if(!(a=_util_util_js__WEBPACK_IMPORTED_MODULE_4___default().get(conf__WEBPACK_IMPORTED_MODULE_33__,"fallback_agents.agents"))||!a.length)return;a=_util_rand_js__WEBPACK_IMPORTED_MODULE_6___default().rand_element(a);return{host:a.name+".hola.org",port:25500,ip:a.ip,port_list:conf__WEBPACK_IMPORTED_MODULE_33__.fallback_agents.ports,is_fallback:true}},is_proxy_auth_supported:()=>conf__WEBPACK_IMPORTED_MODULE_33__.type=="cws"||_util_util_js__WEBPACK_IMPORTED_MODULE_4___default().is_mocha(),proxy_preauth:v3,get_auth_url:agent=>{let host=_bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_16__.Z.need_agent_domain_fallback()?_bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_16__.Z.get_agent_fallback_host(agent.host):agent.host;return`https://${host}:${agent.port}/auth`}});E.listenTo(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default(),"change:is_premium",on_premium_change)}));E.uninit=function(){if(!E.get("inited"))return;E.sp.return();status_cb.timer=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_18___default().clear_timeout(status_cb.timer);E.off("recover",on_recover);_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().off("change:is_premium",set_gen_conf_cb);proxy_settings_monitor.uninit();monitor_active_uninit();monitor_sites_uninit();uninit_unblocker_lib();update_vpn_countries.et=bext_config_init.et=bext_ping.et=undefined;if(_util_util_js__WEBPACK_IMPORTED_MODULE_4___default().is_mocha()){E.be_tpopup.uninit();_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_9__.Z.uninit();_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_15___default().uninit();_bext_vpn_bg_tab_perr_js__WEBPACK_IMPORTED_MODULE_24__.Z.uninit();_bext_vpn_bg_pac_js__WEBPACK_IMPORTED_MODULE_22__["default"].uninit();_bext_vpn_bg_mitm_js__WEBPACK_IMPORTED_MODULE_30__.Z.uninit();E.be_svc.uninit();E.be_mode.uninit();E.be_info.uninit()}else{E.be_tpopup._destroy();_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_9__.Z._destroy();_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_15___default()._destroy();_bext_vpn_bg_tab_perr_js__WEBPACK_IMPORTED_MODULE_24__.Z._destroy();_bext_vpn_bg_pac_js__WEBPACK_IMPORTED_MODULE_22__["default"]._destroy();if(!v3)_bext_vpn_bg_mitm_js__WEBPACK_IMPORTED_MODULE_30__.Z._destroy();E.be_svc._destroy();E.be_mode._destroy();E.be_info._destroy()}E.stopListening();E.clear()};var proxy_settings_monitor={};proxy_settings_monitor.init=function(){if(this.inited||!chrome||conf__WEBPACK_IMPORTED_MODULE_33__.firefox_web_ext||_util_util_js__WEBPACK_IMPORTED_MODULE_4___default().is_mocha())return;this.inited=true;try{chrome.proxy.settings.get({},this.changed_cb);chrome.proxy.settings.onChange.addListener(this.changed_cb)}catch(err){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default().perr("proxy_settings_init_err",{},{err,rate_limit:{count:1}})}};proxy_settings_monitor.uninit=function(){if(!this.inited)return;try{chrome.proxy.settings.onChange.removeListener(this.changed_cb)}catch(err){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default().perr("proxy_settings_uninit_err",{},{err,rate_limit:{count:1}})}};proxy_settings_monitor.changed_cb=function(details){if(!details)return _util_zerr_js__WEBPACK_IMPORTED_MODULE_8___default()("proxy_changed no details");var conflict=details.levelOfControl=="controlled_by_other_extensions";_util_zerr_js__WEBPACK_IMPORTED_MODULE_8___default()[conflict?"err":"debug"]("proxy changed: %s control: %s",!details.value.pacScript||details.value.pacScript.url?_util_zerr_js__WEBPACK_IMPORTED_MODULE_8___default().json(details.value):"pacScript-data",details.levelOfControl);let prev=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().get("ext.conflict");_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().set({"proxy.effective.control_level":details.levelOfControl,"proxy.effective.value":details.value,"ext.conflict":conflict});if(!!prev==!!conflict)return;_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default().perr(conflict?"ext_conflict":"ext_conflict_resolved",{proxy_level:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().get("proxy.effective.control_level"),proxy_value:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().get("proxy.effective.value")},{rate_limit:{count:1,ms:_util_date_js__WEBPACK_IMPORTED_MODULE_20___default().ms.DAY}})};function on_recover(){if(E.get("need_recover"))return;E.set("need_recover",true);status_cb()}function update_state(){let is_enabled=!_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().is_disabled();if(is_enabled==E.is_enabled)return;E.is_enabled=is_enabled;if(!is_enabled){if(update_vpn_countries.et)update_vpn_countries.et=void update_vpn_countries.et.return();if(bext_config_init.et)bext_config_init.et=void bext_config_init.et.return();if(bext_ping.et)bext_ping.et=void bext_ping.et.return();monitor_active_uninit();_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_26___default().reset();_bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_16__.Z.reset();_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_21__["default"].uninit()}else{_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_21__["default"].init(E);update_vpn_countries();bext_config_init();bext_ping();monitor_active_init();E.force_bext_config_update()}}E.init=function(){return _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*init(){if(E.get("inited"))return;chrome=self.chrome;E.sp=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_18___default().new_etask("be_vpn");E.set("inited",true);E.on("recover",on_recover);E.be_rule=_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_9__.Z;E.be_tpopup=_bext_vpn_bg_tpopup_js__WEBPACK_IMPORTED_MODULE_13__.Z;E.be_info=_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_10__["default"];E.be_svc=_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_21__["default"];E.be_mode=_bext_vpn_bg_mode_js__WEBPACK_IMPORTED_MODULE_23__.Z;_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_10__["default"].init();_bext_vpn_bg_svc_js__WEBPACK_IMPORTED_MODULE_21__["default"].init(E);_bext_vpn_bg_mode_js__WEBPACK_IMPORTED_MODULE_23__.Z.init();_bext_vpn_bg_pac_js__WEBPACK_IMPORTED_MODULE_22__["default"].init();yield init_unblocker_lib();_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_15___default().init();if(!v3)_bext_vpn_bg_mitm_js__WEBPACK_IMPORTED_MODULE_30__.Z.init(E);_bext_vpn_bg_tab_perr_js__WEBPACK_IMPORTED_MODULE_24__.Z.init(E);_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_9__.Z.init();_bext_vpn_bg_tpopup_js__WEBPACK_IMPORTED_MODULE_13__.Z.init();proxy_settings_monitor.init();E.listenTo(_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_9__.Z,"change:status",status_cb);E.listenTo(E.be_info,"change:status",status_cb);E.listenTo(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_11___default(),"change:active.id",tab_vpn_on_change_active);E.listenTo(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_11___default(),"created",tab_vpn_on_created);E.listenTo(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_11___default(),"updated",tab_vpn_on_updated);E.listenTo(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_11___default(),"committed",tab_vpn_on_comitted);E.listenTo(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_11___default(),"removed",tab_vpn_on_removed);E.listenTo(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_11___default(),"replaced",tab_vpn_on_replaced);E.listenTo(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_11___default(),"error_occured",tab_vpn_on_error_occured);E.listenTo(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default(),"trial_end",trial_end_cb);E.listenTo(_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_25__["default"],"user_updated",(()=>E.force_bext_config_update()));E.listenTo(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default(),"conf_ver_change",(new_ver=>E.force_bext_config_update(false,new_ver)));E.listen_to(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default(),"change:ext.active change:ext.suspended",update_state);chrome.tabs.query({},(tabs=>{for(var i=0;i<tabs.length;i++)tab_vpn_on_created({tab:tabs[i]})}));_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().on_init("change:is_premium",set_gen_conf_cb);update_vpn_countries();bext_config_init();monitor_active_init();monitor_sites_init();bext_ping();E.update_full_browser_vpn_mode();E.update_src_country_exclude();let bump_ts;if(!(bump_ts=_util_storage_js__WEBPACK_IMPORTED_MODULE_17___default().get_int("bump_ts")))return;_util_storage_js__WEBPACK_IMPORTED_MODULE_17___default().clr("bump_ts");_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default().perr("be_bump_done",{bump:_util_storage_js__WEBPACK_IMPORTED_MODULE_17___default().get_int("bump"),ms:Date.now()-bump_ts})}))};function update_tests(conf){const is_enabled=(c,key,name)=>c[key][name]>0&&c[key][name]<1;if(!_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_25__["default"].get("is_test_user"))return;let key;for(key in conf){if(is_enabled(conf,key,"on"))conf[key].on=1}if(!conf.ws)return;for(key in conf.ws){if(is_enabled(conf.ws,key,"enabled_on"))conf.ws[key].enabled_on=1}}function ts_in_range(begin_ts,ts_ar,end_ts){return ts_ar.some((ts=>ts&&begin_ts<ts&&ts<=end_ts))}function update(info,data,ts,pref,expire_ts){if(!info||!info.last_req_ts)return;ts[pref+"req_ts"]=Math.max(ts[pref+"req_ts"],info.last_req_ts);const to_remove=[];for(let host in info.agents){if(info.agents[host]>expire_ts)data[pref+"agents"][host]=info.agents[host];else to_remove.push(host)}for(let i=0;i<to_remove.length;i++)delete data[pref+"agents"][to_remove[i]];if(!info.req_stats)return;const p=pref+(pref?"_":"")+"req_";for(let n in info.req_stats){if(info.req_stats[n])data[p+n]=(data[p+n]||0)+info.req_stats[n]}info.req_stats={}}function get_active_agents(agents,begin_ts,end_ts){const res=[];for(let host in agents){if(ts_in_range(begin_ts,[agents[host]],end_ts))res.push(host)}return res}var monitor_active={};function monitor_active_init(){if(monitor_active.sp)return;const get_data=()=>{let data=_util_storage_js__WEBPACK_IMPORTED_MODULE_17___default().get_json("monitor_active");if(!data||typeof data!="object")data={};return data};let ts=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().get("install_ts");const install_period=5,max_period=60;let period=ts==self.hola.t.l_start?install_period:max_period;E.sp.spawn(monitor_active.sp=_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({name:"monitor_active",cancel:true},(function*monitor_active_init_loop_(){this.finally((()=>delete monitor_active.sp));let period_ms=period*_util_date_js__WEBPACK_IMPORTED_MODULE_20___default().ms.MIN;for(let n=1;;n++){if(n>=period){let data=get_data();let ts=Date.now(),end_ts=ts;let begin_ts=end_ts-period_ms;let active_ts_ar=[data.unblocker_tab_ts,data.ui_close_ts,data.ui_open_ts,data.req_ts,data.mitm_tab_ts,data.mitm_req_ts];if(n<max_period){period=max_period;period_ms=period*_util_date_js__WEBPACK_IMPORTED_MODULE_20___default().ms.MIN}n=0;if(ts_in_range(begin_ts,active_ts_ar,end_ts)){let agents=get_active_agents(data.agents,begin_ts,end_ts);let mitm_agents=get_active_agents(data.mitm_agents,begin_ts,end_ts);_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default().perr("be_active",assign({agents,mitm_agents,begin:begin_ts,end:end_ts},_util_util_js__WEBPACK_IMPORTED_MODULE_4___default().pick(data,"req_ts","unblocker_tab_ts","ui_close_ts","ui_open_ts","mitm_tab_ts","mitm_req_ts","req_total_n","req_succ_n","req_err_n","mitm_req_total_n","mitm_req_succ_n","mitm_req_err_n")))}data.agents={};data.mitm_agents={};["total_n","succ_n","err_n"].forEach((n=>{delete data["req_"+n];delete data["mitm_req_"+n]}));_util_storage_js__WEBPACK_IMPORTED_MODULE_17___default().set_json("monitor_active",data)}yield _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default().sleep(_util_date_js__WEBPACK_IMPORTED_MODULE_20___default().ms.MIN);const tabs=Object.keys(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_11___default().get_nav_tabs());if(!tabs.length)continue;let now=Date.now(),tu=_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_15___default().tab_unblockers||{};let data=get_data();let expire_ts=now-period_ms,ts={req_ts:0,mitm_req_ts:0};data.agents=data.agents||{};data.mitm_agents=data.mitm_agents||{};tabs.forEach((id=>{let u;if((u=tu[id])&&data.unblocker_tab_ts!=now)data.unblocker_tab_ts=now;update(u,data,ts,"",expire_ts)}));data.req_ts=ts.req_ts||undefined;data.mitm_req_ts=ts.mitm_req_ts||undefined;_util_storage_js__WEBPACK_IMPORTED_MODULE_17___default().set_json("monitor_active",data)}})))}function monitor_active_uninit(){if(monitor_active.sp)monitor_active.sp=void monitor_active.sp.return();monitor_active={}}let sites_stat={};function sites_stat_add(root_url){sites_stat[root_url]=1}function send_site_stat(interval){let count=Object.keys(sites_stat).length;_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default().perr("be_sites_stat",{count,interval});sites_stat={}}let monitor_sites_et;function monitor_sites_init(){if(monitor_sites_et)return;E.sp.spawn(monitor_sites_et=_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({name:"monitor_sites",cancel:true},(function*monitor_sites(){this.finally((()=>monitor_sites_et=null));while(true){let start_ts=Date.now();yield _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default().sleep(24*_util_date_js__WEBPACK_IMPORTED_MODULE_20___default().ms.HOUR);send_site_stat(Date.now()-start_ts)}})))}function monitor_sites_uninit(){if(!monitor_sites_et)return;monitor_sites_et.return();monitor_sites_et=null}function check_bump(bext_config){if(E.bump_active||!bext_config.bump)return;var bump;if(!(bump=_util_storage_js__WEBPACK_IMPORTED_MODULE_17___default().get_int("bump"))||config_stats.n==1)return void _util_storage_js__WEBPACK_IMPORTED_MODULE_17___default().set("bump",bext_config.bump);if(bext_config.bump<=bump)return;E.bump_active=true;_util_storage_js__WEBPACK_IMPORTED_MODULE_17___default().set("bump",bext_config.bump);if(_util_storage_js__WEBPACK_IMPORTED_MODULE_17___default().get_int("bump")!=bext_config.bump)return;E.listen_to(_bext_vpn_bg_tab_unblocker_js__WEBPACK_IMPORTED_MODULE_15___default(),"change:activity",underscore__WEBPACK_IMPORTED_MODULE_0___default().debounce((function(){if(_util_storage_js__WEBPACK_IMPORTED_MODULE_17___default().get("bump_ts"))return;["agent_key","agent_key_ts","popup_rating_cache"].concat(bext_config.bump_clear||[]).forEach((function(k){_util_storage_js__WEBPACK_IMPORTED_MODULE_17___default().clr(k)}));_util_storage_js__WEBPACK_IMPORTED_MODULE_17___default().set("bump_ts",Date.now());_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default().perr("be_reload_ext_bump");if(!bext_config.bump_enabled)return _util_zerr_js__WEBPACK_IMPORTED_MODULE_8___default().notice("bump reload extension not allowed");_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default().reload_ext_native()}),bext_config.bump_idle||5*_util_date_js__WEBPACK_IMPORTED_MODULE_20___default().ms.MIN))}const set_gen_conf=(_conf,key)=>{const get_conf=(c,k,keys)=>{const res={};keys.forEach((n=>res[n]=_util_util_js__WEBPACK_IMPORTED_MODULE_4___default().get(c,k+"."+n,_util_util_js__WEBPACK_IMPORTED_MODULE_4___default().get(c,n))));return res};const gen=get_conf(_util_util_js__WEBPACK_IMPORTED_MODULE_4___default().get(_conf,"gen",{}),key,["name","dbg_log_rate","is_zgettunnels_post","name","dbg_log_rate","is_etask_perf_on"]);const features={};for(let e in gen){if(gen[e]&&e.endsWith("_on"))gen[e]=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default().is_conf_allowed(gen[e]);_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().set("gen."+e,gen[e]);if(gen[e])features["test_"+e]=e!="name"?1:gen[e]}_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().unset("features",features);if(Object.keys(features).length)_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().set("features",features)};E.set_bext_config=function(bext_config){if(!bext_config){if(!(bext_config=_util_storage_js__WEBPACK_IMPORTED_MODULE_17___default().get_json("bext_config_last")))return}else _util_storage_js__WEBPACK_IMPORTED_MODULE_17___default().set_json("bext_config_last",bext_config);var hola_conf=_util_storage_js__WEBPACK_IMPORTED_MODULE_17___default().get_json("hola_conf")||{};if(hola_conf)bext_config=_util_util_js__WEBPACK_IMPORTED_MODULE_4___default().extend_deep(bext_config,hola_conf);update_tests(bext_config);_bext_vpn_bg_force_lib_js__WEBPACK_IMPORTED_MODULE_27___default().convert_blob2check(bext_config,"force_premium");_bext_vpn_bg_force_lib_js__WEBPACK_IMPORTED_MODULE_27___default().convert_blob2check(bext_config,"get_privacy");for(let site in bext_config.sites||{}){let verify=bext_config.sites[site].verify||{};for(let country in verify)_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default().convert_url2regex(verify,country);_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default().convert_url2regex(bext_config.sites[site],"redirect");if(!v3)_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default().convert_url2regex(bext_config.sites[site],"headers_conf")}if(!v3)_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default().convert_url2regex(bext_config,"headers_conf2");_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().set("bext_config",bext_config);_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().set("debug.zerr",_util_util_js__WEBPACK_IMPORTED_MODULE_4___default().get(hola_conf,"debug.zerr",{}));_bext_vpn_util_no_log_js__WEBPACK_IMPORTED_MODULE_19__["default"].set_config(bext_config);set_gen_conf_cb();E.update_full_browser_vpn_mode();E.update_src_country_exclude()};var config_update_sleep;var config_update_no_cache=false;var config_update_ver_change=false;var config_stats={n:0,err:false,attempt:0};const set_gen_conf_cb=()=>set_gen_conf(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().get("bext_config"),_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().get("is_premium")?"prem":"free");function bext_config_init(){var pause;if(bext_config_init.et)return;bext_config_init.et=_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({cancel:true,name:"bext_config_init"},[function try_catch$loop(){config_update_sleep=null;let src_country=(_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_10__["default"].get("country")||"").toLowerCase();let url=_util_url_js__WEBPACK_IMPORTED_MODULE_14___default().qs_add(conf__WEBPACK_IMPORTED_MODULE_33__.url_ccgi+"/bext_config.json",{browser:_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default().browser(),ver:_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default().version(),src_country});if(config_update_no_cache){url=_util_url_js__WEBPACK_IMPORTED_MODULE_14___default().qs_add(url,{ts:Date.now()});config_update_no_cache=false}if(config_update_ver_change){url=_util_url_js__WEBPACK_IMPORTED_MODULE_14___default().qs_add(url,{conf_ver:config_update_ver_change});config_update_ver_change=false}let prev_etag=E.get("last_bext_config_etag");let headers={};if(prev_etag&&!CG("disable_bext_config_etag_usage"))headers["if-none-match"]=prev_etag;return _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_16__.Z.ccgi_ajax({timeout:20*SEC,method:"GET",url,headers,full_response:true})},function(resp){let{data,etag,status}=resp||{};if(resp&&resp.stamp){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default().perr("be_bext_config_invalid_return");data=resp}config_stats.n++;config_stats.attempt++;pause=2*_util_date_js__WEBPACK_IMPORTED_MODULE_20___default().ms.HOUR;var err=this.error||resp&&resp.err||data&&data.err,err_info;if(!data&&status==304&&etag==E.get("last_bext_config_etag"))_util_zerr_js__WEBPACK_IMPORTED_MODULE_8___default().notice("bext_config etag hit");else if(err||!data){if(config_stats.attempt==1)E.set_bext_config();err_info=(err?err.hola_info:undefined)||{};_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default().perr("be_bext_config_err",{n:config_stats.n,after_err:config_stats.err,status:err_info.status,exists:!!_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().get("bext_config"),err_info,attempt:config_stats.attempt,stamp:CG("stamp")},{err});pause=((E.t||{}).bext_config_err_to||5)*_util_date_js__WEBPACK_IMPORTED_MODULE_20___default().ms.MIN}else if(data.stamp&&CG("stamp",0)>data.stamp){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default().perr("be_bext_config_old",{n:config_stats.n,after_err:config_stats.err,attempt:config_stats.attempt})}else{E.set_bext_config(data);E.set("last_bext_config_etag",etag);check_bump(data);config_stats.attempt=0}config_stats.err=!!err;if(!config_stats.attempt)_svc_vpn_pub_unblocker_lib_js__WEBPACK_IMPORTED_MODULE_26___default().trigger("conf_change");this.set_state("loop");return config_update_sleep=_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default().sleep(pause)}]);E.sp.spawn(bext_config_init.et);return bext_config_init.et}const update_vpn_countries=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*_update_vpn_countries(){if(update_vpn_countries.et||(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().get("vpn_countries")||[]).length)return;let retries=0;const retry=e=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({cancel:true},(function*_retry(){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default().perr("be_vpn_countries_err",{retries},{err:e});let res=yield _bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_31__["default"].storage_local_get("vpn_countries");_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().set("vpn_countries",(res||{}).vpn_countries||[]);if(retries)return;retries++;yield _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default().sleep(_util_date_js__WEBPACK_IMPORTED_MODULE_20___default().ms.MIN);return yield load()}));const load=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({cancel:true},(function*_load(){let res=yield _bext_vpn_bg_bg_ajax_js__WEBPACK_IMPORTED_MODULE_16__.Z.ccgi_ajax({timeout:2e4,method:"GET",url:conf__WEBPACK_IMPORTED_MODULE_33__.url_ccgi+"/vpn_countries.json?browser="+_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default().browser()+"&ver="+_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default().version(),no_throw:1});if(!res||res.err||!Array.isArray(res))return yield retry((res||{}).err||"empty_list");if(res.includes("uk"))res.push("gb");_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().set("vpn_countries",res);yield _bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_31__["default"].storage_local_set({vpn_countries:res});return res}));this.on("finally",(()=>update_vpn_countries.et=undefined));update_vpn_countries.et=load();if(E.sp)E.sp.spawn(update_vpn_countries.et);return yield update_vpn_countries.et}));function bext_ping(){if(bext_ping.et)return;bext_ping.et=_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({cancel:true},(function*_bext_ping(){for(let n=0;;n++){let period=CG("ping.period",_util_date_js__WEBPACK_IMPORTED_MODULE_20___default().ms.DAY);let now=Date.now(),ping_ts=_util_storage_js__WEBPACK_IMPORTED_MODULE_17___default().get_int("ping_ts");if(!ping_ts&&n*_util_date_js__WEBPACK_IMPORTED_MODULE_20___default().ms.HOUR>=period||ping_ts&&now-ping_ts>=period){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default().perr("be_ping",{n});_util_storage_js__WEBPACK_IMPORTED_MODULE_17___default().set("ping_ts",now)}yield _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default().sleep(_util_date_js__WEBPACK_IMPORTED_MODULE_20___default().ms.HOUR)}}));E.sp.spawn(bext_ping.et);return bext_ping.et}E.force_bext_config_update=function(no_cache,new_ver){if(!config_update_sleep)return;config_update_no_cache=!!no_cache;config_update_ver_change=new_ver;config_update_sleep.return()};function status_cb(){var script=_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_9__.Z.get("status");var info=E.be_info.get("status");var status=[script,info];if(status.includes("error"))E.set("status","error");else if(status.includes("busy"))E.set("status","busy");else{E.set("status","ready");tabs_update()}if(status.includes("busy")||!E.get("need_recover"))return;if(E.get("status")=="ready")return E.set("need_recover",false);_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_18___default().clear_timeout(status_cb.timer);status_cb.timer=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_18___default().set_timeout((()=>{_util_zerr_js__WEBPACK_IMPORTED_MODULE_8___default().notice("be_vpn try recover");E.set("need_recover",false);if(_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_9__.Z.get("status")=="error")_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_9__.Z.recover();if(E.be_info.get("status")=="error")E.be_info.recover()}),0,{sp:E.sp})}function active_stop_measure(tab){if(!tab.active_ts)return;tab.active_time+=Date.now()-tab.active_ts;tab.active_ts=0;active_timer_clr(tab)}function active_reset(tab){active_stop_measure(tab);tab.active_time=0}function active_start_measure(tab){if(tab.active_ts)return;tab.active_ts=Date.now();active_timer_add(tab,active_tab_timer_ms)}function active_timer_clr(tab){if(!tab.active_timer)return;tab.active_timer=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_18___default().clear_timeout(tab.active_timer)}function active_timer_add(tab,ms){active_timer_clr(tab);tab.active_timer=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_18___default().set_timeout((()=>{tab.active_timer=null;total_active_report(tab)}),ms,{sp:E.sp})}function total_active_report(tab){active_stop_measure(tab);if(tab.active_reported)return;tab.active_reported=true;var rule;var loc_country=(_util_util_js__WEBPACK_IMPORTED_MODULE_4___default().get(_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_10__["default"].get("location"),"country")||"").toLowerCase();if(rule=tab.rule){var first_per_time=Date.now()-(E.unblocked_urls[tab.root_url]||0)>24*36e5;var stats=assign(underscore__WEBPACK_IMPORTED_MODULE_0___default().pick(rule,"name","type"),{proxy_country:(rule.country||"").toLowerCase()});_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default().perr("be_vpn_total_active_time",JSON.stringify(assign(stats,{root_url:tab.root_url,src_country:loc_country,total_active_time:tab.active_time/1e3,first_per_time})),{rate_limit:{count:20}});if(first_per_time)E.unblocked_urls[tab.root_url]=Date.now();return}if(!tab.root_url||tab.had_rule||Math.random()*50>=1)return;_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default().perr("be_total_active_time",JSON.stringify({root_url:tab.root_url,src_country:loc_country,total_active_time:tab.active_time/1e3}),{rate_limit:{count:20}})}function tab_vpn_add(tab,rule){tab.had_rule=true;tab.rule=_util_util_js__WEBPACK_IMPORTED_MODULE_4___default().clone(rule);active_reset(tab);if(E.active_tab_id==tab.id)active_start_measure(tab)}function tab_add(tabid,url){var tab=E.tabs[tabid];var rule=E.rule_get(url);if(tab)return;_util_zerr_js__WEBPACK_IMPORTED_MODULE_8___default().debug("tab:%d add url %s root %s",tabid,url.slice(0,200),_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default().get_root_url(url));tab={url,root_url:_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default().get_root_url(url),active:0,active_time:0,rule,id:tabid};E.tabs[tabid]=tab;if(E.active_tab_id==tabid)active_start_measure(tab);if(rule)tab_vpn_add(tab,rule)}function tab_vpn_del(tab){if(!tab.rule)return;total_active_report(tab);tab.rule=tab.storage_updated=tab.tz_spoof_inited=tab.geo_spoof_inited=tab.webrtc_stats_inited=null}function tab_del(tabid){var tab=E.tabs[tabid];if(!tab)return;total_active_report(tab);tab_vpn_del(tab);delete E.tabs[tabid]}function tab_update(tab){var rule=E.rule_get(tab.url);_util_zerr_js__WEBPACK_IMPORTED_MODULE_8___default().debug("tab:%d update url %s is_vpn %O",tab.id,tab.root_url,!!rule);if(rule&&!tab.rule)tab_vpn_add(tab,rule);else if(!rule&&tab.rule)tab_vpn_del(tab)}function tabs_update(){for(var tab in E.tabs)tab_update(E.tabs[tab])}E.rule_get=function(url){var rule;if(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().is_disabled())return null;if((rule=_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_9__.Z.get_rules(url)[0])&&rule.enabled)return rule;return null};var MAX_HISTORY=5;function tab_history_update(id,url,del){var tab=E.history[id];if(!tab){if(del)return;tab=E.history[id]={history:[]}}else if(del)return void delete E.history[id];var host=_util_url_js__WEBPACK_IMPORTED_MODULE_14___default().get_host(url);if(!host)return;if(tab.history.length&&host==tab.history[0])return;tab.history.unshift(host);if(tab.history.length>MAX_HISTORY)tab.history.pop()}E.tab_history_get=function(id){if(!(id=id||_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_11___default().get("active.id")))return;var t=E.history[id];if(!t)return;return t.history};function tab_vpn_on_created(o){var tab=o.tab;if(!tab.url)return;tab_history_update(tab.id,tab.url);tab_add(tab.id,tab.url)}const execute_with_params=(tab_id,fn,params)=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({cancel:true},(function*_execute_with_params(){const tabapi=_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_31__["default"].tabid2api(tab_id);if(v3){yield chrome.scripting.executeScript({target:{tabId:+tabapi},func:fn,args:[params]});return}const code="("+fn.toString()+")("+params+")";if(chrome.tabs.executeScript){yield _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default().cb_apply(chrome.tabs,".executeScript",[tabapi,{code,runAt:"document_start"}])}}));const tz_spoof_inject=o=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({cancel:true},(function*_tz_spoof_inject(){var tab=E.tabs[o.id];if(!tab||tab.tz_spoof_inited||!tab.rule||!chrome||!chrome.runtime||!chrome.runtime.getURL){return}var site,url=_util_util_js__WEBPACK_IMPORTED_MODULE_4___default().get(o,"info.url");if(!(site=E.get_site_conf(url))||!site.tz_spoof)return;var fn=function(offset){var script=document.createElement("script");script.src=chrome.runtime.getURL("js/bext/vpn/bg/tz_spoof.js?"+"offset="+offset);var add_script=function(){if(!document.head)setTimeout(add_script,0);else document.head.appendChild(script)};add_script()};yield execute_with_params(o.id,fn,site.tz_spoof);tab.tz_spoof_inited=true}));const geo_spoof_inject=o=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({cancel:true},(function*_geo_spoof_inject(){let tab=E.tabs[o.id];if(!tab||tab.geo_spoof_inited||!tab.rule||!chrome||!chrome.runtime||!chrome.runtime.getURL){return}let site,conf,url=_util_util_js__WEBPACK_IMPORTED_MODULE_4___default().get(o,"info.url");if(!(site=E.get_site_conf(url))||!(conf=site.geo_spoof))return;const rand_range=val=>_util_rand_js__WEBPACK_IMPORTED_MODULE_6___default().rand_range(Math.min(val.from,val.to),Math.max(val.from,val.to));let fn=function(opt){var script=document.createElement("script");script.src=chrome.runtime.getURL("js/bext/vpn/bg/geo_spoof.js?"+"latitude="+opt.latitude+"&longitude="+opt.longitude);var add_script=function(){if(!document.head)setTimeout(add_script,0);else document.head.appendChild(script)};add_script()};yield execute_with_params(o.id,fn,JSON.stringify({latitude:rand_range(conf.latitude),longitude:rand_range(conf.longitude)}));tab.geo_spoof_inited=true}));const webrtc_stats_inject=o=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({cancel:true},(function*_webrtc_stats_inject(){let tab=E.tabs[o.id];if(!tab||tab.webrtc_stats_inited||!chrome||!chrome.runtime||!chrome.runtime.getURL){return}let site,conf,url=_util_util_js__WEBPACK_IMPORTED_MODULE_4___default().get(o,"info.url");if(!(site=E.get_site_conf(url))||!(conf=site.webrtc_spoof||site.webrtc_stats)||conf.rule_only&&!tab.rule){return}let fn=function(opt){var script=document.createElement("script");script.src=opt.ext_url+"/bext/vpn/bg/webrtc_stats.js?uuid="+opt.uuid+"&version="+opt.version+"&rule="+opt.rule;var loader=document.createElement("script");loader.src=opt.ext_url+"/bext/pub/pre_loader.js";var add_script=function(){if(!document.head)setTimeout(add_script,0);else{document.head.appendChild(loader);document.head.appendChild(script)}};add_script()};yield execute_with_params(o.id,fn,JSON.stringify({ext_url:chrome.runtime.getURL("")+"js",version:_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default().version(),uuid:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().get("uuid"),rule:+!!tab.rule}));tab.webrtc_stats_inited=true}));const update_site_storage=o=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({cancel:true},(function*_update_site_storage(){const tab=E.tabs[o.id];if(!tab||!tab.rule||tab.storage_updated||!chrome||!chrome.runtime)return;const url=_util_util_js__WEBPACK_IMPORTED_MODULE_4___default().get(o,"info.url"),site=E.get_site_conf(url);if(!site||!site.site_storage)return;const fn=ls=>Object.keys(ls).forEach((key=>{const set=()=>{if(ls[key]==null){delete localStorage[key];delete sessionStorage[key];return}localStorage.setItem(key,ls[key]);sessionStorage.setItem(key,ls[key])};if(!key.includes("*"))return set();key=new RegExp(key.replace(/\./g,"\\.").replace(/\*/g,".*"));key=Object.keys(localStorage).find((e=>key.test(e)));if(key)set()}));yield execute_with_params(o.id,fn,JSON.stringify(site.site_storage));tab.storage_updated=true}));const tab_vpn_on_comitted=o=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({cancel:true},(function*_tab_vpn_on_comitted(){yield tz_spoof_inject(o);yield geo_spoof_inject(o);yield webrtc_stats_inject(o);yield update_site_storage(o)}));function tab_vpn_on_updated(o){var id=o.id,info=o.info;var tab=E.tabs[id];if(tab){delete tab.tz_spoof_inited;delete tab.geo_spoof_inited;delete tab.webrtc_stats_inited}if(!info||!info.url)return;tab_history_update(id,info.url);var root_url=_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default().get_root_url(info.url);if(tab&&tab.root_url==root_url){tab.url=info.url;tz_spoof_inject(o);geo_spoof_inject(o);webrtc_stats_inject(o);return}if(tab)tab_del(id);if(root_url)sites_stat_add(root_url);tab_add(id,info.url);tz_spoof_inject(o);geo_spoof_inject(o);webrtc_stats_inject(o)}function tab_vpn_on_removed(tab){tab_history_update(tab.id,null,true);tab_del(tab.id)}function tab_vpn_on_replaced(o){var added=o.added,removed=o.removed;tab_history_update(removed,null,true);tab_vpn_del(removed);chrome.tabs.get(added,(function(tab){if(!tab||!tab.url)return;tab_history_update(added,tab.url);var root_url=_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default().get_root_url(tab.url);if(!root_url)return;tab_add(added,tab.url)}))}function tab_vpn_on_change_active(){var id=_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_11___default().get("active.id");if(!id)return;var tab=E.active_tab_id?E.tabs[E.active_tab_id]:null;if(tab)active_stop_measure(tab);E.active_tab_id=id;if(tab=E.tabs[id])active_start_measure(tab)}function tab_vpn_on_error_occured(o){var info=o.info||{};if(info.http_status_code!=0)return;var last=tab_vpn_on_error_occured.info||{};if(last.error==info.error&&last.url==info.url&&last.tabId==info.tabId)return;tab_vpn_on_error_occured.info=info;var domain=_util_url_js__WEBPACK_IMPORTED_MODULE_14___default().get_host(""+info.url);if(!_util_url_js__WEBPACK_IMPORTED_MODULE_14___default().is_valid_domain(domain))return;var rule,perr_info={domain,err:info.error||""};if(!(rule=E.rule_get(info.url))||info.error=="net::ERR_ABORTED")return;_util_zerr_js__WEBPACK_IMPORTED_MODULE_8___default().debug("tab:%d tab_vpn_on_error_occured rule %s error %s url %s",info.tabId,rule.name||"undefined",info.error,info.url);perr_info.proxy_country=rule.country;_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default().perr("be_webrequest_error",perr_info,{err:true,rate_limit:{count:5}})}E.set_enabled=function(on){try{on=!!on;get_bg_main().set_enabled(on);if(!!_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().get("ext.active")!=on&&!_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().get("ext.conflict")){var attributes=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().attributes;_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default().perr("be_set_enabled_mismatch",{on,attributes},{err:true,rate_limit:{count:1}})}}catch(e){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default().perr("be_set_enabled_err",{},{err:e});throw e}};E.script_set=(rule,val)=>{_util_zerr_js__WEBPACK_IMPORTED_MODULE_8___default().debug("set rule %s %d %s",rule.name,+val.enabled,val.root_url);return _util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({name:"script_set",cancel:true},(function*script_set_(){yield E.set_enabled(true);if(val.enabled&&!val.stub&&!val.mitm&&val.src!="smart_suggestion"&&(_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_29__["default"].need_trial(val.root_url)||false&&0)){let src=val.src=="ui"?"popular_page":val.src;_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_31__["default"].set_site_storage(val.root_url,"force_trial",{country:val.country||rule.country,src});return this.return()}if(rule&&+val.enabled&&rule.enabled&&rule.src==val.src&&rule.mode==val.mode&&(rule.country&&!val.country||rule.country==val.country)){return this.return()}const new_rule={name:val.host||val.name||rule.name,enabled:+val.enabled,root_url:val.host||val.root_url,country:(val.country||rule.country||"").toLowerCase(),type:rule.type,mode:val.mode,tab_id:val.tab_id,stub:val.stub,no_reload:val.no_reload,mitm:val.mitm};if(val.src)new_rule.src=val.src;_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_9__.Z.trigger("set_rule",new_rule);if(E.get("status")=="ready")return;E.once("change:status",(()=>this.continue()));return yield this.wait(15*SEC)}))};E.enable_root_url=opt=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()({cancel:true},(function*enable_root_url(){const src_country=_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_10__["default"].get("country");let rule_ratings,rule,root_url=opt.root_url,enabled=true;if(E.get_src_country_excluded()){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default().perr("be_enable_root_url_src_country_excluded",{src_country});return void _bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_10__["default"].set_force_tpopup(root_url)}if(!_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().get("is_premium")&&_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_25__["default"].get_force_premium_rule(root_url)){return void _bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_10__["default"].set_force_tpopup(root_url)}if(opt.rule&&opt.rule.name&&opt.rule.country){rule=opt.rule;if(rule.enabled!==undefined)enabled=rule.enabled}else{if(opt.rule){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default().perr("be_enable_root_url_invalid_rule",assign(opt,{hola_uid:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().get("hola_uid")}))}const _rule_ratings=yield _bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_9__.Z.get_rule_ratings({root_url,src_country,limit:20,proxy_country:opt.country,vpn_only:true});let groups;if(_rule_ratings){rule_ratings=_rule_ratings.filter((r=>{const country=r.proxy_country.toUpperCase();return _protocol_pub_countries_js__WEBPACK_IMPORTED_MODULE_28___default().proxy_countries.bext.includes(country)}));groups=yield _bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_9__.Z.get_groups_from_ratings(rule_ratings)}let url="http://"+root_url+"/",host=_util_url_js__WEBPACK_IMPORTED_MODULE_14___default().get_host(url);let popular=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_18___default().get_popular_country({host,rule_ratings});let proxy_country=(opt.country||popular[0].proxy_country||"").toLowerCase();let all_rules=_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_31__["default"].get_all_rules({proxy_country,rules:_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_9__.Z.get("rules"),url,root_url,rule_ratings,groups,mitm:opt.mitm});rule=all_rules[0]}if(E.is_enabled_for_browser()||_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default().full_browser_mode()){yield E.set_browser_country({country:enabled?rule.country:null,root_url,tab_id:_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_11___default().get("active.id"),src:"popular_page"})}else{yield E.script_set(rule,{enabled,root_url,src:opt.src,country:rule.country,mitm:opt.mitm||rule.mitm,no_reload:opt.no_reload})}_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default().perr("be_enable_root_url",{name:rule.name,root_url,country:rule.country,hola_uid:_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().get("hola_uid"),src_country:(src_country||"").toLowerCase()});return rule}));E.tpopup_is_connected=(id,tpopup_type)=>E.be_tpopup&&E.be_tpopup.is_connected(id,tpopup_type);E.stop_vpn=function(url,tab_id){_util_zerr_js__WEBPACK_IMPORTED_MODULE_8___default().notice("stop vpn "+url);let root_url=_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default().get_root_url(url);if(_bext_vpn_bg_mitm_js__WEBPACK_IMPORTED_MODULE_30__.Z.is_popup_needed(root_url))return void _bext_vpn_bg_mitm_js__WEBPACK_IMPORTED_MODULE_30__.Z.set_ignore(root_url,tab_id);const rule=E.rule_get(url);if(!rule)return;_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default().perr("be_ui_vpn_stop",{root_url,country:rule.country});_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_9__.Z.trigger("set_rule",{name:rule.name,root_url,enabled:0,country:rule.country,type:rule.type,tab_id})};E.get_site_conf=url=>{const root_url=_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default().get_root_url(url);return _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default().get_site_conf(root_url)};E.do_tpopup=(tab_id,root_url)=>{_bext_vpn_bg_tpopup_js__WEBPACK_IMPORTED_MODULE_13__.Z.do_tpopup(E.tabs[tab_id],root_url)};E.get_all_browser_rule=()=>{const rules=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_18___default().get_rules(_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_9__.Z.get("rules"));if(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().is_disabled())return false;return _bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_18___default().is_all_browser(rules[0])&&rules[0]};E.is_enabled_for_browser=()=>!!E.get_all_browser_rule();E.set_enabled_for_browser=(enable,opt)=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*set_enabled_for_browser(){opt=opt||{};_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default().perr("be_ui_vpn_protect_browser",{enable});let rule=E.get_all_browser_rule();if(!enable){if(!rule)return;yield E.script_set(rule,{enabled:false})}else{if(rule&&rule.country==opt.country)return;yield E.script_set({country:opt.country,type:"url"},{enabled:true,host:"all_browser",mode:"protect"})}}));E.set_browser_country=({country,tab_id,root_url,src})=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*set_browser_country(){if(!country){yield E.set_enabled_for_browser(false);return true}if(!root_url&&tab_id)root_url=_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default().get_root_url(_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_11___default().get_url(tab_id));if(!_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_29__["default"].need_trial(root_url)){yield E.set_enabled_for_browser(true,{country});return true}if(_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_29__["default"].can_start_trial_silently(root_url)){try{if(yield _bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_29__["default"].start_trial(root_url)){yield E.set_enabled_for_browser(true,{country});return true}}catch(e){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default().perr("be_vpn_silent_trial_start_err",{root_url,country},{err:e})}}_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_31__["default"].set_site_storage(root_url,"force_trial",{country,tab_id,src});if(src=="new_tab"){_bext_vpn_bg_tpopup_js__WEBPACK_IMPORTED_MODULE_13__.Z.do_tpopup(E.tabs[tab_id],root_url,{tpopup_type:"watermark"})}return false}));E.get_disabled_rule=opt=>{if(!E.get("inited"))return;let{url}=opt;let is_premium=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().get("is_premium");if(is_premium&&E.is_enabled_for_browser())return;let rules=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_18___default().get_rules(_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_9__.Z.get("rules"),url);let rule=rules&&rules[0];if(rule&&!rule.enabled)return rule};const is_browser_vpn_allowed=()=>_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().get("is_premium")||_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default().full_browser_mode();E.get_enabled_rule=opt=>{if(!E.get("inited"))return;let{url,tab_id}=opt;let is_premium=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().get("is_premium");if(E.is_enabled_for_browser())return assign({protect:"browser"},E.get_all_browser_rule());let stub_rule=(_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_9__.Z.get("tabs_stub_rules")||{})[tab_id];if(stub_rule&&stub_rule.enabled&&_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_18___default().is_stub_url(url,is_premium)){return stub_rule}let rules=_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_18___default().get_rules(_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_9__.Z.get("rules"),url);let rule=rules&&rules[0]||{};if(!rule.enabled||_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().is_disabled())return null;return rule};E.unblock_disable=({url,tab_id,skip_dont_show})=>{let rule=E.get_enabled_rule({url,tab_id});let root_url=_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default().get_root_url(url);if(!skip_dont_show&&(_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_29__["default"].get_trial_active(root_url)||_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_29__["default"].is_trial_expired(root_url))){_bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_31__["default"].set_site_storage(root_url,"trial.dont_show_ended",true)}if(!rule)return;if(rule.protect=="browser")E.set_enabled_for_browser(false,{tab_id,url});_bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_9__.Z.trigger("set_rule",{name:root_url,root_url,enabled:0,country:rule.country,type:rule.type,tab_id,stub:rule.stub})};let unblock_enable=opt=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*unblock_enable_(){let{url,tab_id,mitm,protect,country}=opt;let root_url=_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default().get_root_url(url);let rule=E.get_enabled_rule({url,tab_id})||{};let is_premium=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().get("is_premium");const set_site_rule=changes=>E.script_set(rule,assign({name:root_url,root_url,enabled:1,country:country||rule.country,mode:rule.mode,tab_id,mitm,stub:!mitm&&_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_18___default().is_skip_url(url)||!is_premium&&_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_18___default().is_google(root_url),no_reload:opt.no_reload},changes));if(!is_premium&&(_bext_vpn_bg_premium_js__WEBPACK_IMPORTED_MODULE_25__["default"].get_force_premium_rule(root_url)||protect))return _util_zerr_js__WEBPACK_IMPORTED_MODULE_8___default()("user not premium");if(country&&protect&&!(_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().get("vpn_countries")||[]).includes(country.toLowerCase())){country="us"}if(protect=="browser"||protect===undefined&&rule.protect=="browser"||protect===undefined&&rule.protect===undefined&&_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default().full_browser_mode()){return yield E.set_enabled_for_browser(true,{country:country||rule.country,tab_id,url})}if(protect===false){if(rule.protect=="browser")yield E.set_enabled_for_browser(false,{tab_id,url});if(!_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_18___default().is_skip_url(url))yield set_site_rule({mode:"unblock",country});return}yield set_site_rule({country})}));E.unblock_action=opt=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*unblock_action(){const src_country=_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_10__["default"].get("country");let{url,tab_id}=opt;let redirects,root_url=_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default().get_root_url(url);let rules_set=new _bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_31__["default"].Rules_set(null,opt.disable);if(opt.disable){redirects=new _bext_vpn_bg_util_js__WEBPACK_IMPORTED_MODULE_31__["default"].Rules_set(root_url).to_array().map((r=>_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_18___default().root2url(r)));for(let u of[url,...redirects]){rules_set.add(_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default().get_root_url(u));E.unblock_disable({url:u,tab_id})}if(redirects&&redirects.length)rules_set.save();if(!CG("mitm2.disable_rule_removal_on_vpn_stop"))_bext_vpn_bg_mitm_js__WEBPACK_IMPORTED_MODULE_30__.Z.remove_rule(root_url);return}if(E.get_src_country_excluded()){return void _bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default().perr("be_unblock_action_src_country_excluded",{src_country})}redirects=opt.redirects&&opt.redirects.filter((u=>u!=url))||[];let no_reload,site;no_reload=redirects.length&&(!(site=_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default().get_site_conf(root_url))||!_util_util_js__WEBPACK_IMPORTED_MODULE_4___default().get(site,"trial.trial_redirect"));for(let u of[url,...redirects]){rules_set.add(_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default().get_root_url(u));yield unblock_enable(assign({},opt,{url:u,no_reload}))}if(redirects&&redirects.length)rules_set.save();if(no_reload)_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_11___default().update(tab_id,{url,active:true});_util_storage_js__WEBPACK_IMPORTED_MODULE_17___default().set("unblock_action_n",(_util_storage_js__WEBPACK_IMPORTED_MODULE_17___default().get_int("unblock_action_n")||0)+1)}));E.force_full_browser_mode=enable=>{_util_storage_js__WEBPACK_IMPORTED_MODULE_17___default().set("force_full_browser_mode",enable);E.update_full_browser_vpn_mode()};E.update_full_browser_vpn_mode=()=>{let force=_util_storage_js__WEBPACK_IMPORTED_MODULE_17___default().get_json("force_full_browser_mode");if(force===true||force===false)_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default().set_full_browser_mode(force);else{_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default().set_full_browser_mode(CG("full_browser")||v3&&!CG("debug.v3_per_tab"))}if(!is_browser_vpn_allowed()&&E.is_enabled_for_browser())E.set_enabled_for_browser(false)};const get_src_country_exclude=src_country=>{if(!src_country)return false;const country=(""+src_country).toLowerCase();const _conf=CG("exclude_user_countries",{});const uuid=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().get("uuid");const hola_uid=_bext_pub_ext_js__WEBPACK_IMPORTED_MODULE_3___default().get("hola_uid");let matched;for(const co of _conf.countries||[]){if(co.country.toLowerCase()==country){matched=co;break}}if(!matched){if(_conf.blacklist&&(uuid&&_conf.blacklist.uuids&&_conf.blacklist.uuids.includes(uuid)||hola_uid&&_conf.blacklist.hola_uids&&_conf.blacklist.hola_uids.includes(hola_uid))){return{url:_conf.blacklist.url}}return false}if(_conf.whitelist&&(uuid&&_conf.whitelist.uuids&&_conf.whitelist.uuids.includes(uuid)||hola_uid&&_conf.whitelist.hola_uids&&_conf.whitelist.hola_uids.includes(hola_uid))){return false}return assign({src_country},matched)};E.update_src_country_exclude=()=>_util_etask_js__WEBPACK_IMPORTED_MODULE_2___default()((function*(){const src_country=_bext_vpn_bg_info_js__WEBPACK_IMPORTED_MODULE_10__["default"].get("country");const current_opt=_util_storage_js__WEBPACK_IMPORTED_MODULE_17___default().get_json("src_country_exclude")||{};const opt=get_src_country_exclude(src_country);if(!opt&&!current_opt.enabled||opt&&current_opt.enabled)return;if(opt){_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default().perr("be_src_country_exclude_enabled",opt);yield _bext_vpn_bg_rule_js__WEBPACK_IMPORTED_MODULE_9__.Z.update_rules({enable:false});return void _util_storage_js__WEBPACK_IMPORTED_MODULE_17___default().set_json("src_country_exclude",assign({},opt,{enabled:true}))}_bext_pub_util_js__WEBPACK_IMPORTED_MODULE_7___default().perr("be_src_src_country_exclude_disabled",assign({current_src_country:src_country},current_opt));_util_storage_js__WEBPACK_IMPORTED_MODULE_17___default().set_json("src_country_exclude",{enabled:false})}));E.get_src_country_excluded=()=>{const opt=_util_storage_js__WEBPACK_IMPORTED_MODULE_17___default().get_json("src_country_exclude")||{};return opt&&opt.enabled?opt:null};E.get_events=()=>_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default().events;E.events_to_str=()=>_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default().events_to_str();E.get_event_n=e=>_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default().get_event_n(e);E.reset_events=()=>_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default().reset_events();E.push_event=(name,opt)=>_svc_vpn_pub_util_js__WEBPACK_IMPORTED_MODULE_12___default().push_event(name,opt);E.show_rating_popup=()=>{let tab_id=_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_11___default().get("active.id");let tab=E.tabs[tab_id];if(!tab||_bext_vpn_util_util_js__WEBPACK_IMPORTED_MODULE_18___default().is_skip_url(tab.url))return;if(_bext_vpn_bg_tpopup_js__WEBPACK_IMPORTED_MODULE_13__.Z.is_connected(tab_id))_bext_vpn_bg_tpopup_js__WEBPACK_IMPORTED_MODULE_13__.Z.close_tab_tpopup(tab_id);_bext_vpn_bg_tpopup_js__WEBPACK_IMPORTED_MODULE_13__.Z.do_tpopup(tab,null,{tpopup_type:"rate"})};E.close_rating_popup=()=>{_util_storage_js__WEBPACK_IMPORTED_MODULE_17___default().set("rating_popup_close_ts",Date.now());Object.keys(E.tabs).forEach((tab_id=>{if(_bext_vpn_bg_tpopup_js__WEBPACK_IMPORTED_MODULE_13__.Z.is_connected(tab_id,"rate"))_bext_vpn_bg_tpopup_js__WEBPACK_IMPORTED_MODULE_13__.Z.close_tab_tpopup(tab_id)}))};let trial_end_cb=trial=>{const tabs=_bext_vpn_bg_tabs_js__WEBPACK_IMPORTED_MODULE_11___default().get_nav_tabs();Object.keys(tabs).forEach((tab_id=>{let url=tabs[tab_id];if(!_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_29__["default"].match_url(trial,url))return;if(!_bext_vpn_bg_trial_js__WEBPACK_IMPORTED_MODULE_29__["default"].get_grace_time(trial))E.unblock_disable({tab_id,url,skip_dont_show:true});if(!E.tpopup_is_connected(tab_id))E.do_tpopup(+tab_id)}))};if(_util_util_js__WEBPACK_IMPORTED_MODULE_4___default().is_mocha()){E.t={update_vpn_countries,init_unblocker_lib,uninit_unblocker_lib,update_site_storage,execute_with_params,clean_cookies,monitor_active_init,monitor_active_uninit,unblock_enable}}const __WEBPACK_DEFAULT_EXPORT__=E},2181:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var _util_storage_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(8915);var _util_storage_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_util_storage_js__WEBPACK_IMPORTED_MODULE_0__);var _util_util_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(1291);var _util_util_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_util_util_js__WEBPACK_IMPORTED_MODULE_1__);
// LICENSE_CODE ZON
const E={};let status_cb,no_log_for_plus,no_log_for_uid={};let allowed_perrs={be_install:true,be_update:true};let cached=_util_storage_js__WEBPACK_IMPORTED_MODULE_0___default().get_json("no_log")||{};let enabled=cached.enabled;let is_plus=cached.is_plus;let uuid=cached.uuid;const invalidate=()=>{let no_log=!!(uuid&&uuid in no_log_for_uid?no_log_for_uid[uuid]:is_plus&&no_log_for_plus);if(enabled!==no_log){enabled=no_log;if(status_cb)status_cb(enabled)}_util_storage_js__WEBPACK_IMPORTED_MODULE_0___default().set_json("no_log",{enabled,is_plus,uuid})};E.set_plus=_is_plus=>{if(_is_plus===undefined||_is_plus===is_plus)return;is_plus=_is_plus;invalidate()};E.set_config=conf=>{no_log_for_plus=conf.no_log_for_plus;no_log_for_uid=conf.no_log_for_uid||{};allowed_perrs=_util_util_js__WEBPACK_IMPORTED_MODULE_1___default().bool_lookup(conf.no_log_perrs||[]);invalidate()};E.set_uuid=_uuid=>{if(_uuid===undefined||_uuid===uuid)return;uuid=_uuid;invalidate()};E.set_status_cb=cb=>{status_cb=cb;cb(enabled)};E.enabled=perr_id=>enabled&&!(perr_id&&allowed_perrs[perr_id]);const __WEBPACK_DEFAULT_EXPORT__=E},764:(module,exports,__webpack_require__)=>{var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;var module;
// LICENSE_CODE ZON
"use strict";(function(){var is_node=typeof module=="object"&&module.exports;if(!is_node);else;!(__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(2179),__webpack_require__(7439),__webpack_require__(6386),__webpack_require__(1291),__webpack_require__(901),__webpack_require__(8915)],__WEBPACK_AMD_DEFINE_RESULT__=function($,_,etask,zutil,user_agent,storage){var assign=Object.assign;var port_no_load_from_storage=1;function port_get(){var is_dev;try{is_dev=storage.get_json("hola_opts").developer_mode}catch(err){}if(port_no_load_from_storage||is_dev)return;try{return storage.get_int("svc_ipc_port")}catch(err){}}function port_set(port,up,info){if(up)return void(E.port_up=port||undefined);if(!port){try{storage.clr("svc_ipc_port")}catch(err){}delete E.svc_port;return}try{storage.set("svc_ipc_port",port)}catch(err){}E.svc_port=port;E.svc_has_ssl=port&&info&&info.ssl}var ua=user_agent.guess_browser();var is_ie=ua.browser=="ie";var is_firefox=ua.browser=="firefox";var E={svc_ports:[6880,6881,6882,6883,6884,6885,6886,6887,6888,6889],up_ports:[6890,6891,6892,6893,6894,6895,6896,6897,6898,6899]};E.svc_port=port_get();E.svc_has_ssl=false;E.up_port=undefined;E.load_port_from_storage=function(){port_no_load_from_storage=0;E.svc_port=port_get()};function Eport(up){return up?E.up_port:E.svc_port}function Eports(up){return up?E.up_ports:E.svc_ports}function get_url(cmd,opt){opt=opt||{};var https=location.protocol=="https:"&&opt.https;return(https?"https://localhost.h-local.org":"http://127.0.0.1")+":"+(opt.port||Eport(opt.up))+"/"+cmd}function exe2order(e){if(e.os_ver=="NaCl")return 1;if(/^hola_updater/.test(e.exe))return 1;if(/^hola_svc/.test(e.exe))return 2;if(/^hola_plugin/.test(e.exe))return 3;return 0}function cache_str_fn2(fn){var cache={};return function(s1,s2){var cache2=cache[s1]=cache[s1]||{};if(s2 in cache2)return cache2[s2];return cache2[s2]=fn(s1,s2)}}var version_cmp=cache_str_fn2((function(v1,v2){if(!v1||!v2)return+!!v1-+!!v2;var _v1=v1.split("."),_v2=v2.split("."),i;for(i=0;i<_v1.length&&i<_v2.length&&+_v1[i]==+_v2[i];i++);if(_v1.length==i||_v2.length==i)return _v1.length-_v2.length;return+_v1[i]-+_v2[i]}));var sp_find_port;var disabled_mode=false;try{disabled_mode=storage.get("svc_ipc_disabled",false)}catch(e){}E.find_port=function(up,appid){var opt={dataType:"json",cache:false,no_throw:1,timeout:is_ie||is_firefox?2e3:500};var q=[];if(disabled_mode)return 0;return etask({cancel:true},[function(){if(sp_find_port)return this.loop(sp_find_port);sp_find_port=this},function try_catch$(){if(Eport(up))return this.return(Eport(up))},function try_catch$(){var _this=this;_.each(Eports(up),(function(port){var sp;_this.spawn(sp=post(get_url("callback.json?find_port=1",{port,up}),opt));sp.data=sp.data?sp.data:{};sp.data.port=port;q.push(sp)}));return etask.all(q)},function(arr){var best,port;_.each(arr,(function(e,i){if(!e.ret||e.ret.error)return;if(appid&&(appid.test?!appid.test(e.ret.appid):appid!=e.ret.appid)){return}if(!best){best=e;port=q[i].data.port;return}var e_order=exe2order(e.ret);var best_order=exe2order(best.ret);if(e_order<best_order||e_order==best_order&&version_cmp(e.ret.ver,best.ret.ver)<=0){return}best=e;port=q[i].data.port}));port_set(port,up,best&&best.ret);if(!best)return this.wait(1e3);return this.return(port)},function finally$(){if(this==sp_find_port)sp_find_port=null}])};E.init=function(port){return etask([function(){if(port){port_set(port);return port}return E.find_port()},function(port){if(!port)return-1;return 0}])};function post(url,opt){opt=opt||{};if(typeof url==="object")opt=url;else if(typeof url==="string"){opt=zutil.clone(opt);opt.url=url}var xhr;if(!$.ajax){var response;return etask([function(){if((storage.get_json("hola_opts")||{}).no_svc)throw"svc detection disabled";return fetch(opt.url,{method:"POST",signal:opt.timeout?self.AbortSignal.timeout(opt.timeout):null})},function catch$(err){var error=err+"";if(opt.no_throw){return this.return({xhr:{statusText:error},ret:{error}})}throw new Error(error)},function(res){response=res;if(this.error)return this.throw(this.error);if(!res.ok)return this.throw(res.statusText);return res.json()},function(data){return{xhr:{statusText:response.statusText},ret:data}}])}return etask([function(){if((storage.get_json("hola_opts")||{}).no_svc)throw"svc detection disabled";return xhr=$.ajax(assign({method:"POST"},opt))},function catch$(err){var error=(xhr||{}).statusText||"no_status";if(opt.no_throw)return this.return({xhr,ret:{error}});throw new Error(error)},function(ret){if(this.error)return this.throw(this.error);return{xhr,ret}}])}E.ajax=function(_opt){var cmd,timeout=500,up,appid;var opt={dataType:"json",cache:false,no_throw:1};if(typeof _opt=="string")cmd=_opt;else if(typeof _opt=="object"){cmd=_opt.cmd;opt.data=_opt.data;if(_opt.method)opt.method=_opt.method;timeout=_opt.timeout||timeout;up=_opt.up;appid=_opt.appid}var tested,q=[];if(timeout>-1)opt.timeout=timeout;return etask([function try_catch$ajax(){if(Eport(up))return post(get_url(cmd,{up}),opt);return this.goto("find_port")},function(res){var error=res.ret&&res.ret.error;if(error&&tested)throw new Error(error);if(error){port_set(0);return this.goto("find_port")}return this.return(res)},function try_catch$find_port(){return E.find_port(up,appid)},function(port){if(!port)throw new Error("none_found");tested=1;return this.goto("ajax")}])};E.ext={};function test_img(links){return etask([function(){var _this=this,errs=0;_.each(links,(function(e,i){$("<img>").load(function(){this.return()}.bind(_this)).error(function(){errs++;if(errs==links.length)this.throw("ext not found")}.bind(_this)).attr("src",e+"?rc="+Date.now())}));return this.wait(1e3)}])}E.ext.lean_ping=function(){if(!window.chrome){return test_img(["resource://ff_ext-at-hola-dot-org/"+"hola_firefox_ext/data/img/logo.png","resource://jid1-4p0kohsjxu1qgg-at-jetpack/"+"hola_firefox_ext/data/img/logo.png","resource://jid1-4p0kohsjxu1qgg-at-jetpack/icon.png"])}var old="chrome-extension://gkojfkhlekighikafcpjkiklfbnlmeio/icon.png";var _new="chrome-extension://mhcmfkkjmkcfgelgdpndepmimbmkbpfp/icon.png";return etask({name:"lean_check_ext"},[function(){return etask.all({allow_fail:true},{old:test_img([old]),_new:test_img([_new])})},function(e){if(etask.is_err(e.old)&&etask.is_err(e._new))throw e._new.error}])};return E}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))})()},9946:(module,exports,__webpack_require__)=>{var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;var module;
// LICENSE_CODE ZON
"use strict";(function(){var is_node=typeof module=="object"&&module.exports;if(!is_node);else;!(__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(9824),__webpack_require__(6386),__webpack_require__(1291),__webpack_require__(932),__webpack_require__(5678),__webpack_require__(8425),__webpack_require__(5317),__webpack_require__(4336),__webpack_require__(764),__webpack_require__(6262)],__WEBPACK_AMD_DEFINE_RESULT__=function(zerr,etask,zutil,date,zws,zevents,rate_limit,zescape,svc_ipc,version_util){const E={},assign=Object.assign,noop=()=>{};class State_machine{constructor(){}start(opt){if(this.et)return;this.rl_ctx={};this.events=new zevents.EventEmitter;this.events.on("data",(data=>{if(zutil.equal_deep(this.svc_info,data))return;this.svc_info=data;if(data)this.last_svc_info=data;if(opt.watch)opt.watch(data)}));this.events.on("datapart",(part=>this.events.emit("data",assign({},this.last_svc_info,part))));this.opt=assign({components:["client"]},opt,{log:this.proxy_log(opt.log),perr:this.proxy_perr(opt.perr),events:this.events});this.state={name:"polling",opt:assign({startup:true},this.opt)};this.states={polling:this.state_polling,listening:this.state_listening};this.opt.log("starting svc detection");this.et=etask({cancel:true,state0_args:[this]},(function*(_this){this.on("uncaught",(e=>_this.opt.log("exception in main etask:"+zerr.e2s(e))));while(true){let r=yield _this.states[_this.state.name](_this.state.opt);if(!_this.events)break;_this.state=_this.change_state(r)}}));return this.et}stop(){if(!this.et)return;this.opt.log("svc detection shutdown");this.state.opt.shutdown=true;this.et.return();if(this.ri_et)this.ri_et.return();this.events.removeAllListeners();this.et=this.events=this.opt=this.state=this.rl_ctx=this.svc_info=this.last_svc_info=undefined}proxy_log(fn){fn=fn||noop;this.log_tail=[];return str=>{this.log_tail.push(str);this.log_tail.splice(0,this.log_tail.length-100);return fn(str)}}proxy_perr(fn){fn=fn||noop;return(id,info)=>{info=assign({log_tail:this.log_tail.join("\n")},info);return fn(id,info)}}reconf(opt){if(!this.et)return;let changes=zutil.pick(opt,"monitoring_interval","detecting_interval","state_toggle_rl_n","state_toggle_rl_sec");if(!Object.keys(changes).find((k=>changes[k]!=this.opt[k])))return;assign(this.opt,changes);assign(this.state.opt,changes);setTimeout((()=>this.events.emit("wakeup")),0)}change_state(res){if(this.state.name=="listening"&&res.next=="polling"){let rl_n=this.opt.state_toggle_rl_n||5;let rl_ms=(this.opt.state_toggle_rl_sec||60)*date.ms.SEC;if(!rate_limit(this.rl_ctx,rl_ms,rl_n)){this.opt.log("reconnect loop detected, disabling ws");this.opt.perr("svc_monitor_reconnect_loop");assign(res,{next:"polling",ignore_ws:true})}}this.opt.log(`changing state to ${res.next}`);this.opt.perr("svc_monitor_changeto_"+res.next);return{name:res.next,opt:zutil.omit(res,"next")}}state_polling(opt){return etask({cancel:true},(function*state_polling(){this.on("uncaught",(e=>{opt.log("exception in polling state: "+zerr.e2s(e));opt.perr("svc_monitor_etask_err",{err:zerr.e2s(e),source:"state_polling"})}));let data,waiting_sec,fail_count=0;let qs=opt.components.includes("vpn")?"?vpn=1":"";let on_wakeup=()=>waiting_sec&&this.continue();opt.events.on("wakeup",on_wakeup);this.finally((()=>opt.events.off("wakeup",on_wakeup)));while(true){try{data=(yield svc_ipc.ajax({cmd:"callback.json"+qs,appid:opt.appid})).ret}catch(e){data=undefined}if(data&&!opt.is_connected||!data&&opt.is_connected){opt.startup=false;opt.is_connected=!!data;opt.log(`svc ${opt.is_connected?"found":"disappeared"}`)}if(data){opt.events.emit("data",data);if(!opt.ignore_ws&&data.ws_port_js)break}else{fail_count++;opt.events.emit("data",undefined)}let is_start=opt.startup&&opt.detecting_start_retries&&fail_count<opt.detecting_start_retries;waiting_sec=opt.is_connected?opt.monitoring_interval:is_start?opt.detecting_start_interval:opt.detecting_interval;opt.events.emit("sleep");try{yield this.wait(waiting_sec*date.ms.SEC)}catch(e){}waiting_sec=0}opt.log(`detected ws server on port ${data.ws_port_js}, switching to `+`listening mode`);return assign(opt,{next:"listening",ws_port:data.ws_port_js,svc_ver:data.ver})}))}state_listening(opt){return etask({cancel:true},(function*state_listening(){let client,_this=this;this.on("uncaught",(e=>{opt.log("exception in listening state: "+zerr.e2s(e));opt.perr("svc_monitor_etask_err",{err:zerr.e2s(e),source:"state_listening"})}));this.finally((()=>client&&client.close()));let ws_url=version_util.cmp(opt.svc_ver,"1.155.300")<=0?`wss://localhost.h-local.org:${opt.ws_port}`:`ws://127.0.0.1:${opt.ws_port}`;let ipc_client={vpn_connect:"post",vpn_disconnect:"post",vpn_change_agent:"post",vpn_open_link:"post",vpn_status:"call",push_subscribe:"call",request_upgrade:"call"};if(false){}client=opt.client=new zws.Client(ws_url,{ipc_client,ipc_server:{push_notify:msg=>{opt.log(msg.init?"received initial status update":"received status update"+((msg.changed||[]).length?" for "+msg.changed.join(","):""));opt.log(JSON.stringify(msg.data));opt.events.emit("datapart",msg.data)}},mux:true});opt.log(`connecting to ${ws_url}`);client.on("connected",(()=>etask((function*on_connected(){opt.log(`connected to ${ws_url}`);let sub_res={},sub_opt={components:opt.components};try{sub_res=yield client.ipc.push_subscribe(sub_opt)}catch(e){}if(sub_res.status!="success"){opt.log("failed to subscribe for svc push notifications, "+"switching back to polling mode");opt.perr("svc_monitor_subscribe_failed",{ret:sub_res});return _this.continue({next:"polling",ignore_ws:true})}opt.log("svc push notifications enabled");opt.ws_client=client;if(opt.on_ws_connected)opt.on_ws_connected()}))));client.on("disconnected",(()=>{opt.ws_client=null;if(opt.on_ws_disconnected)opt.on_ws_disconnected();if(opt.shutdown)return;opt.log(`disconnected from ${ws_url}, switching to polling mode`);this.continue({next:"polling"})}));return assign(opt,yield this.wait())}))}exec(cmd,params,opt){if(!this.et)return;return etask({state0_args:[this]},(function*exec(_this){if(cmd=="callback"){let data=yield _this.refresh_info();return data?{ret:data}:undefined}let ws_client;if((ws_client=_this.state.opt.ws_client)&&ws_client.ipc[cmd]&&!_this.opt.prefer_http_exec){try{return{ret:yield ws_client.ipc[cmd](params)}}catch(e){_this.opt.perr("svc_monitor_ws_err",{err:zerr.e2s(e),cmd})}}params=params?`?${zescape.qs(params)}`:"";return svc_ipc.ajax(assign({cmd:`${cmd}.json${params}`,appid:_this.opt.appid},opt))}))}get(cmd,params){return this.exec(cmd,params,{method:"GET"})}get_info(){return this.svc_info}get_last_info(){return this.last_svc_info}refresh_info(){if(!this.et)return;if(this.state.name=="listening")return this.get_info();let _this=this;return this.ri_et=etask({cancel:true},(function*refresh_info(){this.finally((()=>_this.ri_et=undefined));if(_this.ri_et)return yield this.wait_ext(_this.ri_et);this.on("uncaught",(e=>{if(!_this.opt)return;_this.opt.log("refresh_info exception: "+zerr.e2s(e));_this.opt.perr("svc_monitor_etask_err",{err:zerr.e2s(e),source:"refresh_info"})}));let continue_fn=()=>this.continue();_this.events.on("data",continue_fn);_this.events.on("sleep",continue_fn);setTimeout((()=>_this.events.emit("wakeup")),0);yield this.wait(60*date.ms.SEC);if(!_this.events)return;_this.events.off("data",continue_fn);_this.events.off("sleep",continue_fn);return _this.get_info()}))}}let sm=new State_machine;E.init=sm.start.bind(sm);E.exec=sm.exec.bind(sm);E.get=sm.get.bind(sm);E.reconf=sm.reconf.bind(sm);E.uninit=sm.stop.bind(sm);E.get_info=sm.get_info.bind(sm);E.get_last_info=sm.get_last_info.bind(sm);E.refresh_info=sm.refresh_info.bind(sm);E.t={State_machine};return E}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))})()},8033:(module,exports,__webpack_require__)=>{var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;var module;
// LICENSE_CODE ZON
"use strict";(function(){const is_node=typeof module=="object"&&module.exports&&module.children;if(!is_node);else;!(__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(1291),__webpack_require__(932),__webpack_require__(843)],__WEBPACK_AMD_DEFINE_RESULT__=function(zutil,date,svc_vpn_util){const E={},{assign}=Object;let api;let def_api={perr:(id,info,opt)=>{},conf_get:(s,def)=>def,android_conf_get:(s,def)=>def,be_util:null,be_info:null,be_mode:null,now:()=>Date.now(),get_param_from_state:()=>{},is_user_updated:()=>true,must_verify_email:()=>{},get_uuid_md5:()=>{},get_ab_test:()=>{}};E.init=_api=>{api=assign({},def_api,_api)};E.find_first_start_ts=(states,min)=>{if(!states)return min;for(let key in states){let{first_start_ts}=states[key];if(!min||first_start_ts<min)min=first_start_ts}return min};const CG=(s,def)=>api.conf_get(s,def);E.resolve_conf=(conf,query)=>{let res={};query=query||{};for(let c of conf){if(!c.conf||!svc_vpn_util.match_filter(query,c.filter))continue;let key=res.key;if(c.conf.key)key=res.key?res.key+"+"+c.conf.key:c.conf.key;let{watermark}=res;assign(res,c.conf,{key});if(c.conf.watermark)res.watermark=assign({},watermark,c.conf.watermark)}return res};const query_conf=query=>{let conf;if(query.is_android)conf=api.android_conf_get("trial_rules")||[];else if(query.is_ios)conf=api.ios_conf_get("trial_rules")||[];else conf=CG("trial_rules")||[];return E.resolve_conf(conf,query)};E.get_client_params_from_req=req=>{let get_param=p=>{let val=req.zparam(p);return val=="null"?null:val};let domain=get_param("domain");let url=get_param("url");let apk=get_param("apk");let uuid=get_param("uuid");if(url&&!domain)domain=svc_vpn_util.get_root_url(url);let now=api.now();let ext_ver=get_param("ext_ver");let app_ver=get_param("app_ver");let first_start_ts=+get_param("first_start_ts")||now;let is_android=uuid&&uuid.startsWith("apk-");let is_ios=uuid&&uuid.startsWith("ios-");let client_params={root_url:domain,apk,ext_ver,app_ver,is_android,is_ios,hola_apk:get_param("hola_apk"),app_id:is_android&&get_param("app_id"),hola_app:is_ios&&get_param("hola_app"),conf_ver:+get_param("conf_ver"),premium_site:+get_param("premium_site"),premium_apk:+get_param("premium_apk"),browser:get_param("browser"),os:get_param("os"),appid:get_param("appid"),svc_detected:+get_param("svc_detected")||0,hola_svc_detected:+get_param("hola_svc_detected")||0,uuid,uuid_md5:api.md5(uuid),src_country:get_param("src_country"),install_ver:get_param("install_ver")||ext_ver,install_ts:+get_param("install_ts")||now,first_start_ts,total_watch_time:+get_param("total_watch_time")||0,signed_in:+get_param("signed_in")||0,is_premium:+get_param("is_premium")||0,is_pro_grace_period:+get_param("is_pro_grace_period")||0,skipped_signin_ts:+get_param("skipped_signin_ts")||0,tmp_watermark_hide_ts:+get_param("tmp_watermark_hide_ts")||0,ab_test_name:get_param("ab_test_name"),ab_test_value:get_param("ab_test_value"),last_downloaded_svc_ts:+get_param("last_downloaded_svc_ts")||0,now};if(!query_conf(assign({},client_params,{root_url:domain,apk})).key)return{error:"trial_forbidden_domain"};return client_params};E.get_client_params=root_url=>{let now=api.now();let ext_ver=api.be_util.version();let client_params={now,root_url,ext_ver,conf_ver:CG("version"),uuid:api.be_ext.get("uuid"),uuid_md5:api.get_uuid_md5(),browser:api.be_util.browser(),appid:api.be_mode.get("svc.appid"),svc_detected:+api.be_mode.get("svc.detected")||0,hola_svc_detected:+api.be_mode.get("svc.hola_svc_detected")||0,os:api.be_util.os_guess.os,install_ver:api.be_util.install_version()||ext_ver,install_ts:api.be_util.install_ts()||now,first_start_ts:api.get_param_from_state("first_start_ts"),total_watch_time:api.get_param_from_state("total_watch_time"),cycle_n:api.get_param_from_state("cycle_n")||0,cycle_start_ts:api.get_param_from_state("start_ts"),interval_n:api.get_param_from_state("interval_n")||0,interval_start_ts:api.get_param_from_state("interval_ts"),tmp_watermark_hide_ts:+api.get_param_from_state("tmp_watermark_hide_ts")||0,signed_in:+!!api.be_ext.get("user_id"),skipped_signin_ts:+api.get_param_from_state("skipped_signin_ts")||0,is_premium:+!!api.be_ext.get("is_premium"),is_pro_grace_period:+!!api.be_ext.get("is_pro_grace_period"),src_country:(api.be_info.get("country")||"").toUpperCase()};let ab_test=api.get_ab_test();if(ab_test){client_params.ab_test_name=ab_test.name;client_params.ab_test_value=ab_test.value}client_params.premium_site=+!!svc_vpn_util.get_site_conf(CG(""),client_params,root_url,"premium_site");return client_params};class User_trials{constructor(states,client_params){states=states||{};this.trials={};this.ui_conf_tracker={};for(let key in states){let{root_url,apk}=states[key];let conf=query_conf(assign({},client_params,{root_url,apk}));if(!conf.key)continue;this.trials[conf.key]=new Trial(states[key],conf,client_params)}}get_states(){let states={};for(let key in this.trials)states[key]=this.trials[key].get_state();return states}get_trial(client_params,ignore_signin){if(client_params.is_premium)return;if(!ignore_signin&&this.need_signin(client_params))return;let conf=query_conf(client_params);if(!conf.key||conf.skip_trial)return;let trial=this.trials[conf.key];if(!trial)return;trial._conf=conf;return trial}start_trial(client_params){let conf=query_conf(client_params);if(!conf.key)throw new Error("trial_forbidden_domain");let trial=this.trials[conf.key];if(!trial){return this.trials[conf.key]=new Trial(null,conf,client_params)}trial.state.skipped_signin_ts=client_params.skipped_signin_ts;trial.start();return trial}check_ui_conf_change(client_params){let trial=this.get_trial(client_params);if(!trial)return;let old_conf_str=this.ui_conf_tracker[trial._conf.key];let new_conf_str=trial.get_ui_conf_str();let was_updated;if(old_conf_str&&old_conf_str!=new_conf_str)was_updated=true;this.ui_conf_tracker[trial._conf.key]=new_conf_str;if(was_updated)return trial}is_running(client_params){let trial=this.get_trial(client_params);return trial&&trial.is_running()}is_expired(client_params){let conf=query_conf(client_params);if(!conf.key)return;let trial=this.trials[conf.key];return trial&&this.need_trial(client_params)&&!trial.is_running()}is_watermark_hidden(client_params){let trial=this.get_trial(client_params);return trial&&trial.get_conf().is_watermark_hidden}can_hide_watermark(client_params){let trial=this.get_trial(client_params);if(trial)return trial.can_hide_watermark()}can_skip_signin(client_params){let conf=query_conf(client_params);if(!conf.key)return false;if(conf.skip_signin)return true;let type=(conf.signin_opt||{}).type||"force";if(type=="force")return false;return true}has_skipped_signin(client_params){let conf=query_conf(client_params);if(!conf.key)return;let type=(conf.signin_opt||{}).type||"force";if(type=="force")return;let trial=this.trials[conf.key];if(trial&&type=="cycle_start"&&trial.can_start_new_cycle())return trial.get_next_cycle_ts()<client_params.skipped_signin_ts;return client_params.skipped_signin_ts}need_signin(client_params){if(!api.is_user_updated()||client_params.signed_in&&!api.must_verify_email()){return false}let conf=query_conf(client_params);if(!conf.key)return false;if(conf.skip_signin)return false;if(this.has_skipped_signin(client_params))return false;return true}close_watermark(client_params){let trial=this.get_trial(client_params);if(trial)return trial.close_watermark()}close_bonus_tooltip(client_params){let trial=this.get_trial(client_params);if(trial)return trial.close_bonus_tooltip()}need_trial(client_params){if(client_params.is_premium)return;let conf=query_conf(client_params);if(!conf.key||conf.skip_trial)return;return!this.get_trial_active(client_params)}get_trial_active(client_params,ignore_ts,allow_stub){let trial=this.get_trial(client_params);if(!trial){if(!ignore_ts||!allow_stub)return;let conf=query_conf(client_params);if(!conf.key)return;let stub_trial=new Trial(null,conf,client_params,true);return stub_trial.get_obj()}if(ignore_ts||trial.is_running())return trial.get_obj()}get_next_interval_ts(client_params,subtract_wait){let trial=this.get_trial(client_params);if(!trial)return;let interval=trial.get_next_interval();if(!interval)return;if(subtract_wait)return interval.min_start_ts||interval.min_ts;return interval.min_ts}get_last_interval_end_ts(client_params){let trial=this.get_trial(client_params);if(trial)return trial.state.expire_ts}get_interval_dur(client_params){let trial=this.get_trial(client_params);if(!trial)return 0;let interval=trial.get_current_interval()||trial.get_n_interval(0);return interval.dur}get_total_cycle_time(client_params,for_wait_screen){let trial=this.get_trial(client_params);if(!trial)return 0;let{intervals}=trial.get_conf();let sum=0;for(let i=0;i<intervals.length;i++)sum+=intervals[i].dur;return sum}get_used_cycle_time(client_params,subtract_current){let trial=this.get_trial(client_params);if(!trial)return 0;let interval=trial.get_current_interval();if(!interval)return 0;let{intervals}=trial.get_conf();let sum=subtract_current?0:interval.dur;for(let i=0;i<interval.n&&intervals[i];i++)sum+=intervals[i].dur;return sum}get_used_trial_time(client_params,subtract_current){let trial=this.get_trial(client_params);if(!trial)return 0;let sum=trial.state.total_watch_time||0;if(subtract_current&&trial.is_running()){let interval=trial.get_current_interval();if(interval)sum-=interval.dur}return sum}get_trial_wait(client_params){let trial=this.get_trial(client_params);if(trial)return trial.get_wait()}is_wait_ended(client_params){let trial=this.get_trial(client_params);if(trial)return trial.is_wait_ended()}is_watermark_small(client_params){let trial=this.get_trial(client_params);return trial&&trial.get_conf().small_watermark}is_watermark_popcorn(client_params){let trial=this.get_trial(client_params);return trial&&trial.get_conf().popcorn_watermark}get_first_start_ts(min_ts){for(let key in this.trials){let{first_start_ts}=this.trials[key].state;if(!min_ts||first_start_ts<min_ts)min_ts=first_start_ts}return min_ts}get_trials_info(){let info=[];for(let key in this.trials)info.push(this.trials[key].get_info());return info}get_smart_suggestions(client_params){let trial=this.get_trial_active(client_params,true,true);return trial&&trial.conf.smart_suggestions}is_unlimited_trial(client_params){let trial=this.get_trial_active(client_params,true,true);return trial&&trial.conf.unlimited_trial}need_ext_pin_tip(client_params){let trial=this.get_trial_active(client_params,true,true);return trial&&trial.conf.ext_pin_tip}get_special_offer_menu(client_params){if(client_params.is_premium)return;let trial=this.get_trial_active(client_params,true,true);return trial&&!trial.conf.unlimited_trial&&trial.conf.special_offer_menu}}E.User_trials=User_trials;class Trial{constructor(state,conf,client_params,is_stub){this._conf=conf;if(state)this.state=state;else this.state=this.init_state(conf,client_params,is_stub)}init_state(conf,client_params,is_stub){client_params=client_params||{};let now=api.now();let interval=this.get_n_interval(0);let first_start_ts=client_params.first_start_ts||now;let state={conf_ver:client_params.conf_ver,cycle_n:1,total_interval_n:1,total_watch_time:interval.dur,skipped_signin_ts:client_params.skipped_signin_ts,first_start_ts,start_ts:now,interval_ts:now,expire_ts:now+interval.dur,interval_n:0,bonus_type:null};if(is_stub){assign(state,{cycle_n:0,total_interval_n:0,total_watch_time:0,first_start_ts:0,start_ts:0,interval_ts:0,expire_ts:0})}if(client_params.root_url)state.root_url=client_params.root_url;if(client_params.apk)state.apk=client_params.apk;return state}get_state(){let{state}=this;if(this.can_start_new_cycle())this.state.interval_n=0;return state}get_n_interval(n){let{intervals,wait=0}=this._conf;if(!intervals[n])return;let interval=assign({n},intervals[n]);interval.conf=assign({wait},interval.conf);return interval}get_current_interval(){return this.get_n_interval(this.state.interval_n||0)}get_next_cycle_ts(){let{expire_ts}=this.state;let{cycle=0}=this.get_conf();return expire_ts+cycle}can_start_new_cycle(){return this.get_next_cycle_ts()<=api.now()}get_next_interval(){let{expire_ts}=this.state;let{cycle=0}=this.get_conf();let first_interval=this.get_n_interval(0);let res_interval={min_ts:expire_ts+cycle,n:0,dur:first_interval.dur};if(res_interval.min_ts<api.now())return res_interval;let cur_interval=this.get_n_interval(this.state.interval_n||0);let min_ts=cur_interval&&expire_ts+cur_interval.conf.wait;let next_interval=cur_interval&&this.get_n_interval(cur_interval.n+1);if(next_interval&&min_ts<=res_interval.min_ts){res_interval={min_ts,min_start_ts:expire_ts,n:next_interval.n,dur:next_interval.dur}}let bonus_interval=this.get_bonus_interval();if(bonus_interval&&bonus_interval.min_ts<res_interval.min_ts)return bonus_interval;return res_interval}get_bonus_interval(){}start(){if(this.is_running()){api.perr("trial_start_already_running",this.get_obj());return}let now=api.now();let interval=this.get_next_interval();if(now<interval.min_ts){api.perr("trial_start_must_wait",this.get_obj());if(!CG("skip_trial_must_wait_error"))throw new Error("must_wait")}assign(this.state,{cycle_n:(this.state.cycle_n||0)+(interval.n==0?1:0),total_interval_n:(this.state.total_interval_n||0)+1,total_watch_time:(this.state.total_watch_time||0)+interval.dur,interval_ts:now,interval_n:interval.n,expire_ts:now+interval.dur,bonus_type:interval.bonus_type});if(interval.n==0)this.state.start_ts=now}get_wait(){if(this.can_start_new_cycle())return(this.get_conf().new_cycle||{}).wait;let interval=this.get_current_interval();if(interval)return interval.conf.wait}skip_signin(){this.state.skipped_signin_ts=api.now()}start_wait(){let now=api.now();if(this.can_start_new_cycle()){let wait=(this.get_conf().new_cycle||{}).wait;if(!wait)return;this.state.wait_start_new_cycle=true;this.state.wait_start_ts=now;this.state.wait_end_ts=now+wait;return true}this.state.wait_start_new_cycle=false;this.state.wait_start_ts=now;this.state.wait_end_ts=now+this.get_wait();return true}stop_wait(){this.state.wait_start_new_cycle=undefined;this.state.wait_start_ts=undefined;this.state.wait_end_ts=undefined}is_wait_ended(){return this.state.wait_end_ts&&this.state.interval_ts<this.state.wait_end_ts&&this.state.wait_end_ts<=api.now()}can_hide_watermark(){return this.get_conf().allow_tmp_watermark_hide}close_watermark(){this.state.tmp_watermark_hide_ts=api.now()}get_status(){let now=api.now();if(now<this.state.expire_ts)return"watch";if(this.get_conf().intervals.length-1<=this.state.interval_n)return"end";return"wait"}is_running(){return this.get_status()=="watch"}is_ended(){return this.get_status()=="end"}move_count(count){for(let i=0;i<count;i++){let next_interval=this.get_next_interval();let diff=next_interval.min_ts-api.now();if(diff>0)this.move_time(diff);this.start()}}move_time(time){for(let k in this.state){if(k.endsWith("_ts")&&this.state[k])this.state[k]-=time}}cur_interval_id(){return`${this.state.interval_n||0}/${this.state.cycle_n||0}`}get_conf(){if(!this.state)return this._conf;let override;let interval=this.get_current_interval();if(interval&&interval.conf)override=zutil.extend_deep({},interval.conf);let conf=zutil.extend_deep({},this._conf,override);if(this.state.wait_start_new_cycle)conf.autostart_after_wait=(conf.new_cycle||{}).autostart;if(conf.watermark&&conf.watermark.open_bonus_tooltip&&this.has_closed_bonus_tooltip()){conf.watermark=assign({},conf.watermark,{open_bonus_tooltip:false})}return conf}get_obj(){return assign({conf:this.get_conf()},this.state)}close_bonus_tooltip(){this.state.closed_bonus_tooltip=this.cur_interval_id()}has_closed_bonus_tooltip(){return this.cur_interval_id()==this.state.closed_bonus_tooltip}get_ui_conf_str(){const conf=this.get_conf();return[`small_watermark: ${!!conf.small_watermark}`,`popcorn_watermark: ${!!conf.popcorn_watermark}`,`can_hide_watermark: ${!!conf.allow_tmp_watermark_hide}`,`is_watermark_hidden: ${!!conf.is_watermark_hidden}`,`watermark: ${JSON.stringify(conf.watermark)}`].join(", ")}get_info(){let{root_url,apk}=this.state;let state=this.get_status();let intervals=this.get_conf().intervals;let n=this.state.interval_n||0;let time=0,sum=0;for(let i=0;i<n&&intervals[i];i++)time+=intervals[i].dur;for(let i=0;i<intervals.length;i++)sum+=intervals[i].dur;if(state=="watch"){let add=intervals[n]&&api.now()+intervals[n].dur-this.state.expire_ts;if(add>0)time+=add}else if(intervals[n])time+=intervals[n].dur;let drop_ms={drop_ms:1};let info=[];info.push(`cycle time: ${date.dur_to_str(time,drop_ms)}`+`/${date.dur_to_str(sum,drop_ms)}`);info.push("total intervals/cycles: "+`${this.state.total_interval_n||0} / ${this.state.cycle_n||0}`);info.push("total watch time: "+date.dur_to_str(this.state.total_watch_time||0,drop_ms));let first_start_ts=api.get_param_from_state("first_start_ts");info.push("since first_start_ts: "+date.dur_to_str(api.now()-first_start_ts||0,drop_ms));return{is_new:true,key:this._conf.key,domain:root_url,apk,state,info}}}class Activation_tracker{constructor(){this.data={};this.size=0}count_watch(site,dur_ms){if(!this.data[site]){this.data[site]={watch_time_ms:0};this.size++}this.data[site].watch_time_ms+=dur_ms}flush(){if(!this.size)return null;let res=this.data;this.data={};this.size=0;return res}}E.Activation_tracker=Activation_tracker;E.t={match_filter:svc_vpn_util.match_filter,query_conf};return E}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))})()},2227:(module,exports,__webpack_require__)=>{var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;var module;
// LICENSE_CODE ZON
"use strict";(function(){let is_node=typeof module=="object"&&module.exports&&module.children;var is_rn=typeof global=="object"&&!!global.nativeRequire||typeof navigator=="object"&&navigator.product=="ReactNative";if(!is_node&&!is_rn);else if(is_rn){}else;!(__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(932),__webpack_require__(6069),__webpack_require__(4336),__webpack_require__(5305),__webpack_require__(1291),__webpack_require__(9824),__webpack_require__(6386),__webpack_require__(843),__webpack_require__(6262),__webpack_require__(8425),__webpack_require__(6545),__webpack_require__(5317),__webpack_require__(4135)],__WEBPACK_AMD_DEFINE_RESULT__=function(date,zbrowser,zescape,zurl,zutil,zerr,etask,svc_vpn_util,version_util,events,array,rate_limit,rand){const E=new events.EventEmitter;const assign=Object.assign,ms=date.ms;const CACHE_TTL=ms.MIN,POLICY_TTL=5*ms.MIN,SEC=ms.SEC;const gen_ping_id=id=>id||(zutil.is_mocha()?"1111":Math.random());const ctx=[];let force_agent_changed;const extensions={archive:zutil.bool_lookup("7z apk arj bin bz deb dmg exe gz iso msi rar rpm tbz tgz xz zip"),media:zutil.bool_lookup("3gp avi f4v flv h264 m4a m4s m4v mkv mov mp3 mp4 ogg ogv swf ts wav "+"webm wmv"),static:zutil.bool_lookup("css eot gif ico jar jpeg jpg png svg svgz ttf webp woff")};const expected_types={archive:/^application\/(?!json$)/,media:/^((audio|video)\/|application\/octet-stream$)/};const CG=(s,def)=>api.conf_get&&api.conf_get(s,def);let cache={};let peer_domain_re;let user_plus=false;let _app_trial_mode=false;let active_reqs=[];let conf_rand_id;let hola_uid;let proxy_rules_engine;function ext_ver(){return(api.get_prod_info()||{}).ext_ver}function product_ver(){let info=api.get_prod_info()||{};return info.ext_ver||info.apk_ver||info.svc_ver}E.get_strategy=(strategy,ex,opt)=>{opt=opt||{};if(!ex)return strategy;if(opt.country){ex=ex.replace(new RegExp("\\b"+zescape.regex(opt.country)+"\\b"),"XX")}let m;if(m=ex.match(/PROXY XX\.POOL_(\w+)/)){m=m[1];ex="PROXY XX.POOL"}switch(ex){case"DIRECT":strategy={name:"direct"};break;case"BLOCK":strategy={name:"block"};break;case"PROXY XX":strategy.name="proxy";break;case"PROXY XX.direct_first":strategy.name="direct_first";break;case"PROXY XX.PEER":strategy.name="proxy";strategy.peer=true;break;case"PROXY XX.POOL":strategy.name="proxy";strategy.pool=m||true;break}return strategy};E.get_rule_strategy=(s,url,opt)=>{if(!url&&(opt.root_url||opt.src_country))url={orig:"",hostname:""};else if(!url||!url.hostname)return s;let ex=null;if(proxy_rules_engine){ex=proxy_rules_engine.find_proxy_for_url_exception(url.orig,url.hostname,opt)}return E.get_strategy(s,ex,opt)};E.handle_request=(url,opt)=>{opt=opt||{};if(opt.premium===undefined)opt.premium=user_plus||_app_trial_mode;if(typeof url=="string")url=zurl.parse(url,true);let top_url=typeof opt.top_url=="string"?zurl.parse(opt.top_url,true):opt.top_url;let strategy,centry=E.cache_access(url.hostname);let policy_key="policy:"+opt.country;let policy=centry.get(policy_key);if(policy=="blocked")strategy={name:"direct"};else if(opt.force=="peer"&&opt.strict)strategy={name:"proxy",peer:true};else if(opt.premium)strategy=E.get_rule_strategy({name:"proxy",peer:false},url,opt);else if(opt.force=="peer")strategy={name:"proxy"};else if(opt.force)strategy={name:opt.force,peer:false};else{strategy=opt.full_vpn?{name:"proxy"}:choose_strategy(url,opt);if(strategy&&strategy.name!="direct")strategy=E.get_rule_strategy(strategy,url,opt)}if(strategy.cache){let cached=centry.get(strategy.cache);if(cached)strategy={name:cached,peer:strategy.peer}}let peer=strategy.peer===true||strategy.peer===undefined&&peer_domain_re&&(peer_domain_re.test(url.hostname)||top_url&&peer_domain_re.test(top_url.hostname));let res=strategies[strategy.name].bind(null,{cache:centry,cache_key:strategy.cache,policy,policy_key,peer,expect_type:strategy.expect_type,strict:opt.strict,pool:strategy.pool,country:opt.country});res.desc=strategy.name;if(strategy.cache)res.desc+=" cache "+strategy.cache;if(peer&&strategy.name!="direct")res.desc+=" peer";if(strategy.name=="proxy"&&strategy.pool){res.desc+=" pool"+(typeof strategy.pool=="string"?"_"+strategy.pool:"")}return res};function choose_strategy(url,opt){let ext=url.ext&&url.ext.toLowerCase();if(opt.method&&opt.method!="GET")return{name:"proxy"};if(opt.type=="stylesheet"||opt.type=="image")return{name:"parallel",cache:"static",peer:false};if(url.query&&zurl.qs_parse(url.query,0,1).callback)return{name:"parallel"};if(extensions.archive[ext]){return{name:"direct_first",cache:"archive",peer:false,expect_type:expected_types.archive}}if(extensions.media[ext]||/=\d+-\d+\.dash/.test(url.file)||/Seg\d+-?Frag\d+/.test(url.pathname)||/\/QualityLevels\(\d+\)\/Fragments\(.+=\d+(,format=.+)?\)/.test(url.pathname)){return{name:"direct_first",cache:"media",peer:false,expect_type:expected_types.media}}if(extensions.static[ext])return{name:"parallel",cache:"static",peer:false};if(!user_plus&&!_app_trial_mode&&ext=="m3u8"){return{name:"direct_first",cache:"media",peer:false,expect_type:/mpegurl/i}}if(opt.type=="main_frame")return{name:"proxy"};if(url.protocol=="https:")return{name:"proxy"};return{name:"parallel"}}let last_user_type_set;E.set_user_plus=flag=>{if(user_plus==flag||Date.now()-last_user_type_set<2*ms.SEC)return;user_plus=flag;last_user_type_set=Date.now();return Object.keys(agents).map((a=>agents[a].reinit()))};E.set_app_trial_mode=mode=>{_app_trial_mode=mode};E.resp_match=(a,b)=>{if(a.code!=b.code)return{match:false,basis:"response code"};if(a.type!=b.type)return{match:false,basis:"content type"};if(a.etag||b.etag)return{match:a.etag==b.etag,basis:"etag"};if(a.len||b.len)return{match:a.len==b.len,basis:"content-length"}};E.unblocker_json_set=function(json,opt){proxy_rules_engine=new Proxy_rules_engine(json.unblocker_rules,{free:json.unblocker_globals,plus:json.unblocker_plus,pool_countries:json.pool_countries},opt||{ext:true});if(json.exceptions)E.set_peer_sites(json.exceptions.peer);E.emit("lib_event",{id:"unblocker_json_set",data:json})};E.is_pool_country=country=>proxy_rules_engine&&proxy_rules_engine.is_pool_country(country);E.get_all_browser_rules=(country,is_plus)=>proxy_rules_engine?proxy_rules_engine.get_all_browser_rules(country,is_plus):[];E.set_peer_sites=list=>{if(!list)return;peer_domain_re=new RegExp("(^|\\.)("+list.map(zescape.regex).join("|")+")$","i")};E.gen_rule=opt=>{let rule={name:opt.name,country:opt.country.toLowerCase(),peer:peer_domain_re&&peer_domain_re.test(opt.name)||opt.peer,force_peer:opt.force_peer,link:opt.name,description:opt.country.toUpperCase()+" VPN",type:opt.type||"url",enabled:opt.enabled!==undefined?!!opt.enabled:true,supported:true,root_url_orig:["**."+opt.name],root_url:[zurl.http_glob_url("**."+opt.name,1)],ts:opt.ts||Date.now(),mode:opt.mode||"unblock"};zutil.if_set(opt.src,rule,"src");zutil.if_set(opt.src_country,rule,"src_country");zutil.if_set(opt.ratings,rule,"ratings");zutil.if_set(opt.def_traffic,rule,"def_traffic");zutil.if_set(opt.proxy_traffic,rule,"proxy_traffic");zutil.if_set(opt.asnum,rule,"asnum");zutil.if_set(opt.cid,rule,"cid");zutil.if_set(opt.peer_country,rule,"peer_country");zutil.if_set(opt.peer_ip,rule,"peer_ip");zutil.if_set(opt.mitm,rule,"mitm");let pref=[];["def_traffic","proxy_traffic"].forEach((e=>opt[e]&&pref.push(e)));["asnum","cid","peer_country","peer_ip"].forEach((e=>opt[e]&&pref.push(opt[e])));rule.id=rule.name+"_"+rule.country+"_vpn"+(pref.length?"_"+pref.join("_"):"");return rule};class Cache_entry{constructor(){this.timers={}}get(key){return this[key]}put(key,value,ttl){this[key]=value;if(this.timers[key])clearTimeout(this.timers[key]);this.timers[key]=ttl&&setTimeout((()=>{delete this[key];delete this.timers[key]}),ttl);return this}put_weak(key,value,ttl){if(!this[key])this.put(key,value,ttl);return this}del(key){delete this[key];delete this.timers[key];return this}}E.cache_access=domain=>{let entry=cache[domain];if(!entry)entry=cache[domain]=new Cache_entry;return entry};E.cache_purge=()=>{cache={}};let strategies={direct:(opt,direct,proxy)=>{let res={direct:{}};if(!direct){res.direct.start=true;return res}if(direct.code||direct.error)res.direct.serve=true;return res},block:()=>({block:true}),proxy:(opt,direct,proxy)=>{if(opt.policy=="blocked"&&!opt.strict)return strategies.direct(opt,direct,proxy);let res={direct:{},proxy:{country:opt.country}};if(!proxy){res.proxy.start=true;res.proxy.peer=opt.peer;res.proxy.pool=opt.pool;res.proxy.allowed=opt.policy=="allowed";return res}if(opt.strict){res.proxy.abort=true;return res}if(handle_policy(proxy.policy,opt)=="blocked"){res.direct.start=true;return res}if(proxy.code||proxy.error)res.proxy.serve=true;zutil.if_set(opt.peer,res.proxy,"peer");zutil.if_set(opt.pool,res.proxy,"pool");return res},parallel:(opt,direct,proxy)=>{if(opt.policy=="blocked")return strategies.direct(opt,direct,proxy);let res={direct:{},proxy:{country:opt.country}};function serve_proxy(){if(proxy.hdrs_only){res.proxy.start=true;res.proxy.peer=opt.peer;res.proxy.pool=opt.pool;res.proxy.allowed=opt.policy=="allowed"}else res.proxy.serve=true;return!proxy.hdrs_only}if(!direct){res.direct.start=true;res.direct.timeout=true}if(!proxy){res.proxy.start=true;res.proxy.peer=opt.peer;res.proxy.pool=opt.pool;res.proxy.allowed=opt.policy=="allowed";res.proxy.hdrs_only=true}if(!direct||!proxy)return res;if(handle_policy(proxy.policy,opt)=="blocked")return strategies.direct(opt,direct,proxy);if(proxy.error){if(direct.code||direct.error)res.direct.serve=true;if(direct.error)res.proxy.serve=true;return res}if(!proxy.code)return res;if(!direct.code){if(!serve_proxy())return res;if(opt.cache_key&&direct.slow&&is_ok(proxy,opt.expect_type)){res.log="cache put weak proxy";opt.cache.put_weak(opt.cache_key,"proxy",CACHE_TTL)}else if(!opt.cache_key)res.direct.abort=true;return res}let m=E.resp_match(direct,proxy);if(!m){serve_proxy();return res}res.log=m.basis+(m.match?" match":" mismatch");if(m.match){res.direct.serve=true;if(!proxy.hdrs_only)res.proxy.serve=true;if(opt.cache_key){res.log+="; cache put direct";opt.cache.put(opt.cache_key,"direct",CACHE_TTL)}}else{if(!serve_proxy())return res;if(opt.cache_key){res.log+="; cache put proxy";opt.cache.put(opt.cache_key,"proxy",CACHE_TTL)}}return res},direct_first:(opt,direct,proxy)=>{if(opt.policy=="blocked")return strategies.direct(opt,direct,proxy);let res={direct:{},proxy:{country:opt.country}};if(!direct){res.direct.start=true;res.direct.timeout=true;return res}if(is_ok(direct,opt.expect_type)){res.direct.serve=true;if(opt.cache_key){res.log="cache del";opt.cache.del(opt.cache_key)}return res}if(!proxy){if(direct.slow||direct.code||direct.error){res.proxy.start=true;res.proxy.peer=opt.peer;res.proxy.pool=opt.pool;res.proxy.allowed=opt.policy=="allowed"}return res}if(handle_policy(proxy.policy,opt)=="blocked")return strategies.direct(opt,direct,proxy);if(proxy.code){if(opt.cache_key&&(is_ok(proxy,opt.expect_type)||!direct.code)){res.log="cache put proxy";opt.cache.put(opt.cache_key,"proxy",CACHE_TTL)}else if(proxy.code==302&&direct.code==302){if(proxy.location==direct.location)res.direct.serve=true;else{let p=zurl.parse(proxy.location,true);let d=zurl.parse(direct.location,true);if(p.path==d.path)res.direct.serve=true}}if(!res.direct.serve)res.proxy.serve=true;return res}if(proxy.error&&!direct.slow){res.direct.serve=true;if(direct.error)res.proxy.serve=true;return res}}};function is_ok(resp,expect_type){var res=resp.code>=200&&resp.code<300||resp.code==304;if(res&&expect_type)res=expect_type.test(resp.type);return res}function handle_policy(policy,opt){var m=/^(allowed|blocked)( domain)?$/.exec(policy);if(!m)return"allowed";opt.policy=m[1];if(opt.policy_key&&m[2])opt.cache.put(opt.policy_key,opt.policy,POLICY_TTL);return opt.policy}E.is_conf_allowed=on=>{if(!on)return;if(!conf_rand_id)api.storage.set("conf_rand_id",conf_rand_id=Math.random());return conf_rand_id<on};var api={},agents={},mem_storage={};var def_api={perr:opt=>{zerr("agent.perr not set, discarding "+opt.id)},ajax:opt=>{zerr("agent.ajax not set, discarding "+opt.url)},storage:{get:id=>mem_storage[id],set:(id,val)=>mem_storage[id]=val},get_auth:()=>void zerr("agent.get_auth not set"),get_prod_info:()=>({}),get_user_info:()=>({}),suspend_client:()=>({}),url_ccgi:"https://client.hola.org/client_cgi",get_url_ccgi:suffix=>api.url_ccgi+suffix,trigger:(ev,val)=>{},conf_get:(s,def)=>def,get_rule_routes:rule=>{var routes=[],s=zutil.pick(rule,"country");routes.push(s);if(rule.peer)routes.push(assign({peer:true},s));if(rule.pool)routes.push(assign({pool:rule.pool},s));return routes},get_fallback_agent:()=>{},is_proxy_auth_supported:()=>{}};const ERR_TIMER=500;const MAX_ERR_TIMER=15*ms.MIN;let lib_sp;E.init=set=>{E.sp=etask((function*unblocker_lib(){yield this.wait()}));return etask("init",(function*init(){assign(api,def_api,set);lib_sp=etask("lib_sp",(function*(){conf_rand_id=yield api.storage.get("conf_rand_id");hola_uid=yield api.storage.get("hola_uid");yield this.wait()}));E.sp.spawn(lib_sp);yield init_rules();const key=yield api.storage.get("agent_key");if(key)E.emit("lib_event",{id:"set_agent_key",data:key});E.on("not_working",on_not_working)}))};E.reset=()=>{active_reqs.forEach((e=>e.return()));active_reqs=[];Object.keys(agents).forEach((a=>agents[a].uninit()));agents={}};E.trigger=E.emit;E.uninit=()=>{lib_sp.return();E.reset();E.removeAllListeners();api={};rules=null};function Agent(o,parent){if(!(this instanceof Agent))return new Agent(o,parent);this.host=o.host;this.ip=o.ip;this.port=o.port;this.vendor=o.vendor;if(o.pool)this.pool=o.pool;if(o.port_list)this.port_list=o.port_list;this.parents=[];this.last_traffic=0;this.last_verified=0;this.err_timer=ERR_TIMER;this.auth_err_timer=ERR_TIMER;this.waiting=[];this.add_parent(parent);this.verify();this.proxy_auth()}Agent.prototype.is_verified=function(period){if(this.last_verified&&get_verify_conf("disable_verify"))return true;const ts=Math.max(this.last_traffic,this.last_verified);period=period||get_verify_conf("period_ms",10*ms.MIN)+5*ms.MIN;return Date.now()-ts<period};Agent.prototype.is_verify_err=function(){return this.error&&(this.error.err||"").startsWith("verify_")};Agent.prototype.parent_to_ctx=function(parent){return this.parents.find((p=>p.up==parent))};Agent.prototype.is_usable=function(parent){return!this.is_not_usable(parent)};Agent.prototype.err_ts=function(parent){parent=parent&&this.parent_to_ctx(parent);return this.error&&this.error.ts||parent&&parent.error&&parent.error.ts};Agent.prototype.is_not_usable=function(parent){parent=parent&&this.parent_to_ctx(parent);return this.error&&"error"||this.busy&&"busy"||this.bw_busy&&"bw_busy"||!this.is_verified()&&this.is_verify_running()&&"verifying"||!this.is_verified()&&!this.is_verify_running()&&"unverified"||!this.proxy_authed&&(this.proxy_auth_sp||{}).auth_running&&"authing"||!this.proxy_authed&&!(this.proxy_auth_sp||{}).auth_running&&"not_authed"||parent&&parent.error&&"parent error"};Agent.prototype.to_string=function(parent){return this.host+":"+this.port+"\t"+(this.pool||"reg")+"\t"+(this.is_not_usable(parent)||"usable")};Agent.prototype.is_verify_running=function(){return this.verify_sp&&this.verify_sp.verify_running};Agent.prototype.reverify=function(period){if(period&&(this.is_verify_running()||this.last_verified&&Date.now()-this.last_verified<=period)){return}this.last_verified=this.last_traffic=0;if(this.verify_sp)this.verify_sp.return();this.verify()};Agent.prototype.reauth=function(period){if(!this.last_proxy_authed||Date.now()-this.last_proxy_authed<=period)return;this.last_proxy_authed=0;if(this.proxy_auth_sp)this.proxy_auth_sp.return();this.proxy_auth()};Agent.prototype.add_parent=function(parent){this.parents.push({up:parent})};Agent.prototype.unset_error=function(){var _this=this;this.error=undefined;this.err_timer=ERR_TIMER;this.verify_error_n=0;this.parents.forEach((function(p){if(!p.error)p.up.unset_exclude(_this)}))};Agent.prototype.set_error=function(err,desc,rule,forget){var _this=this;if(rule)rule=zutil.pick(rule,"name","country");else this.error={err,desc,ts:Date.now()};if(this.is_verify_err())this.verify_error_n++;let c=get_verify_conf("verify_err",{period:2*ms.HOUR,count:10});forget=forget||!this.is_verified(c.period)&&this.verify_error_n>c.count;this.parents.forEach((function(p){if(rule&&!svc_vpn_util.find_rule(p.up.rules,rule))return;if(rule)p.error={err,desc,ts:Date.now()};if(forget)p.up.forget(_this,forget?"disabled":"verify_err");else p.up.set_exclude(_this)}));if(forget)this.uninit()};Agent.prototype.info=function(){var ret={host:this.host,ip:this.ip,port:this.port,vendor:this.vendor};zutil.if_set(this.version,ret,"version");zutil.if_set(this.bw_available,ret,"bw_available");zutil.if_set(this.rtt,ret,"rtt");zutil.if_set(this.country,ret,"country");zutil.if_set(this.pool,ret,"pool");zutil.if_set(this.error,ret,"error");zutil.if_set(this.port_list,ret,"port_list");return ret};Agent.prototype.wait_verified=function(){var _this=this;return etask((function*_wait_verified(){this.finally((()=>array.rm_elm(_this.waiting,this)));_this.waiting.push(this);return yield this.wait()}))};Agent.prototype.next_verify=function(){return this._next_verify};Agent.prototype.next_auth=function(){return this._next_auth};Agent.prototype.get_rule=function(){return this.parents[0].up.rules[0]};Agent.prototype.verify=function(){let _this=this,rule=this.get_rule();let ping_id=this.ip+"_"+gen_ping_id();let qs=assign({proxy_country:this.parents[0].up.country,ping_id,root_url:rule.link||rule.name},api.get_prod_info());this.verify_error_n=0;E.sp.spawn(etask({name:"verify_"+(this.host||this.ip)},(function*(){qs.key=yield api.storage.get("agent_key");let force_ip,force_post;let verify_err=(err,desc,url)=>{let info={url,host:_this.host,ip:_this.ip,err,err_desc:desc};unittest_resp_by_route(_this.parents.map((p=>p.up.route)),"ea",`<resp(fail=${err})`,this.req_id);svc_vpn_util.push_event("<verify_err",info);E.emit("lib_event",{id:"verify_done",data:info});_this.perr("verify_err",info);force_ip=!CG("disable_verify_fallback")&&_this.err_timer>ERR_TIMER&&err!="agent_err";force_post=force_ip;_this.err_timer=Math.min(_this.err_timer*4,MAX_ERR_TIMER);if(_this.err_timer==MAX_ERR_TIMER)force_ip=false;_this.set_error("verify_"+err,desc,undefined,err=="agent_err");_this.waiting.forEach((et=>et.continue()))};this.finally((()=>{delete _this.verify_sp}));for(;;){if(this.verify_running){svc_vpn_util.push_event("<verify",{host:_this.host,ip:_this.ip,rtt:_this.rtt})}this.verify_running=false;_this.verify_sp=this;if(_this.error){_this._next_verify=Date.now()+_this.err_timer;yield etask.sleep(_this.err_timer)}if(_this.last_verified&&get_verify_conf("disable_verify"))return;let ts=Math.max(_this.last_traffic||0,_this.last_verified||0);let now=Date.now();let period=get_verify_conf("period_ms",10*ms.MIN);if(ts&&now-ts<period){let timer=ts+period-now;_this._next_verify=now+timer;yield etask.sleep(timer);continue}this.verify_running=true;svc_vpn_util.push_event(">verify",{host:_this.host,ip:_this.ip});_this._next_verify=0;let url=api.get_verify_url?api.get_verify_url(_this,force_ip):"https://"+(_this.host||_this.ip)+":"+_this.port+"/verify_proxy";this.req_id=unittest_req_by_route(_this.parents.map((p=>p.up.route)),"ea",">req(url="+url+")");let ret,t0=Date.now();let method=force_post?"POST":"GET";try{if(api.be_dev_mode&&api.be_dev_mode.get("verify_ajax_fail")){yield etask.sleep(SEC);svc_vpn_util.push_event(">verify_ajax_fail");throw new Error("DEBUG_FORCE_FAIL")}ret=yield api.ajax({timeout:7*SEC,url,qs,method})}catch(e){verify_err(/timeout/.test(e)?"timeout":"unknown",""+e,url);continue}if(!ret||!ret.version){verify_err("empty","empty ret",url);continue}if(ret.error)return verify_err("agent_err",ret.error,url);_this.bw_available=ret.bw_available;_this.rtt=Date.now()-t0;_this.country=ret.country;_this.busy=ret.busy;_this.bw_busy=ret.bw_busy;_this.version=ret.version;_this.last_verified=Date.now();_this.unset_error();E.emit("lib_event",{id:"verify_done",data:{host:_this.host,ip:_this.ip,rtt:_this.rtt,url}});if(_this.busy||_this.bw_busy)_this.parents.forEach((p=>p.up.set_busy()));unittest_resp_by_route(_this.parents.map((p=>p.up.route)),"ea","<resp(data="+JSON.stringify(ret)+")",this.req_id);_this.waiting.forEach((et=>et.continue()));if(get_verify_conf("disable_periodic"))return}})))};Agent.prototype.proxy_auth=function(){if(!api.is_proxy_auth_supported()||!api.ajax_via_proxy||get_proxy_auth_conf("disable")){return void(this.proxy_authed=true)}let _this=this,rule=this.get_rule();let auth=api.get_auth()||{};let method=_this.last_method||"GET";let url;let on_auth_error=(err,desc)=>{_this.perr("proxy_auth_err",{host:_this.host,ip:_this.ip,err,err_desc:desc,method});_this.auth_err_timer=Math.min(_this.auth_err_timer*4,15*ms.MIN);_this.auth_error={err,desc}};return etask({name:"proxy_auth_"+(this.host||this.ip)},(function*(){this.finally((()=>{delete _this.proxy_auth_sp}));this.auth_running=false;_this.proxy_auth_sp=this;while(true){if(_this.auth_error){_this._next_auth=Date.now()+_this.auth_err_timer;yield etask.sleep(_this.auth_err_timer)}let now=Date.now(),ts=_this.last_proxy_authed;let period=get_proxy_auth_conf("period_ms",4*ms.HOUR);if(ts&&now-ts<period){let timer=ts+period-now;_this._next_auth=now+timer;yield etask.sleep(timer);continue}this.auth_running=true;_this._next_auth=0;if(api.proxy_preauth){let data={user:"user-uuid-"+auth.uuid,key:yield api.storage.get("agent_key")};url=api.get_auth_url(_this)+"?"+zurl.qs_str(data)}else{let ping_id=_this.ip+"_"+gen_ping_id();let data={ping:"proxy_auth",proxy_country:_this.parents[0].up.country,uuid:auth.uuid,root_url:rule.link||rule.name,ping_id};url="http://"+_this.ip.replace(/\./g,"_")+".proxy_auth.trigger.hola.org/hola_trigger?"+zurl.qs_str(data)}this.req_id=unittest_req_by_route(_this.parents.map((p=>p.up.route)),"ea",">req(url="+url+")");let ret;try{if(api.proxy_preauth){ret=yield api.ajax({timeout:7*SEC,url,full_response:true})}else{ret=yield api.ajax_via_proxy({url,type:method||"GET"},{timeout:7*SEC,rule,agent:_this,force:"proxy",src:"proxy_auth"})}}catch(e){on_auth_error(/timeout/.test(e)?"timeout":"unknown",""+e);continue}if(!ret||ret.status!=200){unittest_resp_by_route(_this.parents.map((p=>p.up.route)),"ea","<resp(fail=empty)",this.req_id);if(!ret||!ret.status)method={GET:"POST",POST:"GET"}[method];on_auth_error("fail","empty ret");continue}_this.last_method=method;_this.proxy_authed=true;_this.last_proxy_authed=Date.now();_this.auth_error=undefined;unittest_resp_by_route(_this.parents.map((p=>p.up.route)),"ea","<resp(status="+ret.status+")",this.req_id);if(get_proxy_auth_conf("disable_periodic"))return}}))};Agent.prototype.perr=function(id,info,err){let rule=zutil.pick(this.get_rule(),"name","country");info=assign({rule,proxy_country:rule.country,hola_uid},info);api.perr({info,id,err,rate_limit:{count:2}})};Agent.prototype.to_str=function(){let s=zutil.pick(this,"host","bw","bw_busy","busy","error","last_verified","last_traffic","ip","pool");return JSON.stringify(s)};Agent.prototype.uninit=function(){if(this.verify_sp)this.verify_sp.return();if(this.proxy_auth_sp)this.proxy_auth_sp.return()};function Agents(rule,route){if(!(this instanceof Agents))return new Agents(rule);this.rule=rule;this.rules=[rule];this.route=route.toLowerCase();var m;if(m=this.route.match(/\.pool_?(\w+)?/))this.pool=m[1]||true;this.exclude=[];this.agents=[];this.deselect={};this.deselected={};this.exclude_vendor={};this._log=[];this.limit=CG("verify_proxy.agent_num",3);this.country=rule.country;this.get_best_agent_waiting=[];this.rl={};agents[this.route]=this;this.init_key_monitor(12*ms.HOUR)}Agents.prototype.init_key_monitor=function(monitor_interval){if(!CG("enable_agent_key_monitor"))return;if(this.agent_key_monitor_sp)this.agent_key_monitor_sp.return();let _this=this;this.agent_key_monitor_sp=E.sp.spawn(etask((function*agent_key_monitor_sp(){yield etask.sleep(monitor_interval);for(;;){try{let ts=yield api.storage.get("agent_key_ts");let diff=Date.now()-ts;if(ts&&diff<monitor_interval){yield etask.sleep(monitor_interval-diff);continue}let{agent_key}=yield _this.zgettunnels(null,{agent_key_only:1});if(!agent_key)throw new Error("missing agent_key");yield api.storage.set("agent_key",agent_key);E.emit("lib_event",{id:"set_agent_key",data:agent_key});yield api.storage.set("agent_key_ts",Date.now())}catch(e){api.perr({id:"agent_key_update_err",rate_limit:{count:2}},e);yield etask.sleep(10*ms.MIN)}}})))};Agents.prototype.reverify=function(period){this.agents.forEach((a=>a.reverify(period)));this.exclude.forEach((a=>a.reverify(period)))};Agents.prototype.reauth=function(period){this.agents.forEach((a=>a.reauth(period)));this.exclude.forEach((a=>a.reauth(period)))};Agents.prototype.uninit=function(){if(this.agent_key_monitor_sp)this.agent_key_monitor_sp.return();this.uninited=true;this.agents.forEach((function(a){a.uninit()}));this.agents=[];this.exclude.forEach((function(a){a.uninit()}));this.exclude=[];this.deselect={};this.deselected={};this.exclude_vendor={};delete agents[this.route];if(this.load_agents_info_et)this.load_agents_info_et=void this.load_agents_info_et.return()};Agents.prototype.zgettunnels=function(ping_id,opt){opt=opt||{};let _this=this,fa;if((fa=api.be_dev_mode&&api.be_dev_mode.get("force_agent"))&&!api.be_dev_mode.get("force_until_change")){zerr.info("using force_agent %O instead of /zgettunnels req",fa);return{ip_list:{[fa.host]:fa.ip},protocol:{[fa.host]:"https"},vendor:{[fa.host]:"force_agent"},ztun:{[this.route]:[`HTTP ${fa.host}:${fa.port}`]},agent_types:{[this.route]:"hola"}}}let exclude=array.unique(this.exclude.concat(opt.exclude||[]).map((e=>e.host)));let ex_limit;if(ex_limit=CG("exclude_limit",9)){if(this.country=="us")ex_limit+=3;if(exclude.length>ex_limit)exclude=rand.rand_subset(exclude,ex_limit)}let deselect=[];for(let host in this.deselect){if(!this.deselected[host]){deselect.push(host);this.deselected[host]=true}}const auth=api.get_auth()||{};const data_params=["uuid","session_key","install_ts","install_ver","identity"];let data=zutil.pick(auth,...data_params);zutil.if_set(ping_id,data,"ping_id");let qs=assign({country:this.route,limit:opt.limit||this.limit},zutil.omit(auth,data_params));zutil.if_set(opt.agent_key_only,qs,"agent_key_only");let params={exclude,deselect};for(let p in params){if(params[p].length>1){data[p]=params[p].join(",");qs[p]=1}else if(params[p].length)qs[p]=params[p][0]}return etask((function*_zgettunnels(){this.on("uncaught",(e=>{api.perr({id:"zgettunnel_err",info:{country:_this.route,exclude,ping_id,hola_info:(e||{}).hola_info},rate_limit:{count:2}},e);throw e}));this.req_id=unittest_req_by_route(_this.route,"ec",">req(url="+api.get_url_ccgi("/zgettunnels?"+zurl.qs_str(assign({},qs,data))+")"));svc_vpn_util.push_event(">zgettunnels",{country:qs.country,exclude});if(api.be_dev_mode&&api.be_dev_mode.get("zgettunnel_ajax_slow")){svc_vpn_util.push_event(">zgettunnel_ajax_slow");yield etask.sleep(15*SEC)}if(api.be_dev_mode&&api.be_dev_mode.get("zgettunnel_ajax_fail")){svc_vpn_util.push_event(">zgettunnel_ajax_fail");throw new Error("DEBUG_FORCE_FAIL")}if(zutil.is_mocha())api.perr({id:"zgettunnel_req"});let res=yield api.ajax({url:api.get_url_ccgi("/zgettunnels"),method:CG("is_zgettunnels_post4")?"POST":"GET",qs,data,retry:3});svc_vpn_util.push_event("<zgettunnels",{country:qs.country,ip_list:res.ip_list});try{unittest_resp_by_route(_this.route,"ec","<resp(data="+JSON.stringify(res)+")",this.req_id)}catch(e){zerr("failed to generate test %s",e&&e.stack)}return res}))};Agents.prototype.add_agents=function(_agents,zgettunnels){this.type=zgettunnels.agent_types[this.route];for(let proxy_str of _agents){let[,host,port]=proxy_str.match(/^.* (.*):(.*)$/);let a={host,port,ip:zgettunnels.ip_list[host],vendor:zgettunnels.vendor&&zgettunnels.vendor[host]};zutil.if_set(zgettunnels.pool&&zgettunnels.pool[host],a,"pool");zutil.if_set(zgettunnels.port,a,"port_list");if(!a.pool)this.push(a);else if(this.pool==true){let route=svc_vpn_util.gen_route_str({country:this.country,pool:a.pool});let route_agent=set_agent_route(assign({},this.rule,{pool:a.pool}),route);route_agent.push(a);a=route_agent.find(a);this.push(a)}else this.push(E.find_agents(a)[0]||a)}};Agents.prototype.reinit=function(){this.rl={};this.uninited=undefined;this.agents.forEach((function(a){a.uninit()}));this.agents=[];this.exclude.forEach((function(a){a.uninit()}));this.exclude=[];this.deselect={};this.deselected={};this.exclude_vendor={};if(this.load_agents_info_et)this.load_agents_info_et=void this.load_agents_info_et.return();return this.load_agents_info(null,"reset")};Agents.prototype.load_agents_info=function(ping_id,reason){let _this=this;return etask((function*_load_agents_info(){if(_this.load_agents_info_et)return yield this.wait_ext(_this.load_agents_info_et);let usable=_this.agents.filter((a=>!_this.should_replace(a)));if(usable.length>=_this.limit){zerr.info("load_agents_info %s use existing %O",_this.route,_this.agents);return}let since_last_no_agents=Date.now()-_this.last_no_agents_ts;if(_this.last_no_agents_ts&&since_last_no_agents<CG("no_agents_period",5*ms.MIN)){zerr.info("load_agents_info %s - ignore zgettunnels, no agents",_this.route);return}let rl=CG("get_agents_rl",{count:2,period:ms.MIN});if(rl.count&&!rate_limit(_this.rl,rl.period,rl.count)){zerr.info("load_agents_info %s - ignore zgettunnels, max rate",_this.route);return}let exclude=_this.agents.concat(_this.exclude);_this.load_agents_info_et=this;this.finally((()=>{delete _this.load_agents_info_et}));let zgettunnels=yield _this.zgettunnels(ping_id,{exclude,limit:_this.limit-usable.length});zerr.info("zgettunnels %s ret %O",_this.route,zgettunnels);if(zgettunnels.blocked)return void api.suspend_client(zgettunnels.permanent);if(zgettunnels.agent_key){api.storage.set("agent_key",zgettunnels.agent_key);E.emit("lib_event",{id:"set_agent_key",data:zgettunnels.agent_key})}else{api.perr({id:"agent_key_miss",info:{ret:zgettunnels},rate_limit:{count:2}})}if(!zgettunnels.ztun)return;if(!_this.agents.length&&_this.exclude.length&&_this.exclude.every((a=>a.is_verify_err()))){api.perr({id:"verify_all_failed",info:{agents:_this.exclude.map((a=>a.info())),route:_this.route},rate_limit:{count:1}})}let new_agents=zgettunnels.ztun[_this.route]||[];zerr.info("%s agents set, reason %s, %O",_this.route,reason,new_agents);delete _this.last_no_agents_ts;if(!new_agents.length){_this.last_no_agents_ts=Date.now();if(!exclude.length){zerr.info("zgettunnels no agents for %s",_this.route);if(_this.pool&&!_this.agents.length&&!_this.exclude.length){api.perr({id:"forget_route",info:{route:_this.route},rate_limit:{count:1}});_this.uninit()}}}else _this.add_agents(new_agents,zgettunnels)}))};Agents.prototype.usable=function(){let count=0;for(let agent of this.agents)count+=agent.is_usable(this);return count};Agents.prototype.dump_agents=function(){console.log(this.route+" Agents:");this.agents.forEach((a=>console.log(a.to_string(this))));console.log(this.route+" Excludes:");this.exclude.forEach((a=>console.log(a.to_string(this))))};Agents.prototype.set_busy=function(){if(this.usable()<=1)this.load_agents_info(gen_ping_id())};Agents.prototype.remove=function(s,agent){let i=s.findIndex((a=>a.host==agent.host));if(i<0)return;s.splice(i,1);return true};Agents.prototype.move=function(s,d,agent){if(!this.remove(s,agent))return;d.push(agent);return true};Agents.prototype.unset_exclude=function(agent){this.move(this.exclude,this.agents,agent);delete this.deselect[agent.host];delete this.deselected[agent.host];if(!this.exclude.some((e=>e.vendor==agent.vendor)))delete this.exclude_vendor[agent.vendor]};Agents.prototype.set_exclude=function(agent){this.move(this.agents,this.exclude,agent);this.deselect[agent.host]=true;this.exclude_vendor[agent.vendor]=Date.now();if(this.usable()<=1)this.load_agents_info(gen_ping_id())};Agents.prototype.forget=function(agent,reason){this.remove(this.exclude,agent);this.remove(this.agents,agent);delete this.deselect[agent.host];delete this.deselected[agent.host];api.perr({id:"forget_agent",info:{agent:agent.info(),route:this.route,reason},rate_limit:{count:1}});if(this.usable()==0)this.load_agents_info(gen_ping_id())};Agents.prototype.log=function(s){this._log.push(s)};Agents.prototype.has_rule=function(rule){return this.rules.some((r=>r.name==rule.name))};Agents.prototype.add_rule=function(rule){if(this.has_rule(rule))return;this.rules.push(rule)};Agents.prototype.should_replace=function(agent){return(!agent||!Object.keys(agent).length)&&"empty"||agent.is_not_usable(this)};Agents.prototype.get_best_agent=function(ping_id){let _this=this;return etask({async:true},(function*get_best_agent(){if(_this.uninited)return;this.finally((()=>{delete _this.get_best_agent_sp;for(let sp of _this.get_best_agent_waiting)sp.return(this.retval);_this.get_best_agent_waiting=[]}));try{if(_this.get_best_agent_sp){_this.get_best_agent_waiting.push(this);return yield this.wait()}_this.get_best_agent_sp=this;let _agents=_this.get_chosen();if(!_agents.length){yield _this.load_agents_info(ping_id,"missing agents");_agents=_this.get_chosen();if(!_agents.length)return}let verified_agent=_agents.find((a=>a.is_verified()));if(verified_agent)return{chosen:verified_agent};for(let a of _agents){this.spawn(etask((function*wait_verify(){yield a.wait_verified();return a})))}let res=yield this.wait_child("any",(a=>a&&a.is_verified()));if(res)return{chosen:res.child.retval}}catch(e){return{error:""+e}}}))};Agents.prototype.get_all_agents=function(){const ret=this.agents.filter((a=>!this.should_replace(a)));return!ret.length?this.agents:ret};Agents.prototype.get_chosen=function(){let ret=[];let add=(cond,check_vendor)=>{let _agents=this.agents.filter((e=>cond(e)&&(!check_vendor||check_vendor&&e.vendor&&!this.exclude_vendor[e.vendor])));if(!_agents.length)return;_agents.sort(((a,b)=>a.rtt-b.rtt));ret=ret.concat(_agents.slice(0,3-ret.length))};add((a=>!this.should_replace(a,true)));if(ret.length==3)return ret;add((a=>this.should_replace(a)));if(ret.length==3)return ret;this.exclude.sort(((a,b)=>a.err_ts(this)-b.err_ts(this)));ret=ret.concat(this.exclude.slice(0,3-ret.length));return ret};Agents.prototype.get_fallback=function(){if(CG("disable_fallback_aagents"))return;return this.fallback_agent=this.fallback_agent||api.get_fallback_agent(this.country.toUpperCase())};Agents.prototype.push=function(agent){if(this.find(agent))return-1;if(agent instanceof Agent)agent.add_parent(this);else agent=new Agent(agent,this);return this.agents.push(agent)};Agents.prototype.find=function(agent){function cmp_agents(a,b){return(a.host==b.host||a.ip==b.ip)&&(!a.port||a.port==b.port)}return this.agents.find((a=>cmp_agents(agent,a)))||this.exclude.find((a=>cmp_agents(agent,a)))};Agents.prototype.to_str=function(){let s='"'+this.route+'":{"agents":[';this.agents.forEach(((a,i)=>{s+=(i?",":"")+a.to_str()}));s+='],"exclude":[';this.exclude.forEach(((a,i)=>{s+=(i?",":"")+a.to_str()}));return s+"]}"};E.find_agents=function(agent){let res=[];if(!agent.host&&!agent.ip)return res;for(let route in agents){let a=agents[route].find(agent);if(a)res.push(a)}return res};E.is_agent=o=>!!E.find_agents({ip:o,host:o})[0];E.update_chosen=agent=>{for(agent of E.find_agents(agent))agent.last_traffic=Date.now()};E.get_agents_by_route=route=>agents[route]?agents[route].get_all_agents():[];E.get_agents_type=route=>agents[route]&&agents[route].type;E.get_rule_routes=function(rule,raw){let routes=rule&&api.get_rule_routes?api.get_rule_routes(rule):[];return raw?routes:routes.map((r=>svc_vpn_util.gen_route_str(r)))};function set_agent_route(rule,route_str){if(agents[route_str])agents[route_str].add_rule(rule);else agents[route_str]=new Agents(rule,route_str);return agents[route_str]}E.get_agents=(ping_id,rule)=>etask((function*_get_agents(){let succ,res={rule,proxy_country:rule.country,verify_proxy:{}};ping_id=gen_ping_id(ping_id);active_reqs.push(this);this.finally((()=>array.rm_elm(active_reqs,this)));for(let route_str of E.get_rule_routes(rule)){let route_agents=set_agent_route(rule,route_str);this.spawn(etask((function*get_best_agent_child(){let ret=yield route_agents.get_best_agent(ping_id);if(!ret)return;if(ret.error){res.verify_proxy[route_str]=[];return}succ=true;let a={host:ret.chosen.host,port:ret.chosen.port,ip:ret.chosen.ip,type:route_agents.type,verified:true};zutil.if_set(ret.chosen.pool,a,"pool");zutil.if_set(ret.chosen.port_list,a,"port_list");let r={agent:a,res:{version:ret.chosen.version,ip:ret.chosen.ip,bw_available:ret.chosen.bw_available,country:ret.chosen.country},t:ret.chosen.t};zutil.if_set(ret.chosen.bw_busy,r.res,"bw_busy");zutil.if_set(ret.chosen.busy,r.res,"busy");res.verify_proxy[route_str]=[r]})))}try{yield this.wait_child("all",CG("get_agents_timeout",10*SEC));if(!succ)throw new Error("not_found")}catch(e){api.perr({id:"get_agents_err",rate_limit:{count:2}},e);res.info={error:"catch",err:""+e}}return res}));E.replace_agents=(rule,replace)=>etask((function*_change_agents(){if(!force_agent_changed&&api.be_dev_mode&&api.be_dev_mode.get("force_agent")&&api.be_dev_mode.get("force_until_change")&&(replace||[])[0].vendor=="force_agent"){force_agent_changed=true}for(let agent_obj of replace){for(let agent of E.find_agents(agent_obj))agent.set_error("force_change","by change agents",rule)}return yield E.get_agents(null,rule)}));let def_cc_states={wait:{wait:ms.MIN,next:"hola"},hola:{next:"zspeed",priority:1,type:"direct"},zspeed:{next:"hvpn",delay:ms.SEC,priority:1,type:"direct"},hvpn:{next:"holavpnextension",delay:ms.SEC,priority:1,type:"direct"},holavpnextension:{next:"holavpn",delay:ms.SEC,priority:1,type:"direct"},holavpn:{next:"holax",delay:ms.SEC,priority:1,type:"direct"},holax:{next:"hola_vpn",delay:ms.SEC,priority:1,type:"direct"},hola_vpn:{next:"holavpnrussia",delay:ms.SEC,priority:1,type:"direct"},holavpnrussia:{next:"http",delay:ms.SEC,priority:1,type:"direct"},http:{next:"connectivity",delay:ms.SEC,priority:3,type:"direct"},connectivity:{urls:["google.com","microsoft.com","wikipedia.org"],next:"wait",next_success:"common_agents"},common_agents:{next:"mem_agents",agents:"common_agents",retries:1,priority:2,type:"proxy"},mem_agents:{next:"build_agents",agents:"mem_agents",retries:1,priority:2,type:"proxy"},build_agents:{next:"cloud_agents",agents:"build_agents",retries:1,priority:2,type:"proxy"},cloud_agents:{agents:"cloud_agents",retries:1,priority:2,type:"proxy"}};let def_cc_api={ajax_via_proxy:undefined,perr:function(opt){zerr("cc.perr not set, discarding "+opt.id)}};let agent_fallback_domains=["zspeed-cdn.com","h-vpn.org","hola-vpn.com","holavpnrussia.com"];function ConnectivityCheck(opt){this.api={};assign(this.api,def_cc_api,opt.api);this.states={};assign(this.states,def_cc_states,opt.states);for(let name in this.states){let state=this.states[name]=assign({urls:[]},this.states[name]);state.name=name;if(state.name=="wait")continue;if(opt.ignore){state.ignore=opt.ignore instanceof RegExp?opt.ignore.test(name):opt.ignore.includes(name)}if(!state.urls||state.urls.length)continue;let is_agent_state=name.endsWith("_agents");let use_urls=is_agent_state?opt.hola:opt[name];if(!use_urls){state.ignore=true;continue}if(typeof use_urls=="string")use_urls=[use_urls];if(is_agent_state)use_urls=use_urls.slice(0,1);state.urls=use_urls}this.opt=opt;this.logs=[];this.perrs={}}ConnectivityCheck.prototype.reset=function(){if(this.et)this.et=this.et.return();this.selected=this.state=undefined};ConnectivityCheck.prototype.uninit=function(){this.reset()};ConnectivityCheck.prototype.log=function(log,state){this.logs.push({log,state})};ConnectivityCheck.prototype.perr=function(opt){let path=opt.info.name+"."+opt.id;if(zutil.get(this.perrs,path))return;zutil.set(this.perrs,path,true);if(opt.info&&this.opt.dbg_logs)opt.info.logs=this.logs.map((function(o){return o.log}));return this.api.perr(opt)};ConnectivityCheck.prototype.check=function(state,loop_et,mode){mode=mode||"syq";let _agents=this.opt[state.agents]||[],ret={error:"check failed"};let et_timeout,ts,_this=this,next=0;let send_next=()=>{if(_agents[next])delete _agents[next].timeout;if(!_agents.length||next+1==_agents.length)return;if(_agents[++next])state.urls.forEach((url=>et.spawn(send_ajax(url))));else et_timeout=setTimeout((()=>et.return(ret)),3e3)};let ajax_via_proxy=(url,type,opt)=>etask((function*ajax_wrapper(){let resp=yield _this.api.ajax_via_proxy({url,type},opt);if(resp)resp.test_url=url;return resp}));let send_ajax=url=>{let proto=state.name=="http"?"http":"https";url=url.startsWith("http")?url:proto+"://"+url+(url.includes("/")?"":"/");let agent=_agents.length?_agents[next]:null;let opt={always:true,hdrs_abort:true,ignore_redir:true,hdrs:{"Cache-Control":"no-cache,no-store,must-revalidate,"+"max-age=-1"},force_headers:true,fix_307:true,agent,force:agent?"proxy":"direct",src:"bg_ajax"};if(opt.force=="proxy")opt.prot="proxy";_this.log("ajax "+(_agents.length?"proxy ":"")+url);ts=Date.now();let _et=ajax_via_proxy(url,"GET",opt);if(agent)agent.timeout=setTimeout(send_next,3e3);else{et_timeout=setTimeout((()=>_et.return({orig_res:{error:"timeout"}})),5e3)}return _et};let et=etask((function*connectivity_check(){this.finally((()=>{clearTimeout(et_timeout);if(_agents.length)_agents.forEach((a=>clearTimeout(a.timeout)));let selected;if(!ret.error){if(state.next_success){_this.state=assign({},state);_this.retries=0;_this.state.next=state.next_success;if(mode=="parallel")selected={connected:true}}else{selected=assign({success_url:ret.url,ts:Date.now()},state);if(_agents.length)selected.agent=_agents[next];if(mode!="parallel"){_this.perr({id:"connectivity_check_success",rate_limit:{count:5},info:{name:state.name,mode,urls:state.urls,success:ret.url}})}}}else if(state.type!="proxy"||_agents.length){_this.perr({id:"connectivity_check_failed",rate_limit:{count:15},info:{name:state.name,mode,urls:state.urls,error:ret.error}})}if(mode!="parallel"&&selected)_this.selected=selected;loop_et.continue(selected)}));if(typeof _agents=="function")_agents=yield _agents();_agents=_agents||[];let tmp_agents=_agents.slice();if(!CG("disable_agent_domain_fallback")){for(let a of _agents){for(let d of agent_fallback_domains){let host=(a.host||"").replace("hola.org",d);tmp_agents.push(assign({},a,{host,fallback_domain:d}))}}}_agents=tmp_agents;if(state.agents&&!_agents.length)return;if(state.delay&&!zutil.is_mocha()&&mode=="parallel")yield etask.sleep(state.delay);state.urls.forEach((url=>this.spawn(send_ajax(url))));yield this.wait_child("any",(resp=>{if(!ret.error)return;clearTimeout(et_timeout);let _ret=resp&&resp.orig_res?resp.orig_res:{error:"ajax failed"};_ret.url=resp&&resp.test_url;_ret.statusCode=_ret.statusCode!=undefined?_ret.statusCode:_ret.code;if(_ret.statusCode>=400)_ret.error="bad status code "+_ret.statusCode;delete _ret.body;if(resp&&resp.agent&&resp.agent.timeout)clearTimeout(resp.agent.timeout);let proxy_err=_agents.length&&/ERR_PROXY_CONNECTION_FAILED/.test(_ret.error);_this.log("resp "+(_ret.error||_ret.statusCode)+" after "+(Date.now()-ts)+"ms",state);if(_ret.error||proxy_err){ret.error=_ret.error;return void send_next()}if(next){_this.perr({id:"connectivity_check_failed_agent",rate_limit:{count:2},info:{name:state.name,mode}})}return ret=_ret}))}));return et};ConnectivityCheck.prototype.get_state=function(){return this.state?this.states[this.state.next]:this.states.hola};ConnectivityCheck.prototype.run=function(opt){if(Date.now()-this.error_ts<10*ms.MIN)return;opt=opt||{};let _this=this;return etask({async:true},(function*run(){this.finally((()=>{_this.et=undefined}));if(_this.et)return yield this.wait_ext(_this.et);_this.error_ts=_this.retries=0;_this.et=this;_this.perrs={};while(!_this.selected){let state=_this.get_state();if(!state)break;let max=state.retries||_this.opt.retries||3;if(_this.retries==max||state.ignore){_this.retries=0;_this.state=state;continue}_this.retries++;let _agents=_this.opt[state.agents];if(_agents&&_agents instanceof ConnectivityCheck){if(!_agents.selected)yield _agents.run();if(_agents.selected){_this.perr({id:"connectivity_check_success",rate_limit:{count:5},info:{name:state.name,urls:state.urls}});let success_url=_this.opt.def_url||_agents.selected.success_url;return _this.selected=assign({success_url,agent:_agents.selected.agent},state)}continue}let wait_et;if(state.wait)wait_et=etask.sleep(state.wait);else if(_this.check(state,this))wait_et=this.wait();if(!wait_et)break;if(opt.on_state)opt.on_state(state);yield wait_et}if(!_this.selected&&!_this.error_ts){_this.perr({id:"connectivity_check_all_failed",rate_limit:{count:5},info:{url:_this.opt.hola}});_this.error_ts=Date.now()}return _this.selected||{error:"all_failed"}}))};ConnectivityCheck.prototype.run_parallel=function(opt){opt=opt||{};let _this=this,mode="parallel";return etask({async:true},(function*run_parallel(){this.finally((()=>_this.et=undefined));if(_this.et)return yield this.wait_ext(_this.et);_this.error_ts=_this.retries=0;_this.et=this;_this.perrs={};for(let type of["direct","proxy"]){const tests=[];for(let name in _this.states){let s=_this.states[name];if(!s.priority||s.ignore||s.type!=type)continue;tests.push(s)}if(!tests.length)continue;for(let test of tests){this.spawn(etask((function*run_parallel_child(){let res,_agents=_this.opt[test.agents];if(_agents&&_agents instanceof ConnectivityCheck){if(!_agents.selected)yield _agents.run_parallel();if(_agents.selected){let success_url=_this.opt.def_url||_agents.selected.success_url;res=assign({success_url,agent:_agents.selected.agent},test)}return res}let wait_et;if(_this.check(test,this,mode))wait_et=this.wait();if(!wait_et)return;if(opt.on_state)opt.on_state(test);let r=yield wait_et;return r})))}yield this.wait_child("any",(selected=>{if(!selected)return;if(selected.priority==1)return _this.selected=selected;if(selected.name&&(!_this.selected||_this.selected.priority>selected.priority)){_this.selected=selected}}));if(_this.selected){_this.perr({id:"connectivity_check_success",rate_limit:{count:5},info:{name:_this.selected.name,urls:_this.selected.urls,mode}});return _this.selected}_this.perr({id:"connectivity_check_all_failed",rate_limit:{count:5},info:{url:_this.opt.hola}});let res=yield _this.check(_this.states.connectivity,this,mode);if(!res||!res.connected)yield etask.sleep(_this.states.wait.wait)}return _this.selected||{error:"all_failed"}}))};ConnectivityCheck.prototype.is_completed=function(){return!!this.selected};ConnectivityCheck.prototype.get_selected_state=function(){return this.selected?this.selected.name:undefined};ConnectivityCheck.prototype.get_backend_link=function(){const s=this.selected;return s?{url:s.success_url,agent:s.agent,name:s.name}:{url:this.opt.def_url}};E.ConnectivityCheck=ConnectivityCheck;E.get_chosen_agent=function(route_opt,rule){let fa;if(!force_agent_changed&&(fa=api.be_dev_mode&&api.be_dev_mode.get("force_agent"))&&api.be_dev_mode.get("force_until_change")){return assign({vendor:"force_agent"},fa)}route_opt=route_opt||{};const route_str=svc_vpn_util.gen_route_str(route_opt,{no_algo:true});let chosen,route_agent=set_agent_route(rule,route_str);if(!(chosen=route_agent.get_chosen())||!chosen.length||chosen[0].replace){route_agent.get_best_agent(Math.random());return route_agent.get_fallback()}return chosen[0].info()};E.get_active_agents=function(rule){let _agents=[];E.get_rule_routes(rule,true).forEach((r=>{let a;if(a=E.get_chosen_agent(r,rule))_agents=_agents.concat(a)}));return _agents};E.resolve_agents=(rules,opt)=>etask((function*_resolve_agents(){let ping_id=gen_ping_id();for(let rule of rules)this.spawn(E.get_agents(ping_id,rule,opt));yield this.wait_child("all")}));E.verify_agents=(period,wait)=>etask((function*_verify_agents(){let unverified=new Set,ts=Date.now();for(let a in agents)agents[a].agents.forEach((ag=>unverified.add(ag)));for(let agent of unverified){if(!agent.last_verified||ts-agent.last_verified>period)agent.reverify(period);else unverified.delete(agent)}if(!wait)return;for(;;){for(let agent of unverified){if(ts-agent.last_verified<=period)unverified.delete(agent)}if(!unverified.size)return;yield etask.sleep(wait)}}));let gen_stamp=()=>Math.floor(Math.random()*4294967295);function commit_rules(update){rules.stamp=gen_stamp();if(update)gen_rules(rules.set);api.storage.set("rules",rules)}E.has_rule=function(o){if(!o)return;if(typeof o=="function"){for(let i in rules.set){if(o(rules.set[i]))return true}return}return svc_vpn_util.find_rule(rules.set,o)};function rules_fixup(){let change,now=Date.now();let country=api.get_user_info().country;for(let i in rules.set){let r=rules.set[i];let diff=now-(r.ts||0);if(!r.enabled)continue;if(r.country==country&&diff>ms.DAY&&r.mode!="protect"&&r.src_country&&r.src_country!=country){zerr.notice("disabled rule after country change site %s %s -> %s",r.name,r.src_country,r.country);api.perr({id:"disable_rule_country_changed",with_log:true,info:{rule:{name:r.name,country:r.country,src_country:r.src_country},src_country:country}});change=true;r.enabled=false}}if(change)commit_rules(true)}function _set_rule(opt,pair){let r,i;svc_vpn_util.push_event("set_rule",{name:opt.name,src:opt.src,pair,country:opt.country,enabled:opt.enabled,mode:opt.mode,del:opt.del,mitm:opt.mitm});if(!rules||!opt.name||!opt.country)return;if(!rules.generated)rules.generated={};if(!rules.set)rules.set={};for(i in rules.set){r=rules.set[i];if(r.name!=opt.name||opt.src&&opt.src!=r.src)continue;delete rules.generated[i];delete rules.set[i]}if(!opt.del){if(opt.name.match(/^https?:\/\//))opt.name=svc_vpn_util.get_root_url(opt.name);r=E.gen_rule(opt);rules.generated[r.id]=r;rules.set[r.id]={name:r.name,country:r.country,enabled:r.enabled,ts:r.ts,mode:r.mode,src:r.src,src_country:r.src_country||""};zutil.if_set(opt.def_traffic,rules.set[r.id],"def_traffic");zutil.if_set(opt.proxy_traffic,rules.set[r.id],"proxy_traffic");zutil.if_set(opt.asnum,rules.set[r.id],"asnum");zutil.if_set(opt.cid,rules.set[r.id],"cid");zutil.if_set(opt.peer_country,rules.set[r.id],"peer_country");zutil.if_set(opt.peer_ip,rules.set[r.id],"peer_ip");zutil.if_set(opt.mitm,rules.set[r.id],"mitm")}if(pair)return;let root_urls=get_root_urls(opt.name);for(i=1;i<root_urls.length;i++)_set_rule(assign({},opt,{name:root_urls[i]}),true)}E.get_site_key=root_url=>{let sites=CG("sites",{});for(let k in sites){let v=sites[k];let urls=Array.isArray(v.root_url)?v.root_url:[v.root_url];if(urls.includes(root_url)&&v.min_ver&&version_util.cmp(ext_ver(),v.min_ver)>=0){return k}}};E.get_site_conf=root_url=>CG("sites."+E.get_site_key(root_url));function get_root_urls(domain){let site=E.get_site_conf(domain);return site?[...new Set([domain].concat(site.root_url))]:[domain]}E.set_rule=function(opt){if(!rules)return;opt=assign({ts:Date.now()},opt);unittest_set_rule(opt);E.emit("lib_event",{id:"before_rule_set",data:opt.name});_set_rule(opt);commit_rules()};function gen_rules(set){if(!set)return;rules.generated=null;rules.set=null;for(let i in set)_set_rule(set[i])}function is_supported_country(op,rule){if(!rule.country)return true;let c=rule.country;if(!c.list||!c.type||!(c.list instanceof Array))return true;if(c.type=="in"&&(!op.country||!c.list.includes(op.country))||c.type=="not_in"&&op.country&&c.list.includes(op.country)){return false}return true}function get_filtered_rules(urules,op){if(!urules)return;var m,res={};for(var i in urules){if(!is_supported_country(op,urules[i]))continue;res[i]=urules[i];if(!(m=urules[i].match))continue;if(m.min_ver&&version_util.cmp(product_ver(),m.min_ver)<0||m.browser&&!m.browser.includes((api.get_prod_info()||{}).browser)){delete urules[i].match}}return res}E.set_rules=_rules=>{let opt={country:api.get_user_info().country};let need_update=rules.enable!=_rules.enable||!zutil.equal_deep(rules.blacklist,_rules.blacklist)||["globals","plus"].some((e=>!zutil.equal_deep(rules[e],get_filtered_rules(_rules["unblocker_"+e],opt))));if(need_update){rules.globals=get_filtered_rules(_rules.unblocker_globals,opt);rules.plus=get_filtered_rules(_rules.unblocker_plus,opt);rules.blacklist=_rules.blacklist;rules.enable=_rules.enable;api.storage.set("rules",rules)}};E.get_rules=()=>{if(!rules)return null;rules_fixup();if(!rules.globals)return null;let json={unblocker_rules:rules.generated||{},stamp:rules.stamp,enable:rules.enable,blacklist:rules.blacklist};["globals","plus"].forEach((e=>json["unblocker_"+e]=rules[e]));return zutil.clone_deep(json)};E.get_groups=groups=>{let ret={unblocker_rules:{}};for(let group of groups){let r=E.gen_rule(group);ret.unblocker_rules[r.id]=r}return zutil.clone_deep(ret)};function agents_to_unittest_str(rule){let routes=E.get_rule_routes(rule);let _s='"def":{';for(let route in agents){if(!rule||routes.includes(route))_s+=agents[route].to_str()}return"{"+_s+"}}"}E.reauth_country_agents=(country,period)=>{if(CG("reauth.disable"))return;period=period!==undefined?period:CG("reauth.period",5*ms.MIN);for(let route in agents){let agent=agents[route];if(agent.country==country)agent.reauth(period)}};E.reverify_country_agents=country=>{let period=get_verify_conf("reverify_period_ms",5*ms.MIN);for(let a in agents){let agent=agents[a];if(agent.country==country)agent.reverify(period)}};let get_ctx=id=>ctx.find((c=>c.id==id));E.add_ctx=function(id,rule,data){try{E.del_ctx(id);ctx.push({id,rule,data,ts:Date.now(),ids:{ew:0,bw:0,ea:0,ec:0},reqs:{},routes:E.get_rule_routes(rule),unittest:[],src:data.src});if(!gen_auto_unittest())return;c_unittest_push(id,"open(country="+api.get_user_info().country+' date="'+date.to_sql(new Date)+'" auto user_plus='+user_plus+" set_agents="+agents_to_unittest_str(rule)+")");c_unittest_push(id,"set_rule(raw="+JSON.stringify(rule)+")");c_unittest_push(id,"nav(url="+data.src+")");if(ctx.length>20)ctx.splice(0,10)}catch(e){console.error(e)}};E.del_ctx=id=>array.rm_elm(ctx,get_ctx(id));let agent_num=host=>host.match(/[a-z]+([0-9]+)/)[1];E.on_before=(url,req_id,ctx_id,data)=>{if(!gen_auto_unittest())return;try{let c=get_ctx(ctx_id);if(!c)return;c_unittest_push(ctx_id,"bw",">req(url="+url+" "+(data.strategy?'strategy="'+data.strategy+(data.agent?".z"+agent_num(data.agent):"")+'"':"")+")",req_id)}catch(e){console.error(e)}};E.on_completed=(req_id,ctx_id,data)=>{if(!gen_auto_unittest())return;try{let c=get_ctx(ctx_id);if(!c)return;let req=c.unittest.find((u=>u.req_id==req_id));if(!req)return;c_unittest_push(ctx_id,"bw",'<resp(status="'+(data.status||0)+'"'+(data.hdrs?" hdrs="+JSON.stringify(zutil.pick(data.hdrs,"content-length","x-hola-response","x-hola-error","location")):"")+")",req_id,req.roles_id)}catch(e){console.error(e)}};E.dump_unittest=ctx_id=>{let c=get_ctx(ctx_id);if(c)c.unittest.forEach((u=>console.log(u.s)))};class Proxy_exceptions{constructor(){this.ips=[];this.match_root_url={};let rule_props=["hosts","root_urls","src_country","proxy_country"];for(let name of rule_props){this[name]={};this[name+"_cache"]={};this[name+"_counter"]=0}}}let regex_ip2=/^((\d{1,3}\.){3}\d{1,3})(\/(\d+))?$/;class Proxy_rules_engine{constructor(unblocker_rules,proxy_rules,opt){this.proxy_rules=proxy_rules||{};opt=opt||{};this.opt={redir_direct:opt.redir_direct===undefined||opt.redir_direct,proxy_port:opt.proxy_port||6857,redir_port:opt.redir_port||6850,ext:opt.ext||0,by_rules:opt.by_rules||0,do_redir:opt.do_redir||0};this.hosts={hosts:{},ips:[],hosts_cache:{},hosts_counter:0};if(!this.opt.by_rules){for(let i in unblocker_rules){let rule=unblocker_rules[i];if(rule.internal||this.opt.ext&&!rule.enabled)continue;this.parse_cmds(i,rule,unblocker_rules,this.hosts)}}else{this.rules={};for(let i in unblocker_rules){let rule=unblocker_rules[i];if(rule.internal||this.opt.ext&&!rule.enabled)continue;if(!rule.root_url){this.parse_cmds(i,rule,unblocker_rules,this.hosts);continue}if(!rule.cmds)continue;this.rules[i]={hosts:{},ips:[],hosts_cache:{},hosts_counter:0};this.parse_cmds(i,rule,unblocker_rules,this.rules[i],1)}}this.exceptions=this.parse_exceptions(this.proxy_rules.free);this.exceptions_plus=this.parse_exceptions(this.proxy_rules.plus)}is_pool_country(country){return(this.proxy_rules.pool_countries||{})[country.toUpperCase()]}find_proxy_for_url_exception(url,host,opt){opt=opt||{};let rules=opt.is_trial||!opt.premium?this.exceptions:this.exceptions_plus;let ret;if(!(ret=this.find_proxy_for_match(url,host,rules,opt))){ret=this.find_proxy_for_url_exception_int(url,host,opt.root_url,rules,opt)}return ret&&ret.str}find_proxy_for_val(url,host,hosts,opt){opt=opt||{};if(!opt.name||!opt.val)return;let do_redir=this.opt.do_redir;let cname=opt.name+"_cache",counter=opt.name+"_counter";if(hosts[cname]){let c=hosts[cname][opt.val];if(c&&c.func)return c.func(url,host,do_redir,opt);if(c)return this.pac_redir(url,host,do_redir)}if(hosts[counter]>5e3){hosts[counter]=0;hosts[cname]={}}let func;if(!(func=hosts[opt.name][opt.val]))return;hosts[cname][opt.val]={func};hosts[counter]++;return func(url,host,do_redir,opt)}find_proxy_for_url_exception_int(url,host,root_url,rules,opt){let ret=this.find_proxy_for_url(url,host,rules,{exception:1});if(!ret&&root_url){ret=this.find_proxy_for_val(url,host,rules,{name:"root_urls",val:root_url,exception:1})}if(!ret&&opt.src_country){ret=this.find_proxy_for_val(url,host,rules,{name:"src_country",val:opt.src_country,exception:1})}if(!ret&&opt.proxy_country){ret=this.find_proxy_for_val(url,host,rules,{name:"proxy_country",val:opt.proxy_country,exception:1})}return ret}find_pac_proxy(url,host){let ret=this.find_proxy_for_url(url,host,this.hosts);if(ret.proxy){let ex=this.find_proxy_for_url(url,host,this.exceptions,{exception:1,orig_proxy:ret.str});if(ex)ret=ex}return ret.str}find_proxy_for_url(url,host,hosts,opt){opt=opt||{};let do_redir=this.opt.do_redir;if(hosts.hosts_cache){let c=hosts.hosts_cache[host];if(c&&c.func)return c.func(url,host,do_redir,opt);if(c)return this.pac_redir(url,host,do_redir)}if(hosts.hosts_counter>5e3){hosts.hosts_counter=0;hosts.hosts_cache={}}if(zurl.is_ip(host)){let ip=zurl.ip2num(host);let ips=hosts.ips;for(let i=0;i<ips.length;i++){let _ip=ips[i];if(ip>>>_ip.bits<<_ip.bits^_ip.mask)continue;hosts.hosts_cache[host]={func:_ip.func};hosts.hosts_counter++;return _ip.func(url,host,do_redir,opt)}}let index=-1;for(;;){let func=hosts.hosts["*"]||hosts.hosts[host.substr(index+1)];if(func){hosts.hosts_cache[host]={func};hosts.hosts_counter++;return func(url,host,do_redir,opt)}if((index=host.indexOf(".",index+1))<0)break}if(opt.exception)return null;hosts.hosts_cache[host]={};hosts.hosts_counter++;return this.pac_redir(url,host,do_redir)}find_proxy_for_match(url,host,rules,opt){if(!rules.match_root_url||!opt.root_url)return opt.orig_proxy;opt=opt||{};for(let root_url of[opt.root_url,opt.real_root_url,""]){let mr,mrules;if(root_url===undefined||!(mrules=rules.match_root_url[root_url])){continue}mr=mrules.find((r=>{if(r.fsrc_country&&!r.fsrc_country.includes(opt.src_country)){return false}if(r.fproxy_country&&!r.fproxy_country.includes(opt.proxy_country)){return false}return true}));if(mr){return this.find_proxy_for_url_exception_int(url,host,root_url||opt.root_url||opt.real_root_url,mr,opt)}}}parse_exceptions(rules){if(!rules)rules={};let exceptions=new Proxy_exceptions;for(let name in rules){let rule=rules[name];if(rule.match)this.parse_match(name,rule,exceptions);else this.parse_cmds(name,rule,rules,exceptions)}return exceptions}pac_redir(url,host,do_redir){if(!do_redir||!this.opt.redir_direct)return{proxy:false,str:"DIRECT"};if(zbrowser.isPlainHostName(host))return{proxy:false,str:"DIRECT"};let m=url.match(/^.+:([0-9]+)\/.*$/);if(m&&m.length==2&&m[1]!="80")return{proxy:false,str:"DIRECT"};if(url.match(/^https:.*$/))return{proxy:false,str:"DIRECT"};return{proxy:false,str:"PROXY 127.0.0.1:"+this.opt.redir_port+"; DIRECT"}}handle_then(value,url,host,do_redir,exception,orig_proxy){if(value=="DIRECT")return this.pac_redir(url,host,do_redir);if(value=="BLOCK")return{block:true,str:"BLOCK"};let n=value.split(" ");if(exception&&n[0]=="PROXY"){if(n.length==1)return null;if(n[1].startsWith("XX")&&orig_proxy){let c=orig_proxy.split(" ")[1].split(".")[0];return{proxy:true,str:"PROXY "+n[1].replace("XX",c)}}}if(n.length<2)return this.pac_redir(url,host,do_redir);else if(!{PROXY:1,SOCKS:1,SOCKS5:1,HTTPS:1}[n[0]])return this.pac_redir(url,host,do_redir);if(this.opt.ext)return{proxy:true,str:value};return{proxy:true,str:"PROXY 127.0.0.1:"+this.opt.proxy_port}}static get_ext(url){let ext="",index=url.indexOf("?");if(index>=0)url=url.slice(0,index);let ext_index=url.lastIndexOf(".",url.length);let _ext_index=url.lastIndexOf("/",url.length);if(ext_index>=0&&ext_index>_ext_index)ext=url.slice(ext_index+1);else if(_ext_index>=0)ext=url.slice(_ext_index+1);return ext}host_cb(name,rule,cmd,url,host,do_redir,opt){if(!cmd["if"]){if(cmd.dst_dns){return this.handle_then(cmd.then,url,host,do_redir,opt.exception,opt.orig_proxy)}cmd["if"]=[]}let ext=Proxy_rules_engine.get_ext(url);for(let i=0;i<cmd["if"].length;i++){let _if=cmd["if"][i];let arg=null,value=null;let type="==";if(!_if.then)continue;if(_if.type)type=_if.type;if(_if.host){arg=host;value=_if.host}else if(_if.url){arg=url;value=_if.url}else if(_if.ext){arg=ext;value=_if.ext}else if(_if.main){arg=opt.is_main;value=_if.main}else continue;let cmp;switch(type){case"==":cmp=arg==value;break;case"!=":cmp=arg!=value;break;case"=~":cmp=arg.match(value);break;case"!~":cmp=!arg.match(value);break;case"=a":case"in":cmp=value.includes(arg);break;case"!a":case"not_in":cmp=!value.includes(arg);break;case"=o":cmp=!!value[arg];break;case"!o":cmp=!value[arg];break;default:continue}if(cmp){return this.handle_then(_if.then,url,host,do_redir,opt.exception,opt.orig_proxy)}if(_if["else"]){return this.handle_then(_if["else"],url,host,do_redir,opt.exception,opt.orig_proxy)}}return this.handle_then(cmd.then,url,host,do_redir,opt.exception,opt.orig_proxy)}set_rule(name,rule,cmd,hosts){let add=prop=>{if(!cmd[prop]||!hosts[prop])return;for(let i=0;i<cmd[prop].length;i++){let val=cmd[prop][i];hosts[prop][val]=(url,host,do_redir,opt)=>this.host_cb(prop,rule,cmd,url,host,do_redir,opt)}return true};let _cif=cmd["if"];if(_cif){for(let i=0;i<_cif.length;i++){let _if=_cif[i];if(_if.type=="=~"||_if.type=="!~"){if(_if.host)_if.host=new RegExp(_if.host);else if(_if.url)_if.url=new RegExp(_if.url);else if(_if.ext)_if.ext=new RegExp(_if.ext)}}}if(!cmd.hosts){if(add("root_urls"))return;if(add("src_country"))return;if(add("proxy_country"))return;hosts.hosts["*"]=(url,host,do_redir,opt)=>this.host_cb(name,rule,cmd,url,host,do_redir,opt);return}for(let i=0;i<cmd.hosts.length;i++){let _host=cmd.hosts[i],n;if(n=_host.match(regex_ip2)){if(!cmd.ips)cmd.ips=[];let bits=32-(n[4]?+n[4]:32);if(bits<0)bits=0;let mask=zurl.ip2num(n[1])>>>bits<<bits;hosts.ips.push({mask,bits,func:(url,host,do_redir,exception)=>this.host_cb(name,rule,cmd,url,host,do_redir,exception)});continue}hosts.hosts[_host]=(url,host,do_redir,opt)=>this.host_cb(name,rule,cmd,url,host,do_redir,opt)}}parse_cmds(name,rule,rules,exceptions,by_rules){let cmds=rule.cmds;if(!cmds)return;for(let i=0;i<cmds.length;i++){let cmd=cmds[i];if(cmd.rule){let _name=cmd.rule;return this.parse_cmds(_name,rules[_name],rules,exceptions)}if(!cmd.hosts&&!by_rules&&!cmd.root_urls&&!cmd.src_country&&!cmd.proxy_country||!cmd.then){continue}this.set_rule(name,rule,cmd,exceptions)}}parse_match(name,rule,exceptions){let match=rule.match;if(!match||!match.rules||!match.root_urls)return;let res=[];for(let r of match.rules){let ex=new Proxy_exceptions;res.push(ex);this.parse_cmds(name,r,match,ex);ex.fsrc_country=r.src_country;ex.fproxy_country=r.proxy_country}match.root_urls.forEach((function(root_url){exceptions.match_root_url[root_url]=res}))}push(bw_rule,req){let acc=this.data[bw_rule.id];if(acc&&acc.rule!=req.opt.rule)this._send(bw_rule,acc);acc=this.data[bw_rule.id]=this.data[bw_rule.id]||{len:0,ms:0,rule:req.opt.rule};acc.len+=+req.proxy_resp.len;acc.ms+=Date.now()-req.start_ts;if(acc.len>(bw_rule.sample_size||10*1024*1024))this._send(bw_rule,acc)}get_all_browser_rules(proxy_country,is_plus){if(!proxy_country)return{};proxy_country=proxy_country.toUpperCase();let def=`PROXY ${proxy_country}`;let hosts_map={default:def};let rules=is_plus?this.proxy_rules.plus:this.proxy_rules.free;const replace_XX=then=>then.replace(/\bXX\b/,proxy_country);const country_match=rule_country=>!Array.isArray(rule_country)||rule_country.includes(proxy_country);const add_host_rule=(host,then)=>{then=replace_XX(then);if(then==def)return;let m=then.match(/PROXY ([A-Z]{2})/);if(m&&m[1]!=proxy_country)return;if(hosts_map[host]&&hosts_map[host]!=then)zerr(`override ${host} rule: ${hosts_map[host]} -> ${then}`);hosts_map[host]=then};for(let name in rules){let subrules=zutil.get(rules[name],"match.rules");if(!Array.isArray(subrules))subrules=[rules[name]];for(let rule of subrules){if(!rule||!Array.isArray(rule.cmds))continue;if(!country_match(rule.proxy_country))continue;for(let cmd of rule.cmds){let hosts=cmd.hosts||cmd.root_urls;if(!country_match(cmd.proxy_country)||!hosts||!hosts.length){continue}for(let host of hosts)add_host_rule(host,cmd.then)}}}return{hosts_map}}}function c_unittest_push(ctx_id,roles,req,req_id,roles_id){if(arguments.length==2){req=roles;roles=null}let c;if(!(c=get_ctx(ctx_id)))return;if(!roles)return void c.unittest.push({s:req,req_id});roles_id=roles_id||++c.ids[roles];c.unittest.push({s:roles+roles_id+req,req_id,roles_id})}function on_not_working(id,e){let c;if(gen_auto_unittest()&&(c=get_ctx(id)))e.unittest=c.unittest.map((u=>u.s)).slice(0,300);api.perr({id:"be_not_working_trigger",info:e,rate_limit:{count:5,ms:date.ms.MIN}},true)}function unittest_req_by_route(routes,roles,req){if(!gen_auto_unittest())return;try{if(!Array.isArray(routes))routes=[routes];let req_id=gen_stamp();ctx.forEach((c=>{if(c.routes.some((r=>routes.includes(r))))c_unittest_push(c.id,roles,req,req_id)}));return req_id}catch(e){console.error(e)}}function unittest_resp_by_route(route,roles,resp,req_id){if(!gen_auto_unittest())return;try{ctx.forEach((c=>{if(!c.routes.includes(route))return;let req=c.unittest.find((u=>u.req_id==req_id));if(req)c_unittest_push(c.id,roles,resp,req_id,req.roles_id)}))}catch(e){console.error(e)}}function unittest_set_rule(opt){if(!gen_auto_unittest())return;try{c_unittest_push(opt.tab_id,"set_rule("+JSON.stringify(opt)+")")}catch(e){console.error(e)}}function gen_auto_unittest(){let conf=CG("auto_unittest",{});return conf&&conf.enable&&ext_ver()&&version_util.cmp(ext_ver(),conf.min_ver||"0.0.0")>=0&&E.is_conf_allowed(conf.on||100)}function get_conf(root,name,def){let conf=CG(root);if(conf&&conf.min_ver&&product_ver()&&version_util.cmp(product_ver(),conf.min_ver)>=0&&E.is_conf_allowed(conf.on||100)){return zutil.get(conf,name,def)}return def}let get_verify_conf=(name,def)=>get_conf("verify_proxy",name,def);let get_proxy_auth_conf=(name,def)=>get_conf("proxy_auth",name,def);let rules;let init_rules=()=>etask((function*init_rules_(){rules=yield api.storage.get("rules");if(!rules){rules={ver:ext_ver()};commit_rules()}if(rules.set)gen_rules(rules.set);if(zutil.is_mocha())E.t.rules=rules;E.emit("local_rules_set",rules.set)}));if(zutil.is_mocha()){E.t={Cache_entry,choose_strategy,expected_types,extensions,strategies,Agents,get_api:()=>api,ConnectivityCheck,find_agents:E.find_agents,rules_fixup,rules,Proxy_rules_engine}}return E}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))})()},2044:(module,exports,__webpack_require__)=>{var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;var module;
// LICENSE_CODE ZON ISC
"use strict";(function(){var is_node=typeof module=="object"&&module.exports&&module.children;if(!is_node);else;!(__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(5516)],__WEBPACK_AMD_DEFINE_RESULT__=function(string){var E={};E.from_str=function(s,opt){return E.from_lines(string.split_crlf(s),opt)};E.from_lines=function(l,opt){var last_pos=0,attrib=[],i,m,invalid=false,line;opt=opt||{};for(i=0;i<l.length;i++){if(!(line=l[i])){invalid=true;continue}if(/^\s+/.test(line)){if(!last_pos){invalid=true;continue}attrib[last_pos-1][1]+="\n"+line.trim();continue}if(!(m=line.match(/^([^:]+):([^\n]*)$/))){invalid=true;continue}attrib[last_pos++]=[m[1].trim(),m[2].trim()]}if(invalid&&!opt.allow_invalid)attrib=null;return attrib};E.to_str=function(attrib){var s="",i;for(i=0;i<attrib.length;i++)s+=attrib[i][0]+": "+(""+attrib[i][1]).replace(/\n/,"\n  ")+"\n";return s};E.to_obj=function(attrib){var obj={},i;for(i=0;i<attrib.length;i++)obj[attrib[i][0]]=attrib[i][1];return obj};E.to_obj_lower=function(attrib){var obj={},i;for(i=0;i<attrib.length;i++)obj[attrib[i][0].toLowerCase()]=attrib[i][1];return obj};E.to_lower=function(attrib){var a=[];for(var i=0;i<attrib.length;i++)a.push([attrib[i][0].toLowerCase(),attrib[i][1]]);return a};E.get_index=function(attrib,field){for(var i=0;i<attrib.length;i++){if(attrib[i][0]==field)return i}return-1};E.get=function(attrib,field,opt){var res="",sep=opt&&opt.sep,_null=opt&&opt.null?null:"";for(var i=0;i<attrib.length;i++){if(attrib[i][0]==field){if(!sep)return attrib[i][1];res+=(res?sep:"")+attrib[i][1]}}return res||_null};E.get_arr=function(attrib,field){var i,ret=[];for(i=0;i<attrib.length;i++){if(attrib[i][0]==field)ret.push(attrib[i][1])}return ret};return E}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))})()},6069:(module,exports)=>{var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;var module;
// LICENSE_CODE ZON
"use strict";(function(){var is_node=typeof module=="object"&&module.exports&&module.children;var is_rn=typeof global=="object"&&!!global.nativeRequire||typeof navigator=="object"&&navigator.product=="ReactNative";if(!is_node&&!is_rn);else;!(__WEBPACK_AMD_DEFINE_ARRAY__=[],__WEBPACK_AMD_DEFINE_RESULT__=function(){var E={};function dnsResolve(host){return null}E.dnsDomainIs=function(host,domain){return host.length>=domain.length&&host.substring(host.length-domain.length)==domain};E.dnsDomainLevels=function(host){return host.split(".").length-1};E.convert_addr=convert_addr;function convert_addr(ipchars){var bytes=ipchars.split(".");var result=(bytes[0]&255)<<24|(bytes[1]&255)<<16|(bytes[2]&255)<<8|bytes[3]&255;return result>>>0}E.isInNet=function(ipaddr,pattern,maskstr){var test=/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/.exec(ipaddr);if(test==null){ipaddr=dnsResolve(ipaddr);if(ipaddr==null)return false}else if(test[1]>255||test[2]>255||test[3]>255||test[4]>255)return false;var host=convert_addr(ipaddr);var pat=convert_addr(pattern);var mask=convert_addr(maskstr);return(host&mask)==(pat&mask)};E.isPlainHostName=function(host){return!host.includes(".")};E.isResolvable=function(host){var ip=dnsResolve(host);return ip!=null};E.localHostOrDomainIs=function(host,hostdom){return host==hostdom||hostdom.lastIndexOf(host+".",0)==0};E.shExpMatch=function(url,pattern){pattern=pattern.replace(/\./g,"\\.").replace(/\*/g,".*").replace(/\?/g,".");var newRe=new RegExp("^"+pattern+"$");return newRe.test(url)};return E}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))})()},9201:(module,exports,__webpack_require__)=>{var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;var module;
// LICENSE_CODE ZON ISC
"use strict";(function(){var is_node=typeof module=="object"&&module.exports&&module.children;if(!is_node);else;!(__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(4336),__webpack_require__(1291)],__WEBPACK_AMD_DEFINE_RESULT__=function(zescape,zutil){var E={};E.glob_to_regex_str=function(glob){return"^("+glob.replace(/(\?|\*\*|\*)|([^?*]+)/g,(function(m){return m=="?"?"[^/]":m=="**"?".*":m=="*"?"[^/]*":zescape.regex(m)}))+")$"};E.glob_to_regex=function(glob){return new RegExp(E.glob_to_regex_str(glob))};E.glob_fn=function(glob){var re=E.glob_to_regex(glob);return function(s){return re.test(s)}};E.glob=function(glob,value){return E.glob_fn(glob)(value)};function eat_group(arr,start){for(var c=0,i=start;i<arr.length;i++){if(arr[i].depth)c+=arr[i].depth;if(!c)return arr.splice(start,i-start+1).slice(1,-1)}throw new Error("unbalanced group")}function parse_arr_to_tree(arr,join){function is_join(el){return el.join&&Object.keys(el).length==1}function clean(el){if(!Array.isArray(el.elm))delete el.join;return el}function pass(fn){for(var i=0;i<arr.length;i++){var change;if(change=fn(arr[i],arr[i+1],i))i+=change}}pass((function(el,next,i){if(el.depth)arr.splice(i,0,parse_arr_to_tree(eat_group(arr,i),join))}));pass((function(el,next,i){if(el.fn&&!el.elm)el.elm=arr.splice(i+1,1)[0]}));pass((function(el,next,i){if(is_join(el)){arr[i-1]={join:el.join,elm:[arr[i-1],next].map(clean)};arr.splice(i,2);return-1}if(next&&next.join=="&&"&&!is_join(next)){arr[i]={join:"&&",elm:[el,next].map(clean)};arr.splice(i+1,1)}}));if(arr.length<=1)return arr[0];return{join,elm:[arr[0],parse_arr_to_tree(arr.slice(1),join)].map(clean)}}E.match_parse=function(filter,opt){var res=[],o={s:filter},cmp=[],match,i,_plugin;var eat_token=zescape.parse.eat_token;opt=opt||{};var plugin=opt.plugin||[];var join=opt.join||"||";var logical=opt.logical===undefined||opt.logical;token:while(o.s.length){if(opt.eat_white!==false&&eat_token(o,/^\s+/))continue;for(i=0;i<plugin.length;i++){_plugin=plugin[i];if(match=eat_token(o,_plugin.re)){cmp.push({plugin:_plugin,m:match});continue token}}if(match=eat_token(o,/^\/((\\.|[^\\/])+)\/([i]?)(\s|$)/)){cmp.push({re:match[1],re_opt:match[3]});continue}if(match=eat_token(o,/^\S+/)){var m=match[0],l;var _logical={"&&":{join:"&&"},"||":{join:"||"},"!":{fn:"!"},"+":{join:"||"},"-":{fn:"!",join:"&&",wrap_join:true},"(":{fn:"(",depth:1},")":{fn:")",depth:-1,join:""}};if(logical&&(l=_logical[m])){if(l.wrap_join){var depth=0;for(i=cmp.length;i>=0&&depth>=0;i--)depth+=-(l.depth||0);i++;if(i<cmp.length){cmp.splice(i,0,_logical["("]);cmp.push(_logical[")"])}delete l.wrap_join}cmp.push(l)}else if(opt.glob&&/[\[\]*?{}]/.test(m)){cmp.push(opt.glob=="re"?{re:E.glob_to_regex_str(m)}:{glob:m})}else cmp.push({eq:m});continue}E.match_last_error=new Error("invalid token "+o.s)}var have_val=false;cmp.forEach((function(c){var _join=have_val&&join;if(c.eq!==undefined||c.re!==undefined||c.glob!==undefined||c.plugin){have_val=true}else{if(c.join!==undefined)_join=c.join;have_val=false}if(_join)c.join=_join;else delete c.join}));return opt.tree?parse_arr_to_tree(cmp,join):cmp};E.match_fn=function(filter,opt){opt=opt||{};var cmp=E.match_parse(filter,opt),func="return ",i;for(i=0;i<cmp.length;i++){var c=cmp[i];if(c.join)func+=c.join+" ";if(c.re!==undefined){try{var re=new RegExp(c.re,c.re_opt);c=function(s){return this.test(s)}.bind(re)}catch(e){c=function(){return false};E.match_last_error=e}}else if(c.glob!==undefined)c=E.glob_fn(c.glob);else if(c.eq!==undefined)c=function(s){return s===this}.bind(c.eq);else if(c.plugin){c=c.plugin.cmp?c.plugin.cmp.bind(null,c.m):c.plugin.cmp_fn(c.m)}cmp[i]=c;if(typeof c=="function")func+="cmp["+i+"](s, extra) ";else if(c instanceof Object)func+=c.fn?c.fn+" ":"";else throw new Error}if(!cmp.length)func+="false ";func+=";";return new Function(["cmp","s","extra"],func).bind(null,cmp)};E.match=function(filter,value,opt){return E.match_fn(filter,opt)(value,opt&&opt.extra)};E.cmp_norm=function(cmp){return cmp>0?1:cmp<0?-1:0};E.strcmp=function(a,b){return a>b?1:a<b?-1:0};E.strverscmp=function(a,b){var _a,_b,diff,skip_digit=0;for(_a=0,_b=0;_a<a.length&&_b<b.length;_a++,_b++){if(a[_a]==b[_b]&&!zutil.isdigit(a[_b]))continue;if(skip_digit)skip_digit--;if(zutil.isdigit(a[_a])&&zutil.isdigit(b[_b])){var ma=a.substr(_a).match(/\d+/)[0];var mb=b.substr(_b).match(/\d+/)[0];if(diff=+ma-+mb)return diff;skip_digit=ma.length}if(diff=a[_a].charCodeAt()-b[_b].charCodeAt())return diff}return a.length-b.length};E.regexp_merge=function(a){var re=[],i;for(i=0;i<a.length;i++)re.push(a[i]instanceof RegExp?a[i].source:zescape.regex(""+a[i]));return new RegExp("("+re.join(")|(")+")")};return E}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))})()},4135:(module,exports,__webpack_require__)=>{var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;var module;
// LICENSE_CODE ZON ISC
"use strict";(function(){var is_node=typeof module=="object"&&module.exports&&module.children;var is_rn=typeof global=="object"&&!!global.nativeRequire||typeof navigator=="object"&&navigator.product=="ReactNative";if(is_rn){}else if(!is_node);else;!(__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(6545)],__WEBPACK_AMD_DEFINE_RESULT__=function(array){var E={};var is_jtest=false;var jtest_vals={};var MAX_INT=2147483647;var MIN_INT=-MAX_INT-1;function jtest_pop(s){var elm;if(s===undefined)return null;if((elm=jtest_vals[s])===undefined)return null;return elm.shift()}E.rand=function(s){var ret;if(is_jtest&&(ret=jtest_pop(s))!==null)return ret;return Math.random()};E.rand_int32=function(s){var ret;if(is_jtest&&(ret=jtest_pop(s))!==null)return ret;return Math.floor(Math.random()*(MAX_INT-MIN_INT+1))-MAX_INT};E.rand_range=function(from,to,s){var ret;if(is_jtest&&(ret=jtest_pop(s))!==null)return ret;return Math.floor(Math.random()*(to-from))+from};E.rand_element=function(a,s){if(a.length)return a[E.rand_range(0,a.length,s)]};E.rand_subset=function(a,size,s){var shuffled=a.slice(0);for(var i=0;i<size;i++){var j=E.rand_range(i,shuffled.length,s);var tmp=shuffled[j];shuffled[j]=shuffled[i];shuffled[i]=tmp}return shuffled.slice(0,size)};E.jtest_push=function(s,arr){if(!jtest_vals[s])jtest_vals[s]=[];if(Array.isArray(arr))array.push(jtest_vals[s],arr);else jtest_vals[s].push(arr)};E.jtest_init=function(){is_jtest=true;jtest_vals={}};E.jtest_uninit=function(){is_jtest=false};E.basic_u32=function(v){return 1103515245*v+12345>>>0};E.basic_u31=function(v){return 1103515245*v+12345&2147483647};return E}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))})()},5678:(module,exports,__webpack_require__)=>{var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;var module;
// LICENSE_CODE ZON
"use strict";(function(){let next_tick;let is_node=typeof module=="object"&&module.exports&&module.children;var is_rn=typeof global=="object"&&!!global.nativeRequire||typeof navigator=="object"&&navigator.product=="ReactNative";if(is_rn){}else if(!is_node){next_tick=function(){var can_set_immediate=typeof self!=="undefined"&&self.setImmediate;var can_post=typeof self!=="undefined"&&self.postMessage&&self.addEventListener;if(can_set_immediate)return function(f){return self.setImmediate(f)};if(can_post){var queue=[];self.addEventListener("message",(function(ev){var source=ev.source;if((source===self||source===null)&&ev.data==="process-tick"){ev.stopPropagation();if(queue.length>0){var fn=queue.shift();fn()}}}),true);return function(fn){queue.push(fn);self.postMessage("process-tick","*")}}return function(fn){setTimeout(fn,0)}}()}else;next_tick=next_tick||process.nextTick;!(__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(3787),__webpack_require__(6386),__webpack_require__(8425),__webpack_require__(5516),__webpack_require__(9824)],__WEBPACK_AMD_DEFINE_RESULT__=function(conv,etask,events,string,zerr){const ef=etask.ef;const{assign}=Object;const zjson_opt={func:false,date:true,re:true};const is_win=/^win/.test((is_node||is_rn)&&process.platform);const is_darwin=/^darwin/.test((is_node||is_rn)&&process.platform);const default_user_agent=is_node?(()=>{const zconf=require("./config.js");const conf=require("./conf.js");return`Hola ${conf.app}/${zconf.ZON_VERSION}`})():undefined;const debug_str_len=4096;const default_win_size=1048576;const SEC=1e3,MIN=6e4,vfd_sz=8;let zcounter;function noop(){}class WS extends events.EventEmitter{constructor(opt){super();this.ws=undefined;this.data=opt.data;this.connected=false;this.reason=undefined;this.zc_rx=opt.zcounter=="rx"||opt.zcounter=="all";this.zc_tx=opt.zcounter=="tx"||opt.zcounter=="all";this.zc=opt.zcounter?opt.label?`${opt.label}_ws`:"ws":undefined;this.zjson_opt=assign({},zjson_opt,opt.zjson_opt);this.label=opt.label;this.remote_label=undefined;this.local_addr=undefined;this.local_port=undefined;this.remote_addr=undefined;this.remote_port=undefined;this.remote_forwarded=false;this.status="disconnected";this.ping=is_node&&opt.ping!=false;this.ping_interval=typeof opt.ping_interval=="function"?opt.ping_interval():opt.ping_interval||6e4;this.ping_timeout=typeof opt.ping_timeout=="function"?opt.ping_timeout():opt.ping_timeout||1e4;this.ping_timer=undefined;this.ping_last=undefined;this.idle_timeout=opt.idle_timeout;this.idle_timer=undefined;this.ipc=opt.ipc_client?new IPC_client(this,opt.ipc_client,{zjson:opt.ipc_zjson}):undefined;this.time_parse=opt.time_parse;if(opt.ipc_server){new IPC_server(this,opt.ipc_server,{zjson:opt.ipc_zjson,sync:opt.ipc_sync})}this.mux=opt.mux?new Mux(this,opt.backpressuring):undefined;if(this.zc&&!zcounter)zcounter=require("./zcounter.js")}send(msg){if(zerr.is.debug()){zerr.debug(typeof msg=="string"?`${this}> str: ${string.trunc(msg,debug_str_len)}`:`${this}> buf: ${msg.length} bytes`)}if(!this.connected){if(zerr.is.info())zerr.info(`${this}: sending failed: disconnected`);return false}if(this.ws.readyState==2){if(zerr.is.info())zerr.info(`${this}: sending failed: socket closing`);return false}this._update_idle();this.ws.send(msg);if(this.zc_tx){zcounter.inc(`${this.zc}_tx_msg`);zcounter.inc(`${this.zc}_tx_bytes`,msg.length);zcounter.avg(`${this.zc}_tx_bytes_per_msg`,msg.length)}return true}json(data){return this.send(JSON.stringify(data))}zjson(data,ttl){return this.send(conv.JSON_stringify(data,this.zjson_opt))}_check_status(){let prev=this.status;this.status=this.ws?this.connected?"connected":"connecting":"disconnected";if(this.status!=prev){this.emit(this.status);this.emit("status",this.status);if(this.status=="disconnected")this._on_disconnected()}}_on_disconnected(){this.emit("destroyed")}_assign(ws){this.ws=ws;this.ws.onopen=this._on_open.bind(this);this.ws.onclose=this._on_close.bind(this);this.ws.onmessage=this._on_message.bind(this);this.ws.onerror=this._on_error.bind(this);if(is_node){this.ws.on("upgrade",this._on_upgrade.bind(this));this.ws.on("unexpected-response",this._on_unexpected_response.bind(this))}if(this.ping)this.ws.on("pong",this._on_pong.bind(this))}abort(code,reason){this.reason=reason||code;let msg=`${this}: closed locally`;if(this.reason)msg+=` (${this.reason})`;if(!is_node&&!is_rn&&!(code==1e3||code>=3e3&&code<5e3))code+=3e3;this._close(true,code,reason);zerr.warn(msg);if(this.zc&&code)zcounter.inc(`${this.zc}_err_${code}`);this._check_status()}_close(close,code,reason){if(!this.ws)return;if(this.ping){clearTimeout(this.ping_timer);this.ping_timer=undefined;this.ping_last=undefined;this.ws.removeAllListeners("pong")}this.ws.onopen=undefined;this.ws.onclose=undefined;this.ws.onmessage=undefined;this.ws.onerror=noop;if(is_node){this.ws.removeAllListeners("unexpected-response");this.ws.removeAllListeners("upgrade")}this.local_addr=undefined;this.local_port=undefined;this.remote_addr=undefined;this.remote_port=undefined;if(close){if(this.ws.terminate&&(!this.connected||code==-2)){zerr.notice(`${this}: ws.terminate`);this.ws.terminate()}else{zerr.notice(`${this}: ws.close`);this.ws.close(code,reason)}}this.ws=undefined;this.connected=false}toString(){let res=this.label?`${this.label} WS`:"WS";if(this.remote_label||this.remote_addr)res+=" (";if(this.remote_label)res+=this.remote_label;if(this.remote_label&&this.remote_addr)res+=" ";if(this.remote_addr)res+=this.remote_addr;if(this.remote_label||this.remote_addr)res+=")";return res}_on_open(){if(this.connected)return;this.connected=true;let sock=this.ws._socket||{};this.local_addr=sock.localAddress;this.local_port=sock.localPort;if(this.remote_addr==sock.remoteAddress)this.remote_forwarded=false;if(!this.remote_forwarded){this.remote_addr=sock.remoteAddress;this.remote_port=sock.remotePort}zerr.notice(`${this}: connected`);if(this.ping){this.ping_timer=setTimeout(this._ping.bind(this),this.ping_interval)}this._check_status()}_on_close(event){this.reason=event.reason||event.code;zerr.notice(`${this}: closed by remote (${this.reason})`);this._close();this._check_status()}_on_error(event){this.reason=event.message||"Network error";zerr(`${this}: ${this.reason}`);if(this.zc)zcounter.inc(`${this.zc}_err`);this._close();this._check_status()}_on_unexpected_response(req,resp){this._on_error({message:"unexpected response"})}_on_upgrade(resp){zerr.notice(`${this}: upgrade conn`)}_on_message(event){let msg=event.data,handled=false;if(msg instanceof ArrayBuffer)msg=Buffer.from(Buffer.from(msg));if(zerr.is.debug()){zerr.debug(typeof msg=="string"?`${this}< str: ${string.trunc(msg,debug_str_len)}`:`${this}< buf: ${msg.length} bytes`)}if(this.zc_rx){zcounter.inc(`${this.zc}_rx_msg`);zcounter.inc(`${this.zc}_rx_bytes`,msg.length);zcounter.avg(`${this.zc}_rx_bytes_per_msg`,msg.length)}try{if(typeof msg=="string"){if(this._events.zjson){let parsed;if(this.zc&&this.time_parse){let started=Date.now();parsed=conv.JSON_parse_unsafe(msg,this.zjson_opt);zcounter.inc(`${this.zc}_parse_zjson_ms`,Date.now()-started)}else parsed=conv.JSON_parse_unsafe(msg,this.zjson_opt);this.emit("zjson",parsed);handled=true}if(this._events.json){let parsed,started;if(this.zc&&this.time_parse)started=Date.now();parsed=JSON.parse(msg);if(this.zc&&this.time_parse){zcounter.inc(`${this.zc}_parse_json_ms`,Date.now()-started)}this.emit("json",parsed);handled=true}if(this._events.text){this.emit("text",msg);handled=true}}else{if(this._events.bin){this.emit("bin",msg);handled=true}}if(this._events.raw){this.emit("raw",msg);handled=true}}catch(e){ef(e);zerr(`${this}: ${zerr.e2s(e)}`);return this.abort(1011,e.message)}if(!handled)this.abort(1003,"Unexpected message");this._update_idle();if(this.ping_last){clearTimeout(this.ping_timer);this.ping_timer=setTimeout(this._ping_expire.bind(this),this.ping_timeout)}}_on_pong(){clearTimeout(this.ping_timer);let rtt=Date.now()-this.ping_last;this.ping_last=undefined;this.ping_timer=setTimeout(this._ping.bind(this),Math.max(this.ping_interval-rtt,0));if(zerr.is.debug())zerr.debug(`${this}< pong (rtt ${rtt}ms)`);if(this.zc)zcounter.avg(`${this.zc}_ping_ms`,rtt)}_ping(){if(this.ws.readyState==2)return;this.ws.ping();this.ping_timer=setTimeout(this._ping_expire.bind(this),this.ping_timeout);this.ping_last=Date.now();if(zerr.is.debug())zerr.debug(`${this}> ping (max ${this.ping_timeout}ms)`)}_ping_expire(){this.abort(1002,"Ping timeout")}_idle(){if(this.zc)zcounter.inc(`${this.zc}_idle_timeout`);this.emit("idle_timeout");this.abort(1002,"Idle timeout")}_update_idle(){this.idle_since=Date.now();if(this.idle_timeout){clearTimeout(this.idle_timer);this.idle_timer=setTimeout(this._idle.bind(this),this.idle_timeout)}}close(code,reason){if(!this.ws)return;let msg=`${this}: closed locally`;if(reason||code)msg+=` (${reason||code})`;this._close(true,code,reason);zerr.notice(msg);if(this.zc&&code)zcounter.inc(`${this.zc}_err_${code}`);this._check_status()}inspect(){return{class:this.constructor.name,label:this.toString(),status:this.status,reason:this.reason,local_addr:this.local_addr,local_port:this.local_port,remote_addr:this.remote_addr,remote_port:this.remote_port}}}class Client extends WS{constructor(url,opt={}){super(opt);this.status="connecting";this.impl=client_impl(opt);this.url=url;this.retry_interval=opt.retry_interval||1e4;this.retry_max=opt.retry_max||this.retry_interval;this.next_retry=this.retry_interval;this.no_retry=opt.no_retry;if(is_node){this.headers=assign({"User-Agent":opt.user_agent||default_user_agent},opt.headers)}this.deflate=!!opt.deflate;if(opt.proxy){let _lib=require("https-proxy-agent");this.agent=new _lib(opt.proxy)}else this.agent=opt.agent;this.reconnect_timer=undefined;this.handshake_timeout=opt.handshake_timeout===undefined?1e4:opt.handshake_timeout;this.handshake_timer=undefined;if(this.zc)zcounter.inc_level(`level_${this.zc}_online`,0,"sum");this._connect()}_on_disconnected(){}_assign(ws){super._assign(ws);if(this.zc)zcounter.inc_level(`level_${this.zc}_online`,1,"sum")}_close(close,code,reason){if(this.zc&&this.ws)zcounter.inc_level(`level_${this.zc}_online`,-1,"sum");if(this.handshake_timer)this.handshake_timer=clearTimeout(this.handshake_timer);super._close(close,code,reason)}_connect(){this.reason=undefined;this.reconnect_timer=undefined;let opt={headers:this.headers};if(!is_rn){opt.agent=this.agent;opt.perMessageDeflate=this.deflate}zerr.notice(`${this}: connecting to ${this.url}`);this._assign(new this.impl(this.url,undefined,opt));if(this.handshake_timeout){this.handshake_timer=setTimeout((()=>this.abort(1002,"Handshake timeout")),this.handshake_timeout)}this._check_status()}_reconnect(){if(this.no_retry)return false;let delay=this.next_retry;if(typeof delay=="function")delay=delay();else{this.next_retry=Math.min(delay*2,typeof this.retry_max=="function"?this.retry_max():this.retry_max)}if(zerr.is.info())zerr.info(`${this}: will retry in ${delay}ms`);this.reconnect_timer=setTimeout((()=>this._connect()),delay)}_on_open(){if(this.handshake_timer)this.handshake_timer=clearTimeout(this.handshake_timer);this.next_retry=this.retry_interval;super._on_open()}_on_close(event){this._reconnect();super._on_close(event)}_on_error(event){this._reconnect();super._on_error(event)}abort(code,reason){this._reconnect();super.abort(code,reason)}close(code,reason){if(this.ws)this.emit("destroyed");super.close(code,reason);if(this.reconnect_timer){clearTimeout(this.reconnect_timer);this.reconnect_timer=undefined;this.emit("destroyed")}}inspect(){return assign(super.inspect(),{url:this.url,retry_interval:this.retry_interval,retry_max:this.retry_max,next_retry:this.next_retry,handshake_timeout:this.handshake_timeout,deflate:this.deflate,reconnecting:!!this.reconnect_timer})}}class Server extends events.EventEmitter{constructor(opt={},handler=undefined){super();this.handler=handler;let ws_opt={server:opt.http_server,host:opt.host||"0.0.0.0",port:opt.port,noServer:!opt.http_server&&!opt.port,path:opt.path,clientTracking:false,perMessageDeflate:!!opt.deflate};if(opt.max_payload)ws_opt.maxPayload=opt.max_payload;if(opt.verify)ws_opt.verifyClient=opt.verify;this.ws_server=new(server_impl(opt))(ws_opt);this.opt=opt;this.label=opt.label;this.connections=new Set;this.zc=opt.label?`${opt.label}_ws`:"ws";this.ws_server.addListener("connection",this.accept.bind(this));this.ws_server.addListener("error",this._on_error.bind(this));this.ws_server.addListener("listening",this._on_listening.bind(this));if(opt.port)zerr.notice(`${this}: listening on port ${opt.port}`);if(!zcounter)zcounter=require("./zcounter.js");zcounter.inc_level(`level_${this.zc}_conn`,0,"sum")}_on_error(...args){this.emit("error",...args)}_on_listening(...args){this.emit("listening",...args)}toString(){return this.label?`${this.label} WS server`:"WS server"}upgrade(req,socket,head){this.ws_server.handleUpgrade(req,socket,head,(ws=>this.accept(ws,req)))}accept(ws,req=ws.upgradeReq){if(!ws._socket.remoteAddress){ws.onerror=noop;return zerr.warn(`${this}: dead incoming connection`)}let headers=req&&req.headers||{};if(this.opt.origin_whitelist){if(!this.opt.origin_whitelist.includes(headers.origin)){if(ws._socket.destroy)ws._socket.destroy();else if(ws.terminate)ws.terminate();return zerr.notice("incoming conn from %s rejected",headers.origin||"unknown origin")}zerr.notice("incoming conn from %s",headers.origin)}let zws=new WS(this.opt);if(this.opt.trust_forwarded){let forwarded=headers["x-real-ip"];if(!forwarded){forwarded=headers["x-forwarded-for"];if(forwarded){let ips=forwarded.split(",");forwarded=ips[ips.length-1]}}if(forwarded){zws.remote_addr=forwarded;zws.remote_forwarded=true}}let ua=headers["user-agent"];let m=/^Hola (.+)$/.exec(ua);zws.remote_label=m?m[1]:ua?"web":undefined;zws._assign(ws);zws._on_open();this.connections.add(zws);zcounter.inc(`${this.zc}_conn`);zcounter.inc_level(`level_${this.zc}_conn`,1,"sum");zws.addListener("disconnected",(()=>{this.connections.delete(zws);zcounter.inc_level(`level_${this.zc}_conn`,-1,"sum")}));if(this.handler){try{zws.data=this.handler(zws,req)}catch(e){ef(e);zerr(zerr.e2s(e));return zws.close(1011,String(e))}}return zws}broadcast(msg){if(zerr.is.debug()){zerr.debug(typeof msg=="string"?`${this}> broadcast str: ${string.trunc(msg,debug_str_len)}`:`${this}> broadcast buf: ${msg.length} bytes`)}for(let zws of this.connections)zws.send(msg)}broadcast_json(data){if(this.connections.size)this.broadcast(JSON.stringify(data))}broadcast_zjson(data){if(this.connections.size)this.broadcast(conv.JSON_stringify(data,zjson_opt))}close(code,reason){zerr.notice(`${this}: closed`);this.ws_server.close();for(let zws of this.connections)zws.close(code,reason)}inspect(){let connections=[];for(let c of this.connections)connections.push(c.inspect());return{class:this.constructor.name,label:this.toString(),opt:this.opt,connections}}}class IPC_client{constructor(zws,names,opt={}){this._ws=zws;this._pending=new Map;this._ws.addListener(opt.zjson?"zjson":"json",this._on_resp.bind(this));this._ws.addListener("status",this._on_status.bind(this));this._ws.addListener("destroyed",this._on_status.bind(this,"destroyed"));if(Array.isArray(names)){for(let name of names)this[name]=this._call.bind(this,opt,name)}else{for(let name in names){let spec=names[name];if(typeof spec=="string")spec={type:spec};let _opt=assign({},opt,spec);switch(_opt.type||"call"){case"call":this[name]=this._call.bind(this,_opt,name);break;case"post":this[name]=this._post.bind(this,_opt,name);break;default:zerr.zexit(`${this._ws}: ${name}: Invalid IPC client spec`)}}}}_call(opt,cmd,...arg){let _this=this;let timeout=opt.timeout||5*MIN;let send_retry_timeout=3*SEC;return etask((function*IPC_client_call(){let req={type:"ipc_call",cmd,cookie:++IPC_client._cookie};if(arg.length==1)req.msg=arg[0];else if(arg)req.arg=arg;this.info.label=()=>_this._ws.toString();this.info.cmd=cmd;this.info.cookie=req.cookie;_this._pending.set(req.cookie,this);this.finally((()=>_this._pending.delete(req.cookie)));this.alarm(timeout,(()=>this.throw(new Error(`${cmd} timeout`))));let res={status:_this._ws.status},prev;let send=_this._ws[opt.zjson?"zjson":"json"].bind(_this._ws);while(res.status){switch(res.status){case"disconnected":if(opt.retry==false||!_this._ws.reconnect_timer)throw new Error(_this._ws.reason||"Connection closed");break;case"connecting":if(opt.retry==false)throw new Error("Connection not ready");break;case"destroyed":throw new Error(_this._ws.reason||"Connection closed");case"connected":while(!send(req))yield etask.sleep(send_retry_timeout);break}do{prev=res.status;res=yield this.wait()}while(prev==res.status)}return res.value}))}_post(opt,cmd,...arg){let req={type:"ipc_post",cmd};if(arg.length==1)req.msg=arg[0];else if(arg)req.arg=arg;if(opt.zjson)this._ws.zjson(req);else this._ws.json(req)}_on_resp(msg){if(!msg||msg.type!="ipc_result"&&msg.type!="ipc_error")return;let task=this._pending.get(msg.cookie);if(!task){return zerr.info(`${this._ws}: `+`unexpected IPC cookie ${msg.cookie}`)}if(msg.type=="ipc_result")task.continue({value:msg.msg});else task.throw(new Error(msg.msg))}_on_status(status){for(let task of this._pending.values())task.continue({status})}}IPC_client._cookie=0;class IPC_server{constructor(zws,methods,opt={}){this.ws=zws;if(Array.isArray(methods)){this.methods={};for(let m of methods)this.methods[m]=true}else this.methods=methods;this.zjson=!!opt.zjson;this.sync=!!opt.sync;this.pending=this.sync?undefined:new Set;this.ws.addListener(this.zjson?"zjson":"json",this._on_call.bind(this));if(!this.sync){this.ws.addListener("disconnected",this._on_disconnected.bind(this))}}_on_call(msg){if(!msg||!msg.cmd)return;let type=msg.type||"ipc_call",cmd=msg.cmd;if(type!="ipc_call"&&type!="ipc_post")return;let method=this.methods.hasOwnProperty(cmd)&&this.methods[cmd];if(method===true)method=this.ws.data[cmd];if(!method){let err=`Method ${cmd} not defined`;if(type=="ipc_post")return zerr(`${this.ws}: ${err}`);return this.ws.json({type:"ipc_error",cmd,cookie:msg.cookie,msg:err})}let arg=msg.arg||[msg.msg];let _this=this;etask((function*IPC_server_on_call(){if(!_this.sync&&type=="ipc_post"){_this.pending.add(this);this.finally((()=>_this.pending.delete(this)))}this.info.label=()=>_this.ws.toString();this.info.cmd=cmd;this.info.cookie=msg.cookie;try{let rv=method.apply(_this.ws.data||_this.ws,arg);if(!_this.sync)rv=yield rv;if(type=="ipc_post")return;let res={type:"ipc_result",cmd,cookie:msg.cookie,msg:rv};if(_this.zjson)_this.ws.zjson(res);else _this.ws.json(res)}catch(e){if(type=="ipc_post")return zerr(`${_this.ws}: ${cmd}: ${zerr.e2s(e)}`);_this.ws.json({type:"ipc_error",cmd,cookie:msg.cookie,msg:e.message||String(e)})}}))}_on_disconnected(){for(let task of this.pending)task.return()}}class Mux{constructor(zws,backpressuring=false){this.ws=zws;this.backpressuring=backpressuring;this.streams=new Map;this.ws.on("bin",this._on_bin.bind(this));this.ws.on("json",this._on_json.bind(this));this.ws.on("disconnected",this._on_disconnected.bind(this))}open(vfd,bytes_allowed=Infinity,opt={}){this.ignore_unexpected_acks=opt.ignore_unexpected_acks;return this.streams.get(vfd)||(opt.use_ack?this.open_ack(vfd,opt):this.open_bp(vfd,bytes_allowed,opt))}open_bp(vfd,bytes_allowed,opt={}){const _lib=require("stream");let _this=this,suspended;const stream=new _lib.Duplex(assign({read(size){},write(data,encoding,cb){if(bytes_allowed<=0){suspended=()=>this._write(data,encoding,cb);return}if(zerr.is.debug())zerr.debug(`${_this.ws}> vfd ${vfd}`);bytes_allowed-=data.length;let buf=Buffer.allocUnsafe(data.length+vfd_sz);buf.writeUInt32BE(vfd,0);buf.writeUInt32BE(0,4);data.copy(buf,vfd_sz);cb(_this.ws.send(buf)?undefined:new Error(_this.ws.reason||_this.ws.status));this.last_use_ts=Date.now()},destroy(err,cb){try{stream.push(null)}catch(e){zerr.notice("DEBUG RECURSIVE DESTROY "+e)}stream.end();this.emit("_close");next_tick(cb,err)}},opt));let _stacktrace=(new Error).stack;stream.create_ts=Date.now();stream.prependListener("data",(function(chunk){if(_this.backpressuring&&this.readableLength<=this.readableHighWaterMark>>1){_this.remote_write_resume(vfd)}this.last_use_ts=Date.now();if(!this._httpMessage||this.parser&&this.parser.socket===this||is_rn){return}const{parsers}=require("_http_common");zcounter.inc(`mux_no_parser`);zerr("\n--- assert failed, socketinfo:\n"+`DEBUG HEADER: ${this._httpMessage._header}\n`+`DEBUG mux.open(): ${_stacktrace}\n`+`DEBUG WS: ${_this.ws.remote_addr}:${_this.ws.remote_port}`);const old_parser=this.parser;const parser=this.parser=parsers.alloc();const old_execute=parser.execute;parser.socket=this;parser.execute=buf=>{parser.execute=old_execute;this.parser=old_parser;return new Error("Mux Duplex parser removed before data "+"consumed")}}));stream.allow=(bytes=Infinity)=>{bytes_allowed=bytes;if(bytes_allowed>0&&suspended){suspended();suspended=undefined}if(_this.ws.zc)zcounter.inc("mux_write_"+(bytes>0?"allow":"disallow"))};stream.on("_close",(()=>{if(this.streams.delete(vfd)){zerr.info(`${this.ws}: vfd ${vfd} closed`);if(this.ws.zc)zcounter.inc_level(`level_${this.ws.zc}_mux_vfd`,-1)}}));this.streams.set(vfd,stream);zerr.info(`${this.ws}: vfd ${vfd} open`);if(this.ws.zc)zcounter.inc_level(`level_${this.ws.zc}_mux_vfd`,1);return stream}open_ack(vfd,opt={}){const _lib=require("stream");const _this=this;opt.fin_timeout=opt.fin_timeout||10*SEC;const w_log=(e,str)=>zerr.warn(`${_this.ws}: ${str}: ${vfd}-${zerr.e2s(e)}`);let pending,zfin_pending,send_ack_timeout,send_ack_ts=0;const stream=new _lib.Duplex(assign({read(size){},write(data,encoding,cb){const{buf,buf_pending}=stream.process_data(data);if(buf){if(!_this.ws.send(buf))return cb(new Error(_this.ws.reason||_this.ws.status));stream.sent+=buf.length-vfd_sz;stream.last_use_ts=Date.now()}if(zerr.is.debug()){zerr.debug(`${_this.ws}> vfd ${vfd} sent ${stream.sent}`+` ack ${stream.ack} win_size ${stream.win_size}`)}if(!buf_pending)return void cb();pending=etask((function*_ws_mux_pending(){yield this.wait();pending=null;stream._write(buf_pending,encoding,cb)}))},destroy(err,cb){return etask((function*_ws_mux_destroy(){if(stream.zdestroy){yield this.wait_ext(stream.zdestroy);return next_tick(cb,err)}stream.zdestroy=this;stream.prependListener("error",(()=>{if(stream._writableState)stream._writableState.errorEmitted=true}));yield zfinish(true,false);try{stream.push(null)}catch(e){zerr.notice("DEBUG RECURSIVE DESTROY "+e)}stream.emit("_close");next_tick(cb,err)}))}},opt));stream.allow=size=>{if(stream.win_size_got)return;stream.win_size=size||Infinity;if(!size&&_this.ws.zc)zcounter.inc("mux_legacy_allow_call")};stream.process_data=data=>{let bytes=Math.min(stream.win_size-(stream.sent-stream.ack),data.length);if(bytes<=0)return{buf_pending:data};const buf=Buffer.allocUnsafe(bytes+vfd_sz);buf.writeUInt32BE(vfd,0);buf.writeUInt32BE(0,4);data.copy(buf,vfd_sz,0,bytes);if(bytes==data.length)return{buf};const buf_pending=Buffer.allocUnsafe(data.length-bytes);data.copy(buf_pending,0,bytes);return{buf,buf_pending}};const zfinish=(end_write,wait_rmt)=>etask((function*_zfinish(){if(stream.zfin)return yield this.wait_ext(stream.zfin);stream.zfin=this;zerr.info(`${_this.ws}:vfd:${vfd}:zfin:${end_write}:${wait_rmt}`);if(end_write&&(!stream._writableState||!stream._writableState.finished)){if(pending)pending.continue();stream.once("finish",this.continue_fn());try{yield this.wait(opt.fin_timeout/2)}catch(e){w_log(e,"fin_wait");stream.end();try{yield this.wait(opt.fin_timeout/2)}catch(e2){w_log(e2,"fin_wait2")}}}if(pending&&!etask.is_final(pending)){try{pending.return();pending=null}catch(e){w_log(e,"destroy write pending")}stream.emit("error",new Error("Fail to write pending data"))}stream.send_fin();if(wait_rmt){try{yield zfin_pending=this.wait(opt.fin_timeout)}catch(e){w_log(e,"zfin_pending")}}if(stream.destroy)stream.destroy()}));stream.create_ts=Date.now();stream.win_size=default_win_size;stream.sent=stream.ack=stream.zread=0;stream.prependListener("finish",(()=>zfinish(false,true)));stream.prependListener("data",(function(chunk){this.zread+=chunk.length;this.send_ack();this.last_use_ts=Date.now();if(!this._httpMessage||this.parser&&this.parser.socket===this||is_rn){return}const{parsers}=require("_http_common");const _stacktrace=(new Error).stack;zcounter.inc(`mux_ack_no_parser`);zerr("\n--- assert failed, socketinfo:\n"+`DEBUG HEADER: ${this._httpMessage._header}\n`+`DEBUG mux.open(): ${_stacktrace}\n`+`DEBUG WS: ${_this.ws.remote_addr}:${_this.ws.remote_port}`);const old_parser=this.parser;const parser=this.parser=parsers.alloc();const old_execute=parser.execute;parser.socket=this;parser.execute=buf=>{parser.execute=old_execute;this.parser=old_parser;return new Error("Mux Duplex parser removed before data "+"consumed")}}));const throttle_ack=+opt.throttle_ack;const _send_ack=()=>{_this.ws.json({vfd,ack:stream.zread});send_ack_ts=Date.now()};stream.send_ack=!throttle_ack?_send_ack:()=>{if(send_ack_timeout)return;const delta=Date.now()-send_ack_ts;if(delta>=throttle_ack)return _send_ack();send_ack_timeout=setTimeout((()=>{send_ack_timeout=null;_send_ack()}),throttle_ack-delta)};stream.on_ack=ack=>{stream.ack=ack;if(pending)pending.continue()};stream.send_win_size=()=>{if(stream.win_size_sent)return;_this.ws.json({vfd,win_size:opt.win_size||default_win_size});stream.win_size_sent=true};stream.on_win_size=size=>{stream.win_size=size;stream.win_size_got=true;if(pending)pending.continue()};stream.send_fin=()=>{_this.ws.json({vfd,fin:1})};stream.on_fin=()=>{const fn=()=>next_tick((()=>zfin_pending?zfin_pending.continue():zfinish(true,false)));etask((function*_ws_mux_stream_destroy(){stream.once("end",this.continue_fn());try{stream.push(null);if(stream._readableState&&stream._readableState.ended)return fn();yield this.wait(opt.fin_timeout)}catch(e){w_log(e,"ending")}fn()}))};stream.on("_close",(()=>{if(!this.streams.delete(vfd))return;zerr.info(`${this.ws}: vfd ${vfd} closed`);if(this.ws.zc)zcounter.inc_level(`level_${this.ws.zc}_mux_ack_vfd`,-1)}));this.streams.set(vfd,stream);zerr.info(`${this.ws}: vfd ${vfd} open`);if(this.ws.zc)zcounter.inc_level(`level_${this.ws.zc}_mux_ack_vfd`,1);return stream}close(vfd){let stream=this.streams.get(vfd);if(!stream)return false;if(stream.destroy)stream.destroy();else{stream.push(null);stream.end();stream.emit("_close")}return true}remote_write_pause(id){const stream=this.streams.get(id);if(!stream||stream.remote_write_paused)return;this.ws.json({stream_id:id,backpressure_cmd:"write_pause",log:this.backpressuring.log});stream.remote_write_paused=true;if(this.ws.zc)zcounter.inc("mux_remote_write_pause")}remote_write_resume(id){const stream=this.streams.get(id);if(!stream||!stream.remote_write_paused)return;this.ws.json({stream_id:id,backpressure_cmd:"write_resume",log:this.backpressuring.log});stream.remote_write_paused=false;if(this.ws.zc)zcounter.inc("mux_remote_write_resume")}_on_bin(buf){if(buf.length<vfd_sz)return zerr(`${this.ws}: malformed binary message`);let vfd=buf.readUInt32BE(0);if(zerr.is.debug())zerr.debug(`${this.ws}< vfd ${vfd}`);let stream=this.streams.get(vfd);if(!stream)return zerr(`${this.ws}: unexpected stream vfd ${vfd}`);if(stream.on_ack)this._on_bin_ack(stream,buf);else this._on_bin_bp(stream,buf,vfd)}_on_bin_bp(stream,buf,vfd){if(!stream.push(buf.slice(vfd_sz))&&this.backpressuring)this.remote_write_pause(vfd)}_on_bin_ack(stream,buf){stream.send_win_size();stream.push(buf.slice(vfd_sz))}_on_json(msg){if(msg&&msg.backpressure_cmd)this._on_json_bp(msg);else this._on_json_ack(msg)}_on_json_bp(msg){const stream=this.streams.get(msg.stream_id);if(!stream||!msg.backpressure_cmd)return;if(msg.log)zerr.notice(`${this.ws}: ${msg.backpressure_cmd}`);switch(msg.backpressure_cmd){case"write_pause":return stream.allow(0);case"write_resume":return stream.allow()}}_on_json_ack(msg){if(!msg||msg.vfd===undefined)return;const stream=this.streams.get(msg.vfd);if(!stream)return zerr.info(`${this.ws}: unexpected stream ID %O`,msg);if(msg.ack&&stream.on_ack)return void stream.on_ack(msg.ack);if(msg.win_size&&stream.on_win_size)return void stream.on_win_size(msg.win_size);if(msg.fin&&stream.on_fin)return void stream.on_fin();stream.emit("unexpected_ack",msg);zerr(`${this.ws}: unexpected json_ack %O`,msg);if(this.ws.zc)zcounter.inc("mux_unexpected_ack")}_on_disconnected(){let err=new Error(this.ws.reason||"disconnected");for(let stream of this.streams.values()){if(stream.destroy)stream.destroy(err);else{stream.emit("error",err);stream.emit("_close")}}this.streams.clear()}}function lib(impl){if(impl=="ws")return require("ws");if(impl=="uws"&&!is_win&&!is_darwin)return require("uws");zerr.zexit(`WS library ${impl} is not available`)}function client_impl(opt){if(is_rn)return WebSocket;if(!is_node&&!opt.impl)return self.WebSocket;return lib(opt.impl||"ws")}function server_impl(opt){if(!is_node)throw new Error(`WS server is not available`);return lib(opt.impl||(is_win||is_darwin?"ws":"uws")).Server}return{Client,Server,IPC_client,IPC_server,Mux,t:{WS}}}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))})()},4118:module=>{"use strict";module.exports=JSON.parse('{"BUILDTYPE_DEBUG":false,"ZON_VERSION":"1.204.641","_RELEASE":true,"_RELEASE_LEVEL":2}')}}]);
//# sourceMappingURL=https://hola.org/be_source_map/1.204.641/169.bundle.js.map?build=nopeer